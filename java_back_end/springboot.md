# SpringBoot

https://mp.weixin.qq.com/mp/homepage?__biz=Mzg2NTAzMTExNg==&hid=1&sn=3247dca1433a891523d9e4176c90c499&scene=18&uin=&key=&devicetype=Windows+10+x64&version=63030522&lang=zh_CN&ascene=7&fontgear=2

- æœ¬æ–‡æ¡£çš„ä½¿ç”¨é‡ç‚¹ï¼š
  - çœ‹åç«¯ä¸çœ‹å‰ç«¯ï¼ˆæœ¬æ–‡æ¡£è®²çš„å‰åç«¯ä¸åˆ†ç¦»åŸºæœ¬è¢«å‰åç«¯åˆ†ç¦»ä»£æ›¿äº† çœ‹äº†å‰ç«¯ç›¸å…³ä¹Ÿæ²¡å•¥ç”¨ï¼‰
  - çœ‹ä½¿ç”¨ä¸çœ‹æºç ï¼ˆæºç çœ‹äº†å°±å¿˜ ç»“åˆæœ¬æ–‡æ¡£å»ä¼šè®®springçš„å„ç§åŠŸèƒ½å®ç°æ–¹å¼æ‰æ˜¯é‡ç‚¹ï¼‰

## å‰è¨€ç®€ä»‹

### javaå¼€å‘è¿›åŒ–è·¯çº¿å’Œæ ¸å¿ƒç‚¹

javaseï¼šoop

mysqlï¼šæŒä¹…åŒ–

html+css+js+jquery+æ¡†æ¶ï¼šè§†å›¾ï¼Œæ¡†æ¶ä¸ç†Ÿç»ƒï¼Œcssä¸å¥½ï¼›

javawebï¼šç‹¬ç«‹å¼€å‘mvcä¸‰å±‚æ¶æ„çš„ç½‘ç«™ï¼šåŸå§‹

ssmï¼šæ¡†æ¶ï¼šç®€åŒ–äº†æˆ‘ä»¬çš„å¼€å‘æµç¨‹ï¼Œé…ç½®ä¹Ÿå¼€å§‹è¾ƒä¸ºå¤æ‚ï¼›

åˆ°æ­¤ä¸ºæ­¢ï¼Œç¨‹åºæ‰“waråŒ…ï¼Œç¨‹åºåœ¨tomcatä¸­è¿è¡Œ



springåœ¨å†ç®€åŒ–ï¼šspringboot-jarï¼šå†…åµŒtomcatï¼›å¾®æœåŠ¡æ¶æ„ï¼

- 20230520æˆ‘ï¼šä¸€ä¸ªspringbootæ˜¯å•ä½“å§ï¼Œspringcloudæ‰æ˜¯å¾®æœåŠ¡ï¼ˆå¤šä¸ªspringbootå®ç°ä¸åŒåŠŸèƒ½å¹¶é€šè¿‡zkåšæœåŠ¡æ³¨å†Œä¸å‘ç°ä¹Ÿå¯ä»¥ç®—å¾®æœåŠ¡å§ï¼‰ã€‚ssmçš„waråŒ…ä¸­æ²¡æœ‰å®¹å™¨ï¼Œæ‰€ä»¥éœ€è¦æ”¾åˆ°tomcatä¸­å»è¿è¡Œï¼›springbootæ‰“åŒ…å¾—åˆ°çš„jaråŒ…ä¸­è‡ªå¸¦tomcatå®¹å™¨ï¼Œæ‰€ä»¥ç”¨`java -jar`å°±å¯ä»¥åœ¨linuxä¸­æŠŠé¡¹ç›®è·‘èµ·æ¥ã€‚

æœåŠ¡è¶Šæ¥è¶Šå¤šï¼šspringcloudï¼›



### springboot+springcloudæŠ€æœ¯æ ‘

springbootæœ€æ ¸å¿ƒçš„ç‚¹ï¼šè‡ªåŠ¨è£…é…ï¼ˆé‡è¦ï¼Œè°ˆèµ„ï¼‰

- 20230520æˆ‘ï¼šå®é™…ä¸Šå°±æ˜¯å¯åŠ¨æ—¶ï¼Œé€šè¿‡`@AutoConfig`è‡ªåŠ¨åŠ è½½äº†å¾ˆå¤šé…ç½®ç±»

springSecurityï¼šshiroï¼ˆä½¿ç”¨äº†aopçš„æ€æƒ³ï¼‰

![image-20210817114244104](springboot.assets/image-20210817114244104.png)



### è€å¸ˆçš„åŒºåˆ«

åŸ¹è®­è®²å¸ˆ

- é¢å‘é¢è¯•åŸ¹è®­ï¼Œæ•™ä½ å¦‚ä½•ä½¿ç”¨ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼

åšæ•™è‚²çš„

- å¦‚ä½•å­¦ä¹ æ–°ä¸œè¥¿ï¼Œå¦‚ä½•æŒç»­å­¦ä¹ ï¼Œå¦‚ä½•å…³æ³¨è¿™ä¸ªè¡Œä¸šï¼
- æ¥é¾™å»è„‰ï¼Œå†å²ï¼Œç†è®ºï¼›è°ˆèµ„

åŒç†ï¼Œé¢†å¯¼å’Œé¡¹ç›®ç»ç†ä¹Ÿæœ‰åŒºåˆ«ã€‚å¦‚æœé¢†å¯¼ä¸èƒ½å¸¦è¿›æ­¥ï¼Œé‚£ä¹ˆå…¬å¸å¾…ä¸€ä¸¤å¹´æ··ä¸ªç»éªŒå°±å¯ä»¥æºœäº†ã€‚ä¸ç„¶å®¹æ˜“stuckåœ¨å…¬å¸ï¼Œç„¶å30å²è¿˜æ˜¯ç¨‹åºå‘˜ï¼Œæœ€åè¢«æ·˜æ±°ã€‚æ‰€ä»¥åšäººè¦æœ‰ç›®æ ‡ã€‚



### èŠèŠSpringboot

#### çº¦å®šå¤§äºé…ç½®

è¶Šæ˜¯ç®€å•çš„ä¸œè¥¿è¯´æ˜å¾ˆå¤šä¸œè¥¿å·²ç»é…å¥½äº†ï¼Œè¿™æ—¶å€™å°±å¾—æŒ‰ç…§çº¦å®šå»åšï¼Œå¦åˆ™æ— æ³•è¿è¡Œã€‚ç¬¬ä¸€æ¬¡å¬è§â€œçº¦å®šå¤§äºé…ç½®â€æ˜¯åœ¨Mavené‡Œï¼Œå› ä¸ºmavençš„é¡¹ç›®æ¶æ„å›ºå®šçš„ï¼›åé¢springï¼Œspringmvcï¼Œspringbootï¼Œ....dockerï¼Œk8s éƒ½æ˜¯çº¦å®šå¤§äºé…ç½®ã€‚

#### è½¯ä»¶å·¥ç¨‹å¸ˆvsç å†œ

è½¯ä»¶å·¥ç¨‹å¸ˆå†™çš„ç¨‹åº=æ•°æ®ç»“æ„+ç®—æ³•ï¼ˆé›†åˆæ¡†æ¶ï¼‰

ç å†œå†™çš„ç¨‹åº=é¢å‘å¯¹è±¡+æ¡†æ¶



æˆ‘ä¸»å¯¼é¢è¯•å®˜ 20kï¼šèŠå¤©ï¼ŒæŠŠé¢è¯•å®˜èŠåˆ°ä¸æ•¢é—®äº†ã€‚

é¢è¯•å®˜ä¸»å¯¼ä½  7kï¼šæ²¡å¾—èŠã€‚



#### é¢è¯•å®˜é—®

è‡ªåŠ¨è£…é…ï¼š

é¢è¯•å®˜é—®ä½ ä½ å¯ä»¥è¿™æ ·è¯´,springbootæ˜¯é€šè¿‡mainæ–¹æ³•ä¸‹çš„SpringApplication.runæ–¹æ³•å¯åŠ¨çš„,å¯åŠ¨çš„æ—¶å€™ä»–ä¼šè°ƒç”¨refshContextæ–¹æ³•,å…ˆåˆ·æ–°å®¹å™¨,ç„¶åæ ¹æ®è§£ææ³¨è§£æˆ–è€…è§£æé…ç½®æ–‡ä»¶çš„å½¢å¼ç¥–å†Œbean,è€Œå®ƒæ˜¯é€šè¿‡å¯åŠ¨ç±»çš„SpringBootApplicationæ³¨è§£è¿›è¡Œå¼€å§‹è§£æçš„,ä»–ä¼šæ ¹æ®EnableAutoConfigurationå¼€å¯è‡ªåŠ¨åŒ–é…ç½®,é‡Œé¢æœ‰ä¸ªæ ¸å¿ƒæ–¹æ³•ImportSelecté€‰æ‹©æ€§çš„å¯¼å…¥,æ ¹æ®loadFanctoryNamesæ ¹æ®classpashè·¯å¾„ä»¥MATA-INF/spring.factorcesä¸‹é¢ä»¥ä»€ä¹ˆä»€ä¹ˆEnableAutoConfigurationå¼€å¤´çš„keyå»åŠ è½½é‡Œé¢æ‰€æœ‰å¯¹åº”çš„è‡ªåŠ¨åŒ–é…ç½®,ä»–å¹¶ä¸æ˜¯æŠŠè¿™ä¸€ç™¾äºŒåå¤šä¸ªè‡ªåŠ¨åŒ–é…ç½®å…¨éƒ¨å¯¼å…¥,åœ¨ä»–æ¯ä¸ªè‡ªåŠ¨åŒ–é…ç½®é‡Œé¢éƒ½æœ‰æ¡ä»¶åˆ¤æ–­æ³¨è§£,å…ˆåˆ¤æ–­æ˜¯å¦å¼•å…¥ç›¸äº’çš„jaråŒ…,å†åˆ¤æ–­å®¹å™¨æ˜¯å¦æœ‰beanå†è¿›è¡Œæ³¨å…¥åˆ°beanå®¹å™¨



### å¾®æœåŠ¡

#### å•ä½“æ¶æ„

æ‰€è°“å•ä½“æ¶æ„ï¼ˆall in oneï¼‰æ˜¯æŒ‡ï¼Œå°†ä¸€ä¸ªåº”ç”¨ä¸­çš„æ‰€æœ‰åº”ç”¨æœåŠ¡å°è£…åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ã€‚

æ— è®ºERPï¼ŒCRMæˆ–è€…å…¶ä»–ä»€ä¹ˆç³»ç»Ÿï¼Œä½ éƒ½æŠŠæ•°æ®åº“è®¿é—®ï¼Œwebè®¿é—®ï¼Œç­‰åŠŸèƒ½æ”¾åˆ°ä¸€ä¸ªwaråŒ…å†…ã€‚

ä¼˜ç‚¹ï¼š

- æ˜“äºå¼€å‘å’Œæµ‹è¯•ï¼Œéœ€è¦æ‰©å±•æ˜¯éœ€è¦warå¤åˆ¶å¤šåˆ†æ”¾åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œåšä¸ªè´Ÿè½½å‡è¡¡å³å¯ã€‚

ç¼ºç‚¹ï¼š

- **ä¿®æ”¹ä¸€ä¸ªå°åœ°æ–¹è¦æš‚åœæ•´ä¸ªæœåŠ¡ï¼Œä¸é€‚åˆå¤§å‹é¡¹ç›®ã€‚**

  

#### å¾®æœåŠ¡æ¶æ„

åç«¯æœ‰mvcä¸‰å±‚æ¶æ„ï¼Œå‰ç«¯æœ‰mvvmæ¶æ„ï¼Œspringbootå¯¹åº”å¾®æœåŠ¡æ¶æ„ã€‚

æ¡†æ¶æ¼”è¿›å›¾ç‰‡å¦‚ä¸‹ï¼ˆæºè‡ªdubboå®˜ç½‘ï¼‰ï¼š

![image-20210817151343376](springboot.assets/image-20210817151343376.png)



**å¿…è¯»ï¼š**

**martinå¤§ä½¬çš„[è®ºæ–‡](https://martinfowler.com/articles/microservices.html)**ï¼Œè¯¦ç»†è¯´äº†å¾®æœåŠ¡æ€è·¯äº§ç”Ÿçš„åŸå› ã€‚[ç¿»è¯‘](https://blog.csdn.net/weixin_42236165/article/details/92979025)



åŸæ¥ä¸åŒæ¨¡å—åœ¨ä¸€ä¸ªwaråŒ…ä¸­ï¼ŒæŠŠwaråŒ…æ”¾åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šå¹¶è´Ÿè½½å‡è¡¡ï¼›ç°åœ¨æŠŠæ¯ä¸ªåŠŸèƒ½ï¼ˆæ¥å£çš„æ¦‚å¿µï¼‰å•ç‹¬æ‹å‡ºæ¥åšä¸€ä¸ªæ¨¡å—ï¼Œéœ€è¦æœåŠ¡æ—¶æŠŠå„åŠŸèƒ½æ¨¡å—ç»„åˆåº”ç”¨

![image-20210817153058890](springboot.assets/image-20210817153058890.png)



å¥½å¤„ï¼š

- èŠ‚çœäº†è°ƒç”¨èµ„æº
- æ¯ä¸ªåŠŸèƒ½å…ƒç´ çš„æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå¯æ›¿æ¢çš„ï¼Œå¯ç‹¬ç«‹å‡çº§çš„è½¯ä»¶ä»£ç ã€‚



#### å¦‚ä½•æ„å»ºå¾®æœåŠ¡

ä¸€ä¸ªå¤§å‹çš„å¾®æœåŠ¡æ¶æ„ï¼Œå°±åƒä¸€ä¸ªå¤æ‚äº¤ç»‡çš„ç¥ç»ç½‘ç»œï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒå°±æ˜¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ ï¼Œä»–ä»¬å„è‡ªå®Œæˆè‡ªå·±çš„åŠŸèƒ½ï¼Œç„¶åé€šè¿‡httpäº’ç›¸è¯·æ±‚è°ƒç”¨ã€‚

è¿™ç§åºå¤§çš„ç³»ç»Ÿæ¶æ„ç»™éƒ¨ç½²å’Œè¿ç»´å¸¦æ¥å¾ˆå¤§çš„éš¾åº¦ã€‚äºæ˜¯springä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ„å»ºå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡çš„**å…¨å¥—-å…¨ç¨‹**äº§å“ï¼š

- æ„å»ºä¸€ä¸ªä¸ªåŠŸèƒ½ç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨å•å…ƒï¼Œå¯ä»¥ä½¿ç”¨springbootï¼Œå¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿæ„å»ºä¸€ä¸ªåº”ç”¨
- å¤§å‹åˆ†å¸ƒå¼ç½‘ç»œæœåŠ¡çš„è°ƒç”¨ï¼Œè¿™éƒ¨åˆ†ç”±spring cloudæ¥å®Œæˆï¼Œå®ç°åˆ†å¸ƒå¼ï¼›
- åœ¨åˆ†å¸ƒå¼ä¸­é—´ï¼Œè¿›è¡Œæµå¼æ•°æ®è®¡ç®—ï¼Œæ‰¹å¤„ç†ï¼Œæˆ‘ä»¬æœ‰spring cloud data flow

Springä¸ºæˆ‘ä»¬æƒ³æ¸…æ¥šäº†æ•´ä¸ªä»å¼€å§‹æ„å»ºåº”ç”¨åˆ°å¤§å‹åˆ†å¸ƒå¼åº”ç”¨å…¨æµç¨‹çš„æ–¹æ¡ˆã€‚

![image-20210817154120882](springboot.assets/image-20210817154120882.png)

ä½¿ç”¨å¾®æœåŠ¡æ‰€æ„å»ºçš„å„ä¸ªåº”ç”¨çš„ç›®æ ‡ï¼Œéƒ½æ˜¯å°½å¯èƒ½åœ°å®ç°â€œé«˜å†…èšå’Œä½è€¦åˆâ€



## ç¬¬ä¸€ä¸ªSpringBootç¨‹åº

å¾ˆç®€å•ã€‚

ç¯å¢ƒï¼š

- jdk1.8
- maven 3.6.1
- springboot æœ€æ–°ç‰ˆ
- IDEA

Springå®˜æ–¹ï¼šæä¾›äº†ä¸€ä¸ªå¿«é€Ÿç”Ÿæˆçš„ç½‘ç«™ï¼IDEAé›†æˆäº†è¿™ä¸ªç½‘ç«™ã€‚ä¸‹é¢å±•ç°å®Œæ•´åˆ›å»ºè¿‡ç¨‹ã€‚

### å®ä¾‹

æ–°å»ºé¡¹ç›®

![image-20210822112016059](springboot.assets/image-20210822112016059.png)

![image-20210822112120658](springboot.assets/image-20210822112120658.png)

è¿™ä¸ªé¡µé¢çš„é€‰é¡¹å’Œspringå®˜ç½‘çš„é¡µé¢é€‰é¡¹ä¸€æ¨¡ä¸€æ ·ï¼Œæ˜¯ä»Springå®˜ç½‘å¯¼å…¥çš„

![image-20210822112345224](springboot.assets/image-20210822112345224.png)

å‹¾é€‰spring webä¾èµ–

![image-20210822112523448](springboot.assets/image-20210822112523448.png)

![image-20210822112558740](springboot.assets/image-20210822112558740.png)

åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼ˆæˆªå›¾ä¸­é€‰ä¸­äº†ï¼‰

![image-20210822113458263](springboot.assets/image-20210822113458263.png)

åˆ é™¤ç”¨ä¸ç€çš„æ–‡ä»¶åï¼Œé¡¹ç›®ç»“æ„å˜å¾—å¾ˆç†Ÿæ‚‰ï¼ˆimlæ–‡ä»¶æš‚æ—¶ç”¨æ³•ä¸æ˜ï¼Œå…ˆä¸ç®¡ï¼‰

![image-20210822113533580](springboot.assets/image-20210822113533580.png)

è‡ªåŠ¨ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è®²è§£å¦‚ä¸‹ï¼ˆè¿˜æœ‰pom.xmlï¼‰

![image-20210822114434862](springboot.assets/image-20210822114434862.png)

åˆ†æideaè‡ªåŠ¨ç”Ÿæˆçš„pomï¼Œæ·»åŠ æ³¨é‡Šï¼Œå¹¶æ”¾åœ¨ä¸‹é¢

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.5.4</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.zhangyk</groupId>
    <artifactId>boothelloworld</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>boothelloworld</name>
    <description>Demo project for Spring Boot</description>
    <properties>
        <java.version>1.8</java.version>
    </properties>
    <dependencies>
        <!-- spring-boot-starter æ‰€æœ‰çš„springbootä¾èµ–éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªå¼€å¤´çš„-->

        <!--webä¾èµ–ï¼šé›†æˆtomcatï¼ŒdispatcherServletï¼Œxmlã€‚ã€‚ã€‚-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <!--å•å…ƒæµ‹è¯•-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>
```

åœ¨ä¸»åº”ç”¨ç¨‹åºapplicationçš„åŒçº§ç›®å½•ä¸‹ï¼Œå»ºåŒ…å†™é¡¹ç›®ã€‚å»ºåœ¨åˆ«çš„åœ°æ–¹ç³»ç»Ÿå¯èƒ½æ‰«æä¸åˆ°

![image-20210822115020163](springboot.assets/image-20210822115020163.png)

ç¼–å†™controllerä½œä¸ºæ¥å£

```java
package com.zhangyk.boothelloworld.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

//è‡ªåŠ¨è£…é…ï¼šåŸç†
@RestController
public class HelloController {

    //æ¥å£ï¼šhttp://localhost:8080/hello
    @RequestMapping("/hello")
    public String hello(){
        //è°ƒç”¨ä¸šåŠ¡ï¼Œæ¥æ”¶å‰ç«¯ä¼ æ¥çš„å‚æ•°
        return "hello,world";
    }
}
```

å¯åŠ¨tomcatå¹¶æµ‹è¯•ï¼ˆå¯èƒ½å› ä¸ºæ˜¯ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæœ¬æ¬¡æœªæ£€æŸ¥tomcatçš„artifactï¼Œæœªæ£€æŸ¥projectstructureä¸­æœ‰æ— libï¼‰ã€‚æˆåŠŸç»™å‰ç«¯é¡µé¢è¿”å›äº†æ•°æ®ã€‚

![image-20210822122111276](springboot.assets/image-20210822122111276.png)

æƒ³æŠŠå½“å‰å¾®æœåŠ¡æ‰“æˆjaråŒ…çš„è¯ï¼Œå¯ä»¥ç”¨mavenä¸­çš„packageæ’ä»¶ã€‚ä¼šç”ŸæˆjaråŒ…ï¼Œè¯¥jaråŒ…åœ¨javaç¯å¢ƒä¸­å¯ä»¥ä¸ä¾æ‰˜ideaç‹¬ç«‹è¿è¡Œã€‚

**![image-20210822122338900](springboot.assets/image-20210822122338900.png)**

å¦‚æœé‡åˆ°ä»¥ä¸‹çš„é”™è¯¯ï¼Œå¯ä»¥é…ç½®æ‰“åŒ…æ—¶ è·³è¿‡é¡¹ç›®è¿è¡Œæµ‹è¯•ç”¨ä¾‹

![image-20210822122811418](springboot.assets/image-20210822122811418.png)

```xml
<!--    åœ¨å·¥ä½œä¸­,å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ‰“åŒ…æ˜¯ä¸æƒ³æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„    å¯èƒ½æ˜¯æµ‹è¯•ç”¨ä¾‹ä¸å®Œäº‹,æˆ–æ˜¯æµ‹è¯•ç”¨ä¾‹ä¼šå½±å“æ•°æ®åº“æ•°æ®    è·³è¿‡æµ‹è¯•ç”¨ä¾‹æ‰§    -->
<plugin>    
    <groupId>org.apache.maven.plugins</groupId>    
    <artifactId>maven-surefire-plugin</artifactId>    
    <configuration>        
        <!--è·³è¿‡é¡¹ç›®è¿è¡Œæµ‹è¯•ç”¨ä¾‹-->        
        <skipTests>true</skipTests>    
    </configuration>
</plugin>
```



### å½©è›‹

#### æ›´æ”¹é¡¹ç›®ç«¯å£å·

åœ¨application.propertiesä¸­æ·»åŠ å¦‚ä¸‹è¯­å¥

```properties
# æ›´æ”¹é¡¹ç›®çš„ç«¯å£å·
server.port=8081
```

å¯åŠ¨tomcatæµ‹è¯•

è®¿é—®8080ä¼šæŠ¥é”™

![image-20210822171357986](springboot.assets/image-20210822171357986.png)

è®¿é—®8081ç«¯å£æˆåŠŸ

![image-20210822171419617](springboot.assets/image-20210822171419617.png)

#### æ›´æ”¹springbootå¯åŠ¨æ—¶æ˜¾ç¤ºå°æ˜¾ç¤ºçš„å›¾æ¡ˆ

è¿™ä¸ªå›¾æ¡ˆä¸€èˆ¬å«åšspringbootçš„banner

è®¿é—®[ç½‘å€](https://www.bootschool.net/ascii)

è‡ªå®šä¹‰å›¾æ¡ˆ

![image-20210822172051644](springboot.assets/image-20210822172051644.png)

ç‚¹å‡»å³ä¾§â€œæ‹·è´ç»“æœâ€ï¼Œåœ¨ideaé¡¹ç›®ä¸­application.propertiesçš„åŒçº§ç›®å½•ä¸‹æ–°å»ºbanner.txt,å¹¶æŠŠå¤åˆ¶çš„å†…å®¹ç²˜å¸–è¿›å»ã€‚

çœ‹è§æ–‡ä»¶å›¾æ ‡æœ‰ä¸€ä¸ªå¼€å…³æŒ‰é’®æ—¶ï¼Œè¯´æ˜banner.txtè¢«springæ­£ç¡®è¯†åˆ«äº†ã€‚

![image-20210822172307758](springboot.assets/image-20210822172307758.png)

è¿è¡Œtomcatï¼Œå‘ç°æ§åˆ¶å°æ‰“å°çš„æ˜¯æˆ‘ä»¬è®¾ç½®çš„å›¾æ¡ˆ

![image-20210822172459389](springboot.assets/image-20210822172459389.png)



#### æ€»ç»“

å¾ˆç¥å¥‡ï¼Œæ²¡æœ‰è¿‡å¤šé…ç½®ï¼Œå°±å¯ä»¥æ›´æ”¹é¡¹ç›®ç«¯å£å·ï¼Œæ›´æ”¹é¡¹ç›®çš„bannerã€‚çŒœæµ‹æ˜¯springbootçº¦å®šå¤§äºé…ç½®åŸåˆ™ä¸‹ï¼Œspringbootå·²ç»é…ç½®å¥½äº†å¾ˆå¤šä¸œè¥¿ã€‚



## åŸç†åˆæ¢

å¯¹springbootçš„è‡ªåŠ¨é…ç½®åšå¦‚ä¸‹æ¢è®¨ã€‚

### pom.xml

çˆ¶ä¾èµ–ï¼š

å…¶ä¸­å®ƒä¸»è¦æ˜¯ä¾èµ–ä¸€ä¸ªçˆ¶é¡¹ç›®ï¼Œä¸»è¦æ˜¯ç®¡ç†é¡¹ç›®çš„èµ„æºè¿‡æ»¤åŠæ’ä»¶ï¼

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.2.5.RELEASE</version>
    <relativePath/> <!-- lookup parent from repository -->
</parent>
```

ç‚¹è¿›å»ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªçˆ¶ä¾èµ–

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-dependencies</artifactId>
    <version>2.2.5.RELEASE</version>
    <relativePath>../../spring-boot-dependencies</relativePath>
</parent>
```

è¿™é‡Œæ‰æ˜¯çœŸæ­£ç®¡ç†SpringBootåº”ç”¨é‡Œé¢æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬çš„åœ°æ–¹ï¼ŒSpringBootçš„ç‰ˆæœ¬æ§åˆ¶ä¸­å¿ƒï¼›

**ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬ï¼›ä½†æ˜¯å¦‚æœå¯¼å…¥çš„åŒ…æ²¡æœ‰åœ¨ä¾èµ–ä¸­ç®¡ç†ç€å°±éœ€è¦æ‰‹åŠ¨é…ç½®ç‰ˆæœ¬äº†ï¼›**

- 20230520æˆ‘ï¼šä¸€èˆ¬é¡¹ç›®é‡Œæ²¡æ³¨æ„ç”¨åˆ°è¿™ä¸ªçˆ¶ä¾èµ–ï¼Œæ²¡åˆ»æ„è®¾ç½®è¿‡ï¼›ä¸€èˆ¬éƒ½æ˜¯ç”¨ä»€ä¹ˆä¾èµ–å¾€pomä¸­å¤åˆ¶ä»€ä¹ˆã€‚

### å¯åŠ¨å™¨

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
</dependency>
```

**springboot-boot-starter-xxx**ï¼šå°±æ˜¯spring-bootçš„åœºæ™¯å¯åŠ¨å™¨

**spring-boot-starter-web**ï¼šå¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ï¼›

SpringBootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„starter ï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿™äº›starterå³å¯ï¼Œæ‰€æœ‰ç›¸å…³çš„ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ ï¼Œ æˆ‘ä»¬è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆæ ·çš„åœºæ™¯å¯åŠ¨å™¨å³å¯ ï¼›æˆ‘ä»¬æœªæ¥ä¹Ÿå¯ä»¥è‡ªå·±è‡ªå®šä¹‰ starterï¼›



### ä¸»å¯åŠ¨ç±»

```java
package com.zhangyk.boothelloworld;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

//å¯åŠ¨ç±»æœ¬èº«å°±æ˜¯springçš„ä¸€ä¸ªç»„ä»¶ï¼ˆcomponentï¼‰

/*ç¨‹åºçš„ä¸»å…¥å£
*
* @SpringBootApplication:æ ‡æ³¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªspringbootçš„åº”ç”¨
* */
@SpringBootApplication
public class BoothelloworldApplication {

    public static void main(String[] args) {
        //å°†springbootåº”ç”¨å¯åŠ¨
        /*
        ä¸‹é¢è¿™è¡Œä»£ç æœ‰ä¸¤ä¸ªé‡ç‚¹ï¼š
        springapplicationç±»
        runæ–¹æ³•
        */
        SpringApplication.run(BoothelloworldApplication.class, args);
    }

}
```

ä½†æ˜¯**ä¸€ä¸ªç®€å•çš„å¯åŠ¨ç±»å¹¶ä¸ç®€å•ï¼**æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™äº›æ³¨è§£éƒ½å¹²äº†ä»€ä¹ˆ

#### @SpringBootApplication

ä½œç”¨ï¼šæ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±» ï¼Œ SpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ï¼›

è¿›å…¥è¿™ä¸ªæ³¨è§£ï¼šå¯ä»¥çœ‹åˆ°ä¸Šé¢è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ³¨è§£ï¼

```java
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
), @Filter(
    type = FilterType.CUSTOM,
    classes = {AutoConfigurationExcludeFilter.class}
)}
)
public @interface SpringBootApplication {
    // ......
}
```

##### @ComponentScan

è¿™ä¸ªæ³¨è§£åœ¨Springä¸­å¾ˆé‡è¦ ,å®ƒå¯¹åº”XMLé…ç½®ä¸­çš„å…ƒç´ ã€‚

ä½œç”¨ï¼šè‡ªåŠ¨æ‰«æå¹¶åŠ è½½ç¬¦åˆæ¡ä»¶çš„ç»„ä»¶æˆ–è€…bean ï¼Œ å°†è¿™ä¸ªbeanå®šä¹‰åŠ è½½åˆ°IOCå®¹å™¨ä¸­

##### @SpringBootConfiguration

ä½œç”¨ï¼šSpringBootçš„é…ç½®ç±» ï¼Œæ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Š ï¼Œ è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªSpringBootçš„é…ç½®ç±»ï¼›

æˆ‘ä»¬ç»§ç»­è¿›å»è¿™ä¸ªæ³¨è§£æŸ¥çœ‹

```java
// ç‚¹è¿›å»å¾—åˆ°ä¸‹é¢çš„ @Component
@Configuration
public @interface SpringBootConfiguration {}

@Component
public @interface Configuration {}
```

- è¿™é‡Œçš„ @Configurationï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±» ï¼Œé…ç½®ç±»å°±æ˜¯å¯ä»¥ä»£æ›¿Springçš„xml é…ç½®æ–‡ä»¶ï¼›

- é‡Œé¢çš„ @Component è¿™å°±è¯´æ˜ï¼Œå¯åŠ¨ç±»æœ¬èº«ä¹Ÿæ˜¯Springä¸­çš„ä¸€ä¸ªç»„ä»¶è€Œå·²ï¼Œè´Ÿè´£å¯åŠ¨åº”ç”¨ï¼

  @Componentçš„ä½œç”¨å°±æ˜¯å®ç°beançš„æ³¨å…¥ã€‚

  webå¼€å‘ï¼Œæä¾›3ä¸ª@Componentæ³¨è§£è¡ç”Ÿæ³¨è§£ï¼ˆåŠŸèƒ½ä¸€æ ·ï¼‰å–ä»£@Componentï¼š

  - @Repository(â€œåç§°â€)ï¼šdaoå±‚
    - æˆ‘ï¼šä¸€èˆ¬ä½¿ç”¨`@Mapper`å»æ³¨å†Œdaoå±‚çš„beanï¼Œæ¯”@Repositoryæ›´æ–¹ä¾¿ï¼›å¹¶ä¸”@Autowiredç±»ä¼¼@Resourceï¼Œä¸è¿‡æˆ‘ä¸ªäººåŸºæœ¬éƒ½ç”¨@Autowiredï¼›[å‚è€ƒ](https://blog.csdn.net/yuanyuan11111111/article/details/114406210)ã€‚
  - @Service(â€œåç§°â€)ï¼šserviceå±‚
  - @Controller(â€œåç§°â€)ï¼šwebå±‚

æˆ‘ä»¬å›åˆ° SpringBootApplication æ³¨è§£ä¸­ç»§ç»­çœ‹ã€‚

##### @EnableAutoConfiguration

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {...}
```

@EnableAutoConfiguration ï¼šå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½

ä»¥å‰æˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®çš„ä¸œè¥¿ï¼Œè€Œç°åœ¨SpringBootå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½® ï¼›@EnableAutoConfigurationå‘Šè¯‰SpringBootå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œè¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›

ç‚¹è¿›æ³¨è§£æ¥ç»­æŸ¥çœ‹ï¼š

###### @AutoConfigurationPackage

@AutoConfigurationPackage ï¼šè‡ªåŠ¨é…ç½®åŒ…

```java
@Import({Registrar.class})
public @interface AutoConfigurationPackage {}
```

###### @import

Springåº•å±‚æ³¨è§£@import ï¼Œ ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶

Registrar.class ä½œç”¨ï¼šå°†ä¸»å¯åŠ¨ç±»çš„æ‰€åœ¨åŒ…åŠåŒ…ä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Springå®¹å™¨ ï¼›

è¿™ä¸ªåˆ†æå®Œäº†ï¼Œé€€åˆ°ä¸Šä¸€æ­¥ï¼Œç»§ç»­çœ‹

###### @Import({AutoConfigurationImportSelector.class}) 

@Import({AutoConfigurationImportSelector.class}) ï¼šç»™å®¹å™¨å¯¼å…¥ç»„ä»¶ ï¼›

AutoConfigurationImportSelector ï¼šè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ï¼Œé‚£ä¹ˆå®ƒä¼šå¯¼å…¥å“ªäº›ç»„ä»¶çš„é€‰æ‹©å™¨å‘¢ï¼Ÿæˆ‘ä»¬ç‚¹å‡»å»è¿™ä¸ªç±»çœ‹æºç ï¼š

1ã€è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•

 ```java
 // è·å¾—å€™é€‰çš„é…ç½®
 protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
     //è¿™é‡Œçš„getSpringFactoriesLoaderFactoryClassï¼ˆï¼‰æ–¹æ³•
     //è¿”å›çš„å°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çœ‹çš„å¯åŠ¨è‡ªåŠ¨å¯¼å…¥é…ç½®æ–‡ä»¶çš„æ³¨è§£ç±»ï¼›EnableAutoConfiguration
     List<String> configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());
     Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.");
     return configurations;
 }
 ```

2ã€è¿™ä¸ªæ–¹æ³•åˆè°ƒç”¨äº†  SpringFactoriesLoader ç±»çš„é™æ€æ–¹æ³•ï¼æˆ‘ä»¬è¿›å…¥SpringFactoriesLoaderç±»loadFactoryNames() æ–¹æ³•

```java
public static List<String> loadFactoryNames(Class<?> factoryClass, @Nullable ClassLoader classLoader) {
    String factoryClassName = factoryClass.getName();
    //è¿™é‡Œå®ƒåˆè°ƒç”¨äº† loadSpringFactories æ–¹æ³•
    return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());
}
```

3ã€æˆ‘ä»¬ç»§ç»­ç‚¹å‡»æŸ¥çœ‹ loadSpringFactories æ–¹æ³•

```java

private static Map<String, List<String>> loadSpringFactories(@Nullable ClassLoader classLoader) {
    //è·å¾—classLoader ï¼Œ æˆ‘ä»¬è¿”å›å¯ä»¥çœ‹åˆ°è¿™é‡Œå¾—åˆ°çš„å°±æ˜¯EnableAutoConfigurationæ ‡æ³¨çš„ç±»æœ¬èº«
    MultiValueMap<String, String> result = (MultiValueMap)cache.get(classLoader);
    if (result != null) {
        return result;
    } else {
        try {
            //å»è·å–ä¸€ä¸ªèµ„æº "META-INF/spring.factories"
            Enumeration<URL> urls = classLoader != null ? classLoader.getResources("META-INF/spring.factories") : ClassLoader.getSystemResources("META-INF/spring.factories");
            LinkedMultiValueMap result = new LinkedMultiValueMap();

            //å°†è¯»å–åˆ°çš„èµ„æºéå†ï¼Œå°è£…æˆä¸ºä¸€ä¸ªProperties
            while(urls.hasMoreElements()) {
                URL url = (URL)urls.nextElement();
                UrlResource resource = new UrlResource(url);
                Properties properties = PropertiesLoaderUtils.loadProperties(resource);
                Iterator var6 = properties.entrySet().iterator();

                while(var6.hasNext()) {
                    Entry<?, ?> entry = (Entry)var6.next();
                    String factoryClassName = ((String)entry.getKey()).trim();
                    String[] var9 = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());
                    int var10 = var9.length;

                    for(int var11 = 0; var11 < var10; ++var11) {
                        String factoryName = var9[var11];
                        result.add(factoryClassName, factoryName.trim());
                    }
                }
            }

            cache.put(classLoader, result);
            return result;
        } catch (IOException var13) {
            throw new IllegalArgumentException("Unable to load factories from location [META-INF/spring.factories]", var13);
        }
    }
}
```

4ã€å‘ç°ä¸€ä¸ªå¤šæ¬¡å‡ºç°çš„æ–‡ä»¶ï¼šspring.factoriesï¼Œå…¨å±€æœç´¢å®ƒ

æˆ‘ä»¬æ ¹æ®æºå¤´æ‰“å¼€spring.factories ï¼Œ çœ‹åˆ°äº†å¾ˆå¤šè‡ªåŠ¨é…ç½®çš„æ–‡ä»¶ï¼›è¿™å°±æ˜¯è‡ªåŠ¨é…ç½®æ ¹æºæ‰€åœ¨ï¼

META-INF/spring.factoriesï¼šè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ–‡ä»¶ã€‚

æœ¬æœºspring.factoriesçš„ç›®å½•ï¼šD:\software\maven\apache-maven-3.6.1-bin\apache-maven-3.6.1\maven-repo\org\springframework\boot\spring-boot-autoconfigure\2.5.4\spring-boot-autoconfigure-2.5.4.jar!\META-INF\spring.factories

![image-20210822222002333](springboot.assets/image-20210822222002333.png)

5ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„è‡ªåŠ¨é…ç½®ç±»éšä¾¿æ‰¾ä¸€ä¸ªæ‰“å¼€çœ‹çœ‹ï¼Œæ¯”å¦‚ ï¼šWebMvcAutoConfiguration

![image-20210822222358745](springboot.assets/image-20210822222358745.png)

ç‚¹è¿›å»

![image-20210822222505905](springboot.assets/image-20210822222505905.png)

å¯ä»¥çœ‹åˆ°è¿™äº›ä¸€ä¸ªä¸ªçš„éƒ½æ˜¯JavaConfigé…ç½®ç±»ï¼Œè€Œä¸”éƒ½æ³¨å…¥äº†ä¸€äº›Beanï¼Œå¯ä»¥æ‰¾ä¸€äº›è‡ªå·±è®¤è¯†çš„ç±»ï¼Œçœ‹ç€ç†Ÿæ‚‰ä¸€ä¸‹ï¼

æ‰€ä»¥ï¼Œè‡ªåŠ¨é…ç½®çœŸæ­£å®ç°æ˜¯ä»classpathä¸­æœå¯»æ‰€æœ‰çš„META-INF/spring.factoriesé…ç½®æ–‡ä»¶ ï¼Œå¹¶å°†å…¶ä¸­å¯¹åº”çš„ org.springframework.boot.autoconfigure. åŒ…ä¸‹çš„é…ç½®é¡¹ï¼Œé€šè¿‡åå°„å®ä¾‹åŒ–ä¸ºå¯¹åº”æ ‡æ³¨äº† @Configurationçš„JavaConfigå½¢å¼çš„IOCå®¹å™¨é…ç½®ç±» ï¼Œ ç„¶åå°†è¿™äº›éƒ½æ±‡æ€»æˆä¸ºä¸€ä¸ªå®ä¾‹å¹¶åŠ è½½åˆ°IOCå®¹å™¨ä¸­ã€‚



##### ç»“è®º

ä¸»å¯åŠ¨ç±»çš„æ‰§è¡Œæ­¥éª¤ï¼š

1. SpringBootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„META-INF/spring.factoriesä¸­è·å–EnableAutoConfigurationæŒ‡å®šçš„å€¼
2. å°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥å®¹å™¨ ï¼Œ è‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆ ï¼Œ å¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œï¼›ä»¥å‰æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é…ç½®çš„ä¸œè¥¿ï¼Œspringbootå¸®æˆ‘ä»¬åšäº†ã€‚
3. æ•´ä¸ªJ2EEçš„æ•´ä½“è§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨springboot-autoconfigureçš„jaråŒ…ä¸­ï¼›
4. å®ƒä¼šç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±» ï¼ˆxxxAutoConfigurationï¼‰,å°±æ˜¯è¿™äº›ç±»ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ ï¼Œ å¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ ï¼›å¹¶è‡ªåŠ¨é…ç½®ï¼Œ@Configurationï¼Œ@JavaConfig
5. æœ‰äº†è‡ªåŠ¨é…ç½®ç±» ï¼Œ å…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶ç­‰çš„å·¥ä½œï¼›



ç»¼åˆç»“è®ºï¼š

springbootæ‰€æœ‰é…ç½®éƒ½æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™æ‰«æå¹¶åŠ è½½ï¼šspring.factoriesæ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½åœ¨è¿™é‡Œé¢ï¼Œä½†æ˜¯ä¸ä¸€å®šç”Ÿæ•ˆï¼Œè¦åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œåªè¦å¯¼å…¥äº†å¯¹åº”çš„startï¼Œå°±æœ‰äº†å¯¹åº”çš„å¯åŠ¨å™¨ï¼Œæœ‰äº†å¯åŠ¨å™¨ï¼Œæˆ‘ä»¬è‡ªåŠ¨è£…é…å°±ä¼šç”Ÿæ•ˆä»è€Œé…ç½®æˆåŠŸã€‚

- æœ‰ç‚¹iocé‚£å‘³é“ï¼Œå°±æ˜¯æ‰€æœ‰çš„ä¸œè¥¿éƒ½æä¾›ç»™ä½ ï¼Œä½ ä½¿ç”¨ä»€ä¹ˆstarterï¼Œå°±å¯¹åº”ä½¿ä¸€äº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆã€‚



**ç°åœ¨å¤§å®¶åº”è¯¥å¤§æ¦‚çš„äº†è§£äº†ä¸‹ï¼ŒSpringBootçš„è¿è¡ŒåŸç†ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šæ·±åŒ–ä¸€æ¬¡ï¼**



#### SpringApplication.run

ä¸ç®€å•çš„æ–¹æ³•ï¼Œåˆå­¦ç¨å¾®äº†è§£å°±å¥½ã€‚

æœ€åˆä»¥ä¸ºå°±æ˜¯è¿è¡Œäº†ä¸€ä¸ªmainæ–¹æ³•ï¼Œæ²¡æƒ³åˆ°å´å¼€å¯äº†ä¸€ä¸ªæœåŠ¡ã€‚

```java
@SpringBootApplication
public class SpringbootApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringbootApplication.class, args);
    }
}
```

åˆ†æSpringApplication.runä¸»è¦åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯SpringApplicationçš„å®ä¾‹åŒ–ï¼ŒäºŒæ˜¯runæ–¹æ³•çš„æ‰§è¡Œï¼›

##### SpringApplication

è¿™ä¸ªç±»ä¸»è¦åšäº†ä»¥ä¸‹å››ä»¶äº‹æƒ…ï¼š

1ã€**æ¨æ–­**åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®ï¼ˆè¿è¡Œå®Œå°±ç»“æŸï¼‰è¿˜æ˜¯Webé¡¹ç›®ï¼ˆä¸€ç›´ä¿æŒè¿è¡Œï¼‰

2ã€æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ°initializerså±æ€§ä¸­

3ã€æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ°listenerså±æ€§ä¸­

4ã€æ¨æ–­å¹¶è®¾ç½®mainæ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„**ä¸»ç±»**



æŸ¥çœ‹SpringApplicationç±»çš„æ„é€ å™¨ï¼š

```java
public SpringApplication(ResourceLoader resourceLoader, Class... primarySources) {
    // ......
    this.webApplicationType = WebApplicationType.deduceFromClasspath();
    this.setInitializers(this.getSpringFactoriesInstances();
    this.setListeners(this.getSpringFactoriesInstances(ApplicationListener.class));
    this.mainApplicationClass = this.deduceMainApplicationClass();
}
```



##### runæ–¹æ³•æµç¨‹åˆ†æ

![image-20210824105454465](springboot.assets/image-20210824105454465.png)

è·Ÿç€æºç å’Œè¿™å¹…å›¾å°±å¯ä»¥ä¸€æ¢ç©¶ç«Ÿäº†ï¼



### å…³äºSpringbootè°ˆè°ˆç†è§£

- è‡ªåŠ¨è£…é…

- run()
- å…¨é¢æ¥ç®¡springmvcçš„é…ç½®ï¼å®æ“ï¼





## yamlè¯­æ³•è¯¦è§£

springbootå®˜æ–¹æ¨èä½¿ç”¨yamlåšé…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯propertiesã€‚

pomçš„çˆ¶æ–‡ä»¶â€œspring-boot-starter-parent.pomâ€ä¸­å¯ä»¥çœ‹åˆ°æ‰“åŒ…è®¾ç½®ï¼Œä¸ä»…å¯ä»¥æ‰“åŒ…propertiesï¼Œè¿˜èƒ½æ‰“åŒ…yamlã€‚



### é…ç½®æ–‡ä»¶

SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ ï¼Œ é…ç½®æ–‡ä»¶åç§°æ˜¯å›ºå®šçš„ï¼š

- application.properties

- - è¯­æ³•ç»“æ„ ï¼škey=value

- application.yml

- - è¯­æ³•ç»“æ„ ï¼škeyï¼š**ç©ºæ ¼** value



é…ç½®æ–‡ä»¶çš„ä½œç”¨ ï¼š

- ä¿®æ”¹SpringBootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå› ä¸ºSpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½äº†ï¼›



æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹Tomcat é»˜è®¤å¯åŠ¨çš„ç«¯å£å·ï¼æµ‹è¯•ä¸€ä¸‹ï¼

```yaml
server:
  port: 8081
```

æˆåŠŸè§£é™¤æœåŠ¡å™¨ã€‚å› ä¸ºæ²¡æœ‰é»˜è®¤é¡µé¢å±•ç¤ºï¼Œæ‰å‡ºç°whitelabelçš„é”™

![image-20210824123809962](springboot.assets/image-20210824123809962.png)

### yamlæ¦‚è¿°

YAMLæ˜¯ "YAML Ain't a Markup Language" ï¼ˆYAMLä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰çš„é€’å½’ç¼©å†™ã€‚åœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAML çš„æ„æ€å…¶å®æ˜¯ï¼š"Yet Another Markup Language"ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰

è¿™ç§è¯­è¨€**ä»¥æ•°æ®ä½œä¸ºä¸­å¿ƒ**ï¼Œè€Œä¸æ˜¯ä»¥æ ‡è®°è¯­è¨€ä¸ºé‡ç‚¹ï¼



ä»¥å‰çš„é…ç½®æ–‡ä»¶ï¼Œå¤§å¤šæ•°éƒ½æ˜¯ä½¿ç”¨xmlæ¥é…ç½®ï¼›æ¯”å¦‚ä¸€ä¸ªç®€å•çš„ç«¯å£é…ç½®ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸‹yamlå’Œxml

ä¼ ç»Ÿxmlé…ç½®ï¼š

```xml
<server>
    <port>8081<port>
</server>
```

yamlé…ç½®ï¼š

```yaml
serverï¼š
  prot: 8080
```



### yamlåŸºç¡€è¯­æ³•

è¯´æ˜ï¼šè¯­æ³•è¦æ±‚ä¸¥æ ¼ï¼

1ã€**ç©ºæ ¼**ä¸èƒ½çœç•¥

2ã€ä»¥ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼Œåªè¦æ˜¯å·¦è¾¹å¯¹é½çš„ä¸€åˆ—æ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ã€‚

- 20230520æˆ‘ï¼šæœ‰äººè°ƒä¾ƒè¯´ymlçš„å†…å®¹è¦ç”¨æ¸¸æ ‡å¡å°ºå¯¹é½æ‰èƒ½çœ‹æ¸…æ¥šï¼›å…¶å®å¤¸å¼ äº†ï¼Œå› ä¸ºå¯¹é½ä¸æ­£ç¡®çš„keyæ˜¯ç™½è‰²çš„ï¼Œå¾ˆå®¹æ˜“ä¸€çœ¼çœ‹å‡ºã€‚

3ã€å±æ€§å’Œå€¼çš„å¤§å°å†™éƒ½æ˜¯ååˆ†æ•æ„Ÿçš„ã€‚



#### å­—é¢é‡ï¼šæ™®é€šçš„å€¼  [ æ•°å­—ï¼Œå¸ƒå°”å€¼ï¼Œå­—ç¬¦ä¸²  ]

å­—é¢é‡ç›´æ¥å†™åœ¨åé¢å°±å¯ä»¥ ï¼Œ å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸ŠåŒå¼•å·æˆ–è€…å•å¼•å·ï¼›

```
k: v
```

æ³¨æ„ï¼š

- â€œ â€ åŒå¼•å·ï¼Œä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ ï¼Œ ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ï¼›

  æ¯”å¦‚ ï¼šname: "kuang \n shen"  è¾“å‡º ï¼škuang  æ¢è¡Œ  shen

- '' å•å¼•å·ï¼Œä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ ï¼Œ ç‰¹æ®Šå­—ç¬¦æœ€ç»ˆä¼šå˜æˆå’Œæ™®é€šå­—ç¬¦ä¸€æ ·è¾“å‡º

  æ¯”å¦‚ ï¼šname: â€˜kuang \n shenâ€™  è¾“å‡º ï¼škuang  \n  shen



#### å¯¹è±¡ã€Mapï¼ˆé”®å€¼å¯¹ï¼‰

```yaml
#å¯¹è±¡ã€Mapæ ¼å¼
k1: 
    k11: v11
    k12: v12
```



#### æ•°ç»„ï¼ˆ Listã€set ï¼‰

ç”¨ - å€¼è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ 



#### ä¿®æ”¹SpringBootçš„é»˜è®¤ç«¯å£å·

é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼Œç«¯å£å·çš„å‚æ•°ï¼Œå°±å¯ä»¥åˆ‡æ¢ç«¯å£ï¼›

```yaml
server:
  port: 8082
```



#### yamlå’Œpropertiesæ–‡ä»¶å®ä¾‹å¯¹æ¯”

yaml:

```yaml
# æ™®é€šçš„key-value
name: zhangyk

# å¯¹è±¡
student:
  name: zhangyk
  age: 18
# å¯¹è±¡çš„è¡Œå†…å†™æ³•
student1: {name: zhangyk,age: 18}

# æ•°ç»„
pets:
  - cat
  - dog
  - pig
# æ•°ç»„çš„è¡Œå†…å†™æ³•
pet: [cat,dog,pig]
```

properties:

```properties
# propertiesæ–‡ä»¶åªèƒ½ä¿å­˜é”®å€¼å¯¹
name=zhangyk

student.name=zhangyk
student.age=18
```



### yamlæ³¨å…¥é…ç½®æ–‡ä»¶

yamlæ–‡ä»¶æ›´å¼ºå¤§çš„åœ°æ–¹åœ¨äºï¼Œä»–å¯ä»¥ç»™æˆ‘ä»¬çš„å®ä½“ç±»ç›´æ¥æ³¨å…¥åŒ¹é…å€¼ï¼

#### yamlæ³¨å…¥é…ç½®æ–‡ä»¶æµç¨‹

å®ä¾‹ï¼š

![image-20210824160726356](springboot.assets/image-20210824160726356.png)

pomæ–‡ä»¶ä¸­åŠ å…¥å®˜æ–¹æ¨èåŠ å…¥çš„ä¸€ä¸ªä¾èµ–

```xml
<!--è¿™ä¸ªæ³¨è§£åŠ äº†åï¼Œå†™dependencyä¼šæœ‰ä¸€äº›æç¤ºï¼Œæ²¡ä»€ä¹ˆç”¨-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```

ä¸é…ç½®è¿™ä¸ªpomçš„è¯ï¼Œä¼šå‡ºç°ä¸‹é¢å›¾ç‰‡çš„è­¦å‘Šï¼Œè™½ç„¶è¿™ä¸ªè­¦å‘Šä¸å½±å“ç¨‹åºè¿è¡Œï¼š

![image-20210824142455734](springboot.assets/image-20210824142455734.png)

å¯åŠ¨ç±»çš„åŒçº§æ–°å»ºpojoæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ–‡ä»¶å¤¹ä¸­æ–°å»ºpojoç±»

```java
package com.zhangyk.springboot02config.pojo;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/*
@Componentæ³¨å†Œbeanï¼ŒæŠŠè¢«æ³¨è§£çš„ç±»æ·»åŠ åˆ°springç»„ä»¶ä¸­

æ³¨æ„ï¼Œé¡¹ç›®çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¦æ”¾åœ¨å¯åŠ¨ç±»çš„åŒä¸€å±‚ï¼Œspringbootæ‰èƒ½æ‰¾åˆ°ã€‚å¦åˆ™ä¼šå‘ç°ï¼š
æ·»åŠ äº†componentæ³¨è§£åç±»åçš„å·¦è¾¹ä¸å‡ºç°å¶å­ï¼Œå³ç±»æ²¡æœ‰è¢«æ³¨å†Œä¸ºbean
*/
@Component
public class Dog {
    @Value("æ—ºè´¢")
    private String name;
    @Value("2")
    private Integer age;

    public Dog() {
    }

    public Dog(String name, Integer age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    @Override
    public String toString() {
        return "Dog{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
}
```



```java
package com.zhangyk.springboot02config.pojo;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

import java.util.Date;
import java.util.List;
import java.util.Map;

@Component
/*
* å¦‚æœä¸é…ç½®ä½¿ç”¨äº†è¿™ä¸ªæ³¨è§£ï¼šå°±ä¼šæç¤ºçˆ†çº¢ã€‚
* ç½‘å€â€œhttps://docs.spring.io/spring-boot/docs/2.5.4/reference/html/configuration-metadata.html#configuration-metadata.annotation-processorâ€
* ä¸è¿‡çˆ†çº¢ä¸å½±å“ç¨‹åºçš„è¿è¡Œã€‚
* */
@ConfigurationProperties(prefix = "person")

/*
* å¦‚æœjavaconfigæƒ³ç»‘å®šé…ç½®æ–‡ä»¶çš„å€¼ã€‚
* 1. å¯ä»¥ç”¨yamlï¼›
* 2. æˆ–è€…ç”¨@PropertySourceå»æŒ‡å®šæŒ‡å®šè‡ªå·±è¦ç”¨çš„propertiesé…ç½®æ–‡ä»¶ï¼Œå†ç”¨@Value+SPELè¡¨è¾¾å¼å–å‡ºé…ç½®æ–‡ä»¶çš„å€¼
* */
public class Person {
    private String name;
    private Integer age;
    private Boolean happy;
    private Date birth;
    private Map<String,Object> maps;
    private List<Object> lists;
    private Dog dog;

    public Person() {
    }

    public Person(String name, Integer age, Boolean happy, Date birth, Map<String, Object> maps, List<Object> lists, Dog dog) {
        this.name = name;
        this.age = age;
        this.happy = happy;
        this.birth = birth;
        this.maps = maps;
        this.lists = lists;
        this.dog = dog;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public Boolean getHappy() {
        return happy;
    }

    public void setHappy(Boolean happy) {
        this.happy = happy;
    }

    public Date getBirth() {
        return birth;
    }

    public void setBirth(Date birth) {
        this.birth = birth;
    }

    public Map<String, Object> getMaps() {
        return maps;
    }

    public void setMaps(Map<String, Object> maps) {
        this.maps = maps;
    }

    public List<Object> getLists() {
        return lists;
    }

    public void setLists(List<Object> lists) {
        this.lists = lists;
    }

    public Dog getDog() {
        return dog;
    }

    public void setDog(Dog dog) {
        this.dog = dog;
    }

    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", happy=" + happy +
                ", birth=" + birth +
                ", maps=" + maps +
                ", lists=" + lists +
                ", dog=" + dog +
                '}';
    }
}
```

ç¼–å†™yamlï¼Œèµ‹ç»™person beanå¯¹è±¡çš„å€¼

```yaml
# ymlè¿˜èƒ½ç¼–å†™å ä½ç¬¦å¦‚${random.uuid}ç”Ÿæˆéšæœºuuidï¼Œè€Œpropertiesä¸è¡Œã€‚ymlæ˜¯yyds
person:
  name: zhangyk
  age: 3
  happy: true
  birth: 2021/08/24
  maps: {k1: v1,k2: v2}
  lists:
    - code
    - music
    - house
  dog:
    name: æ—ºè´¢
    age: 3
```

åœ¨springbooté»˜è®¤çš„æµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™æµ‹è¯•å†…å®¹

```java
package com.zhangyk.springboot02config;

import com.zhangyk.springboot02config.pojo.Dog;
import com.zhangyk.springboot02config.pojo.Person;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class Springboot02ConfigApplicationTests {

    @Autowired
    private Dog dog;
    //å¯¹æ¯ä¸ªå¯¹è±¡éƒ½è¦ç”¨Autowiredï¼Œæˆ‘åˆšä»¥ä¸ºä¸€ä¸ªautowiredå¯ä»¥ç»™æ‰€æœ‰å¯¹è±¡è‡ªåŠ¨æ³¨å…¥ï¼Œç»“æœyamlçš„å†…å®¹æ— æ³•æ³¨å…¥personï¼ŒæŸ¥åŠå¤©
    @Autowired
    private Person person;

    @Test
    void contextLoads() {

        System.out.println("æ‰“å°é€šè¿‡æ³¨è§£è®¾ç½®å€¼çš„dog");
        System.out.println(dog);

        System.out.println("æ‰“å°é€šè¿‡yamlè®¾ç½®å€¼çš„person");
        System.out.println(person);
    }

}
```

å¯åŠ¨tomcatï¼ŒæŸ¥çœ‹è¿è¡Œç»“æœã€‚dogå’Œpersonéƒ½æˆåŠŸè¢«æ³¨å†Œä¸ºbeanï¼Œå¹¶è¢«èµ‹å€¼ã€‚

![image-20210824160814799](springboot.assets/image-20210824160814799.png)



#### åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶

@PropertySource ï¼šåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼›

@configurationPropertiesï¼šé»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›

1ã€æˆ‘ä»¬å»åœ¨resourcesç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª**person.properties**æ–‡ä»¶

```properties
name=kuangshen
```

2ã€ç„¶ååœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æŒ‡å®šåŠ è½½person.propertiesæ–‡ä»¶

```java
@PropertySource(value = "classpath:person.properties")
@Component //æ³¨å†Œbean
public class Person {

    @Value("${name}")
    private String name;

    ......  
}
```

3ã€å†æ¬¡è¾“å‡ºæµ‹è¯•ä¸€ä¸‹ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶ç»‘å®šæˆåŠŸï¼

![image-20210824161828659](springboot.assets/image-20210824161828659.png)



### å›é¡¾propertiesé…ç½®

æˆ‘ä»¬ä¸Šé¢é‡‡ç”¨çš„yamlæ–¹æ³•éƒ½æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œå¼€å‘ä¸­æœ€å¸¸ç”¨çš„ï¼›ä¹Ÿæ˜¯springbootæ‰€æ¨èçš„ï¼é‚£æˆ‘ä»¬æ¥å” å” å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œé“ç†éƒ½æ˜¯ç›¸åŒçš„ï¼›å†™è¿˜æ˜¯é‚£æ ·å†™ï¼›é…ç½®æ–‡ä»¶é™¤äº†ymlè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„properties ï¼Œ æˆ‘ä»¬æ²¡æœ‰è®²ï¼Œæˆ‘ä»¬æ¥å” å” ï¼

ã€æ³¨æ„ã€‘propertiesé…ç½®æ–‡ä»¶åœ¨å†™ä¸­æ–‡çš„æ—¶å€™ï¼Œä¼šæœ‰ä¹±ç  ï¼Œ æˆ‘ä»¬éœ€è¦å»IDEAä¸­è®¾ç½®ç¼–ç æ ¼å¼ä¸ºUTF-8ï¼›

settings-->FileEncodings ä¸­é…ç½®ï¼›

![image-20210824162145047](springboot.assets/image-20210824162145047.png)

- 20230520æˆ‘ï¼ˆé¢è¯•è¢«é—®æ‡µä½ï¼‰ï¼š
  - åŒºåˆ†utf8 utf16 utf32ï¼šä¸‰è€…éƒ½æ˜¯unicodeçš„ç¼–ç æ ¼å¼ï¼Œunicodeè§„å®šäº†ä¸–ç•Œä¸Šæ‰€æœ‰çš„å­—ç¬¦ï¼Œä½†æ˜¯æ²¡æœ‰è§„å®šå­—ç¬¦è¯¥æ€ä¹ˆç¼–ç ã€‚utf8æ˜¯è‹±æ–‡1å­—èŠ‚ å¸¸è§æ±‰å­—3å­—èŠ‚ ç½•è§æ±‰å­—4å­—èŠ‚ï¼›utf16æ˜¯è‹±æ–‡å’Œå¸¸è§æ±‰å­—éƒ½2å­—èŠ‚ ç½•è§æ±‰å­—4å­—èŠ‚ï¼›utf32æ˜¯ä»»ä½•ç¬¦å·éƒ½å ç”¨4å­—èŠ‚ã€‚javaçš„charé»˜è®¤ä½¿ç”¨utf16çš„2å­—èŠ‚éƒ¨åˆ†ï¼ˆèˆå¼ƒäº†ç½•è§çš„4å­—èŠ‚å†…å®¹ï¼‰ï¼Œæ‰€ä»¥charæ˜¯2å­—èŠ‚å¤§å°ã€‚
  - åŒºåˆ†utf8 utf8mb4ï¼šè¿™ä¸¤è€…çš„åŒºåˆ«å‡ºç°åœ¨mysqlæ•°æ®åº“ç¼–ç ä¸­ï¼Œéƒ½æ˜¯unicodeçš„utf8çš„ç¼–ç ï¼›ä½†æ˜¯mysqlçš„utf8æ˜¯é˜‰å‰²ç‰ˆçš„utf8ï¼Œæœ€å¤šåªå­˜å ç”¨3å­—èŠ‚çš„å­—ç¬¦ï¼›è€Œutf8mb4æ˜¯utf8çš„å®Œæ•´å®ç°ï¼Œå³å¯ä»¥å­˜å‚¨4å­—èŠ‚çš„å†…å®¹ï¼Œæ¯”å¦‚å­˜å‚¨è¡¨æƒ…ç¬¦å·ğŸ˜Šã€‚

å®ä¾‹ï¼š

1ã€æ–°å»ºä¸€ä¸ªå®ä½“ç±»User

```java
@Component //æ³¨å†Œbean
public class User {
    private String name;
    private int age;
    private String sex;
}
```

2ã€ç¼–è¾‘é…ç½®æ–‡ä»¶ user.properties

```properties
user1.name=kuangshen
user1.age=18
user1.sex=ç”·
```

3ã€æˆ‘ä»¬åœ¨Userç±»ä¸Šä½¿ç”¨@Valueæ¥è¿›è¡Œæ³¨å…¥ï¼

```java
@Component //æ³¨å†Œbean
@PropertySource(value = "classpath:user.properties")
public class User {
    //ç›´æ¥ä½¿ç”¨@value
    @Value("${user.name}") //ä»é…ç½®æ–‡ä»¶ä¸­å–å€¼
    private String name;
    @Value("#{9*2}")  // #{SPEL} Springè¡¨è¾¾å¼
    private int age;
    @Value("ç”·")  // å­—é¢é‡
    private String sex;
}
```

4ã€Springbootæµ‹è¯•

```java
@SpringBootTest
class DemoApplicationTests {

    @Autowired
    User user;

    @Test
    public void contextLoads() {
        System.out.println(user);
    }

}
```

ç»“æœæ­£å¸¸è¾“å‡ºï¼š

![image-20210824162344237](springboot.assets/image-20210824162344237.png)



### å¯¹æ¯”ä¸å°ç»“

@Valueè¿™ä¸ªä½¿ç”¨èµ·æ¥å¹¶ä¸å‹å¥½ï¼æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå±æ€§å•ç‹¬æ³¨è§£èµ‹å€¼ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼›æˆ‘ä»¬æ¥çœ‹ä¸ªåŠŸèƒ½å¯¹æ¯”å›¾

![image-20210824162426195](springboot.assets/image-20210824162426195.png)

1ã€@ConfigurationPropertiesåªéœ€è¦å†™ä¸€æ¬¡å³å¯ ï¼Œ @Valueåˆ™éœ€è¦æ¯ä¸ªå­—æ®µéƒ½æ·»åŠ 

2ã€æ¾æ•£ç»‘å®šï¼šè¿™ä¸ªä»€ä¹ˆæ„æ€å‘¢? æ¯”å¦‚æˆ‘çš„ymlä¸­å†™çš„last-nameï¼Œè¿™ä¸ªå’Œpojoç±»ä¸­lastNameæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä»å¯ä»¥ç»‘å®šã€‚ - åé¢è·Ÿç€çš„å­—æ¯é»˜è®¤æ˜¯å¤§å†™çš„ã€‚è¿™å°±æ˜¯æ¾æ•£ç»‘å®šã€‚å¯ä»¥æµ‹è¯•ä¸€ä¸‹

3ã€JSR303æ•°æ®æ ¡éªŒ ï¼Œ è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µæ˜¯å¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ ï¼Œ å¯ä»¥ä¿è¯æ•°æ®çš„åˆæ³•æ€§

4ã€å¤æ‚ç±»å‹å°è£…ï¼Œymlä¸­å¯ä»¥å°è£…å¯¹è±¡ ï¼Œ ä½¿ç”¨valueå°±ä¸æ”¯æŒ

**ç»“è®ºï¼š**

é…ç½®ymlå’Œé…ç½®propertieséƒ½å¯ä»¥è·å–åˆ°å€¼ ï¼Œ å¼ºçƒˆæ¨è ymlï¼›

å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªä¸šåŠ¡ä¸­ï¼Œåªéœ€è¦è·å–é…ç½®æ–‡ä»¶ä¸­çš„æŸä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹ @valueï¼›

å¦‚æœè¯´ï¼Œæˆ‘ä»¬ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ªJavaBeanæ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œä¸€ä¸€æ˜ å°„ï¼Œå°±ç›´æ¥@configurationPropertiesï¼Œä¸è¦çŠ¹è±«ï¼



## JSR303æ•°æ®æ ¡éªŒåŠå¤šç¯å¢ƒåˆ‡æ¢

è¿™å—å†…å®¹æ˜¯é¢å¤–äº†è§£ï¼Œæ ¸å¿ƒè¦æŒæ¡yamlå¦‚ä½•ç»™beanæ³¨å…¥å€¼ã€‚

- JSRæ˜¯Java Specification Requests çš„ç¼©å†™ï¼Œæ„æ€æ˜¯Java è§„èŒƒææ¡ˆã€‚

### JSR303

#### ä½¿ç”¨æ–¹å¼

Springbootä¸­å¯ä»¥ç”¨@validatedæ¥æ ¡éªŒæ•°æ®ï¼Œå¦‚æœæ•°æ®å¼‚å¸¸åˆ™ä¼šç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ï¼Œæ–¹ä¾¿å¼‚å¸¸ä¸­å¿ƒç»Ÿä¸€å¤„ç†ã€‚æˆ‘ä»¬è¿™é‡Œæ¥å†™ä¸ªæ³¨è§£è®©æˆ‘ä»¬çš„nameåªèƒ½æ”¯æŒEmailæ ¼å¼ï¼›

```java
@Component //æ³¨å†Œbean
@ConfigurationProperties(prefix = "person")
@Validated  //æ•°æ®æ ¡éªŒ
public class Person {

    @Email(message="é‚®ç®±æ ¼å¼é”™è¯¯") //nameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
    private String name;
}
```

è¿è¡Œç»“æœ ï¼šdefault message [ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç”µå­é‚®ä»¶åœ°å€];

![image-20210824172209383](springboot.assets/image-20210824172209383.png)

ä½¿ç”¨æ•°æ®æ ¡éªŒï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼› 

#### å¸¸è§JSRæ³¨è§£

```

@NotNull(message="åå­—ä¸èƒ½ä¸ºç©º")
private String userName;
@Max(value=120,message="å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120")
private int age;
@Email(message="é‚®ç®±æ ¼å¼é”™è¯¯")
private String email;

ç©ºæ£€æŸ¥
@Null       éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull
@NotNull    éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²
@NotBlank   æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.
@NotEmpty   æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.
    
Booelanæ£€æŸ¥
@AssertTrue     éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º true  
@AssertFalse    éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º false  
    
é•¿åº¦æ£€æŸ¥
@Size(min=, max=) éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  
@Length(min=, max=) string is between min and max included.

æ—¥æœŸæ£€æŸ¥
@Past       éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  
@Future     éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  
@Pattern    éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™

.......ç­‰ç­‰
é™¤æ­¤ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›æ•°æ®æ ¡éªŒè§„åˆ™
```



### å¤šç¯å¢ƒåˆ‡æ¢

#### ä¸åŒä½ç½®é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§

ä¼˜å…ˆçº§ä»ä¸Šå¾€ä¸‹**é€’å‡**ã€‚åŒä¸€å¯¹è±¡çš„é…ç½®ï¼Œä¸Šé¢çš„ä½ç½®å¯ä»¥è¦†ç›–ä¸‹é¢çš„ä½ç½®

```
file:./config/        fileæ˜¯æŒ‡é¡¹ç›®è·¯å¾„ï¼Œå°±æ˜¯srcæ–‡ä»¶å¤¹åœ¨å¾€ä¸Šçš„é‚£ä¸ªç›®å½•ã€‚
file:./
classpath:/config/    classpathæ˜¯ç±»ï¼ˆèµ„æºï¼‰è·¯å¾„ï¼Œjavaå’Œresourceç›®å½•éƒ½æ˜¯ç±»è·¯å¾„çš„æ ¹ç›®å½•ï¼Œé…ç½®æ–‡ä»¶ä¸€èˆ¬æ”¾resourceä¸­ã€‚
classpath:/           é»˜è®¤çš„é…ç½®æ–‡ä»¶æ‰€å­˜æ”¾çš„ä½ç½®ï¼Œä¼˜å…ˆçº§ä¹Ÿæ˜¯æœ€ä½çš„
```

- 20230522æˆ‘ï¼šä¸€èˆ¬å¹¶ä¸ä¼šä½¿ç”¨å¤šä¸ªyamlï¼Œç›®å‰çœ‹åˆ°çš„é¡¹ç›®éƒ½æ˜¯ä¸€ä¸ªç¯å¢ƒä¸€ä¸ªymlã€‚

å„ä½ç½®åœ¨é¡¹ç›®ä¸­å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20210825124008669](springboot.assets/image-20210825124008669.png)

ä¸åŒé…ç½®ä½ç½®çš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç«¯å£å·æ¥æµ‹è¯•ï¼Œçœ‹å¯åŠ¨é¡¹ç›®åï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ˜¯ä»€ä¹ˆç«¯å£å·ã€‚



äº’è¡¥é…ç½®ï¼š

- SpringBootä¼šä»è¿™å››ä¸ªä½ç½®**å…¨éƒ¨åŠ è½½**ä¸»é…ç½®æ–‡ä»¶ï¼›**äº’è¡¥é…ç½®**ï¼›æœ‰é…ç½®å†²çªæ—¶ï¼Œå†æŒ‰ç…§ä¸åŒä½ç½®çš„ä¼˜å…ˆçº§è¿›è¡Œè¦†ç›–ã€‚



æ‹“å±•ï¼Œ**è¿ç»´**å°æŠ€å·§ï¼š

- æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šä½ç½®åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå³é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®

- é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯åæœŸè¿ç»´åšçš„å¤šï¼Œç›¸åŒé…ç½®ï¼Œå¤–éƒ¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æœ€é«˜

- æŒ‡ä»¤å¦‚ä¸‹ï¼š

  ```
  java -jar spring-boot-config.jar --spring.config.location=F:/application.properties
  ```



#### properties/yamlåˆ‡æ¢é…ç½®æ–‡ä»¶

æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ application-{profile}.properties/yml , ç”¨æ¥æŒ‡å®šå¤šä¸ªç¯å¢ƒç‰ˆæœ¬ï¼›è¿™äº›é…ç½®æ–‡ä»¶æœ€å¥½åœ¨**åŒä¸€ç›®å½•**ä¸­ã€‚

ä¾‹å¦‚ï¼š

- application-test.properties ä»£è¡¨æµ‹è¯•ç¯å¢ƒé…ç½®

- application-dev.properties ä»£è¡¨å¼€å‘ç¯å¢ƒé…ç½®

ä½†æ˜¯Springbootå¹¶ä¸ä¼šç›´æ¥å¯åŠ¨è¿™äº›é…ç½®æ–‡ä»¶ï¼Œå®ƒ**é»˜è®¤ä½¿ç”¨application.propertiesä¸»é…ç½®æ–‡ä»¶**ï¼›

æˆ‘ä»¬éœ€è¦é€šè¿‡application.propertiesä¸­çš„ä¸€ä¸ªé…ç½®æ¥é€‰æ‹©éœ€è¦æ¿€æ´»çš„ç¯å¢ƒï¼š

```properties
#æ¯”å¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä½¿ç”¨devç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„ç«¯å£å·è¿›è¡Œæµ‹è¯•ï¼›
#æˆ‘ä»¬å¯åŠ¨SpringBootï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»åˆ‡æ¢åˆ°devä¸‹çš„é…ç½®äº†ï¼›
spring.profiles.active=dev
```



#### yamlçš„å¤šæ–‡æ¡£å—

å’Œpropertiesé…ç½®æ–‡ä»¶ä¸­ä¸€æ ·ï¼Œä½†æ˜¯ä½¿ç”¨ymlå»å®ç°ä¸éœ€è¦åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ›´åŠ æ–¹ä¾¿äº† !

ymlä¸­å¯ä»¥ç”¨ä¸‰æ¡æ ---æ¥åˆ†å‰²ä¸åŒçš„ä»£ç å—ã€‚

```yaml
server:
  port: 8081
#åœ¨ç¬¬ä¸€ä¸ªæ¨¡å—é€‰æ‹©è¦æ¿€æ´»é‚£ä¸ªç¯å¢ƒå—ï¼›æˆ–è€…ä¸æ¿€æ´»ï¼Œå°±ä½¿ç”¨ç¬¬ä¸€æ¨¡å—çš„é…ç½®ã€‚
spring:
  profiles:
    active: prod

---
server:
  port: 8083
#é…ç½®ç¯å¢ƒçš„åç§°
spring:
  profiles: dev 


---

server:
  port: 8084
#é…ç½®ç¯å¢ƒçš„åç§°
spring:
  profiles: prod  
```

æ³¨æ„ï¼šå¦‚æœ**ymlå’Œproperties**åŒæ—¶éƒ½é…ç½®äº†ç«¯å£ï¼Œå¹¶ä¸”æ²¡æœ‰æ¿€æ´»å…¶ä»–ç¯å¢ƒ ï¼Œ **é»˜è®¤ä¼šä½¿ç”¨properties**é…ç½®æ–‡ä»¶çš„ï¼

æœ‰äººä¼šè§‰å¾—æ–‡æ¡£å—æ²¡æœ‰å¤šä¸ªæ–‡æ¡£æ•´æ´ï¼Œçœ‹ä¸ªäººå–œå¥½ä½¿ç”¨å³å¯ï¼Œå› ä¸ºyamlä¹Ÿæ”¯æŒåˆ‡æ¢é…åˆ¶æ–‡ä»¶ã€‚ymlæ˜¯yydsã€‚



## è‡ªåŠ¨é…ç½®åŸç†

é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿ

SpringBootå®˜æ–¹æ–‡æ¡£ä¸­æœ‰å¤§é‡çš„é…ç½®ï¼Œæˆ‘ä»¬æ— æ³•å…¨éƒ¨è®°ä½

![img](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7IPEXZtUAUBhnSZvUmrPzbD7ibqw837BhN1F7lHdAMhMmYNCYF2tSdvUGv0y3X48tzetuuYc8tUMLg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



### åˆ†æè‡ªåŠ¨é…ç½®åŸç†

æˆ‘ä»¬ä»¥**HttpEncodingAutoConfigurationï¼ˆHttpç¼–ç è‡ªåŠ¨é…ç½®ï¼‰**ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼›

```java
//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå’Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼›
@Configuration 

//å¯åŠ¨æŒ‡å®šç±»çš„ConfigurationPropertiesåŠŸèƒ½ï¼›
  //è¿›å…¥è¿™ä¸ªHttpPropertiesæŸ¥çœ‹ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’ŒHttpPropertiesç»‘å®šèµ·æ¥ï¼›
  //å¹¶æŠŠHttpPropertiesåŠ å…¥åˆ°iocå®¹å™¨ä¸­
@EnableConfigurationProperties({HttpProperties.class}) 

//Springåº•å±‚@Conditionalæ³¨è§£
  //æ ¹æ®ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›
  //è¿™é‡Œçš„æ„æ€å°±æ˜¯åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯webåº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ
@ConditionalOnWebApplication(
    type = Type.SERVLET
)

//åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»CharacterEncodingFilterï¼›SpringMVCä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›
@ConditionalOnClass({CharacterEncodingFilter.class})

//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®ï¼šspring.http.encoding.enabledï¼›
  //å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„
  //å³ä½¿æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½®pring.http.encoding.enabled=trueï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„ï¼›
@ConditionalOnProperty(
    prefix = "spring.http.encoding",
    value = {"enabled"},
    matchIfMissing = true
)

public class HttpEncodingAutoConfiguration {
    //ä»–å·²ç»å’ŒSpringBootçš„é…ç½®æ–‡ä»¶æ˜ å°„äº†
    private final Encoding properties;
    //åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿
    public HttpEncodingAutoConfiguration(HttpProperties properties) {
        this.properties = properties.getEncoding();
    }
    
    //ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–
    @Bean
    @ConditionalOnMissingBean //åˆ¤æ–­å®¹å™¨æ²¡æœ‰è¿™ä¸ªç»„ä»¶ï¼Ÿ
    public CharacterEncodingFilter characterEncodingFilter() {
        CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter();
        filter.setEncoding(this.properties.getCharset().name());
        filter.setForceRequestEncoding(this.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.REQUEST));
        filter.setForceResponseEncoding(this.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.RESPONSE));
        return filter;
    }
    //ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
}
```

**ä¸€å¥è¯æ€»ç»“ ï¼šæ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼**

- ä¸€ä½†è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›
- è¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„propertiesç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªå±æ€§åˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„ï¼›
- æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨xxxxPropertiesç±»ä¸­å°è£…ç€ï¼›
- é…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»

```java
//ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®šã€‚è¿™é‡Œæ˜¯springçš„httpå±æ€§ã€‚
@ConfigurationProperties(prefix = "spring.http") 
public class HttpProperties {
    // .....
}
```

æˆ‘ä»¬å»é…ç½®æ–‡ä»¶(ymlæˆ–properties)é‡Œé¢è¯•è¯•å‰ç¼€ï¼Œçœ‹æç¤ºï¼

![Image](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7IPEXZtUAUBhnSZvUmrPzbD4hfI8rrZuGnuFRBjKdaR8mvkyuGfHG1IxBPw0vcTP5LoXIJT9davlA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

è¿™å°±æ˜¯**è‡ªåŠ¨è£…é…**çš„åŸç†ï¼

### ç²¾é«“

1ã€SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆXXXAutoConfigurationï¼‰

2ã€æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰åœ¨SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»å½“ä¸­ï¼›

3ã€æˆ‘ä»¬å†æ¥çœ‹ï¼ˆå»XXXPropertiesç±»ä¸­çœ‹ï¼‰è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶å­˜åœ¨åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½®ï¼ˆymlæˆ–propertiesä¸­é…ï¼‰äº†ï¼‰

4ã€ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»XXXPropertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼å³å¯ï¼›

**xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›**ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼›ç»„ä»¶è¦èµ‹å€¼å°±è¦ç»‘å®šXXXPropertiesç±»ï¼Œä¼šæœ‰é»˜è®¤é…ç½®ã€‚

**xxxxProperties:å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›**é€šè¿‡@ConfigurationPropertiesæ³¨è§£ç»‘å®š **é…ç½®æ–‡ä»¶ï¼ˆymlæˆ–propertiesï¼‰**ä¸‹çš„ç›¸å…³é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®ï¼ˆå³ä¿®æ”¹é»˜è®¤é…ç½®ï¼‰ã€‚



### @Conditional

*ï¼ˆäº†è§£å³å¯ï¼‰*

äº†è§£å®Œè‡ªåŠ¨è£…é…çš„åŸç†åï¼Œæˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸ªç»†èŠ‚é—®é¢˜ï¼Œ**è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›**ï¼Œæ¡ä»¶ç”±@Conditionalæ´¾ç”Ÿæ³¨è§£æŒ‡å®šã€‚

**@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰**ä½œç”¨ï¼š

- å¿…é¡»æ˜¯@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®ç±»é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›

![Image](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7IPEXZtUAUBhnSZvUmrPzbDGcJRvdK3PtqHPAWYBBmpe1XBVjQJeiatU4vasEaxckHlOga1BV9RPaw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

é‚£ä¹ˆå¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åŠ è½½äº†è¿™ä¹ˆå¤šçš„é…ç½®ç±»ï¼Œä½†**ä¸æ˜¯æ‰€æœ‰çš„éƒ½ç”Ÿæ•ˆ**äº†ã€‚

æˆ‘ä»¬æ€ä¹ˆ**çŸ¥é“**å“ªäº›è‡ªåŠ¨é…ç½®ç±»**ç”Ÿæ•ˆ**ï¼Ÿ

- æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ymlæˆ–propertiesæ–‡ä»¶ä¸­å¯ç”¨ **debug=true**å±æ€§ï¼›æ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›

```properties
#å¼€å¯springbootçš„è°ƒè¯•ç±»
debug=true
```

æ§åˆ¶å°æ˜¾ç¤ºè‡ªåŠ¨é…ç½®ç±»æœ‰ä¸‰ç§æƒ…å†µï¼š

- Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼šæ­£åŒ¹é…ï¼‰

- Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼šè´ŸåŒ¹é…ï¼‰

- Unconditional classes: ï¼ˆæ²¡æœ‰æ¡ä»¶çš„ç±»ï¼‰



### é¡¹ç›®ä¸­åˆ†ææ–‡ä»¶

åœ¨ymlæ–‡ä»¶ä¸­ï¼Œè¾“å…¥springï¼Œåœ¨å¼¹å‡ºçš„æç¤ºä¸­éšä¾¿é€‰ä¸€ä¸ªé…ç½®ï¼›ç‚¹å‡»ï¼Œå¦‚ä¸‹

![image-20210826122555605](springboot.assets/image-20210826122555605.png)

ç‚¹å‡»â€œnon-blocking-redeliveryâ€ï¼Œè¿›å…¥XXXPropertiesç±»ã€‚æ¥åˆ°è®¾ç½®non-blocking-redeliveryå±æ€§çš„setæ–¹æ³•çš„ä½ç½®

![image-20210826122840441](springboot.assets/image-20210826122840441.png)

æ¥åˆ°XXXPropertiesç±»çš„å¼€å¤´ï¼Œåˆ†æè¯¥ç±»

![image-20210826123554217](springboot.assets/image-20210826123554217.png)

æ¥åˆ°spring.factoriesæ–‡ä»¶æ¥æŸ¥æ‰¾ActiveMQPropertiesç±»å¯¹åº”çš„autoconfigurationç±»ã€‚ï¼ˆåœ¨æ–‡ä»¶ä¸­æœç´¢activemqï¼‰

![image-20210826123813171](springboot.assets/image-20210826123813171.png)

ç‚¹å‡»æŸ¥åˆ°çš„è¯¥autoconfigurationç±»ã€‚è¯¥autoconfigurationç±»ç»‘å®šçš„activemqpropertiesç±»ã€‚

ç”±äº@conditionalæ³¨è§£çš„è¦æ±‚æ²¡æ»¡è¶³ï¼ˆè¦æ±‚å­˜åœ¨çš„beançˆ†çº¢ï¼Œå³beanä¸å­˜åœ¨ï¼‰ï¼Œæ‰€ä»¥è¯¥autoconfigurationç±»ä¸ä¼šç”Ÿæ•ˆï¼›æ‰€ä»¥è¯¥autoconfigurationåœ¨debugæ¨¡å¼æ‰“å°æ—¶ï¼Œè‚¯å®šä½äºâ€œNegative matchesâ€ã€‚

![image-20210826123952582](springboot.assets/image-20210826123952582.png)

æ‰¾ä¸åˆ°connectionfactoryæ˜¯å› ä¸ºæ²¡å¯¼å…¥ç›¸å…³ä¾èµ–ï¼›æƒ³å¯¼å…¥è¯¥ä¾èµ–ï¼Œåªè¦åœ¨pomä¸­å¯¼å…¥è¯¥ä¾èµ–å¯¹åº”çš„spring-boot-starterä¾èµ–å³å¯ã€‚



## webå¼€å‘æ¢ç©¶

### å‰è¨€

å½“å‰å­˜åœ¨çš„é—®é¢˜ï¼š

- springbootæ²¡æœ‰webappï¼Œä¸”å½“å‰æ‰“åŒ…çš„éƒ½æ˜¯jaråŒ…**VS**webé¡¹ç›®éœ€è¦æœ‰webappæ–‡ä»¶å¤¹

è‡ªåŠ¨è£…é…

- springbootåˆ°åº•å¸®æˆ‘ä»¬é…ç½®äº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ä¿®æ”¹ï¼Ÿèƒ½ä¿®æ”¹å“ªäº›ä¸œè¥¿ï¼Ÿèƒ½ä¸èƒ½æ‰©å±•
  - XXXAutoConfigurationï¼šå‘å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ï¼›æ‰€æœ‰autoconfigurationç±»å¯ä»¥åœ¨spring.factoriesæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼›è¾¾åˆ°conditionçš„autoconfigurationç±»ä¼šè¢«æ¿€æ´»ï¼›autoconfigurationç±»ä¼šç»‘å®šä¸€ä¸ªpropertiesç±»ã€‚
  - XXXPropertiesï¼šè£…é…é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰çš„ä¸€äº›å†…å®¹ï¼›ä¼šæŒ‡å®šymlæˆ–propertiesæ–‡ä»¶ä¸­çš„é…ç½®æ‰€åœ¨çš„ä½ç½®ã€‚

è¦è§£å†³çš„é—®é¢˜ï¼š

- å¯¼å…¥é™æ€èµ„æºï¼Œå¦‚htmlï¼Œcss
- ç¼–å†™é¦–é¡µï¼Œå¦‚index.js
- ç¼–å†™jspï¼Œè¿™é‡Œæ²¡æœ‰èƒ½å†™jspçš„åœ°æ–¹ï¼Œæ‰€ä»¥è¦å­¦æ¨¡æ¿å¼•æ“ï¼ˆThymeleafï¼‰
- æ‰©å±•springmvc
- å¢åˆ æ”¹æŸ¥
- æ‹¦æˆªå™¨
  - æˆ‘ï¼šæ³¨æ„åŒºåˆ†æ‹¦æˆªå™¨ï¼ˆspringmvcçš„ç»„ä»¶ï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆserveletçº§åˆ«ï¼‰ã€‚
- å›½é™…åŒ–ï¼ˆä¸­è‹±æ–‡åˆ‡æ¢ï¼‰

### é™æ€èµ„æº

#### è¯»æºç 

ï¼ˆåˆå­¦å¯ä»¥å…ˆè·³è¿‡ï¼‰

```java
@Override
		public void addResourceHandlers(ResourceHandlerRegistry registry) {
			if (!this.resourceProperties.isAddMappings()) {
				logger.debug("Default resource handling disabled");
				return;
			}
			addResourceHandler(registry, "/webjars/**", "classpath:/META-INF/resources/webjars/");
			addResourceHandler(registry, this.mvcProperties.getStaticPathPattern(), (registration) -> {
				registration.addResourceLocations(this.resourceProperties.getStaticLocations());
				if (this.servletContext != null) {
					ServletContextResource resource = new ServletContextResource(this.servletContext, SERVLET_LOCATION);
					registration.addResourceLocations(resource);
				}
			});
		}
```

#### å­˜æ”¾é™æ€èµ„æºçš„ç›®å½•

é€šè¿‡è¯»æºç å‘ç°çš„ã€‚

ä¼˜å…ˆçº§ï¼š

-  resources(ä¸€èˆ¬æ”¾ä¸€äº›ä¸Šä¼ çš„æ–‡ä»¶)>static(ä¸€èˆ¬æ”¾ä¸€äº›é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡)>public(ä¸€èˆ¬æ”¾å…¬å…±èµ„æºï¼Œå¦‚å¤§å®¶éƒ½ä¼šè®¿é—®çš„js)ã€‚

![image-20210826175327847](springboot.assets/image-20210826175327847.png)

æµ‹è¯•ï¼š

åœ¨ä¸‰ä¸ªæ–‡ä»¶å¤¹ä¸­éƒ½å†™åŒåjsæ–‡ä»¶ï¼Œçœ‹è®¿é—®è¯¥åå­—jsæ‰“å¼€çš„æ˜¯å“ªä¸ªé¡µé¢å³å¯å¾—åˆ°å…ˆåé¡ºåº

![image-20210826180332053](springboot.assets/image-20210826180332053.png)

![image-20210826180229142](springboot.assets/image-20210826180229142.png)

ä¿®æ”¹é»˜è®¤é™æ€èµ„æºè·¯å¾„ï¼š

- å¯ä»¥åœ¨ymlæˆ–propertiesæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç 

  `spring.mvc.static-path-pattern=/hello/,classpath:/kuang/`

  ä½¿ç”¨ä¸Šè¿°ä»£ç åï¼Œâ€resourcesï¼Œstaticï¼Œpublicï¼Œæ ¹ç›®å½•â€œçš„é™æ€èµ„æºä½ç½®ä¸å†æ˜ å°„åˆ°localhost:8080ã€‚ä½†æ˜¯ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšã€‚

#### æ€»ç»“

1. åœ¨springbootä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¤„ç†é™æ€èµ„æº
   - webjarsï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰                     
   - public, static, /** (æ ¹ç›®å½•), resources               è¿™å››ä¸ªä½ç½®ç›´æ¥æ˜ å°„åˆ°localhost:8080/

2. ä¼˜å…ˆçº§

   resources>static(é»˜è®¤çš„æ–‡ä»¶å¤¹ï¼Œé¡¹ç›®åˆ›å»ºæ—¶è‡ªå¸¦)>public

   

### é¦–é¡µå®šåˆ¶

#### è¯»æºç 

åœ¨WebMvcAutoConfigurationç±»ä¸­æœ‰ä¸‹åˆ—å‡½æ•°

```java
private Resource getIndexHtml(Resource location) {
   try {
      //åœ¨é™æ€èµ„æºç›®å½•ä¸‹æ‰¾ä¸€ä¸ªindex.htmlçš„æ–‡ä»¶ï¼Œå°±ä¼šæ˜ å°„åˆ°é¦–é¡µ
      Resource resource = location.createRelative("index.html");
      if (resource.exists() && (resource.getURL() != null)) {
         return resource;
      }
   }
   catch (Exception ex) {
   }
   return null;
}
```

é‚£ä¹ˆä½œä¸ºæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨é™æ€ç›®å½•ä¸‹è‡ªå»ºä¸€ä¸ªindex.htmlï¼Œé‡å¯tomcat

![image-20210826203141417](springboot.assets/image-20210826203141417.png)

è®¿é—®localhost:8080ï¼Œçœ‹åˆ°æœ‰é»˜è®¤é¡µé¢å±•ç¤ºï¼Œç¬¦åˆè¯»æºç çš„é¢„æœŸ

![image-20210826203308422](springboot.assets/image-20210826203308422.png)

#### favicon

- å¯ä»¥æ§åˆ¶ç½‘é¡µæœ€ä¸Šé¢barä¸Šçš„å›¾æ ‡æ˜¾ç¤ºã€‚
- æ–°springbootå·²ç»åºŸé™¤ï¼Œæš‚ä¸éœ€å­¦ä¹ ã€‚



### æ¨¡æ¿å¼•æ“

#### å‰è¨€

springbootæ¨èçš„é¡µé¢æ¨¡æ¿æ˜¯thymeleafï¼š

- åœ¨å‰åç«¯ä¸åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œspringbootæ¨èç”¨htmlåšé¡µé¢ï¼Œç„¶åç”¨thymeleafåšæ¨¡æ¿å¼•æ“ï¼Œåšæ•°æ®æ¸²æŸ“ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è¿˜æ˜¯è¦ç”¨jsæˆ–è€…jqueryæ‰‹åŠ¨å»æ“ä½œdomï¼Œå¾ˆéš¾å—

- **å‰åç«¯åˆ†ç¦»**çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨vueã€reactç­‰

æ¨¡æ¿å¼•æ“å›¾ç¤ºï¼š

![image-20210826211017975](springboot.assets/image-20210826211017975.png)



#### å¼•å…¥Thymeleaf

æ€ä¹ˆå¼•å…¥å‘¢ï¼Œå¯¹äºspringbootæ¥è¯´ï¼Œä»€ä¹ˆäº‹æƒ…ä¸éƒ½æ˜¯ä¸€ä¸ªstartçš„äº‹æƒ…å˜›ï¼Œæˆ‘ä»¬å»åœ¨é¡¹ç›®ä¸­å¼•å…¥ä¸€ä¸‹ã€‚

ç»™å¤§å®¶ä¸‰ä¸ªç½‘å€ï¼š

- Thymeleaf å®˜ç½‘ï¼šhttps://www.thymeleaf.org/
- Thymeleaf åœ¨Github çš„ä¸»é¡µï¼šhttps://github.com/thymeleaf/thymeleaf
- Springå®˜æ–¹æ–‡æ¡£ï¼šæ‰¾åˆ°æˆ‘ä»¬å¯¹åº”çš„ç‰ˆæœ¬ï¼šhttps://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter 

**thymeleafä½¿ç”¨æ‰‹å†Œ**usingthymeleaf.pdfï¼š

- https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.pdf

æ‰¾åˆ°å¯¹åº”çš„pomä¾èµ–ï¼šå¯ä»¥é€‚å½“ç‚¹è¿›æºç çœ‹ä¸‹æœ¬æ¥çš„åŒ…ï¼ç›´æ¥å¯¼å…¥å¯åŠ¨å™¨ã€‚

```html
<!--thymeleaf-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```



#### Thymeleafåˆ†æ

æˆ‘ä»¬å»æ‰¾ä¸€ä¸‹Thymeleafçš„è‡ªåŠ¨é…ç½®ç±»ï¼šThymeleafProperties

```java
//æŒ‡æ˜ymlæˆ–propertiesæ–‡ä»¶ä¸­çš„é‚£å—æœ‰å½“å‰é…ç½®ç±»çš„é…ç½®
@ConfigurationProperties(prefix = "spring.thymeleaf")
public class ThymeleafProperties {
    //é»˜è®¤ç¼–ç æ–¹å¼
    private static final Charset DEFAULT_ENCODING;
    //å‰ç¼€ï¼Œï¼ˆä¹‹å‰springæ—¶ï¼Œå‰ç¼€æ˜¯web-infï¼‰
    public static final String DEFAULT_PREFIX = "classpath:/templates/";
    //åç¼€ï¼Œï¼ˆä¹‹å‰springæ—¶ï¼Œåç¼€æ˜¯jspï¼‰
    public static final String DEFAULT_SUFFIX = ".html";
    private boolean checkTemplate = true;
    private boolean checkTemplateLocation = true;
    private String prefix = "classpath:/templates/";
    private String suffix = ".html";
    private String mode = "HTML";
    private Charset encoding;
}
```

æˆ‘ä»¬åªéœ€è¦æŠŠæˆ‘ä»¬çš„htmlé¡µé¢æ”¾åœ¨ç±»è·¯å¾„ä¸‹çš„templatesä¸‹ï¼Œthymeleafå°±å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ¸²æŸ“äº†ã€‚

ä½¿ç”¨thymeleafä»€ä¹ˆéƒ½ä¸éœ€è¦é…ç½®ï¼Œåªéœ€è¦å°†ä»–æ”¾åœ¨æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸‹å³å¯ï¼



#### æµ‹è¯•å‰åç«¯è°ƒç”¨

![image-20210826214228251](springboot.assets/image-20210826214228251.png)

pomä¸­å¯¼å…¥æŒ‡å®šä¾èµ–ã€‚ä¸€å®šè¦å¯¼ï¼Œä¸ç„¶å‡ºé”™ã€‚

```xml
<!--thymeleaf-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```

templateæ–‡ä»¶å¤¹ä¸‹ï¼Œç¼–å†™test.htmlæ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>test template</h1>
</body>
</html>
```

controlleræ–‡ä»¶å¤¹ä¸‹æ§åˆ¶è§†å›¾è·³è½¬

ï¼ˆå…¶å®ç°åœ¨å‰åç«¯åˆ†ç¦»ï¼Œä¸å¤ªæ¨èåç«¯æ§åˆ¶è§†å›¾è·³è½¬äº†ï¼‰

```java
package com.zhangyk.springboot03web.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

/*æˆ‘ä»¬è¦è·³é¡µé¢ï¼Œç”¨@Controllerä»£è¡¨ä»–ä¼šè·³åˆ°ä¸€ä¸ªé¡µé¢ï¼›ä¸èƒ½ç”¨restcontroller
*
* åœ¨templateç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡controlleræ¥è·³è½¬ï¼›è¿™ä¸ªéœ€è¦æ¨¡æ¿å¼•æ“ï¼ˆthymeleafï¼‰çš„æ”¯æŒã€‚
* */
@Controller
public class IndexController {

    @RequestMapping("/test")
    public String index(){
        return "test";
    }
}
```

å¯åŠ¨tomcatï¼Œæµè§ˆå™¨å‘é€/testè¯·æ±‚ã€‚æˆåŠŸä½¿ç”¨thymeleafï¼Œå¹¶è·³è½¬åˆ°test.htmlé¡µé¢ã€‚

![image-20210826214630989](springboot.assets/image-20210826214630989.png)

ç»“è®ºï¼š

- åªè¦éœ€è¦ä½¿ç”¨thymeleafï¼Œåªéœ€è¦å¯¼å…¥å¯¹åº”çš„ä¾èµ–å°±å¯ä»¥äº†ï¼æˆ‘ä»¬å°†htmlæ”¾åœ¨æˆ‘ä»¬çš„templatesç›®å½•ä¸‹å³å¯ã€‚

```java
private String prefix = "classpath:/templates/";
private String suffix = ".html";
```



#### thymeleafè¯­æ³•åˆæ¢

è¦å­¦ä¹ è¯­æ³•ï¼Œè¿˜æ˜¯å‚è€ƒå®˜ç½‘æ–‡æ¡£æœ€ä¸ºå‡†ç¡®ï¼Œæˆ‘ä»¬æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬çœ‹ä¸€ä¸‹ï¼›

Thymeleaf **å®˜ç½‘**ï¼šhttps://www.thymeleaf.org/ ï¼Œ ç®€å•çœ‹ä¸€ä¸‹å®˜ç½‘ï¼æˆ‘ä»¬å»ä¸‹è½½Thymeleafçš„å®˜æ–¹æ–‡æ¡£ï¼

æˆ‘ä»¬åšä¸ªæœ€ç®€å•çš„**ç»ƒä¹ ** ï¼šæˆ‘ä»¬éœ€è¦æŸ¥å‡ºä¸€äº›æ•°æ®ï¼Œåœ¨é¡µé¢ä¸­å±•ç¤º

å®ä¾‹ï¼š

ä¿®æ”¹æµ‹è¯•è¯·æ±‚ï¼Œå¢åŠ æ•°æ®ä¼ è¾“ï¼›

```java
package com.zhangyk.springboot03web.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

/*æˆ‘ä»¬è¦è·³é¡µé¢ï¼Œç”¨@Controllerä»£è¡¨ä»–ä¼šè·³åˆ°ä¸€ä¸ªé¡µé¢ï¼›ä¸èƒ½ç”¨restcontroller
*
* åœ¨templateç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡controlleræ¥è·³è½¬ï¼›è¿™ä¸ªéœ€è¦æ¨¡æ¿å¼•æ“ï¼ˆthymeleafï¼‰çš„æ”¯æŒã€‚
* */
@Controller
public class IndexController {

    @RequestMapping("/test")
    public String index(Model model){

        model.addAttribute("msg","hellospringboot,zyk");
        return "test";
    }
}
```

æˆ‘ä»¬è¦ä½¿ç”¨thymeleafï¼Œéœ€è¦åœ¨htmlæ–‡ä»¶ä¸­å¯¼å…¥å‘½åç©ºé—´çš„çº¦æŸï¼Œæ–¹ä¾¿æç¤ºã€‚

æˆ‘ä»¬å¯ä»¥å»å®˜æ–¹æ–‡æ¡£çš„#3ä¸­çœ‹ä¸€ä¸‹å‘½åç©ºé—´æ‹¿æ¥è¿‡æ¥

`xmlns:th="http://www.thymeleaf.org"`

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!--æ‰€æœ‰htmlå…ƒç´ éƒ½å¯ä»¥è¢«thymeleafæ›¿æ¢æ¥ç®¡ï¼šthï¼šå…ƒç´ å-->
<div th:text="${msg}"></div>
</body>
</html>
```

å¯åŠ¨tomcatæµ‹è¯•ã€‚æ•°æ®è¢«thymeleafæˆåŠŸæ•´åˆ

![image-20210826220511257](springboot.assets/image-20210826220511257.png)



### thymeleafè¯­æ³•

å…¥é—¨æå®šï¼Œæˆ‘ä»¬æ¥è®¤çœŸç ”ä¹ ä¸€ä¸‹Thymeleafçš„ä½¿ç”¨è¯­æ³•ï¼

#### çŸ¥è¯†

1. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„çš„ th:attr æ¥æ›¿æ¢Htmlä¸­åŸç”Ÿå±æ€§çš„å€¼ï¼

   ![Image](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Idia351qHgmH2vbzurk1Pp6fGYIwv043icVDYuybRJDCGTSNTMEibFzzMdlKS4t07TQoicQJKQAe0slQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

2. æˆ‘ä»¬èƒ½å†™å“ªäº›è¡¨è¾¾å¼å‘¢ï¼Ÿ

   ```
   
   Simple expressions:ï¼ˆè¡¨è¾¾å¼è¯­æ³•ï¼‰
   Variable Expressions: ${...}ï¼šè·å–å˜é‡å€¼ï¼›OGNLï¼›
       1ï¼‰ã€è·å–å¯¹è±¡çš„å±æ€§ã€è°ƒç”¨æ–¹æ³•
       2ï¼‰ã€ä½¿ç”¨å†…ç½®çš„åŸºæœ¬å¯¹è±¡ï¼š#18
            #ctx : the context object.
            #vars: the context variables.
            #locale : the context locale.
            #request : (only in Web Contexts) the HttpServletRequest object.
            #response : (only in Web Contexts) the HttpServletResponse object.
            #session : (only in Web Contexts) the HttpSession object.
            #servletContext : (only in Web Contexts) the ServletContext object.
   
       3ï¼‰ã€å†…ç½®çš„ä¸€äº›å·¥å…·å¯¹è±¡ï¼š
   ã€€ã€€ã€€ã€€ã€€ã€€#execInfo : information about the template being processed.
   ã€€ã€€ã€€ã€€ã€€ã€€#uris : methods for escaping parts of URLs/URIs
   ã€€ã€€ã€€ã€€ã€€ã€€#conversions : methods for executing the configured conversion service (if any).
   ã€€ã€€ã€€ã€€ã€€ã€€#dates : methods for java.util.Date objects: formatting, component extraction, etc.
   ã€€ã€€ã€€ã€€ã€€ã€€#calendars : analogous to #dates , but for java.util.Calendar objects.
   ã€€ã€€ã€€ã€€ã€€ã€€#numbers : methods for formatting numeric objects.
   ã€€ã€€ã€€ã€€ã€€ã€€#strings : methods for String objects: contains, startsWith, prepending/appending, etc.
   ã€€ã€€ã€€ã€€ã€€ã€€#objects : methods for objects in general.
   ã€€ã€€ã€€ã€€ã€€ã€€#bools : methods for boolean evaluation.
   ã€€ã€€ã€€ã€€ã€€ã€€#arrays : methods for arrays.
   ã€€ã€€ã€€ã€€ã€€ã€€#lists : methods for lists.
   ã€€ã€€ã€€ã€€ã€€ã€€#sets : methods for sets.
   ã€€ã€€ã€€ã€€ã€€ã€€#maps : methods for maps.
   ã€€ã€€ã€€ã€€ã€€ã€€#aggregates : methods for creating aggregates on arrays or collections.
   ==================================================================================
   
     Selection Variable Expressions: *{...}ï¼šé€‰æ‹©è¡¨è¾¾å¼ï¼šå’Œ${}åœ¨åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·ï¼›
     Message Expressions: #{...}ï¼šè·å–å›½é™…åŒ–å†…å®¹
     Link URL Expressions: @{...}ï¼šå®šä¹‰URLï¼›
     Fragment Expressions: ~{...}ï¼šç‰‡æ®µå¼•ç”¨è¡¨è¾¾å¼
   
   Literalsï¼ˆå­—é¢é‡ï¼‰
         Text literals: 'one text' , 'Another one!' ,â€¦
         Number literals: 0 , 34 , 3.0 , 12.3 ,â€¦
         Boolean literals: true , false
         Null literal: null
         Literal tokens: one , sometext , main ,â€¦
         
   Text operations:ï¼ˆæ–‡æœ¬æ“ä½œï¼‰
       String concatenation: +
       Literal substitutions: |The name is ${name}|
       
   Arithmetic operations:ï¼ˆæ•°å­¦è¿ç®—ï¼‰
       Binary operators: + , - , * , / , %
       Minus sign (unary operator): -
       
   Boolean operations:ï¼ˆå¸ƒå°”è¿ç®—ï¼‰
       Binary operators: and , or
       Boolean negation (unary operator): ! , not
       
   Comparisons and equality:ï¼ˆæ¯”è¾ƒè¿ç®—ï¼‰
       Comparators: > , < , >= , <= ( gt , lt , ge , le )
       Equality operators: == , != ( eq , ne )
       
   Conditional operators:æ¡ä»¶è¿ç®—ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰
       If-then: (if) ? (then)
       If-then-else: (if) ? (then) : (else)
       Default: (value) ?: (defaultvalue)
       
   Special tokens:
       No-Operation: _
   ```

#### å®ä¾‹

![image-20210827104317382](springboot.assets/image-20210827104317382.png)

ç¼–å†™controller

```java
package com.zhangyk.springboot03web.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.Arrays;

/*æˆ‘ä»¬è¦è·³é¡µé¢ï¼Œç”¨@Controllerä»£è¡¨ä»–ä¼šè·³åˆ°ä¸€ä¸ªé¡µé¢ï¼›ä¸èƒ½ç”¨restcontroller
*
* åœ¨templateç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡controlleræ¥è·³è½¬ï¼›è¿™ä¸ªéœ€è¦æ¨¡æ¿å¼•æ“ï¼ˆthymeleafï¼‰çš„æ”¯æŒã€‚
* */
@Controller
public class IndexController {

    @RequestMapping("/test")
    public String index(Model model){

        model.addAttribute("msg","<h1>hellospringboot,zyk<h1>");
        model.addAttribute("users", Arrays.asList("zhangyun","zyk"));
        return "test";
    }
}
```

ç¼–å†™å‰ç«¯html

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!--æ‰€æœ‰htmlå…ƒç´ éƒ½å¯ä»¥è¢«thymeleafæ›¿æ¢æ¥ç®¡ï¼šthï¼šå…ƒç´ å-->

<!--å±•ç¤ºå­—ç¬¦ï¼šä¸ä¼šè½¬ä¹‰ï¼Œmsgç›´æ¥å°±ä»¥æ–‡æœ¬å±•ç°-->
<div th:text="${msg}"></div>
<!--å±•ç¤ºå­—ç¬¦ï¼šä¼šè½¬ä¹‰ï¼Œmsgä¸­ç‰¹æ®Šå­—ç¬¦ä¼šè¢«ç¿»è¯‘-->
<div th:utext="${msg}"></div>

<hr/>

<!--éå†ï¼šéå†å‡ºçš„æ¯ä¸ªå…ƒç´ ï¼ˆuserï¼‰ï¼Œå±•ç°åœ¨æ–‡æœ¬é‡Œ-->
<h3 th:each="user:${users}" th:text="${user}"></h3>

</body>
</html>
```

å¯åŠ¨tomcatæµ‹è¯•ï¼›æ–‡å­—å†…å®¹éƒ½è¢«æ­£ç¡®æ˜¾ç¤º

![image-20210827104435936](springboot.assets/image-20210827104435936.png)

### mvcé…ç½®åŸç†

#### å®˜ç½‘é˜…è¯»

åœ¨è¿›è¡Œé¡¹ç›®ç¼–å†™å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯SpringBootå¯¹æˆ‘ä»¬çš„SpringMVCè¿˜åšäº†å“ªäº›é…ç½®ï¼ŒåŒ…æ‹¬å¦‚ä½•æ‰©å±•ï¼Œå¦‚ä½•å®šåˆ¶ã€‚

åªæœ‰æŠŠè¿™äº›éƒ½ææ¸…æ¥šäº†ï¼Œæˆ‘ä»¬åœ¨ä¹‹åä½¿ç”¨æ‰ä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚é€”å¾„ä¸€ï¼šæºç åˆ†æï¼Œé€”å¾„äºŒï¼šå®˜æ–¹æ–‡æ¡£ï¼

åœ°å€ ï¼šhttps://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-auto-configuration

```
Spring MVC Auto-configuration
// Spring Bootä¸ºSpring MVCæä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°ä¸å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸€èµ·å·¥ä½œã€‚
Spring Boot provides auto-configuration for Spring MVC that works well with most applications.
// è‡ªåŠ¨é…ç½®åœ¨Springé»˜è®¤è®¾ç½®çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
The auto-configuration adds the following features on top of Springâ€™s defaults:
// åŒ…å«è§†å›¾è§£æå™¨
Inclusion of ContentNegotiatingViewResolver and BeanNameViewResolver beans.
// æ”¯æŒé™æ€èµ„æºæ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œä»¥åŠwebjars
Support for serving static resources, including support for WebJars 
// è‡ªåŠ¨æ³¨å†Œäº†Converterï¼š
// è½¬æ¢å™¨ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç½‘é¡µæäº¤æ•°æ®åˆ°åå°è‡ªåŠ¨å°è£…æˆä¸ºå¯¹è±¡çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æŠŠ"1"å­—ç¬¦ä¸²è‡ªåŠ¨è½¬æ¢ä¸ºintç±»å‹
// Formatterï¼šã€æ ¼å¼åŒ–å™¨ï¼Œæ¯”å¦‚é¡µé¢ç»™æˆ‘ä»¬äº†ä¸€ä¸ª2019-8-10ï¼Œå®ƒä¼šç»™æˆ‘ä»¬è‡ªåŠ¨æ ¼å¼åŒ–ä¸ºDateå¯¹è±¡ã€‘
Automatic registration of Converter, GenericConverter, and Formatter beans.
// HttpMessageConverters
// SpringMVCç”¨æ¥è½¬æ¢Httpè¯·æ±‚å’Œå“åº”çš„çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æŠŠä¸€ä¸ªUserå¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¯ä»¥å»çœ‹å®˜ç½‘æ–‡æ¡£è§£é‡Šï¼›
Support for HttpMessageConverters (covered later in this document).
// å®šä¹‰é”™è¯¯ä»£ç ç”Ÿæˆè§„åˆ™çš„
Automatic registration of MessageCodesResolver (covered later in this document).
// é¦–é¡µå®šåˆ¶
Static index.html support.
// å›¾æ ‡å®šåˆ¶
Custom Favicon support (covered later in this document).
// åˆå§‹åŒ–æ•°æ®ç»‘å®šå™¨ï¼šå¸®æˆ‘ä»¬æŠŠè¯·æ±‚æ•°æ®ç»‘å®šåˆ°JavaBeanä¸­ï¼
Automatic use of a ConfigurableWebBindingInitializer bean (covered later in this document).

/*
å¦‚æœæ‚¨å¸Œæœ›ä¿ç•™Spring Boot MVCåŠŸèƒ½ï¼Œå¹¶ä¸”å¸Œæœ›æ·»åŠ å…¶ä»–MVCé…ç½®ï¼ˆæ‹¦æˆªå™¨ã€æ ¼å¼åŒ–ç¨‹åºã€è§†å›¾æ§åˆ¶å™¨å’Œå…¶ä»–åŠŸèƒ½ï¼‰ï¼Œåˆ™å¯ä»¥æ·»åŠ è‡ªå·±
çš„@configurationç±»ï¼Œç±»å‹ä¸ºwebmvcconfiguerï¼Œä½†ä¸æ·»åŠ @EnableWebMvcã€‚å¦‚æœå¸Œæœ›æä¾›
RequestMappingHandlerMappingã€RequestMappingHandlerAdapteræˆ–ExceptionHandlerExceptionResolverçš„è‡ªå®šä¹‰
å®ä¾‹ï¼Œåˆ™å¯ä»¥å£°æ˜WebMVCregistrationAdapterå®ä¾‹æ¥æä¾›æ­¤ç±»ç»„ä»¶ã€‚
*/
If you want to keep Spring Boot MVC features and you want to add additional MVC configuration 
(interceptors, formatters, view controllers, and other features), you can add your own 
@Configuration class of type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide 
custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or 
ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.

// å¦‚æœæ‚¨æƒ³å®Œå…¨æ§åˆ¶Spring MVCï¼Œå¯ä»¥æ·»åŠ è‡ªå·±çš„@Configurationï¼Œå¹¶ç”¨@EnableWebMvcè¿›è¡Œæ³¨é‡Šã€‚
If you want to take complete control of Spring MVC, you can add your own @Configuration annotated with @EnableWebMvc.
```

æˆ‘ä»¬æ¥ä»”ç»†å¯¹ç…§ï¼Œçœ‹ä¸€ä¸‹å®ƒæ€ä¹ˆå®ç°çš„ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬SpringBootå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½äº†SpringMVCï¼Œç„¶åè‡ªåŠ¨é…ç½®äº†å“ªäº›ä¸œè¥¿å‘¢ï¼Ÿ



æºç åˆå­¦æš‚ä¸éœ€ç»†ç©¶ï¼Œå…ˆå®æˆ˜è¯•ç€åœ¨springbootä¸­æ‰©å±•ä¸€ä¸ªè§†å›¾è§£æå™¨

#### å®ä¾‹

ç¼–å†™é…ç½®ç±»æ¥å°è¯•åœ¨springbootä¸­è¿›è¡Œmvcé…ç½®ï¼Œæœ¬ä¾‹æ˜¯è‡ªå®šä¹‰è§†å›¾è§£æå™¨ã€‚

```java
package com.zhangyk.springboot03web.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.View;
import org.springframework.web.servlet.ViewResolver;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

import java.util.Locale;

//æ‰©å±•springmvc
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {
    //å¦‚æœä½ æƒ³diyä¸€äº›å®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼Œåªè¦å†™è¿™ä¸ªç»„ä»¶ï¼Œç„¶åæŠŠå®ƒäº¤ç»™springbootï¼Œspringbootå°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è£…é…
    // alt+insertæœ‰å„ç§æ–¹æ³•å¯ä»¥é‡å†™ï¼Œå¯ä»¥å®ç°ä¸åŒçš„åŠŸèƒ½
    //viewresolver å®ç°äº†è§†å›¾è§£æå™¨æ¥å£çš„ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒçœ‹åšè§†å›¾è§£æå™¨

    //ä½¿ç”¨é…ç½®ç±»çš„æ–¹æ³•æ³¨å†Œbean
    @Bean
    public ViewResolver myViewResolver(){
        return new MyViewResolver();
    }


    //å®šä¹‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæ–¹ä¾¿æµ‹è¯•
    public static class MyViewResolver implements ViewResolver {

        @Override
        public View resolveViewName(String s, Locale locale) throws Exception {
            return null;
        }
    }
}
```

mvcçš„æ ¸å¿ƒæ˜¯dispathcerservletçš„dodispatcheræ–¹æ³•ã€‚

åŒå‡»shiftæ‰¾åˆ°è¯¥ç±»ï¼Œcontrol+fæ‰¾åˆ°å¯¹åº”æ–¹æ³•ï¼›æ‰“å¥½æ–­ç‚¹ï¼Œå¯åŠ¨debugã€‚

![image-20210827165147011](springboot.assets/image-20210827165147011.png)

è®¿é—®localhost:8080ï¼Œè¿™æ‰ä¼šå»èµ°dispatcherservletï¼›é¦–é¡µç”±äºè®¾ç½®äº†æ–­ç‚¹ï¼Œæ— æ³•åŠ è½½å‡ºæ¥ï¼Œè¿™æ˜¯å›åˆ°ideaã€‚

![image-20210827165412057](springboot.assets/image-20210827165412057.png)

![image-20210827165524557](springboot.assets/image-20210827165524557.png)

å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„è§†å›¾è§£æå™¨ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è‡ªå®šä¹‰çš„è§†å›¾è§£æå™¨ï¼Œè¯´æ˜mvcé…ç½®æˆåŠŸã€‚

![image-20210827165608183](springboot.assets/image-20210827165608183.png)



å¤‡æ³¨ï¼šä¸€èˆ¬ä¸ä¼šè‡ªå®šä¹‰è§†å›¾è§£æå™¨ï¼Œè¿™é‡Œè®²è§£ä»…ä¾›å…¥é—¨springbootä¸­åšmvcé…ç½®ã€‚



### æ‰©å±•SpringMVC

#### ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®

è¿™ä¹ˆå¤šçš„è‡ªåŠ¨é…ç½®ï¼ŒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡è¿™ä¸ªWebMVCçš„è‡ªåŠ¨é…ç½®åŸç†åˆ†æï¼Œæˆ‘ä»¬è¦å­¦ä¼šä¸€ç§å­¦ä¹ æ–¹å¼ï¼Œé€šè¿‡æºç æ¢ç©¶ï¼Œå¾—å‡ºç»“è®ºï¼›è¿™ä¸ªç»“è®ºä¸€å®šæ˜¯å±äºè‡ªå·±çš„ï¼Œè€Œä¸”ä¸€é€šç™¾é€šã€‚

- 20230522æˆ‘ï¼šåšé¡¹ç›®å…¶å®ä¸ç”¨æ‡‚æºç ï¼Œæœ‰é¡¹ç›®ç»éªŒååšé¡¹ç›®å°±è¡Œã€‚

SpringBootçš„åº•å±‚ï¼Œå¤§é‡ç”¨åˆ°äº†è¿™äº›è®¾è®¡ç»†èŠ‚æ€æƒ³ï¼Œæ‰€ä»¥ï¼Œæ²¡äº‹éœ€è¦å¤šé˜…è¯»æºç ï¼å¾—å‡ºç»“è®ºï¼›

SpringBootåœ¨è‡ªåŠ¨é…ç½®å¾ˆå¤šç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆçœ‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·è‡ªå·±é…ç½®çš„ï¼ˆå¦‚æœç”¨æˆ·è‡ªå·±é…ç½®@beanï¼‰ï¼Œå¦‚æœæœ‰å°±ç”¨ç”¨æˆ·é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨è‡ªåŠ¨é…ç½®çš„ï¼›

å¦‚æœæœ‰äº›ç»„ä»¶å¯ä»¥å­˜åœ¨å¤šä¸ªï¼Œæ¯”å¦‚æˆ‘ä»¬çš„è§†å›¾è§£æå™¨ï¼Œå°±å°†ç”¨æˆ·é…ç½®çš„å’Œè‡ªå·±é»˜è®¤çš„ç»„åˆèµ·æ¥ï¼

**æ‰©å±•ä½¿ç”¨SpringMVC**  å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼š

If you want to keep Spring Boot MVC features and you want to add additional MVC configuration (interceptors, formatters, view controllers, and other features), you can add your own @Configuration class of type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.

æˆ‘ä»¬è¦åšçš„å°±æ˜¯ç¼–å†™ä¸€ä¸ª@Configurationæ³¨è§£ç±»ï¼Œå¹¶ä¸”ç±»å‹è¦ä¸ºWebMvcConfigurerï¼Œè¿˜ä¸èƒ½æ ‡æ³¨@EnableWebMvcæ³¨è§£ï¼›æˆ‘ä»¬å»è‡ªå·±å†™ä¸€ä¸ªï¼›æˆ‘ä»¬æ–°å»ºä¸€ä¸ªåŒ…å«configï¼Œå†™ä¸€ä¸ªç±»MyMvcConfigï¼›

```java
package com.zhangyk.springboot03web.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistration;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/*
* å¦‚æœæˆ‘ä»¬è¦æ‰©å±•springmvcï¼Œå®˜æ–¹å»ºè®®æˆ‘ä»¬è¿™æ ·å»åšï¼å³è‡ªå·±å†™å„ç§configç±»
* */
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {

    //è§†å›¾è·³è½¬
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        //è®¾ç½®urlè¯·æ±‚ï¼ŒåŠè¯¥è¯·æ±‚å¯¹åº”è·³å¾€çš„è§†å›¾çš„åå­—
        registry.addViewController("zhangyk").setViewName("test");
    }
}
```

æˆ‘ä»¬å»æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼Œç¡®å®è·³è½¬è¿‡æ¥äº†

![image-20210827182743830](springboot.assets/image-20210827182743830.png)

æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬è¦æ‰©å±•SpringMVCï¼Œ**å®˜æ–¹å°±æ¨è**æˆ‘ä»¬è¿™ä¹ˆå»ä½¿ç”¨ï¼Œæ—¢ä¿SpringBootç•™æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ï¼Œä¹Ÿèƒ½ç”¨æˆ‘ä»¬æ‰©å±•çš„é…ç½®ï¼



#### å…¨é¢æ¥ç®¡SpringMVC

å®˜æ–¹æ–‡æ¡£ï¼š

```
If you want to take complete control of Spring MVC
you can add your own @Configuration annotated with @EnableWebMvc.
```

å…¨é¢æ¥ç®¡å³ï¼šSpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®ä¸éœ€è¦äº†ï¼Œæ‰€æœ‰éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±å»é…ç½®ï¼

åªéœ€åœ¨æˆ‘ä»¬çš„é…ç½®ç±»ä¸­è¦åŠ ä¸€ä¸ª@EnableWebMvcã€‚

æˆ‘ä»¬çœ‹ä¸‹å¦‚æœæˆ‘ä»¬å…¨é¢æ¥ç®¡äº†SpringMVCäº†ï¼Œæˆ‘ä»¬ä¹‹å‰SpringBootç»™æˆ‘ä»¬é…ç½®çš„é™æ€èµ„æºæ˜ å°„ä¸€å®šä¼šæ— æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥å»æµ‹è¯•ä¸€ä¸‹ï¼›

ä¸åŠ æ³¨è§£ä¹‹å‰ï¼Œè®¿é—®é¦–é¡µï¼š

![Image](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Idia351qHgmH2vbzurk1Pp6ic2wzwiaMd6YwOHuK1fcn3ibhuXD60XiarS9NLdTIDJJicFZJt1wQ0ibuUxg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

ç»™é…ç½®ç±»åŠ ä¸Šæ³¨è§£ï¼š@EnableWebMvc

![Image](https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Idia351qHgmH2vbzurk1Pp68kRH4rPKMyhAdkIL46HW90qsSoyMcNibRxDbfu7iboWM6AMRr5tFSicPA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

æˆ‘ä»¬å‘ç°æ‰€æœ‰çš„SpringMVCè‡ªåŠ¨é…ç½®éƒ½å¤±æ•ˆäº†ï¼å›å½’åˆ°äº†æœ€åˆçš„æ ·å­ï¼›

**å½“ç„¶ï¼Œæˆ‘ä»¬å¼€å‘ä¸­ï¼Œä¸æ¨èä½¿ç”¨å…¨é¢æ¥ç®¡SpringMVC**

æ€è€ƒé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆåŠ äº†ä¸€ä¸ªæ³¨è§£ï¼Œè‡ªåŠ¨é…ç½®å°±å¤±æ•ˆäº†ï¼æˆ‘ä»¬çœ‹ä¸‹æºç ï¼š

1ã€è¿™é‡Œå‘ç°å®ƒæ˜¯å¯¼å…¥äº†ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›å»çœ‹

```java
@Import({DelegatingWebMvcConfiguration.class})
public @interface EnableWebMvc {
}
```

2ã€å®ƒç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±» WebMvcConfigurationSupport

```java
public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {
  // ......
}
```

3ã€æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹Webmvcè‡ªåŠ¨é…ç½®ç±»

```java
@Configuration(proxyBeanMethods = false)
@ConditionalOnWebApplication(type = Type.SERVLET)
@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })
// è¿™ä¸ªæ³¨è§£çš„æ„æ€å°±æ˜¯ï¼šå®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰ç”Ÿæ•ˆ
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)
@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,
    ValidationAutoConfiguration.class })
public class WebMvcAutoConfiguration {
    
}
```

æ€»ç»“ä¸€å¥è¯ï¼š@EnableWebMvcå°†WebMvcConfigurationSupportç»„ä»¶å¯¼å…¥è¿›æ¥äº†ï¼›

è€Œå¯¼å…¥çš„WebMvcConfigurationSupportåªæ˜¯SpringMVCæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼

åœ¨**SpringBootä¸­ä¼šæœ‰éå¸¸å¤šçš„æ‰©å±•é…ç½®**ï¼Œåªè¦çœ‹è§äº†è¿™ä¸ª(XXXConfiguration(æœ¬ä¾‹MyMvcConfigå±äºå‘½åä¸è§„èŒƒ))ï¼Œæˆ‘ä»¬å°±åº”è¯¥å¤šç•™å¿ƒæ³¨æ„~



## webå¼€å‘å®æˆ˜ï¼ˆæ— æ•°æ®åº“ï¼‰

kuangshenæºç ä¸‹è½½ä½ç½®ï¼šD:\idea\backend_template\springboot-webapp_ioqjwdiomc



### é¦–é¡µé…ç½®

æ³¨æ„ç‚¹ï¼Œå‰åç«¯ä¸åˆ†ç¦»çš„è¯ï¼Œæ‰€æœ‰é¡µé¢çš„é™æ€èµ„æºéƒ½éœ€è¦ä½¿ç”¨thymeleafæ¥ç®¡ï¼›@{}

### é¡µé¢å›½é™…åŒ–

#### åˆæ­¥ç”Ÿæˆä¸åŒå›½å®¶çš„é…ç½®æ–‡ä»¶

åœ¨resourceä¸‹çš„i18nï¼ˆå³internationalï¼‰æ–‡ä»¶å¤¹ï¼Œå»ºç«‹å›½é™…åŒ–çš„é…ç½®æ–‡ä»¶

- å»ºç«‹login.propertieså’Œlogin_zh_CN.propertiesæ–‡ä»¶ï¼Œideaä¼šè‡ªåŠ¨æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å…±åŒå­˜æ”¾äºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ä¸‹

  ![image-20210904110750758](springboot.assets/image-20210904110750758.png)

- è¿˜å¯ä»¥åœ¨è‡ªåŠ¨ç”Ÿæˆçš„Resource Bundle Loginæ–‡ä»¶å¤¹ä¸‹ï¼ŒæŒ‰è¦æ±‚è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶

  ![image-20210904111014481](springboot.assets/image-20210904111014481.png)

  ![image-20210904111057118](springboot.assets/image-20210904111057118.png)

  è‡ªåŠ¨ç”Ÿæˆäº†ç¾å¼è‹±è¯­çš„é…ç½®æ–‡ä»¶

  ![image-20210904111120004](springboot.assets/image-20210904111120004.png)

#### å¯è§†åŒ–é…ç½®ä¸åŒå›½å®¶çš„é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆç¡®ä¿ideaçš„å„ä¸ªç¼–ç éƒ½æ˜¯utf8

![image-20210904113220088](springboot.assets/image-20210904113220088.png)

ç‚¹å‡»reource bundle

![image-20210904111737771](springboot.assets/image-20210904111737771.png)

å³é”®loginæ€»é…ç½®æ–‡ä»¶

![image-20210904111812053](springboot.assets/image-20210904111812053.png)

é…ç½®â€œç™»å½•æç¤ºâ€å›½é™…åŒ–

![image-20210904111856953](springboot.assets/image-20210904111856953.png)

![image-20210904112208312](springboot.assets/image-20210904112208312.png)

é…ç½®â€œå¯†ç â€å›½é™…åŒ–

æ³¨æ„**property key nameçš„å‘½å**ï¼šæ€»é…ç½®æ–‡ä»¶å(login).å­é…ç½®é¡¹å(password)

![image-20210904112704297](springboot.assets/image-20210904112704297.png)

![image-20210904113059042](springboot.assets/image-20210904113059042.png)

é…ç½®â€œè®°ä½å¯†ç â€çš„å›½é™…åŒ–

![image-20210904113713924](springboot.assets/image-20210904113713924.png)

åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å›½é™…åŒ–æ–‡ä»¶çš„ä½ç½®ã€‚**thymeleafçš„æ–‡å­—ç”¨#{}å–**ã€‚

![image-20210925145828859](springboot.assets/image-20210925145828859.png)

åœ¨å‰ç«¯ä»£ç ä¸­å¯¹å„ä¸ªæ–‡å­—åŒºè®¾ç½®å¥½å›½é™…åŒ–

![image-20210925150150493](springboot.assets/image-20210925150150493.png)

å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•(localhoståé¢ä¸€å®šè¦åŠ ä¸Šæˆ‘ä»¬è‡ªå®šä¹‰çš„é¡¹ç›®è®¿é—®è·¯å¾„)ã€‚å¯ä»¥çœ‹åˆ°htmlä¸­åŸæœ¬çš„è‹±æ–‡å†…å®¹å·²ç»è¢«thymleafè®¾ç½®çš„å›½é™…åŒ–å†…å®¹æ›¿ä»£äº†ï¼Œæ›¿ä»£æˆæˆ‘ä»¬åœ¨resource/i18n/login_zh_CN.propertiesä¸­è®¾ç½®çš„ä¸­æ–‡æ ¼å¼ã€‚

![image-20210925151443156](springboot.assets/image-20210925151443156.png)

#### å›½é™…åŒ–åˆ‡æ¢

æˆ‘ä»¬æœç´¢WebMvcAutoConfiguration.javaå¯ä»¥æ‰¾åˆ°`public org.springframework.web.servlet.LocaleResolver localeResolver() { /* compiled code */ }`ï¼Œè¯´æ˜å¯ä»¥é€šè¿‡org.springframework.web.servlet.**LocaleResolver**å®ç°å›½é™…åŒ–ã€‚



ç”¨äºåˆ‡æ¢çš„æ–‡å­—æ‰€åœ¨çš„æ ‡ç­¾åŠ ä¸Šthymeleafé“¾æ¥ï¼Œç”¨äºç»™å®ç°äº†LocalResolveræ¥å£çš„è‡ªå®šä¹‰ç±»MyLocalResolverä¼ å‚æ•°ï¼šzh_CNæˆ–en_USã€‚MyLocalResolverç±»é‡å†™çš„resolveLocaleä¼šæ ¹æ®æ‹¿åˆ°çš„å‚æ•°è¿”å›Localeå¯¹è±¡ï¼Œè¿™æ ·SpringMVCå°±æ ¹æ®Localeå¯¹è±¡ï¼Œç»“åˆresource bundleï¼Œè‡ªåŠ¨æŠŠindex.htmlå›½é™…åŒ–ã€‚**thymeleafçš„urlç”¨@{}å–**

![image-20210925153517576](springboot.assets/image-20210925153517576.png)

ç¼–å†™MyLocalResolverä»è€Œè§£æè¯·æ±‚ã€‚ä¸ªäººç†è§£è¿™ä¸ªresolverç›¸å½“äºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¼šè¿‡æ»¤è¯·æ±‚å¹¶å¤„ç†ã€‚å¦‚æœæ‰¾åˆ°æŒ‡å®šçš„å‚æ•°ï¼Œå°±ä¼šç”¨ä¸Ši18n/resource bundleä¸­å®šä¹‰çš„å›½é™…åŒ–æ–‡å­—ç¿»è¯‘

```java
package com.zhangyk.springboot03web.config;

import org.springframework.web.servlet.LocaleResolver;
import org.springframework.util.StringUtils;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.Locale;

public class MyLocalResolver implements LocaleResolver {
//    public MyLocalResolver() {
//        super();
//    }

    @Override
    public Locale resolveLocale(HttpServletRequest httpServletRequest) {

        //è·å–è¯·æ±‚ä¸­çš„è¯·æ±‚å‚æ•°
        String l = httpServletRequest.getParameter("l");

        //å¦‚æœå‰ç«¯æ²¡æœ‰ä¼ é€’ä½¿ç”¨å“ªç§è¯­è¨€ï¼Œä½¿ç”¨é»˜è®¤çš„localeå¹¶è¿”å›
        Locale locale = Locale.getDefault();

        //å¦‚æœè¯·æ±‚çš„é“¾æ¥æºå¸¦äº†å›½é™…åŒ–çš„å‚æ•°
        if(!StringUtils.isEmpty(l)){
            //æŠŠå›½é™…åŒ–å‚æ•°åˆ†å‰²å¹¶å‚¨å­˜ï¼Œå¦‚zh_CNåˆ‡å‰²ä¸ºzhå’ŒCN
            String[] s = l.split("_");
            //è¦†ç›–æ‰é»˜è®¤çš„locale
            locale = new Locale(s[0], s[1]);
        }

        System.out.println("locale:"+locale);

        return locale;

    }

    @Override
    public void setLocale(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale) {

    }
}
```

åœ¨å®ç°äº†WebMvcConfigureræ¥å£çš„MyMvcConfigè‡ªå®šä¹‰ç±»ä¸­ï¼Œæ³¨å†ŒMyLocalResolver beanï¼ˆå®ç°æ³¨å†Œè‡ªå®šä¹‰çš„resolverï¼‰

```java
package com.zhangyk.springboot03web.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.LocaleResolver;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/*
* å¦‚æœæˆ‘ä»¬è¦æ‰©å±•springmvcï¼Œå®˜æ–¹å»ºè®®æˆ‘ä»¬è¿™æ ·å»åšï¼å³è‡ªå·±å†™å„ç§configç±»
* */
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {

    /*
    * æ ¹æ®è¯·æ±‚ï¼Œé…ç½®æ¯ä¸ªè¯·æ±‚å¯¹åº”è·³è½¬çš„è§†å›¾
    * */
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/index.html").setViewName("index");
    }

    //æ³¨å†Œ MyLocalResolverå·¥å…·ç±»
    //ä¸€å®šä¸è¦å¿˜è®°@beanæ³¨è§£ï¼Œå¦åˆ™æ²¡æ³¨å†Œè¿›å»
    @Bean
    public LocaleResolver localeResolver(){
        return new MyLocalResolver();
    }
}
```

è¿è¡Œé¡¹ç›®æŸ¥çœ‹æ•ˆæœ

è®¿é—®é¡¹ç›®

![image-20210925171004348](springboot.assets/image-20210925171004348.png)

ç‚¹å‡»englishï¼Œé¡µé¢åˆ‡æ¢ä¸ºè‹±è¯­æ¨¡å¼

![image-20210925171029906](springboot.assets/image-20210925171029906.png)

ç‚¹å‡»â€œä¸­æ–‡â€é¡µé¢åˆ‡æ¢ä¸ºä¸­æ–‡æ¨¡å¼

![image-20210925171132740](springboot.assets/image-20210925171132740.png)



### ç™»å½•åŠŸèƒ½å®ç°

ç™»å½•æŒ‰é’®ç»‘å®šçš„åœ°å€æ”¹æˆthymeleafæ¥ç®¡çš„å½¢å¼ï¼Œå³æ”¹ä¸ºè¯·æ±‚è·¯å¾„ï¼Œè¯¥è¯·æ±‚è·¯å¾„ä¼šå¯¹åº”ä¸€ä¸ªcontrollerå»å¤„ç†ç™»å½•è¯·æ±‚ã€‚urlä¸º@{}çš„æ ¼å¼ã€‚

![image-20210925204040812](springboot.assets/image-20210925204040812.png)

ç¼–å†™ç™»å½•æ§åˆ¶ç±»

```java
package com.zhangyk.springboot03web.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.thymeleaf.util.StringUtils;

@Controller
public class LoginController {

    //æ ‡è®°å“ªä¸ªè¯·æ±‚ä¼šèµ°å“ªä¸ªæ–¹æ³•
    @RequestMapping("/user/login")
    //@ResponseBodyè¡¨ç¤ºæ–¹æ³•è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èµ°è§†å›¾è§£æå™¨ã€‚æœ¬ç¨‹åºå¸Œæœ›è·³è½¬åˆ°è§†å›¾ï¼Œæ‰€ä»¥è¦æ³¨é”€æ‰responsebody
    //@ResponseBody
    public String login(@RequestParam("username") String username, @RequestParam("password") String password, Model model){

        //ä¸šåŠ¡å¤„ç†
        if(!StringUtils.isEmpty(username)&&"123456".equals(password)){
            /*è´¦å·å¯†ç ç¬¦åˆè¦æ±‚ï¼Œå»åˆ°ç™»å½•æˆåŠŸé¡µé¢ã€‚é¡µé¢çœ‹ä¸Šå»æ˜¯è®¿é—®äº†main.html,ä½†æ˜¯å®é™…åœ¨MyMvcConfigä¸­é…ç½®äº†mian.htmlåˆ°dashboardçš„
            æ˜ å°„ï¼Œæ‰€ä»¥å®é™…é‡å®šå‘åˆ°äº†dashboardé¡µé¢*/
            return "redirect:/main.html";
        }else{
            //å‘Šè¯‰ç”¨æˆ·ä½ ç™»å½•å¤±è´¥äº†
            model.addAttribute("msg","ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            return "index";

        }
    }
}

```

åœ¨springMVCé…ç½®ç±»ä¸­è®¾ç½®è§†å›¾main.htmlæ˜ å°„ä¸ºdashboard

```java
package com.zhangyk.springboot03web.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.LocaleResolver;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/*
* å¦‚æœæˆ‘ä»¬è¦æ‰©å±•springmvcï¼Œå®˜æ–¹å»ºè®®æˆ‘ä»¬è¿™æ ·å»åšï¼å³è‡ªå·±å†™å„ç§configç±»
* */
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {

    /*
    * æ ¹æ®è¯·æ±‚ï¼Œé…ç½®æ¯ä¸ªè¯·æ±‚å¯¹åº”è·³è½¬çš„è§†å›¾
    * */
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/index.html").setViewName("index");
        //æŠŠä¸€ä¸ªè§†å›¾è§£æå™¨çš„è¯·æ±‚ï¼Œè½¬å˜æˆå¦ä¸€ä¸ªã€‚è¡¨é¢ä¸Šçœ‹åƒè¯·æ±‚main.htmlï¼Œä½†å…¶å®è¯·æ±‚çš„æ˜¯dashboardé¡µé¢
        registry.addViewController("/main.html").setViewName("dashboard");
    }

    //æ³¨å†Œ MyLocalResolverå·¥å…·ç±»
    //ä¸€å®šä¸è¦å¿˜è®°@beanæ³¨è§£ï¼Œå¦åˆ™æ²¡æ³¨å†Œè¿›å»
    @Bean
    public LocaleResolver localeResolver(){
        return new MyLocalResolver();
    }
}
```

æäº¤è¡¨å•çš„inputé¡¹éœ€è¦nameå±æ€§

![image-20210925205349554](springboot.assets/image-20210925205349554.png)

å‰ç«¯ç¼–å†™ç™»å½•é”™è¯¯çš„æç¤ºï¼Œå¯ä»¥ç”¨th:ifæ¥å®ç°åˆ¤æ–­ã€‚**thymeleafä¸­è¡¨è¾¾å¼è¦ç”¨${}**ã€‚

![image-20210925211935691](springboot.assets/image-20210925211935691.png)

è¿è¡Œé¡¹ç›®

è¾“å…¥ç¬¦åˆè¦æ±‚çš„ç”¨æˆ·åå’Œå¯†ç åï¼ŒæˆåŠŸæ¥åˆ°ç™»å½•æˆåŠŸçš„é¡µé¢

![image-20210926140143393](springboot.assets/image-20210926140143393.png)

è¾“å…¥ä¸ç¬¦åˆè¦æ±‚çš„ç”¨æˆ·åå’Œå¯†ç åï¼Œé¡µé¢ä¼šä»modelä¸­æ‹¿åˆ°é”™è¯¯æç¤º

![image-20210925214500233](springboot.assets/image-20210925214500233.png)

ä½†æ˜¯è¦é˜²æ­¢æœªç™»å½•ç›´æ¥è®¿é—®â€œhttp://localhost:8080/zhangyun/main.html"ä¹Ÿèƒ½è¿›å»çš„æƒ…å†µï¼Œæ‰€ä»¥è¦ç¼–å†™ä¸€ä¸ªæ‹¦æˆªå™¨



### ç™»é™†æ‹¦æˆªå™¨

åœ¨ç™»å½•æ§åˆ¶å™¨æ·»åŠ sessionå‚æ•°ï¼Œä¾¿äºé‡å®šå‘æ—¶ä¿å­˜æ˜¯å¦å·²ç™»å½•çš„æ¶ˆæ¯ï¼ˆå³â€œloginUserâ€ï¼‰

![image-20210926152414862](springboot.assets/image-20210926152414862.png)

ç™»å½•æ§åˆ¶å™¨ä»£ç å¦‚ä¸‹

```java
package com.zhangyk.springboot03web.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.thymeleaf.util.StringUtils;

import javax.servlet.http.HttpSession;

@Controller
public class LoginController {

    //æ ‡è®°å“ªä¸ªè¯·æ±‚ä¼šèµ°å“ªä¸ªæ–¹æ³•
    @RequestMapping("/user/login")
    //@ResponseBodyè¡¨ç¤ºæ–¹æ³•è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èµ°è§†å›¾è§£æå™¨ã€‚æœ¬ç¨‹åºå¸Œæœ›è·³è½¬åˆ°è§†å›¾ï¼Œæ‰€ä»¥è¦æ³¨é”€æ‰responsebody
    //@ResponseBody
    public String login(@RequestParam("username") String username,
                        @RequestParam("password") String password,
                        Model model,
                        HttpSession session){

        //ä¸šåŠ¡å¤„ç†
        if(!StringUtils.isEmpty(username)&&"123456".equals(password)){

            //ç™»å½•æˆåŠŸçš„è¯ï¼Œä¸ºsessionæ·»åŠ å‚æ•°ï¼Œæ–¹ä¾¿æ‹¦æˆªå™¨æ£€æŸ¥
            session.setAttribute("loginUser",username);

            /*è´¦å·å¯†ç ç¬¦åˆè¦æ±‚ï¼Œå»åˆ°ç™»å½•æˆåŠŸé¡µé¢ã€‚é¡µé¢çœ‹ä¸Šå»æ˜¯è®¿é—®äº†main.html,ä½†æ˜¯å®é™…åœ¨MyMvcConfigä¸­é…ç½®äº†mian.htmlåˆ°dashboardçš„
            æ˜ å°„ï¼Œæ‰€ä»¥å®é™…é‡å®šå‘åˆ°äº†dashboardé¡µé¢*/
            return "redirect:/main.html";
        }else{
            //å‘Šè¯‰ç”¨æˆ·ä½ ç™»å½•å¤±è´¥äº†
            model.addAttribute("msg","ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            return "index";

        }
    }
}
```

ç¼–å†™æ‹¦æˆªå™¨

```java
package com.zhangyk.springboot03web.config;

import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LoginHandlerInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        Object loginUser = request.getSession().getAttribute("loginUser");

        //æ²¡æœ‰ç™»é™†
        if(loginUser==null){
            request.setAttribute("msg","æ²¡æœ‰æƒé™ï¼Œè¯·å…ˆç™»å½•");
            //sessionçš„å‚æ•°â€œloginUserâ€æ˜¾ç¤ºå½“å‰è¯·æ±‚æ˜¯éç™»å½•çŠ¶æ€ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°index.htmlé¡µé¢
            request.getRequestDispatcher("/index.html").forward(request,response);
            //falseä¸æ”¾è¡Œ
            return false;
        }else{//ç™»é™†äº†åˆ™æ”¾è¡Œ

            return true;
        }

    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```

springMVCé…ç½®ç±»ä¸­ï¼ŒControl+Oï¼Œé‡å†™æ‹¦æˆªå™¨ç›¸å…³çš„æ–¹æ³•

```java
@Override
public void addInterceptors(InterceptorRegistry registry) {
    //æ³¨å†Œè‡ªå·±å†™çš„æ‹¦æˆªå™¨
    registry.addInterceptor(new LoginHandlerInterceptor()).
            //ä¼šæ‹¦æˆªå¤„ç†æ‰€æœ‰è¯·æ±‚ï¼ˆé™¤äº†ä¸‹é¢excludeæŒ‡å®šçš„ï¼‰
            addPathPatterns("/**").
            //ä¸æ‹¦æˆª â€œç™»å½•ç•Œé¢â€ï¼Œâ€œé¦–é¡µâ€ï¼Œâ€œç™»å½•è¯·æ±‚â€ã€‚è¿˜ä¸åº”æ‹¦æˆªå¯¹é™æ€èµ„æºå¦‚cssçš„è®¿é—®,æ‹¦æˆªçš„è¯é¡µé¢ä¼šå˜å½¢ã€‚
            excludePathPatterns("/index.html","/","/user/login","/css/**","/js/**","/img/**");
}
```

æƒ³è®©ç½‘é¡µå±•ç°ç™»å½•çš„ç”¨æˆ·åã€‚

- å› ä¸ºlogincontrollerä¸­çš„è¯·æ±‚å¤„ç†å‡½æ•°loginçš„sessionä¸­ä¿å­˜äº†ç”¨æˆ·åï¼Œæ‰€ä»¥æŠŠdashboardå‰ç«¯é¡µé¢çš„â€company nameâ€œæ”¹ä¸ºä»sessionä¸­æå–ï¼Œå³å¯å±•ç¤ºç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åã€‚å¦‚ä¸‹

  ![image-20210926152655116](springboot.assets/image-20210926152655116.png)



### å±•ç¤ºå‘˜å·¥åˆ—è¡¨

#### ç¼–å†™å‰ç«¯åŠå¯¹åº”controller

åœ¨å‰ç«¯é¡µé¢\<a>å¤„ç¼–å†™å¯¹åº”è¯·æ±‚

![image-20210926171023591](springboot.assets/image-20210926171023591.png)

ç¼–å†™è¯·æ±‚å¯¹åº”çš„controller

```java
package com.zhangyk.springboot03web.controller;

import com.zhangyk.springboot03web.dao.EmployeeDao;
import com.zhangyk.springboot03web.pojo.Employee;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.Collection;

@Controller
public class EmployeeController {

    @Autowired
    EmployeeDao employeeDao;

    @RequestMapping("/emps")
    public String list(Model model){

        Collection<Employee> all = employeeDao.getAll();
        model.addAttribute("emps",all);

        return "emp/list";

    }
}
```

#### æŠ½å–å…¬å…±éƒ¨åˆ†

ä¸åŒé¡µé¢å·¦è¾¹çš„ä¾§è¾¹æ æ˜¯ç›¸åŒçš„å¯ä»¥æŠ½å–å‡ºæ¥ã€‚

![image-20210929122232274](springboot.assets/image-20210929122232274.png)

æŠ½å–é‡å¤çš„ä¾§è¾¹æ ï¼Œç”¨th:fragmentæŠŠæŸé¡µé¢åŒºå—è½¬åŒ–ä¸ºç»„ä»¶

![image-20210929122626600](springboot.assets/image-20210929122626600.png)

åœ¨å¦ä¸€ä¸ªé¡µé¢éœ€è¦ä½¿ç”¨é‡å¤ç»„ä»¶æ—¶ï¼Œä½¿ç”¨th:insertæ’å…¥å³å¯ã€‚å®ç°äº†ä»£ç å¤ç”¨ã€‚å‰ç«¯ç»„ä»¶åŒ–yydsï¼ï¼ï¼

insertå’ŒreplaceåŒºåˆ«ï¼š

- insertä¼šåµŒå¥—ä¸€å±‚div
- replaceä¼šç›´æ¥æ›¿æ¢å½“å‰å…ƒç´ ï¼ˆå¸¸ç”¨ï¼‰

![image-20210929123036029](springboot.assets/image-20210929123036029.png)

å¼€å‘ä¸­å¸¸å¸¸ä¼šæŠŠé‡å¤ä»£ç æŠ½å–åˆ°commmonsæ–‡ä»¶å¤¹ä¸‹æ–¹ä¾¿å¤ç”¨.

è¿™é‡ŒæŠŠdashboardå’Œlistç­‰é¡µé¢å…¬å…±çš„éƒ¨åˆ†ï¼šä¾§è¾¹æ +å¤´éƒ¨æ ï¼Œå‰ªåˆ‡åˆ°commonsæ–‡ä»¶å¤¹ä¸­å¹¶æŠ½è±¡ä¸ºç»„ä»¶ã€‚è¿™æ ·dashboardå’Œlisté¡µé¢ä¸­çš„ä»£ç é‡éƒ½ä¼šå¤§å¤§å‡å°‘ï¼›ä¸”æ–¹ä¾¿ä¿®æ”¹é¡µé¢ã€‚

![image-20210929123753654](springboot.assets/image-20210929123753654.png)

ç°åœ¨ä½¿ç”¨th:replaceæ¥åº”ç”¨ç»„ä»¶ã€‚ç”±äºcommons.htmlä¸æ˜¯æ ¹ç›®å½•ä¸‹çš„äº†ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™è¦åŠ ä¸Šç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„ã€‚

![image-20210929124412546](springboot.assets/image-20210929124412546.png)

#### ä¾§è¾¹æ é«˜äº®

é¦–å…ˆåœ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¼ é€’ä¸€ä¸ªå‚æ•°activeã€‚**å¯ä»¥ç›´æ¥ä½¿ç”¨()ä¼ å‚**ã€‚

å½“å‰é¡µé¢ä¸ºä¸»é¡µé¢ï¼ˆdashboardï¼‰æ—¶ï¼ŒæŠ½å–çš„ç»„ä»¶åœ¨å–æŠ½å–çš„å†…å®¹æ—¶ï¼Œä¼ é€’å‚æ•°activeä¸ºlistã€‚

![image-20210929131406931](springboot.assets/image-20210929131406931.png)

å½“å‰é¡µé¢ä¸ºlisté¡µé¢æ—¶ï¼ŒæŠ½å–çš„ç»„ä»¶åœ¨å–æŠ½å–çš„å†…å®¹æ—¶ï¼Œä¼ é€’å‚æ•°activeä¸ºlist

![image-20210929131205889](springboot.assets/image-20210929131205889.png)

åœ¨æŠ½å–çš„ç»„ä»¶ä¸­ï¼Œåœ¨æ¯ä¸ªå¯èƒ½éœ€è¦é«˜äº®çš„æ ‡ç­¾åˆ¤æ–­ä¼ æ¥å¾—activeçš„å€¼ï¼Œå¦‚æœactiveçš„å€¼å¯¹åº”å½“å‰æ ‡ç­¾ï¼Œå½“å‰æ ‡ç­¾ï¼ˆè¿™é‡Œçš„æ ‡ç­¾\<a>å³é“¾æ¥ï¼‰é«˜äº®ï¼›å¦åˆ™å½“å‰é“¾æ¥æ ‡ç­¾æ˜¯æ™®é€šé“¾æ¥æ ‡ç­¾ï¼Œä¸é«˜äº®ã€‚

![image-20210929131013671](springboot.assets/image-20210929131013671.png)

#### foreachå±•ç¤ºæ•°æ®

åå°EmployeeControllerå¾€list.htmlä¼ äº†empsåˆ—è¡¨ã€‚å‰ç«¯ä½¿ç”¨foreachæ¥å±•ç¤ºempsï¼ˆæ‰€æœ‰employeeçš„æ•°æ®ï¼‰ã€‚



bootstrapä¸­ï¼š

- btnï¼šæŒ‰é’®
- btn-smï¼šå°æŒ‰é’®
- btn-primaryï¼šè“è‰²æŒ‰é’®
- btn-dangerï¼šçº¢è‰²æŒ‰é’®

ä½¿ç”¨å¦‚ä¸Šbootstrapæ¡†æ¶ï¼Œè½»æ¾å®šä¹‰æŒ‰é’®çš„æ ·å¼ï¼Œç®€åŒ–äº†å¼€å‘ï¼Œè¿™å°±æ˜¯æ¡†æ¶çš„å¥½å¤„

![image-20210929160842734](springboot.assets/image-20210929160842734.png)



å¯åŠ¨æœåŠ¡æµ‹è¯•

![image-20210929161716246](springboot.assets/image-20210929161716246.png)



#### è§£å†³æ•°æ®æ˜¾ç¤ºé—®é¢˜

![image-20210929162709786](springboot.assets/image-20210929162709786.png)

æŸ¥çœ‹ä¿®æ”¹ä»£ç åçš„æ˜¾ç¤ºã€‚æˆåŠŸã€‚

![image-20210929162805116](springboot.assets/image-20210929162805116.png)



### å¢åŠ å‘˜å·¥å®ç°

é¦–å…ˆåœ¨å‰ç«¯é¡µé¢çš„åˆé€‚ä½ç½®åŠ ä¸Šâ€æ·»åŠ å‘˜å·¥â€œçš„æŒ‰é’®ã€‚è¿™é‡Œå°è¯•ä½¿ç”¨restfulé£æ ¼ï¼Œå³ç”¨getå’Œpostä¸åŒæ–¹å¼è¯·æ±‚ï¼Œä½†æ˜¯ç”¨ä¸¤ä¸ªåŒåå‡½æ•°å¤„ç†ã€‚å‰ç«¯é»˜è®¤æ˜¯getè¯·æ±‚ï¼Œè¿™é‡Œå³ä¸ºgetã€‚

![image-20210930175645426](springboot.assets/image-20210930175645426.png)

æ§åˆ¶å™¨ä¸­ç¼–å†™å¤„ç†â€œæ·»åŠ è¯·æ±‚â€çš„å‡½æ•°ï¼›æ³¨æ„è¦å–å‡ºdepartmentåˆ—è¡¨ï¼Œç»™å‰ç«¯å±•ç¤ºç”¨ã€‚ä¸è¦å¿˜è®°ç”¨@Autowiredå‘springç”³è¯·ä¸€ä¸ªdepartmentDaoå®ä¾‹ã€‚ä»£ç å’Œæˆªå›¾å¦‚ä¸‹ã€‚

```java
//å¤„ç†è·³è½¬åˆ°æ–°å¢å‘˜å·¥é¡µé¢
@GetMapping("/emp")
public String toAddPage(Model model){

    //æŸ¥å‡ºæ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯
    Collection<Department> departments = departmentDao.getDepartments();
    model.addAttribute("departments",departments);

    return "emp/add";
}
```

![image-20210930202229179](springboot.assets/image-20210930202229179.png)

æ–°å¢add.htmlé¡µé¢ï¼Œä»£ç å°±ä¸æ”¾ç¬”è®°é‡Œäº†ï¼Œå¤ªå¤šã€‚

æ³¨æ„è¡¨å•é‡Œçš„æ¯ä¸€é¡¹inputéƒ½å¾—æœ‰nameå±æ€§ï¼Œå¦åˆ™æäº¤åæ¥æ”¶æ—¶æ¥æ”¶ä¸åˆ°

![image-20210930181503824](springboot.assets/image-20210930181503824.png)

add.htmlä¸­è®¾ç½®departmentä¸‹æ‹‰æ¡†ï¼Œæ¥æ”¶åˆ°åå°çš„æ•°æ®å¹¶ç”¨foreachå±•ç¤ºå‡ºæ¥ã€‚æ³¨æ„ï¼šselectçš„nameå’Œth:valueçš„ç±»å‹è¦å¯¹åº”ã€‚**è™½ç„¶**è¿™é‡Œä¼ çš„æ˜¯departmentidè€Œä¸æ˜¯employeeä¸­çš„departmentï¼Œä½†addEmpå‡½æ•°è¿˜æ˜¯èƒ½ä»¥employeeç±»å‹æ¥æ”¶å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºspringbooté¡¶å±‚æœ‰tobeanã€‚

![image-20210930211051840](springboot.assets/image-20210930211051840.png)

ä¸ºè¡¨å•çš„æäº¤è®¾ç½®è¯·æ±‚è·¯å¾„å’Œæ–¹å¼ã€‚æäº¤è¡¨å•çš„/empè¯·æ±‚æ˜¯postæ–¹å¼ï¼Œç‚¹å‡»â€œæ–°å»ºemployeeâ€çš„/empè¯·æ±‚æ˜¯getæ–¹å¼ï¼Œæ ¹æ®restfulé£æ ¼ï¼Œå¯ä»¥è¿™æ ·ã€‚

![image-20210930203528254](springboot.assets/image-20210930203528254.png)

åç«¯controllerä¸­æ·»åŠ è¡¨å•çš„æ¥æ”¶å’Œå¤„ç†ã€‚å¢åˆ æ”¹çš„æ—¶å€™å°½é‡ç”¨é‡å®šå‘ï¼Œä¸ç„¶å®¹æ˜“æ‰¾å‡ºè¡¨å•é‡å¤æäº¤ã€‚

```java
//å¤„ç†æ–°å¢å‘˜å·¥çš„è¡¨å•æäº¤
@PostMapping("/emp")
//å‰ç«¯æäº¤æ¥çš„æ•°æ®ä¼šè¢«springmvcè‡ªåŠ¨å°è£…ä¸ºemployeeå¯¹è±¡
public String addEmp(Employee employee){

    System.out.println("save=>"+employee);
    employeeDao.save(employee);

    /*é‡å®šå‘åˆ°/empsè¯·æ±‚ã€‚
    * å¢åˆ æ”¹çš„æ—¶å€™å°½é‡ç”¨é‡å®šå‘ï¼Œä¸ç„¶å®¹æ˜“æ‰¾å‡ºè¡¨å•é‡å¤æäº¤
    * */
    return "redirect:/emps";
}
```

é‡å¯é¡¹ç›®ï¼Œæ‰‹åŠ¨æ·»åŠ employeeï¼Œå‘ç°æ·»åŠ æˆåŠŸã€‚

![image-20210930211758393](springboot.assets/image-20210930211758393.png)

æ³¨æ„ï¼Œspringé»˜è®¤çš„æ—¶é—´æ ¼å¼æ˜¯ï¼šdd/MM/yyyyã€‚å¦‚æœè¾“å…¥æ—¶é—´çš„æ ¼å¼ä¸ºyyyy-MM-ddä¼šå¯¼è‡´é”™è¯¯ã€‚æƒ³æ›´æ”¹é»˜è®¤æ—¶é—´é…ç½®ï¼Œå¯ä»¥åœ¨application.propertiesä¸­é…ç½®ã€‚å½“ç„¶å•¦ï¼Œå®é™…å¼€å‘ä¸­éƒ½ä¸ä¼šè®©äººè‡ªå·±å†™æ—¶é—´çš„ï¼Œéƒ½æ˜¯å¼€å‘ä¸€ä¸ªæ—¶é—´é¢æ¿è®©äººç‚¹å‡»ã€‚

![image-20210930212951386](springboot.assets/image-20210930212951386.png)

![image-20210930212654915](springboot.assets/image-20210930212654915.png)

![image-20210930212840841](springboot.assets/image-20210930212840841.png)



### ä¿®æ”¹å‘˜å·¥ä¿¡æ¯

https://www.bilibili.com/video/BV1PE411i7CV?p=27&spm_id_from=pageDriver

åœ¨listé¡µé¢æ·»åŠ \<a>å¤„ç†ä¿®æ”¹employee

![image-20211001140542964](springboot.assets/image-20211001140542964.png)

controllerä¸­ç¼–å†™å¤„ç†â€œè¯·æ±‚ç¼–è¾‘â€çš„å‡½æ•°

```java
    //å»å‘˜å·¥çš„ä¿®æ”¹é¡µé¢
    @GetMapping("/emp/{id}")
    public String toUpdateEmp( @PathVariable("id")Integer id, Model model){
        //æŸ¥å‡ºæ¥çš„æ•°æ®
        Employee employee = employeeDao.getEmployeeById(id);
        model.addAttribute("emp",employee);

        //æŸ¥å‡ºæ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ä¾›ä¸‹æ‹‰æ¡†ä½¿ç”¨
        Collection<Department> departments = departmentDao.getDepartments();
        model.addAttribute("departments",departments);

        return "emp/update";

    }
```

ç¼–å†™update.htmlé¡µé¢ï¼Œä»åç«¯æ¥æ”¶è¦ä¿®æ”¹çš„employeeçš„æ•°æ®å¹¶æ˜¾ç¤ºï¼Œè®©â€œä¿®æ”¹é¡µé¢â€èƒ½æ˜¾ç¤ºä¿®æ”¹å‰çš„å€¼ã€‚è¿™é‡Œåº”è¯¥ç”¨th:valueï¼Œç”¨th:textçš„è¯å€¼ä¼šåœ¨æ ‡ç­¾å¤–é¢ã€‚

æ³¨æ„departmenté‚£ï¼Œselectæ ‡ç­¾çš„nameåº”æŒ‡å®šä¸ºdepartmentidï¼Œè¿™æ ·springæ‰èƒ½ç”¨tobeanè‡ªåŠ¨å°è£…ä¸ºdepartmentã€‚ï¼ˆä½†å…¶å®å¼€å‘çš„è¯ï¼Œå¯¹è±¡åµŒå¥—å¯¹è±¡æ„Ÿè§‰ä¸å¤ªå¥½ï¼Œä¸å¦‚å­˜å•çº¯çš„æ•°æ®ï¼‰

æ³¨æ„birthé‚£ï¼Œå±•ç¤ºçš„æ—¶é—´æ ¼å¼è¦å’Œspringé»˜è®¤æ—¶é—´æ ¼å¼ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚

![image-20211001141102064](springboot.assets/image-20211001141102064.png)

![image-20211001154053454](springboot.assets/image-20211001154053454.png)

controllerç¼–å†™å‡½æ•°ï¼Œä»¥è¡¨å•æäº¤çš„æ•°æ®æ›´æ–°è¡¨å•ã€‚

```java
@PostMapping("/updateEmp")
public String updateEmp(Employee employee){

    employeeDao.save(employee);

    return "redirect:/emps";
}
```

å¯åŠ¨æœåŠ¡ä¿®æ”¹æµ‹è¯•ï¼Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¯æ¬¡ä¿®æ”¹åï¼Œæ–°å¢äº†ä¸€ä¸ªç”¨æˆ·ã€‚è¿™æ˜¯å› ä¸ºemployeeDao.save()æ˜¯ä»¥idä¸ºä¸»é”®çš„ï¼Œä½†æ˜¯updateé¡µé¢ç°åœ¨æ²¡ä¼ idç»™employeeDaoï¼Œé‚£ä¹ˆemployeeDaoçš„saveå‡½æ•°ä¼šè‡ªå¢åœ°æ–°å»ºä¸€ä¸ªidå¹¶æŠŠè¦saveçš„æ•°æ®ç»‘å®šåˆ°æ–°idä¸Šï¼ˆè¿™é‡Œå› ä¸ºä½¿ç”¨çš„æ˜¯Mapé›†åˆå­˜æ•°æ®ï¼‰ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜å°±å¾—éšå¼çš„è®©updateé¡µé¢æäº¤ä¸€ä¸ªidï¼Œè¿™æ ·saveçš„æ—¶å€™ï¼Œç”±äºä¸¤ä¸ªä¸»é”®idç›¸åŒï¼Œæ–°saveä¼šè¦†ç›–æ‰åŸæ¥çš„æ•°æ®ã€‚

![image-20211001154508076](springboot.assets/image-20211001154508076.png)

update.htmlåŠ ä¸Šè¿™å¥

![image-20211001155211589](springboot.assets/image-20211001155211589.png)

é‡æ–°æµ‹è¯•ã€‚æ–°æ•°æ®â€œAAçˆ±â€æˆåŠŸè¦†ç›–äº†åŸæ•°æ®â€œAAâ€ã€‚

![image-20211001155313710](springboot.assets/image-20211001155313710.png)



### åˆ é™¤å‘˜å·¥ä¿¡æ¯

åœ¨å‰ç«¯é¡µé¢æ·»åŠ åˆ é™¤çš„é“¾æ¥æ ‡ç­¾ï¼Œè®¾ç½®è¯·æ±‚è·¯å¾„

![image-20211003154425607](springboot.assets/image-20211003154425607.png)

EmployeeControllerä¸­ï¼Œæ·»åŠ å¤„ç†åˆ é™¤è¯·æ±‚çš„æ–¹æ³•

```java
//åˆ é™¤å‘˜å·¥
@GetMapping("/delEmp/{id}")
public String deleteEmp(@PathVariable("id") int id){

    employeeDao.deleteEmployeeById(id);

    return "redirect:/emps";

}
```

è¿è¡Œé¡¹ç›®ç‚¹å‡»åˆ é™¤çš„\<a>æ ‡ç­¾ï¼Œåˆ é™¤æˆåŠŸ

![image-20211003155206039](springboot.assets/image-20211003155206039.png)

### 404å¤„ç†

åœ¨templateæ–‡ä»¶å¤¹ä¸‹çš„å»ºerroræ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾404.htmlï¼Œç¨‹åºå‘ç”Ÿ404é”™è¯¯æ—¶springbootä¼šè‡ªåŠ¨å±•ç°è¿™é‡Œæ”¾ç½®çš„404.html

![image-20211003155416526](springboot.assets/image-20211003155416526.png)

æµ‹è¯•è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼ŒæˆåŠŸæ˜¾ç¤ºè‡ªå®šä¹‰çš„404.html

![image-20211003155714669](springboot.assets/image-20211003155714669.png)

åŒç†ï¼Œè¿˜å¯ä»¥æ”¾405ç­‰é”™è¯¯äºæ­¤



### ç™»å‡ºåŠŸèƒ½å®ç°

å‰ç«¯ç¼–å†™ç™»å‡ºçš„é“¾æ¥

![image-20211003155925175](springboot.assets/image-20211003155925175.png)

logcontrollerä¸­ç¼–å†™å¤„ç†â€œç™»å‡ºè¯·æ±‚â€çš„å‡½æ•°

```java
//æ³¨é”€sessionï¼Œä½¿å¾—ç”¨æˆ·ç™»å‡º
@RequestMapping("/user/loginOut")
//åå°å–å‡ºå…¬ç”¨çš„session
public String logout(HttpSession session){
    session.invalidate();
    return "redirect:/index.html";
}
```

å¯åŠ¨é¡¹ç›®ã€‚ç™»å½•åç‚¹å‡»â€œæ³¨é”€â€åæ¥åˆ°ç™»å½•é¡µï¼Œå°è¯•ç›´æ¥è®¿é—®/empsä¼šæç¤ºæ²¡æƒé™ã€‚æˆåŠŸï¼

![image-20211003160548491](springboot.assets/image-20211003160548491.png)

![image-20211003160601548](springboot.assets/image-20211003160601548.png)

![image-20211003160621633](springboot.assets/image-20211003160621633.png)

## åŠç¨‹èŠèŠ

### å¦‚ä½•å†™å¥½ä¸€ä¸ªç½‘ç«™

å¯¹äºåç«¯å¼€å‘äººå‘˜ï¼Œå‰ç«¯è¦äº†è§£ï¼š

- æ¨¡æ¿ï¼šåˆ«äººå†™å¥½çš„ï¼Œæˆ‘ä»¬æ‹¿æ¥æ”¹æˆè‡ªå·±éœ€è¦çš„ã€‚
- æ¡†æ¶ï¼šç»„ä»¶ï¼Œè‡ªå·±æ‰‹åŠ¨ç»„åˆæ‹¼æ¥ï¼bootstrapï¼Œlayuiï¼Œsemantic-ui
  - æ …æ ¼ç³»ç»Ÿ
  - å¯¼èˆªæ 
  - ä¾§è¾¹æ 
  - è¡¨å•



å¦‚ä½•å¼€å‘ä¸€ä¸ªç½‘ç«™

1. å‰ç«¯æå®šï¼šé¡µé¢é•¿ä»€ä¹ˆæ ·å­ï¼Œè¿™æ ·æ‰çŸ¥é“è¦å“ªäº›æ•°æ®
2. è®¾è®¡æ•°æ®åº“ï¼ˆæ•°æ®åº“è®¾è®¡éš¾ç‚¹ï¼‰
3. å‰ç«¯è®©ä»–èƒ½å¤Ÿè‡ªåŠ¨è¿è¡Œï¼Œç‹¬ç«‹åŒ–å·¥ç¨‹
4. æ•°æ®æ¥å£å¦‚ä½•å¯¹æ¥ï¼šjsonï¼Œä¼ å¯¹è±¡
5. å‰åç«¯æµ‹è¯•è”è°ƒ



è‡ªå·±è¦èƒ½åšè¿™å‡ ä»¶äº‹ï¼ˆç†æƒ³çŠ¶æ€ä¸‹ï¼Œä¸€ä¸ªæœˆåšåˆ°ï¼‰ï¼š

1. æœ‰ä¸€å¥—è‡ªå·±ç†Ÿæ‚‰çš„åå°æ¨¡æ¿ï¼Œå·¥ä½œå¿…è¦ã€‚æ¨è **x-admin**

2. å‰ç«¯é¡µé¢ï¼šè‡³å°‘è‡ªå·±èƒ½å¤Ÿé€šè¿‡å‰ç«¯æ¡†æ¶ï¼Œç»„åˆå‡ºæ¥ä¸€ä¸ªç½‘ç«™é¡µé¢

   æ¯”å¦‚å¯¹äºä¸€ä¸ªåšå®¢è‡³å°‘æœ‰ä»¥ä¸‹é¡µé¢

   - index
   - about
   - blog
   - post
   - user

3. è®©è¿™ä¸ªç½‘ç«™èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œ



### å›é¦–å’Œå±•æœ›

springbootä¹‹å‰å·²ç»å­¦äº†ï¼š

- springbootæ˜¯ä»€ä¹ˆ
- å¾®æœåŠ¡
- helloworld
- æ¢ç©¶æºç -è‡ªåŠ¨è£…é…åŸç†

- é…ç½®yaml
- å¤šæ–‡æ¡£ç¯å¢ƒåˆ‡æ¢
- é™æ€èµ„æºæ˜ å°„
- thymeleaf    th:xx

- springbootå¦‚ä½•æ‰©å±•mvc     javaconfig
- å¦‚ä½•ä¿®æ”¹springbootçš„é»˜è®¤é…ç½®
- crud
- å›½é™…åŒ–
- æ‹¦æˆªå™¨
  - 20220522æˆ‘ï¼šçœŸå®å¼€å‘çš„æ—¶å€™ï¼Œä¸ä¸€å®šä¼šè€ƒè™‘ç”¨æ‹¦æˆªå™¨åšæ‹¦æˆªè¿‡æ»¤ï¼›å¯èƒ½ä¼šç”¨ä¸€äº›çº¿ç¨‹çš„å·¥å…·æˆ–ç»„ä»¶ï¼Œä¹Ÿå¯èƒ½ç±»ä¼¼å¾®æœåŠ¡ç”¨ä¸åŒå¼€æºå·¥å…·åšä¸åŒæ¨¡å—ï¼Œè‡ªå·±å†™ä¸šåŠ¡ä»£ç å³å¯ã€‚

- å®šåˆ¶é¦–é¡µï¼Œé”™è¯¯é¡µ



æ¥ä¸‹æ¥å­¦ä»€ä¹ˆï¼šæ•°æ®åº“å®æˆ˜

- JDBCï¼šæ•°æ®åº“
- **mybatisï¼šæ•°æ®åº“ï¼Œé‡ç‚¹**
  - æˆ‘ï¼šä¸€äº›å…¬å¸ä¼šé—®æœ‰æ²¡æœ‰ç”¨è¿‡jpaï¼Œå…¶å®å°±ç±»ä¼¼mybatisã€‚åŒºåˆ† jpa js jspï¼š
    - jpaï¼šåŠŸèƒ½ç±»ä¼¼mybatisï¼Œç°åœ¨ç”¨çš„å¾ˆå°‘ï¼Œä¸€èˆ¬æ˜¯è€å…¬å¸åœ¨ç”¨
    - jsï¼šæ˜¯javascriptçš„ç®€ç§°ï¼Œæ˜¯å‰ç«¯ç”¨ä¸æ§åˆ¶é€»è¾‘çš„è¯­è¨€
    - jspï¼šJSPå…¨ç§°Java Server Pagesï¼Œæ˜¯ä¸€ç§åŠ¨æ€ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚. å®ƒä½¿ç”¨JSPæ ‡ç­¾åœ¨HTMLç½‘é¡µä¸­æ’å…¥Javaä»£ç ã€‚. æ ‡ç­¾é€šå¸¸ä»¥<%å¼€å¤´ä»¥%>ç»“æŸã€‚æˆ‘ä¸ªäººæ˜¯æ²¡ç”¨è¿‡ã€‚

- **druidï¼šæ•°æ®åº“ï¼Œé‡ç‚¹**
- **shiroï¼šå®‰å…¨ï¼Œé‡ç‚¹**
- **spring securityï¼šå®‰å…¨ï¼Œé‡ç‚¹**

- å¼‚æ­¥ä»»åŠ¡ï¼Œé‚®ä»¶å‘é€ï¼Œå®šæ—¶ä»»åŠ¡
- swagger
- dubbo+zookeeper



## spring DATA

### Springbootæ•´åˆJDBCä½¿ç”¨

å‰è¨€ï¼š

- springdataå®˜ç½‘ç½‘å€ï¼šhttps://spring.io/projects/spring-data
- springæ•°æ®å¤„ç†çš„åº•å±‚éƒ½æ˜¯ç”¨spring dataå®ç°çš„
- spring dataæ˜¯åœ¨springä¸­å’Œspring bootï¼Œspring cloudé½åçš„ä¸€ä¸ªé¡¹ç›®



å®æˆ˜ï¼š

æ–°å»ºdataprojectï¼Œä½¿ç”¨spring initializrã€‚

![image-20211004102156315](springboot.assets/image-20211004102156315.png)

è¿™é‡Œåº”è¯¥å‹¾é€‰springwebï¼Œä½†æ˜¯å›¾ç‰‡ä¸­æ²¡å‹¾ä¹Ÿæ²¡å±•ç¤ºåˆ°ï¼Œä¸å‹¾çš„è¯åƒ@RestControllerè¿™æ ·çš„æ³¨è§£éƒ½æ²¡æ³•ç”¨ï¼›æ²¡å‹¾é€‰æ²¡äº‹ï¼Œåœ¨pomä¾èµ–ä¸­åŠ ä¸Šä¸‹è½½å¥½jaråŒ…å°±å¯ã€‚

![image-20211004102450702](springboot.assets/image-20211004102450702.png)

åˆ é™¤é¡¹ç›®ä¸­å¤šä½™çš„æ–‡ä»¶ï¼ˆå¤¹ï¼‰

![image-20211004102928131](springboot.assets/image-20211004102928131.png)

æ£€æŸ¥pomä¸­æœ‰æ²¡æœ‰æˆ‘ä»¬å‹¾é€‰çš„ä¾èµ–ï¼šæœ‰ã€‚

![image-20211004103340577](springboot.assets/image-20211004103340577.png)

è§‚å¯Ÿé¡¹ç›®ç»“æ„

- ç”±äºåˆ›å»ºé¡¹ç›®çš„æ—¶å€™æ²¡æœ‰å‹¾é€‰â€œspringwebâ€ï¼Œæ‰€ä»¥resourceä¸‹æ²¡æœ‰staticå’Œtemplatesæ–‡ä»¶å¤¹

![image-20211004103508438](springboot.assets/image-20211004103508438.png)

é…ç½®springbooté¡¹ç›®ï¼Œæœ¬æ¬¡ä½¿ç”¨yamlæ–‡ä»¶ï¼ˆå®˜æ–¹æ¨èåå­—ä¸ºyamlï¼Œæœ‰äººå†™æˆymlä¹Ÿèƒ½è¯†åˆ«ï¼‰é…ç½®ï¼Œpropertiesæ–‡ä»¶ç©ºç½®ä¸ç”¨ã€‚

1. è¾“å…¥spring.datasource.usernameï¼Œç‚¹å‡»æç¤ºï¼Œyamlé¡µé¢å‡ºç°ç›¸åº”é…ç½®è¡Œï¼Œé…ç½®ä¸Šæ•°æ®åº“çš„ç”¨æˆ·åï¼ˆç”¨æˆ·åå¯ä»¥åŠ å¼•å·ï¼‰ã€‚
2. è¾“å…¥passwordï¼Œç‚¹å‡»æç¤ºä¸­çš„spring.datasource.passwordï¼Œyamlé¡µé¢å‡ºç°passwordé…ç½®è¡Œï¼Œé…ç½®ä¸Šæ•°æ®åº“çš„å¯†ç ï¼ˆå¯†ç å¯ä»¥åŠ å¼•å·ï¼‰ã€‚
3. urlå‚æ•°é‚£ï¼Œå¯èƒ½éœ€è¦åŠ æ—¶åŒºï¼Œæœ‰æ—¶å€™ä¸åŠ ä¼šå‡ºé”™ï¼Œæ¯”å¦‚ï¼š`useUnicode=true&characterEncodeing=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai  è¿™å‡ ä¸ªå‚æ•°éƒ½åŠ ä¸Šï¼Œæˆ‘æ˜¯sql8+`ã€‚ä½†æœ¬äººè¿è¡Œæ²¡æŠ¥é”™ã€‚

![image-20211004110007749](springboot.assets/image-20211004110007749.png)

æœ¬åœ°æ•°æ®åº“å»ºç«‹mybatisåº“,å¹¶èµ‹å€¼åŸå§‹æ•°æ®

```mysql
CREATE DATABASE `mybatis`;

USE `mybatis`;

DROP TABLE IF EXISTS `user`;

CREATE TABLE `user` (
`id` int(20) NOT NULL,
`name` varchar(30) DEFAULT NULL,
`pwd` varchar(30) DEFAULT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert  into `user`(`id`,`name`,`pwd`) values (1,'å¼ äº‘','123456'),(2,'å¼ ä¸‰','abcdef'),(3,'æå››','987654');
```

ideaè¿æ¥æ•°æ®æº

![image-20211004122451195](springboot.assets/image-20211004122451195.png)

è¾“å…¥ç”¨æˆ·åå¯†ç åç‚¹å‡»apply

![image-20211004122536645](springboot.assets/image-20211004122536645.png)

ç‚¹å‡»schemeï¼Œå‹¾é€‰ä¸Šè¦ç”¨çš„æ•°æ®åº“

![image-20211004122644683](springboot.assets/image-20211004122644683.png)

è¿æ¥æˆåŠŸåå±•ç°å‡ºmybatisåº“å’Œåº“ä¸­çš„æ‰€æœ‰è¡¨

![image-20211004122848970](springboot.assets/image-20211004122848970.png)

è®¾ç½®å½“å‰é¡¹ç›®çš„é¡¹ç›®è®¿é—®è·¯å¾„

![image-20211004123255339](springboot.assets/image-20211004123255339.png)

ç¼–å†™controlleræµ‹è¯•å½“å‰é¡¹ç›®çš„æ•°æ®åº“è¿æ¥ã€‚**æ³¨æ„è¦ç”¨çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶çš„æœ€é¡¶å±‚ç›®å½•è¦å’Œspringapplicationæ–‡ä»¶åŒçº§**ã€‚

![image-20211004123041305](springboot.assets/image-20211004123041305.png)

#### æŸ¥

ç¼–å†™å±•ç¤ºuserè¡¨æ‰€æœ‰å†…å®¹çš„å‡½æ•°

```java
package com.zhangyun.springboot04data.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;
import java.util.Map;

//å‡½æ•°è¿”å›å­—ç¬¦ä¸²ï¼Œå‰åç«¯åˆ†ç¦»
@RestController
public class JDBCController {
    @Autowired
    JdbcTemplate jdbcTemplate;


    @GetMapping("/userList")
    //æŸ¥è¯¢æ•°æ®åº“ä¸­userè¡¨çš„æ‰€æœ‰æ•°æ®
    //æ²¡æœ‰å®ä½“ç±»ï¼Œæ•°æ®åº“ä¸­çš„ä¸œè¥¿æ€ä¹ˆè·å–ï¼Ÿï¼šMap
    public List<Map<String,Object>> userList(){
        String sql="select * from user";
        List<Map<String, Object>> maps = jdbcTemplate.queryForList(sql);

        return maps;
    }
}
```

è¿è¡Œé¡¹ç›®ï¼Œå‰ç«¯å±•ç¤ºäº†ç›®æ ‡æ•°æ®ï¼ŒæˆåŠŸï¼

![image-20211004123343369](springboot.assets/image-20211004123343369.png)

#### å¢

ç¼–å†™å¾€userè¡¨å¢åŠ æ•°æ®çš„å‡½æ•°

```java
@GetMapping("/addUser")
public String addUser(){
    String sql="insert into user(id,name,pwd) values (4,'å°æ˜','123456')";

    //æ’å…¥ä¹Ÿç®—ä¸€ç§æ›´æ–°
    jdbcTemplate.update(sql);
    return "add user done";
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼ŒæˆåŠŸæ·»åŠ ã€‚

![image-20211004194156701](springboot.assets/image-20211004194156701.png)

![image-20211004194225044](springboot.assets/image-20211004194225044.png)

#### æ”¹

ç¼–å†™æ›´æ”¹userè¡¨æ•°æ®çš„å‡½æ•°

```java
//ä½¿ç”¨restfulé£æ ¼ä¼ é€’å‚æ•°ï¼Œä½“ç°åœ¨â€œè¯·æ±‚è·¯å¾„â€å’Œâ€œ@PathVariableâ€ä¸Š
@GetMapping("/updateUser/{id}")
public String updateUser(@PathVariable("id") int id){
    String sql="update user set name=?, pwd=? where id="+id;

    //sqlçš„å‚æ•°è¦é€šè¿‡objects[]ä¼ å…¥jdbc
    Object[] objects = new Object[2];
    objects[0]="æå››1";
    objects[1]="è¿™æ˜¯æ›´æ”¹åçš„å¯†ç å¯†ç ";

    jdbcTemplate.update(sql,objects);
    return "update user done";
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼Œä¿®æ”¹æˆåŠŸã€‚

![image-20211004194711002](springboot.assets/image-20211004194711002.png)

![image-20211004194731918](springboot.assets/image-20211004194731918.png)

#### åˆ 

ç¼–å†™userè¡¨ä¸­åˆ é™¤æŸè¡Œæ•°æ®çš„å‡½æ•°

```java
@GetMapping("/deleteUser/{id}")
public String deleteUser(@PathVariable("id")int id){
    String sql="delete from user where id="+id;

    jdbcTemplate.update(sql);
    return "delete user done";
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼ŒæˆåŠŸåˆ é™¤idä¸º4çš„é¡¹ã€‚

![image-20211004195031718](springboot.assets/image-20211004195031718.png)

![image-20211004195256326](springboot.assets/image-20211004195256326.png)



### æ•´åˆdruidæ•°æ®æº

å‰è¨€ï¼š

- æœ‰ä¸¤ç§ä¸»è¦çš„æ•°æ®æºã€‚druidé›†æˆäº†ç›‘æ§ï¼Œhikarié€Ÿåº¦æ›´å¿«ã€‚æŒ‰ç…§å…¬å¸è¦æ±‚ä½¿ç”¨ä¸åŒçš„æ•°æ®æº.
  - 20230522æˆ‘ï¼š[Hikariè¿æ¥æ± ç›®å‰å…¬è®¤æ˜¯æ€§èƒ½æœ€é«˜çš„æ•°æ®åº“è¿æ¥æ± ï¼ŒåŒæ—¶ä¹Ÿæ˜¯SpringBoot2.0ä»¥åé»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“è¿æ¥æ± ](https://www.cnblogs.com/jackion5/p/14193025.html)ã€‚æ‰€ä»¥ç§°hikariä¸º[æ•°æ®æº](https://www.cnblogs.com/Liuyunsan/p/15590394.html)æ˜¯ä¸€ä¸ªåç¬¼ç»Ÿçš„å«æ³•ï¼Œhikariæœ¬èº«æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ã€‚




#### æ‰“å°æ•°æ®æº

å®æˆ˜ï¼š

æµ‹è¯•ç±»ä¸­æ‰“å°å½“å‰æ•°æ®æº

```java
@Test
void contextLoads() throws SQLException {

    //æŸ¥çœ‹é»˜è®¤æ•°æ®æºçš„ç±»å‹ï¼šclass com.zaxxer.hikari.HikariDataSource
    System.out.println("datasource class: "+dataSource.getClass());

    //è·å¾—æ•°æ®åº“è¿æ¥
    Connection connection = dataSource.getConnection();
    System.out.println("connection: "+connection);

    //å…³é—­è¿æ¥
    connection.close();

}
```

æ§åˆ¶å°æ˜¾ç¤ºæ•°æ®æºæ˜¯springé»˜è®¤çš„hikariæ•°æ®æº

![image-20211004214506912](springboot.assets/image-20211004214506912.png)

åœ¨yamlé…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æ•°æ®æºä¸ºdruid

![image-20211004214643449](springboot.assets/image-20211004214643449.png)

é‡æ–°è¿è¡Œæµ‹è¯•æ–¹æ³•,æŸ¥çœ‹æ•°æ®æºå’Œè¿æ¥ã€‚å‘ç°æ•°æ®æºå˜æˆäº†druidï¼Œä½†æ˜¯åº•å±‚ï¼ˆè¿æ¥ï¼‰è¿˜æ˜¯jdbcã€‚**åº•å±‚æ°¸è¿œéƒ½æ˜¯jdbc**ã€‚

![image-20211004214814371](springboot.assets/image-20211004214814371.png)



#### é…ç½®ç±»é…ç½®duird

å…ˆå±•ç¤ºæ¯”è¾ƒå®Œæ•´çš„springæ•°æ®æºé…ç½®

```yaml
spring:
  datasource:
    username: "root"
    password: "123456"
    url: jdbc:mysql://localhost:3306/mybatis?useUnicode=true&characterEncoding=utf-8
    driver-class-name: com.mysql.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource

    #Spring Boot é»˜è®¤æ˜¯ä¸æ³¨å…¥è¿™äº›å±æ€§å€¼çš„ï¼Œéœ€è¦è‡ªå·±ç»‘å®š
    #druid æ•°æ®æºä¸“æœ‰é…ç½®
    initialSize: 5
    minIdle: 5
    maxActive: 20
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 60000
    minEvictableIdleTimeMillis: 300000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true

    # ä¸‹é¢çš„éƒ¨åˆ†æ˜¯druidæ¯”å…¶ä»–æ•°æ®æºç‰›é€¼çš„åœ°æ–¹
    #é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œstat:ç›‘æ§ç»Ÿè®¡ã€log4jï¼šæ—¥å¿—è®°å½•ã€wallï¼šé˜²å¾¡sqlæ³¨å…¥
    #å¦‚æœå…è®¸æ—¶æŠ¥é”™  java.lang.ClassNotFoundException: org.apache.log4j.Priority
    #åˆ™å¯¼å…¥ log4j ä¾èµ–å³å¯ï¼ŒMaven åœ°å€ï¼šhttps://mvnrepository.com/artifact/log4j/log4j
    filters: stat,wall,log4j
    maxPoolPreparedStatementPerConnectionSize: 20
    useGlobalDataSourceStat: true
    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
```

filteréœ€è¦log4jï¼Œæ‰€ä»¥pomä¾èµ–ä¸­è¦å¯¼å…¥log4jçš„ä¾èµ–

```xml
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

ç¼–å†™druidçš„é…ç½®ç±»

![image-20211004225943505](springboot.assets/image-20211004225943505.png)

```java
package com.zhangyun.springboot04data.config;

import com.alibaba.druid.pool.DruidDataSource;
import com.alibaba.druid.support.http.StatViewServlet;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.web.servlet.ServletRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;
import java.util.HashMap;

@Configuration
public class DruidConfig {

    /*è¦æŠŠyamlé…ç½®çš„druidå±æ€§ï¼Œæ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚è€Œè¦è¿›è¡Œæ³¨å…¥é¦–å…ˆè¦æ³¨å†Œbeanï¼Œå†åŠ ä¸Š@ConfigurationPropertiesæ³¨è§£è¡¨ç¤ºç»‘å®šæˆåŠŸ
    * */
    @ConfigurationProperties(prefix = "spring.datasource")
    @Bean
    public DataSource druidDataSource(){
        return new DruidDataSource();
    }

    //åå°sqlç›‘æ§ï¼šç›¸å½“äºweb.xmlã€‚å› ä¸ºspringbootå†…ç½®äº†servletå®¹å™¨ï¼Œæ‰€ä»¥æ²¡æœ‰web.xmlï¼Œæ›¿ä»£æ–¹æ³•å°±æ˜¯ç”¨ServletRegistrationBean
    //é…ç½®ç±»ä¸­çš„æ–¹æ³•ï¼Œä¸è¦å¿˜è®°æ”¾åˆ°beané‡Œ
    @Bean
    public ServletRegistrationBean statViewServlet(){
        /*
        * è¿™è¡Œå†™æ­»çš„ï¼Œåªè¦è®¿é—®/druid/**å°±ä¼šæ¥åˆ°ç›‘æ§é¡µé¢ã€‚ç›‘æ§é¡µé¢æ˜¯alibabaå†™å¥½çš„ï¼Œå¯ä»¥æ‹¿æ¥å°±ç”¨ã€‚
        * */
        ServletRegistrationBean<StatViewServlet> statViewServletServletRegistrationBean = new ServletRegistrationBean<>(new StatViewServlet(), "/druid/*");

        //åå°éœ€è¦æœ‰äººç™»å½•ï¼Œè¦é…ç½®è´¦å·å¯†ç ã€‚ç™»å½•çš„keyæ˜¯å›ºå®šçš„ï¼šloginUsername loginPassword
        HashMap<String,String> initParameters = new HashMap<>();
        initParameters.put("loginUsername","admin");
        initParameters.put("loginPassword","123456");

        //å…è®¸è°å¯ä»¥è®¿é—®ã€‚valueä¸ºç©ºå­—ç¬¦ä¸²æ—¶è¡¨ç¤ºæ‰€æœ‰äººéƒ½å¯è®¿é—®
        initParameters.put("allow","");

        //ç¦æ­¢è°èƒ½è®¿é—®ã€‚è¿™ä¸ªä¸æ˜¯é‡ç‚¹ã€‚ initParameters.put("zhangyun","192.168.11.123");

        //è¾“å…¥å‚æ•°çš„åå­—ï¼Œæ˜¯çœ‹æºç å‡½æ•°çš„æ¥æ”¶å˜é‡ä¹Ÿå«initParameters
        statViewServletServletRegistrationBean.setInitParameters(initParameters);
        return statViewServletServletRegistrationBean;

    }

}
```

å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®http://localhost:8080/zhangyun/druid/ï¼Œè‡ªåŠ¨è·³åˆ°ä¸‹é¢çš„ç•Œé¢ã€‚è¾“å…¥DruidConfigä¸­é…ç½®çš„è´¦å·å¯†ç ç™»å½•è¿›å»ã€‚

![image-20211004230030658](springboot.assets/image-20211004230030658.png)

![image-20211004230126393](springboot.assets/image-20211004230126393.png)

æˆ‘ä»¬ä½¿ç”¨ä»–â€sqlç›‘æ§â€œçš„åŠŸèƒ½è¯•è¯•ã€‚

é¦–å…ˆæ‰§è¡ŒæŸ¥è¡¨å‡½æ•°

![image-20211004230239618](springboot.assets/image-20211004230239618.png)

æ¥åˆ°â€œsqlç›‘æ§â€é¡µé¢ï¼Œå‘ç°æˆåŠŸè®°å½•äº†æŸ¥è¡¨å‡½æ•°æ‰€ä½¿ç”¨çš„sql

![image-20211004230347379](springboot.assets/image-20211004230347379.png)

#### druidå®ç°Filter

WebStatFilterå°±æ˜¯druidå®ç°çš„è¿‡æ»¤æ–¹æ³•ã€‚

```java
//filter
public FilterRegistrationBean webStatFilter(){
    FilterRegistrationBean bean = new FilterRegistrationBean() ;
    bean.setFilter(new WebStatFilter()) ;
    //å¯ä»¥è¿‡æ»¤å“ªäº›è¯·æ±‚å‘¢?
    Map<String,String> initParameters = new HashMap<>();
    //è¿™äº›ä¸œè¥¿ä¸è¿›è¡Œç»Ÿè®¡~
    initParameters.put( "exclusions","*.js,*.css,/druid/*");
    bean. setInitParameters( initParameters) ;
    return bean;
}
```



### Springbootæ•´åˆMybatisæ¡†æ¶

æœ¬æƒ…å½¢çš„æ•´åˆåŒ…æ˜¯ä»€ä¹ˆï¼š

- mybatiså’Œspringæ•´åˆç”¨çš„æ•´åˆåŒ…ï¼šmybatis-springã€‚
- mybatiså’Œspringbootæ•´åˆç”¨çš„æ•´åˆåŒ…ï¼šmybatis-spring-boot-starter.



#### å®æˆ˜

æ–°å»ºé¡¹ç›®

![image-20211005142947768](springboot.assets/image-20211005142947768.png)

![image-20211005142856592](springboot.assets/image-20211005142856592.png)

dependencyä¸­æ·»åŠ mybatis-spring-boot-starterä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter 
mybatis-spring-boot-starter:æ•´åˆï¼Œmybatisæä¾›çš„è‡ªç ”åŒ…ï¼Œä¸æ˜¯springå®˜æ–¹æä¾›çš„ã€‚
springbootå®˜æ–¹æä¾›çš„åŒ…ä»¥spring-bootå¼€å¤´-->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.1.1</version>
</dependency>
```

propertiesæ–‡ä»¶ä¸­é…ç½®æ•°æ®æºè¿æ¥å±æ€§

```properties
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&characterEncoding=utf-8
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

æµ‹è¯•ç±»ä¸­ç¼–å†™ç®€å•ä»£ç ï¼Œæµ‹è¯•æ•°æ®æºæ˜¯å¦é…ç½®æˆåŠŸ

```java
package com.zhangyun.springboot05mybatis;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import javax.sql.DataSource;
import java.sql.SQLException;

@SpringBootTest
class Springboot05MybatisApplicationTests {

    @Autowired
    DataSource dataSource;

    @Test
    void contextLoads() throws SQLException {

        System.out.println(dataSource.getClass());
        System.out.println(dataSource.getConnection());
    }

}
```

è¿è¡Œæµ‹è¯•æ–¹æ³•ã€‚æˆåŠŸè¿æ¥äº†æ•°æ®æºå¹¶å±•ç¤ºäº†æ•°æ®æºçš„ä¿¡æ¯ã€‚

å¯ä»¥çœ‹å‡ºï¼Œä¸éœ€è¦åœ¨ideaå³ä¸Šè§’çš„databaseé€‰é¡¹æ‰‹åŠ¨è¿æ¥æ•°æ®åº“ï¼Œé‚£ä¸ªdatabaseè¿æ¥åº”è¯¥æ˜¯ç”¨åœ¨ideaä¸­åšæ•°æ®åº“å¼€å‘çš„ï¼Œæˆ–è€…æ–¹ä¾¿æŸ¥çœ‹æ•°æ®åº“è¡¨çš„å†…å®¹ã€‚é‚£ä¸ªdatabaseé€‰é¡¹çš„æ‰‹åŠ¨è¿æ¥å’Œâ€œwebåå°ä¸æ•°æ®åº“çš„è¿æ¥â€œæ²¡æœ‰å…³ç³»ï¼Œwebåå°å’Œæ•°æ®åº“çš„è¿æ¥è¿˜æ˜¯å¾—é propertiesæˆ–yamlæ–‡ä»¶é…ç½®ã€‚

![image-20211005144511125](springboot.assets/image-20211005144511125.png)

![image-20211005150432523](springboot.assets/image-20211005150432523.png)

ç¼–å†™pojoç±»

```java
package com.zhangyun.springboot05mybatis.pojo;

public class User {

    private int id;
    private String name;
    private String pwd;

    public User() {
    }

    public User(int id, String name, String pwd) {
        this.id = id;
        this.name = name;
        this.pwd = pwd;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPwd() {
        return pwd;
    }

    public void setPwd(String pwd) {
        this.pwd = pwd;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", pwd='" + pwd + '\'' +
                '}';
    }
}
```

ç¼–å†™mapperï¼ˆåˆådaoï¼‰æ¥å£ç±»

```java
package com.zhangyun.springboot05mybatis.mapper;

import com.zhangyun.springboot05mybatis.pojo.User;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.stereotype.Repository;

import java.util.List;

//è¿™ä¸ªæ³¨è§£è¡¨ç¤ºäº†è¿™æ˜¯ä¸€ä¸ªmybatisçš„mapperç±»ï¼šdaoå±‚çš„ä¸œè¥¿
@Mapper
//ç›¸å½“äº@beanï¼Œç”¨äºdaoå±‚ã€‚æŠŠç±»æ³¨å†Œåˆ°springbootä¸­å¾…ä½¿ç”¨ã€‚
@Repository
public interface UserMapper {

    /*æ¥å£ä¸­æ•´æ•°çš„ç±»å‹
    * public static final int age=18;
    * */

    int addUser(User user);

    int deleteUser(int id);

    int updateUser(User user);

    List<User> queryUserList();
    User queryUserById(int id);


}
```

ç¼–å†™XXXmapper.xmlæ–‡ä»¶ã€‚ä¹‹å‰XXXmapper.xmlæ˜¯å’ŒXXXmapper.javaæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ä½†æ˜¯ç°åœ¨ç»Ÿä¸€XXXmapper.xmlæ”¾åˆ°resourceçš„å¯¹åº”ç›®å½•ä¸‹ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼‰ï¼Œä½†æ˜¯æ”¾åœ¨ä¸åŒæ–‡ä»¶å¤¹ä¸‹å°±åªèƒ½ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®äº†ã€‚

- [æ¨¡æ¿ä½ç½®](https://mybatis.org/mybatis-3/zh/getting-started.html)

  ![image-20211005154002839](springboot.assets/image-20211005154002839.png)

- æ¨¡æ¿ä¿®æ”¹æ³¨æ„äº‹é¡¹
  - namespaceæ¢æˆè‡ªå·±çš„mapper

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhangyun.springboot05mybatis.mapper.UserMapper">

    <!--è¿™ä¸ªUserè¦è¢«è¯†åˆ«çš„è¯ï¼Œéœ€è¦è®¾ç½®åˆ«åï¼Œå¹¶ä¸”UserMapper.xmlèƒ½è¢«springè¯†åˆ«ã€‚è¿™ä¸ªè¦åœ¨propertiesæˆ–è€…yamlä¸­è®¾ç½®
    æ³¨æ„è§‚å¯Ÿâ€œå¢åˆ æ”¹â€çš„æ ‡ç­¾éƒ½æ˜¯parameterTypeï¼Œå› ä¸ºä»–ä»¬çš„returnæ˜¯è¢«ä¿®æ”¹çš„è¡Œæ•°ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚â€œæŸ¥â€çš„æ ‡ç­¾ä¸­æ˜¯resultTypeï¼Œå› ä¸ºæŸ¥è¿”å›çš„æ˜¯User-->
    <insert id="addUser" parameterType="User">
        insert into user (id,name,pwd) values (#{id},#{name},#{pwd})
    </insert>

    <delete id="deleteUser" parameterType="int">
        delete from user where id=#{id}
    </delete>

    <update id="updateUser" parameterType="User">
        update user set name=#{name},pwd=#{pwd} where id=#{id}
    </update>

    <select id="queryUserList" resultType="User">
        select * from user
    </select>
    <select id="queryUserById" resultType="User">
        select * from user where id=#{id}
    </select>
</mapper>
```

- 20230522æˆ‘ï¼šçœŸå®å¼€å‘çš„æ—¶å€™ç”¨çš„æ˜¯mybatisplusï¼Œæœ‰wrapperå»ç”¨javaä»£ç ç¼–å†™sqlæŸ¥è¯¢é€»è¾‘ å¹¶è‡ªåŠ¨æŠŠæ•°æ®åº“æ˜ å°„ä¸ºpojoç±»ï¼Œå°±ä¸ç”¨è‡ªå·±é…ç½®xmlæ¨¡æ¿ï¼Œå°¤å…¶æ˜¯ä¸ç”¨è´¹æ—¶è´¹åŠ›çš„å»ç¼–å†™resultmapã€‚

å†propertiesæˆ–yamlæ–‡ä»¶ä¸­é…ç½®ä¸€ä¸‹mybatis

```properties
# springbootä¸­çš„mybatisé…ç½®
mybatis.type-aliases-package=com.zhangyun.pojo
# classpathä»£è¡¨resourceç›®å½•
mybatis.mapper-locations=classpath:mybatis/mapper/*.xml
```

ç¼–å†™æ§åˆ¶å±‚controllerï¼ˆè¿™é‡Œä¸šåŠ¡ç®€å•ï¼Œä¸šåŠ¡å±‚å¯ä»¥çœç•¥ï¼Œç›´æ¥åœ¨controllerä¸­å®Œæˆï¼‰

```java
package com.zhangyun.springboot05mybatis.controller;

import com.zhangyun.springboot05mybatis.mapper.UserMapper;
import com.zhangyun.springboot05mybatis.pojo.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

//å‰åç«¯åˆ†ç¦»
@RestController
public class UserController {
    //æ‹¿åˆ°æ³¨å†Œçš„userMapperæ¥å£ï¼Œä»è€Œå¯ä»¥è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•
    @Autowired
    private UserMapper userMapper;

    //æ·»åŠ ä¸€ä¸ªç”¨æˆ·
    //URLè¯·æ±‚éƒ½æ˜¯get
    @GetMapping("/addUser")
    public String addUser(){
        userMapper.addUser(new User(5,"é˜¿ä¸œ","pswnow"));
        return "addUser done";
    }

    //åˆ é™¤ä¸€ä¸ªç”¨æˆ·
    @GetMapping("/deleteUser")
    public String deleteUser(){
        userMapper.deleteUser(5);
        return "deleteUser done";
    }

    //æ›´æ–°ä¸€ä¸ªç”¨æˆ·
    @GetMapping("/updateUser")
    public String updateUser(){
        userMapper.updateUser(new User(5,"é˜¿é˜³","pswchanged"));
        return "updateUser done";
    }

    //æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    @GetMapping("/queryUserList")
    public List<User> queryUserList(){
        List<User> users = userMapper.queryUserList();
        return users;
    }

}

```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ã€‚

æŸ¥çœ‹åŸå§‹è¡¨çš„æ•°æ®

![image-20211005184959561](springboot.assets/image-20211005184959561.png)

æ·»åŠ ç”¨æˆ·ï¼ŒæŸ¥çœ‹æ•°æ®åº“è¡¨å‘ç°æ·»åŠ æˆåŠŸ

![image-20211005184237705](springboot.assets/image-20211005184237705.png)

![image-20211005184927686](springboot.assets/image-20211005184927686.png)

å†ä¿®æ”¹ç”¨æˆ·,æŸ¥çœ‹æ•°æ®åº“è¡¨å‘ç°ä¿®æ”¹æˆåŠŸ

![image-20211005184433792](springboot.assets/image-20211005184433792.png)

![image-20211005184503785](springboot.assets/image-20211005184503785.png)

åˆ é™¤ç”¨æˆ·ï¼ŒæŸ¥çœ‹æ•°æ®åº“è¡¨å‘ç°åˆ é™¤æˆåŠŸ

![image-20211005184603857](springboot.assets/image-20211005184603857.png)

![image-20211005184615904](springboot.assets/image-20211005184615904.png)

æœ€åæŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·ï¼Œå¯¹ç…§æ•°æ®åº“è¡¨å‘ç°æŸ¥æ‰¾æˆåŠŸ

![image-20211005184725017](springboot.assets/image-20211005184725017.png)

**springboot+mybatiså¸®æˆ‘ä»¬æŠŠäº‹åŠ¡åšäº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¥è§¦äº‹åŠ¡**



#### æ€»ç»“

mvcï¼š

- Mï¼šæ¨¡å‹å±‚ï¼ˆmodelï¼‰=æ•°æ®å±‚ï¼ˆdaoï¼‰+ä¸šåŠ¡å±‚ï¼ˆserviceï¼‰ã€‚
- Vï¼šè§†å›¾å±‚ï¼ˆVisualï¼‰ã€‚å¦‚htmlã€‚
- Cï¼šæ§åˆ¶å±‚ï¼ˆControlï¼‰ã€‚å®ç°Må’ŒVçš„äº¤æ¥åŠŸèƒ½ã€‚



Mybatisæ•´åˆè¿›Springæ­¥éª¤ï¼ˆæ¦‚ï¼‰ï¼š

1. å¯¼å…¥åŒ…
2. é…ç½®æ–‡ä»¶
3. mybatisé…ç½®
4. ç¼–å†™sql
5. ä¸šåŠ¡å±‚è°ƒç”¨daoå±‚
6. controllerè°ƒç”¨serviceå±‚



## Securityï¼ˆå®‰å…¨ï¼‰

### å‰è¨€

åœ¨webå¼€å‘ä¸­ï¼Œå®‰å…¨æ˜¯ç¬¬ä¸€ä½çš„ã€‚è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨å¯ä»¥å‚ä¸å®ç°å®‰å…¨.

- æˆ‘ï¼šè¿‡æ»¤å™¨ï¼ˆåŸºäºserveletï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆåŸºäºspringï¼‰çš„åŒºåˆ«éœ€è¦ç•™æ„ã€‚

å®‰å…¨æ˜¯åŠŸèƒ½æ€§éœ€æ±‚ï¼Ÿï¼šå¦ï¼Œå®‰å…¨ä¸æ˜¯å¿…é¡»çš„ã€‚



åšç½‘ç«™ï¼šå®‰å…¨åº”åœ¨ä»€ä¹ˆæ—¶å€™è€ƒè™‘ï¼Ÿ

- æ¼æ´ä¼šé€ æˆéšç§æ³„éœ²ã€‚
- åœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘å¥½ã€‚
  - æˆ‘ï¼šæ¯”å¦‚ç®€å†é¡¹ç›®çš„cookieå¤„ï¼Œå°±ä»‹ç»äº†è®©cookieæ›´å®‰å…¨çš„å‡ ç§æ–¹å¼ã€‚




æœ‰ä¸¤ä¸ªä¸»æµçš„å®‰å…¨æ¡†æ¶ï¼šshiroï¼Œspringsecurityã€‚è¿™ä¸¤è€…å¾ˆåƒï¼Œé™¤äº†ç±»å’Œåå­—ä¸ä¸€æ ·ï¼Œå…¶ä»–å¾ˆå¤šæ–¹é¢ç±»ä¼¼ã€‚ä»¥ä¸‹ä»‹ç»ä¸¤è€…ç›¸ä¼¼å¤„ï¼š

- è®¤è¯ï¼šè®¿é—®è€…å±ä¸å±äºåˆæ³•ç”¨æˆ·ã€‚
- æˆæƒï¼šæ¯”å¦‚â€æ™®é€šç”¨æˆ·â€œï¼Œâ€œvip1â€ï¼Œâ€œsuper vipâ€æœ‰ä¸åŒçš„æƒé™ã€‚ä¹‹å‰æˆæƒè¦é€šè¿‡æ‹¦æˆªå™¨å»åšï¼Œä½†æ˜¯ç°åœ¨ç”¨å®‰å…¨æ¡†æ¶ï¼Œå¯èƒ½ä¸€ä¸¤è¡Œä»£ç å°±å®Œæˆäº†ã€‚



æƒé™åˆ†ç±»ï¼š

- åŠŸèƒ½æƒé™ï¼šæ¯”å¦‚æ¸¸å®¢åªèƒ½çœ‹ï¼Œç™»å½•çš„ç”¨æˆ·å¯ä»¥å†™åšå®¢
- è®¿é—®æƒé™
- èœå•æƒé™

**ä¹‹å‰è¦åšæƒé™ç®¡ç†éœ€è¦ç”¨æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨ï¼Œéœ€è¦å¤§é‡çš„åŸç”Ÿä»£ç **ï¼Œä¼šæœ‰å¤§é‡çš„åŸç”Ÿä»£ç ï¼Œé€ æˆå†—ä½™ã€‚æ­¤æ—¶å°±å¼•å…¥äº†**æ¡†æ¶ï¼ˆshiro/springsecurity)ï¼Œæ¥ç®€åŒ–å¼€å‘**ã€‚

- springsecurityæ˜¯ä¸»æµï¼

### SpringSecurity



#### SpringSecurityç®€ä»‹

Spring Security æ˜¯é’ˆå¯¹Springé¡¹ç›®çš„å®‰å…¨æ¡†æ¶ï¼Œä¹Ÿæ˜¯Spring Bootåº•å±‚å®‰å…¨æ¨¡å—é»˜è®¤çš„æŠ€æœ¯é€‰å‹ï¼Œä»–å¯ ä»¥å®ç°å¼ºå¤§çš„Webå®‰å…¨æ§åˆ¶ï¼Œå¯¹äºå®‰å…¨æ§åˆ¶ï¼Œæˆ‘ä»¬ä»…éœ€è¦å¼•å…¥ **spring-boot-starter-security** æ¨¡å—ï¼Œè¿›è¡Œå°‘é‡çš„é…ç½®ï¼Œå³å¯å®ç°å¼ºå¤§çš„å®‰å…¨ç®¡ç†ï¼ 



è®°ä½å‡ ä¸ªç±»ï¼š

-  WebSecurityConfigurerAdapterï¼š è‡ªå®šä¹‰Securityç­–ç•¥ï¼Œè¯¥ç±»ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ã€‚
- AuthenticationManagerBuilderï¼šè‡ªå®šä¹‰è®¤è¯ç­–ç•¥ ï¼Œè¯¥ç±»ä½¿ç”¨äº†å»ºé€ è€…æ¨¡å¼ã€‚
- @EnableWebSecurityï¼šå¼€å¯WebSecurityæ¨¡å¼ï¼Œ@EnableXXXè¡¨ç¤ºå¼€å¯XXXåŠŸèƒ½ã€‚



Spring Securityçš„ä¸¤ä¸ªä¸»è¦ç›®æ ‡æ˜¯ â€œè®¤è¯â€ å’Œ â€œæˆæƒâ€ï¼ˆè®¿é—®æ§åˆ¶ï¼‰ã€‚ â€œè®¤è¯â€ï¼ˆAuthenticationï¼‰ èº«ä»½éªŒè¯æ˜¯å…³äºéªŒè¯æ‚¨çš„å‡­æ®ï¼Œå¦‚ç”¨æˆ·å/ç”¨æˆ·IDå’Œå¯†ç ï¼Œä»¥éªŒè¯æ‚¨çš„èº«ä»½ã€‚ èº«ä»½éªŒè¯é€šå¸¸é€šè¿‡ç”¨æˆ·åå’Œå¯†ç å®Œæˆï¼Œæœ‰æ—¶ä¸èº«ä»½éªŒè¯å› ç´ ç»“åˆä½¿ç”¨ã€‚â€œè®¤è¯â€å’Œâ€œæˆæƒâ€çš„æ¦‚å¿µæ˜¯é€šç”¨çš„ï¼Œä¸åªæ˜¯åœ¨SpringSecurityä¸­å­˜åœ¨ã€‚



ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ï¼š

- å‚è€ƒå®˜ç½‘ï¼šhttps://spring.io/projects/spring-security 

- æŸ¥çœ‹æˆ‘ä»¬è‡ªå·±é¡¹ç›®ä¸­çš„ç‰ˆæœ¬ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¸®åŠ©æ–‡æ¡£ï¼š https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5/#servlet-applications%208.16.4



#### SpringSecurityç¯å¢ƒæ­å»º

![image-20211005205249365](springboot.assets/image-20211005205249365.png)

åªé€‰æ‹©springwebï¼ˆå¾ˆå¥½å¥‡ä¸ºå•¥ä¸é€‰springsecurityå’Œthymeleafï¼‰

![image-20211005205331647](springboot.assets/image-20211005205331647.png)

æŠŠthymeleafçš„åŒ…å–ä¸€ä¸‹

- springå®˜æ–¹æ–‡æ¡£å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„thymeleafç‰ˆæœ¬ï¼šhttps://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/htmlsingle/#using-boot-starter

  ![image-20211005210602078](springboot.assets/image-20211005210602078.png)

  ![image-20211005210637037](springboot.assets/image-20211005210637037.png)

- è¿™é‡Œä¿å­˜ä¸€ä»½å‰¯æœ¬

  ```xml
  <!--thymeleafæ¨¡æ¿-->
  <dependency>
      <groupId>org.thymeleaf</groupId>
      <artifactId>thymeleaf-spring5</artifactId>
  </dependency>
  <dependency>
      <groupId>org.thymeleaf.extras</groupId>
      <artifactId>thymeleaf-extras-java8time</artifactId>
  </dependency>
  ```

- å¦‚æœå¿˜è®°å¯¼å…¥thymeleafï¼Œæˆ–è€…thymeleafçš„åŒ…æ²¡æœ‰è¢«æˆåŠŸä¸‹è½½ï¼Œä¼šæŠ¥ä¸‹é¢è¿™ä¸ªé”™`Circular view path [index]: would dispatch back to the current handler URL [/index] again`.



å¯¼å…¥é™æ€èµ„æºï¼šD:\ForGoodJob\tech_notes\java_back_end\å­¦ä¹ èµ„æ–™\SpringSecurityç´ æ_ioqdonxcï¼ŒæŠŠstaticå’Œtemplateæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†åˆ«å¤åˆ¶åˆ°é¡¹ç›®ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å®ç°securityï¼ˆç­‰çº§ç­‰åŠŸèƒ½ï¼‰çš„å‰ç«¯ã€‚

![image-20211005212008577](springboot.assets/image-20211005212008577.png)

propertiesæˆ–yamlé…ç½®æ–‡ä»¶ä¸­ï¼Œå…³é—­æ¨¡æ¿å¼•æ“ï¼Œå°±å¯ä»¥éšæ—¶è°ƒè¯•ï¼Œä¸ç„¶æ¯æ¬¡éƒ½å¾—é‡å¯

```properties
# å…³é—­æ¨¡æ¿å¼•æ“
spring.thymeleaf.cache=false
```

æ§åˆ¶å±‚ç¼–å†™RouterControlleråšè¯·æ±‚çš„åˆ†å‘

```java
package com.zhangyun.springboot06security.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class RouterController {

    @GetMapping({"/","/index"})
    public String index(){
        //ä¹Ÿå¯ä»¥å†™æˆ return "index.html";
        return "index";
    }

    @GetMapping("/toLogin")
    public String toLogin(){
        return "views/login";
    }

    //ä½¿ç”¨restfulé£æ ¼ä¼ é€’å‚æ•°ï¼Œå¹¶ç”¨å‚æ•°æ§åˆ¶è®¿é—®ä¸åŒçš„é¡µé¢
    @GetMapping("/level1/{id}")
    public String level1(@PathVariable("id") int id){
        return "views/level1/"+id;
    }

    @GetMapping("/level2/{id}")
    public String level2(@PathVariable("id") int id){
        return "views/level2/"+id;
    }

    @GetMapping("/level3/{id}")
    public String level3(@PathVariable("id") int id){
        return "views/level3/"+id;
    }

}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼ŒæˆåŠŸå±•ç°äº†é¡µé¢ã€‚é¡µé¢æ˜¾ç¤ºä¸åŒç­‰çº§å¯ä»¥è®¿é—®çš„é¡µé¢ï¼Œè¿™ä¸ªç¨åå®ç°ã€‚

![image-20211005214657807](springboot.assets/image-20211005214657807.png)

#### ç”¨æˆ·è®¤è¯å’Œæˆæƒ

ä»¥aopï¼ˆæ¨ªåˆ‡ï¼‰çš„æ–¹å¼å®ç°è®¤è¯å’Œæˆæƒï¼Œä¸ç”¨æ”¹åŠ¨â€œå‰è¨€â€ä¸­çš„åŸºç¡€ä»£ç ã€‚



å®æˆ˜ï¼š

å¯¼å…¥spring-securityä¾èµ–ã€‚ä¹‹å‰è€å¸ˆä¸å‹¾é€‰springsecurityå¯èƒ½å°±æ˜¯æƒ³å¾ªåºæ¸è¿›ï¼Œè¿™æ­¥å¯¼å…¥äº†springsecurityçš„pomç›¸å½“äºå»ºé¡¹ç›®çš„æ—¶å€™å‹¾é€‰äº†springsecurityã€‚å¯¼å…¥ä¾èµ–åç”±äº2021ç‰ˆideaä¸åœ¨pomæ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°jaråŒ…ï¼Œè¦æ‰‹åŠ¨ç‚¹å‡»ä¸€ä¸‹é¡µé¢å³ä¸Šè§’çš„**må›¾æ ‡**æ¥ä¸‹è½½æ›´æ–°çš„jaråŒ…ã€‚

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

![image-20211006132609109](springboot.assets/image-20211006132609109.png)

è§‚å¯Ÿåˆ°springsecurityæ ¸å¿ƒåŒ…æœ‰aopï¼Œç¬¦åˆäº†æ¨ªåˆ‡çš„è¯´æ³•ã€‚

![image-20211006132914225](springboot.assets/image-20211006132914225.png)

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œç”¨javaconfigçš„æ–¹å¼å®ç°springsecurity

![image-20211006134854453](springboot.assets/image-20211006134854453.png)

ç¼–å†™è‡ªå®šä¹‰çš„SecurityConfigã€‚æ³¨æ„å¯†ç å¼ºåˆ¶åŠ å¯†çš„é—®é¢˜ã€‚

```java
package com.zhangyun.springboot06security.config;

import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

//@EnableWebSecurityè®©ç±»è¢«springæ‰˜ç®¡ã€‚WebSecurityConfigurerAdapterè®©ç±»æˆä¸ºspringsecurityé…ç½®ç±»ã€‚
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    //æˆæƒï¼ï¼
    //alt+inserté‡å†™configure(HttpSecurity http)æ–¹æ³•ã€‚å›ºå®šã€‚
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        //è¯·æ±‚æˆæƒçš„è§„åˆ™ï¼šé¦–é¡µæ‰€æœ‰äººå¯ä»¥è®¿é—®ï¼ŒåŠŸèƒ½é¡µåªæœ‰å¯¹åº”æœ‰æƒé™çš„äººæ‰èƒ½è®¿é—®ã€‚
        http.authorizeRequests().antMatchers("/").permitAll()
                .antMatchers("/level1/**").hasRole("vip1")
                .antMatchers("/level2/**").hasRole("vip2")
                .antMatchers("/level3/**").hasRole("vip3");

        /*æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æƒé™åº”è¯¥è·³åˆ°ç™»å½•é¡µé¢ï¼Œè€Œä¸æ˜¯403ï¼ˆpermision deniedï¼‰é¡µé¢ã€‚
        * é…ç½®ä¸‹é¢è¿™è¡Œä»£ç ï¼Œæ²¡æœ‰æƒé™è‡ªåŠ¨è·³åˆ°ç™»å½•é¡µï¼ˆspringsecurityè‡ªå¸¦çš„ç™»å½•é¡µï¼‰ã€‚
        * */
        http.formLogin();
    }

    //è®¤è¯ï¼ï¼
    /*å¯†ç ä¸åŠ å¯†çš„è¯ï¼Œåœ¨springboot 2.1.Xå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯é«˜ç‰ˆæœ¬çš„springbootå¼ºåˆ¶è¦æ±‚å¯†ç åŠ å¯†ï¼Œé˜²æ­¢åç¼–è¯‘ä¸ºclassæ–‡ä»¶é€ æˆå¯†ç æ³„éœ²ã€‚
    * å¯†ç ç¼–ç ï¼šPasswordEncoderï¼Œåœ¨springsecurity5.0+ä¸­æ–°å¢äº†å¾ˆå¤šçš„åŠ å¯†æ–¹æ³•ã€‚BCryptPasswordEncoderæ˜¯æ¯”è¾ƒæ¨èçš„åŠ å¯†æ–¹å¼ã€‚
    * */
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        //å¯ä»¥åœ¨æ•°æ®åº“æˆ–è€…å†…å­˜è®¤è¯ï¼Œç°åœ¨æ²¡è¿æ•°æ®åº“ï¼Œå°±åœ¨å†…å­˜è®¤è¯:inMemoryAuthentication()ã€‚
        auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())
                //è¿™äº›æ•°æ®æ­£å¸¸åº”è¯¥ä»æ•°æ®åº“ä¸­è¯»ï¼Œä½†æ˜¯åé¢è®²shiroçš„æ—¶å€™å†ä»æ•°æ®åº“è¯»ã€‚
                .withUser("zhangyun").password(new BCryptPasswordEncoder().encode("123456")).roles("vip2","vip3")
                .and()//æ‹¼æ¥ä¸åŒçš„ç”¨æˆ·
                .withUser("root").password(new BCryptPasswordEncoder().encode("123456")).roles("vip1","vip2","vip3")
                .and()
                .withUser("guest").password(new BCryptPasswordEncoder().encode("123456")).roles("vip1");
    }
}
```

å¯åŠ¨é¡¹ç›®æµ‹è¯•

![image-20211006143322924](springboot.assets/image-20211006143322924.png)

ä½¿ç”¨configä¸­ç™»è®°å¥½çš„çš„ç”¨æˆ·ç™»å½•

![image-20211006143357055](springboot.assets/image-20211006143357055.png)

æˆåŠŸæ¥åˆ°äº†æˆ‘ä»¬æƒ³çœ‹å¾—level

![image-20211006143430847](springboot.assets/image-20211006143430847.png)

ç‚¹å‡»â€œé¦–é¡µâ€å›åˆ°é¦–é¡µï¼Œè®¿é—®level1ä¼šå› ä¸ºæ²¡æœ‰æƒé™è€Œç¦æ­¢è®¿é—®ï¼Œè®¿é—®level2 level3ä¼šæˆåŠŸã€‚

![image-20211006143607623](springboot.assets/image-20211006143607623.png)

![image-20211006143622519](springboot.assets/image-20211006143622519.png)



#### æ³¨é”€åŠæƒé™æ§åˆ¶

åœ¨securityé…ç½®ç±»çš„æˆæƒå‡½æ•°ä¸­ï¼Œå¢åŠ æ³¨é”€åŠŸèƒ½ã€‚

![image-20211006153533221](springboot.assets/image-20211006153533221.png)

å‰ç«¯æ·»åŠ æ³¨é”€æŒ‰é’®ï¼Œ**è¿™é‡Œçš„/logoutè¯·æ±‚ä¼šè¢«springsecurityçš„http.logoutè‡ªåŠ¨å¤„ç†**ã€‚æ‰€ä»¥ä¸è¦ä¹±å†™åˆ«çš„è¯·æ±‚urlï¼Œæ¯”å¦‚é¦–é¡µçš„â€œç™»å½•â€æŒ‰é’®ç»‘å®šçš„urlæ˜¯/toLoginï¼Œä¸ä¼šè¢«springsecurityå¤„ç†ï¼Œspringsecurityé»˜è®¤çš„ç™»å½•urlæ˜¯/loginï¼Œæ‰€ä»¥å¾—æ‰‹åŠ¨è¾“å…¥è¿æ¥http://localhost:8080/loginæ¥ä½¿ç”¨springsecurityçš„ç™»å½•åŠŸèƒ½ã€‚

![image-20211006153414054](springboot.assets/image-20211006153414054.png)

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼Œç™»å‡ºæˆåŠŸåè·³åˆ°æˆ‘ä»¬æŒ‡å®šçš„é¦–é¡µã€‚

![image-20211006153631445](springboot.assets/image-20211006153631445.png)

![image-20211006153646141](springboot.assets/image-20211006153646141.png)

![image-20211006153702271](springboot.assets/image-20211006153702271.png)

**è¿™é‡Œæœ‰ç¼ºé™·**ã€‚æ­£å¸¸æ¥è¯´ï¼Œç™»å½•ååº”è¯¥åªèƒ½çœ‹åˆ°è‡ªå·±èƒ½çœ‹åˆ°levelæ¨¡å—ï¼Œæ¯”å¦‚zhangyunçš„é¦–é¡µå°±ä¸åº”è¯¥å‡ºç°level1ã€‚

å¯ä»¥é€šè¿‡thymeleafå»è¯»sessionä¸­çš„ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯æ¥æ§åˆ¶å‰ç«¯æ˜¾ç¤ºï¼Œå¯ä»¥é€šè¿‡å¯¼å…¥thymeleafå’Œspringsecurityçš„æ•´åˆåŒ…å®ç°ï¼Œæœ‰è¿™ä¸ªæ•´åˆåŒ…å°±å¯ä»¥åœ¨thymeleafä¸­åšspringsecurityçš„æ“ä½œã€‚

å¯¼å…¥ä¾èµ–ã€‚**ä¸€å®šè¦å¯¼å…¥çš„springsecurity5**ã€‚å¦‚æœå¯¼å…¥springsecurity4åŠä»¥ä¸‹ï¼Œåœ¨springboot2.5.5çš„æ¡†æ¶ä¸‹æœ‰å¾ˆå¤šsecåŠŸèƒ½ä¸èƒ½ç”¨ã€‚

```xml
<!-- springsecurityå’Œthymeleafçš„æ•´åˆåŒ…
https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity5 -->
<dependency>
    <groupId>org.thymeleaf.extras</groupId>
    <artifactId>thymeleaf-extras-springsecurity5</artifactId>
    <version>3.0.4.RELEASE</version>
</dependency>
```

æ³¨æ„secé»˜è®¤å¯¼å…¥çš„å‘½åç©ºé—´æ˜¯**é”™çš„**ï¼Œè¦æ¢æˆ`xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"`ã€‚å›¾ç‰‡å’Œæ–‡å­—çŸ›ç›¾æ—¶ä»¥æ–‡å­—ä¸ºå‡†ï¼ˆå›¾ä¸­security4æ˜¯ä¸èƒ½ç”¨çš„ï¼‰

![image-20211006155349192](springboot.assets/image-20211006155349192.png)

ç¼–å†™å‰ç«¯é¡µé¢ï¼Œç”¨secæ¥æ§åˆ¶è®¿é—®æƒé™

![image-20211006170628051](springboot.assets/image-20211006170628051.png)

![image-20211006170817338](springboot.assets/image-20211006170817338.png)

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•

é¦–å…ˆçœ‹åˆ°çš„é¡µé¢æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œå› ä¸ºè¿˜æ²¡ç™»å½•æ²¡æœ‰roleã€‚è¿™æ—¶å€™è¦ç½‘å€+/loginæ¥ä½¿ç”¨springsecurityçš„ç™»å½•åŠŸèƒ½ã€‚**ä¸è¦**ç‚¹å‡»å³ä¸Šè§’çš„ç™»å½•ï¼Œé‚£ä¸ªæ˜¯è‡ªå·±å†™çš„ç™»å½•æ¥å£ï¼Œæ²¡æœ‰å®ç°springsecurityã€‚**æƒ³è®©å³ä¸Šè§’çš„â€œç™»å½•â€æŒ‰é’®å®ç°springsecurityåŠŸèƒ½ï¼Œå°±è¦æŠŠâ€ç™»å½•â€œæ ‡ç­¾urlç”±/toLoginæ”¹ä¸º/loginï¼ŒåŒæ—¶åˆ æ‰RouterControllerä¸­å…³äº/toLoginçš„å¤„ç†ï¼Œè®©springsecurityè‡ªåŠ¨æ¥ç®¡â€œç™»å½•â€æŒ‰é’®ã€‚**

![image-20211006170936401](springboot.assets/image-20211006170936401.png)

è®¿é—®http://localhost:8080/loginæ¥åˆ°springsecurityçš„ç™»å½•ç•Œé¢ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•

![image-20211006171137984](springboot.assets/image-20211006171137984.png)

æˆåŠŸç™»å½•æ¥åˆ°é¦–é¡µã€‚å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹ç‰¹å¾ï¼Œå®Œå…¨ç¬¦åˆç¨‹åºè®¾å®šï¼š

- å·²ç™»å½•çŠ¶æ€çœ‹ä¸åˆ°â€œç™»å½•â€é€‰é¡¹
- å·²ç™»å½•çŠ¶æ€æ˜¾ç¤ºç™»å½•çš„ç”¨æˆ·å
- å·²ç™»å½•çŠ¶æ€æ˜¾ç¤ºç™»å½•ç”¨æˆ·çš„rolesï¼ˆæƒé™æ ‡è®°ï¼‰
- å·²ç™»å½•çŠ¶æ€æ˜¾ç¤ºâ€œæ³¨é”€â€é€‰é¡¹ã€‚
- å·²ç™»å½•çŠ¶æ€å¯ä»¥çœ‹åˆ°è‡ªå·±èƒ½è¢«å…è®¸çœ‹è§çš„å‰ç«¯éƒ¨åˆ†ã€‚

![image-20211006171301706](springboot.assets/image-20211006171301706.png)

ç‚¹å‡»æ³¨é”€ï¼Œå›åˆ°é¦–é¡µã€‚å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹ç‰¹å¾ï¼Œå®Œå…¨ç¬¦åˆç¨‹åºè®¾å®šï¼š

- æœªç™»å½•çŠ¶æ€æ˜¾ç¤ºâ€œç™»å½•â€æŒ‰é’®ï¼ˆè™½ç„¶è¯¥ç™»å½•æŒ‰é’®ç»‘å®šçš„è¯·æ±‚æ˜¯/toLoginæ²¡å®ç°springsecurityï¼ŒçœŸspringsecurityå¼ç™»å½•å¾—è®¿é—®http://localhost:8080/loginï¼‰

![image-20211006171948526](springboot.assets/image-20211006171948526.png)

![image-20211006172001632](springboot.assets/image-20211006172001632.png)





#### è®°ä½æˆ‘åŠé¦–é¡µå®šåˆ¶

https://www.bilibili.com/video/BV1PE411i7CV?p=37&spm_id_from=pageDriver

å¼€å¯â€œè®°ä½æˆ‘â€åŠŸèƒ½ï¼Œæœ¬è´¨æ˜¯cookieçš„å®ç°ã€‚å‹¾é€‰â€œè®°ä½æˆ‘â€åï¼Œå…³é—­æµè§ˆå™¨å†æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®ç½‘å€ï¼Œå¯ä»¥ç›´æ¥ä¸ºç™»å½•çŠ¶æ€ã€‚

åœ¨â€æˆæƒå‡½æ•°â€œæ·»åŠ æ­¤åŠŸèƒ½

![image-20211006193526222](springboot.assets/image-20211006193526222.png)

ä¹‹å‰æè¿‡ï¼Œå³ä¸Šè§’çš„â€œç™»å½•â€æŒ‰é’®ä¸åœ¨springsecurityæ¡†æ¶ä¸­ï¼Œç°åœ¨æˆ‘ä»¬è®©/toLoginè®¾ç½®ä¸ºspringSecurityçš„é»˜è®¤ç™»å½•é¡µã€‚åŒæ ·ï¼Œåœ¨â€œæˆæƒå‡½æ•°ä¸­æ·»åŠ æ­¤åŠŸèƒ½ã€‚

**æ³¨æ„ï¼šçœ‹æºç ï¼ŒloginPage() æŒ‡å®šç™»å½•ç•Œé¢æ˜¯å“ªä¸€ä¸ªï¼Œè¿™é‡ŒæŒ‡åˆ° "/tologin"ã€‚loginProcessingUrl() æŒ‡å®šå¤„ç†ç™»å½•è¯·æ±‚çš„ï¼Œä¹Ÿå°±æ˜¯ç™»å½•çš„ form æäº¤çš„åœ°å€ï¼Œè¿™é‡Œæ˜¯ "/login"ã€‚æ³¨æ„ï¼ï¼ï¼ï¼šä¸€å®šéƒ½è¦æ˜¯POSTè¯·æ±‚ã€‚**ä½†æ˜¯æˆ‘å®æˆ˜ä¸­/toLoginå¯ä»¥æ˜¯getè¯·æ±‚ã€‚

![image-20211006195644289](springboot.assets/image-20211006195644289.png)

ç™»å½•é¡µä¸­ç”¨æˆ·åå’Œå¯†ç è¡¨å•çš„æäº¤è¯·æ±‚ï¼Œè®¾å®šä¸º/login

![image-20211006200440160](springboot.assets/image-20211006200440160.png)

è®¾ç½®springsecurityä¸­ï¼Œä»€ä¹ˆè¯·æ±‚èƒ½æ¥æ”¶åˆ°è¡¨å•æäº¤çš„ç”¨æˆ·åå¯†ç 

![image-20211006201556319](springboot.assets/image-20211006201556319.png)

åŒæ—¶ï¼Œspringsecurityè¿˜èƒ½è®¾ç½®è‡ªå·±æƒ³æ¥æ”¶çš„ç”¨æˆ·åå’Œå¯†ç çš„nameï¼Œæ¥é€‚é…å‰ç«¯å®šä¹‰çš„name

![image-20211006205030645](springboot.assets/image-20211006205030645.png)

å› ä¸ºæ²¡ä½¿ç”¨é»˜è®¤çš„loginï¼Œç°åœ¨/logoutä¹Ÿå¾—æ‰‹åŠ¨é…ç½®ä¸€ä¸‹

![image-20211006204948583](springboot.assets/image-20211006204948583.png)

åŒæ—¶ï¼Œé«˜çº§springsecurityè¦æ±‚loginå’Œlogoutéƒ½å¾—ä»¥postæ–¹å¼æäº¤ã€‚è¿™é‡Œæ‡’å¾—ç”¨ajaxæŠŠlogoutçš„\<a>è½¬æˆpostè¯·æ±‚ï¼Œç›´æ¥åœ¨ä»£ç ä¸­å…³é—­csrfå³å¯è®©springsecurityå…è®¸ä»¥getæ–¹å¼æ‰§è¡Œlogoutã€‚åœ¨æˆæƒå‡½æ•°ä¸­é…ç½®ã€‚

![image-20211006204913991](springboot.assets/image-20211006204913991.png)

ç™»å½•é¡µé¢æ·»åŠ â€œè®°ä½æˆ‘â€

åœ¨å‰ç«¯æ·»åŠ â€œè®°ä½æˆ‘â€

![image-20211006205830725](springboot.assets/image-20211006205830725.png)

springsecurityé…ç½®ç±»çš„æˆæƒå‡½æ•°ä¸­ï¼Œé…ç½®ç™»å½•è¡¨å•ä¸­å“ªä¸ªå‚æ•°ä»£è¡¨â€œè®°ä½æˆ‘â€

![image-20211006210021259](springboot.assets/image-20211006210021259.png)

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•

é¦–å…ˆæ¥åˆ°é¦–é¡µ

![image-20211006210046869](springboot.assets/image-20211006210046869.png)

ç‚¹å‡»â€ç™»å½•â€œï¼Œæ¥åˆ°æäº¤ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•é¡µé¢ï¼ŒåŒæ—¶å‹¾é€‰ä¸Šâ€œè®°ä½æˆ‘â€ã€‚

![image-20211006210140301](springboot.assets/image-20211006210140301.png)

ç™»å½•æˆåŠŸï¼Œæ¥åˆ°äº†é¦–é¡µï¼Œå±•ç¤ºäº†zhangyunèƒ½çœ‹åˆ°çš„levelã€‚

![image-20211006210208701](springboot.assets/image-20211006210208701.png)

å…³é—­æµè§ˆå™¨ï¼Œå†æ‰“å¼€ï¼Œå†è¾“å…¥ï¼šhttp://localhost:8080/ã€‚ç›´æ¥å°±æ˜¯å·²ç™»å½•çš„ç•Œé¢ï¼Œç¬¦åˆå‹¾é€‰â€œè®°ä½æˆ‘â€çš„æ•ˆæœã€‚

![image-20211006210439310](springboot.assets/image-20211006210439310.png)

ç‚¹å‡»â€œæ³¨é”€â€ï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€å¹¶æ¥åˆ°é¦–é¡µã€‚

![image-20211006210256909](springboot.assets/image-20211006210256909.png)



### shiro

#### ç®€ä»‹

shiroæ²¡æœ‰springsecurityå¥½ç”¨ï¼Œä½†æ˜¯å¾—ä¼šï¼Œå› ä¸ºé¢è¯•ä¼šé—®ã€‚



shiroæ ¸å¿ƒä¸‰å¤§å¯¹è±¡ï¼š

- Subjectï¼šä»£è¡¨ç”¨æˆ·

- SecurityManagerï¼šç®¡ç†æ‰€æœ‰ç”¨æˆ·
- Realmï¼šè¿æ¥æ•°æ®

![image-20211008195949271](springboot.assets/image-20211008195949271.png)



#### shiroå¿«é€Ÿå¼€å§‹

ä¸‹è½½shiroï¼šhttps://github.com/apache/shiroã€‚å¹¶æ¥åˆ°quickStartã€‚

![image-20211007111156066](springboot.assets/image-20211007111156066.png)

![image-20211007111237593](springboot.assets/image-20211007111237593.png)

ideaåˆ›å»ºä¸€ä¸ªç®€å•çš„mavené¡¹ç›®

![image-20211007111117362](springboot.assets/image-20211007111117362.png)

![image-20211007111438465](springboot.assets/image-20211007111438465.png)

åˆ é™¤srcæ–‡ä»¶å¤¹å¹¶å»ºç«‹å­moduleï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åšå¤šä¸ªå­é¡¹ç›®ã€‚mavenä¸­å¸¸è¿™ä¹ˆå¹²ï¼Œé˜²æ­¢å»ºç«‹è¿‡å¤šprojectã€‚

![image-20211007111602689](springboot.assets/image-20211007111602689.png)

![image-20211007111701122](springboot.assets/image-20211007111701122.png)

![image-20211007111734835](springboot.assets/image-20211007111734835.png)

å­moduleåˆ›å»ºå®Œæˆ

![image-20211007111824673](springboot.assets/image-20211007111824673.png)

æŠŠä¸‹è½½çš„shiroçš„pomä¸­çš„ä¾èµ–æ”¾è¿›è‡ªå·±mavené¡¹ç›®çš„pomä¸­ã€‚ä¾èµ–ä¸­ä¸»è¦æ˜¯ä¸€äº›æ—¥å¿—å’Œæ—¥å¿—é—¨é¢çš„é…ç½®ã€‚

![image-20211007112432944](springboot.assets/image-20211007112432944.png)

![image-20211007112511025](springboot.assets/image-20211007112511025.png)

æˆ‘ä»¬å†å»æ‰¾ä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥å»mvnrepositoryæœartifactidï¼Œé€‰æ‹©å¯ç”¨çš„ç‰ˆæœ¬å·ã€‚æ¯”å¦‚å¦‚ä¸‹ï¼š

![image-20211007113127227](springboot.assets/image-20211007113127227.png)

æ·»åŠ ç‰ˆæœ¬å·åçš„ä¾èµ–å¦‚ä¸‹ï¼š

```xml
<dependencies>
    <dependency>
        <groupId>org.apache.shiro</groupId>
        <artifactId>shiro-core</artifactId>
        <version>1.4.1</version>
    </dependency>

    <!-- configure logging -->
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>jcl-over-slf4j</artifactId>
        <version>1.7.21</version>
    </dependency>
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-log4j12</artifactId>
        <version>1.7.21</version>
    </dependency>
    <dependency>
        <groupId>log4j</groupId>
        <artifactId>log4j</artifactId>
        <version>1.2.17</version>
    </dependency>
</dependencies>
```

ç°åœ¨é…ç½®shiroçš„ä¸€äº›å‚æ•°

å…ˆçœ‹log4j.properties

![image-20211007114159662](springboot.assets/image-20211007114159662.png)

![image-20211007114246201](springboot.assets/image-20211007114246201.png)

```properties
log4j.rootLogger=INFO, stdout

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m %n

# General Apache libraries
log4j.logger.org.apache=WARN

# Spring
log4j.logger.org.springframework=WARN

# Default Shiro logging
log4j.logger.org.apache.shiro=INFO

# Disable verbose logging
log4j.logger.org.apache.shiro.util.ThreadContext=WARN
log4j.logger.org.apache.shiro.cache.ehcache.EhCache=WARN

```

åœ¨resourceä¸‹å»ºç«‹åŒålog4j.propertiesæ–‡ä»¶ï¼Œå¹¶æ”¾å…¥é…ç½®

![image-20211007114515145](springboot.assets/image-20211007114515145.png)

å†çœ‹shiro.iniæ–‡ä»¶

![image-20211007114658799](springboot.assets/image-20211007114658799.png)

![image-20211007114747122](springboot.assets/image-20211007114747122.png)

```ini
[users]
# user 'root' with password 'secret' and the 'admin' role
root = secret, admin
# user 'guest' with the password 'guest' and the 'guest' role
guest = guest, guest
# user 'presidentskroob' with password '12345' ("That's the same combination on
# my luggage!!!" ;)), and role 'president'
presidentskroob = 12345, president
# user 'darkhelmet' with password 'ludicrousspeed' and roles 'darklord' and 'schwartz'
darkhelmet = ludicrousspeed, darklord, schwartz
# user 'lonestarr' with password 'vespa' and roles 'goodguy' and 'schwartz'
lonestarr = vespa, goodguy, schwartz

# -----------------------------------------------------------------------------
# Roles with assigned permissions
# 
# Each line conforms to the format defined in the
# org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc
# -----------------------------------------------------------------------------
[roles]
# 'admin' role has all permissions, indicated by the wildcard '*'
admin = *
# The 'schwartz' role can do anything (*) with any lightsaber:
schwartz = lightsaber:*
# The 'goodguy' role is allowed to 'drive' (action) the winnebago (type) with
# license plate 'eagle5' (instance specific id)
goodguy = winnebago:drive:eagle5
```

åœ¨ideaçš„resourceç›®å½•ä¸‹å»ºç«‹åŒåshiro.iniæ–‡ä»¶å¹¶å¤åˆ¶å†…å®¹è¿›å»ã€‚ideaä¼šæç¤ºæ˜¯å¦å®‰è£…iniæ–‡ä»¶çš„æ”¯æŒæ’ä»¶ï¼Œå®‰è£…å®Œæ¯•åiniæ–‡ä»¶çš„å†…å®¹ä¼šæœ‰é«˜äº®ã€‚

![image-20211007114943931](springboot.assets/image-20211007114943931.png)

ç°åœ¨æŠŠquickstart.javaæ–‡ä»¶å¤åˆ¶è¿›mavené¡¹ç›®ã€‚

![image-20211007115520984](springboot.assets/image-20211007115520984.png)

```java
/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.*;
import org.apache.shiro.ini.IniSecurityManagerFactory;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.session.Session;
import org.apache.shiro.subject.Subject;
import org.apache.shiro.lang.util.Factory;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;


/**
 * Simple Quickstart application showing how to use Shiro's API.
 *
 * @since 0.9 RC2
 */
public class Quickstart {

    private static final transient Logger log = LoggerFactory.getLogger(Quickstart.class);


    public static void main(String[] args) {

        // The easiest way to create a Shiro SecurityManager with configured
        // realms, users, roles and permissions is to use the simple INI config.
        // We'll do that by using a factory that can ingest a .ini file and
        // return a SecurityManager instance:

        // Use the shiro.ini file at the root of the classpath
        // (file: and url: prefixes load from files and urls respectively):
        Factory<SecurityManager> factory = new IniSecurityManagerFactory("classpath:shiro.ini");
        SecurityManager securityManager = factory.getInstance();

        // for this simple example quickstart, make the SecurityManager
        // accessible as a JVM singleton.  Most applications wouldn't do this
        // and instead rely on their container configuration or web.xml for
        // webapps.  That is outside the scope of this simple quickstart, so
        // we'll just do the bare minimum so you can continue to get a feel
        // for things.
        SecurityUtils.setSecurityManager(securityManager);

        // Now that a simple Shiro environment is set up, let's see what you can do:

        // get the currently executing user:
        Subject currentUser = SecurityUtils.getSubject();

        // Do some stuff with a Session (no need for a web or EJB container!!!)
        Session session = currentUser.getSession();
        session.setAttribute("someKey", "aValue");
        String value = (String) session.getAttribute("someKey");
        if (value.equals("aValue")) {
            log.info("Retrieved the correct value! [" + value + "]");
        }

        // let's login the current user so we can check against roles and permissions:
        if (!currentUser.isAuthenticated()) {
            UsernamePasswordToken token = new UsernamePasswordToken("lonestarr", "vespa");
            token.setRememberMe(true);
            try {
                currentUser.login(token);
            } catch (UnknownAccountException uae) {
                log.info("There is no user with username of " + token.getPrincipal());
            } catch (IncorrectCredentialsException ice) {
                log.info("Password for account " + token.getPrincipal() + " was incorrect!");
            } catch (LockedAccountException lae) {
                log.info("The account for username " + token.getPrincipal() + " is locked.  " +
                        "Please contact your administrator to unlock it.");
            }
            // ... catch more exceptions here (maybe custom ones specific to your application?
            catch (AuthenticationException ae) {
                //unexpected condition?  error?
            }
        }

        //say who they are:
        //print their identifying principal (in this case, a username):
        log.info("User [" + currentUser.getPrincipal() + "] logged in successfully.");

        //test a role:
        if (currentUser.hasRole("schwartz")) {
            log.info("May the Schwartz be with you!");
        } else {
            log.info("Hello, mere mortal.");
        }

        //test a typed permission (not instance-level)
        if (currentUser.isPermitted("lightsaber:wield")) {
            log.info("You may use a lightsaber ring.  Use it wisely.");
        } else {
            log.info("Sorry, lightsaber rings are for schwartz masters only.");
        }

        //a (very powerful) Instance Level permission:
        if (currentUser.isPermitted("winnebago:drive:eagle5")) {
            log.info("You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  " +
                    "Here are the keys - have fun!");
        } else {
            log.info("Sorry, you aren't allowed to drive the 'eagle5' winnebago!");
        }

        //all done - log out!
        currentUser.logout();

        System.exit(0);
    }
}
```

æ³¨æ„ç”±äºjaråŒ…åº“è·¯å¾„æ›´æ–°ï¼Œä¸¤ä¸ªimportä¼šæŠ¥çº¢ï¼Œè¿™æ—¶å€™æŠŠçˆ†çº¢çš„importæ³¨é‡Šæ‰ï¼Œideaä¼šæç¤ºä½ å¯¼å…¥ä»€ä¹ˆæ–°åŒ…ã€‚

![image-20211007120655482](springboot.assets/image-20211007120655482.png)

![image-20211007120922089](springboot.assets/image-20211007120922089.png)

è¿è¡Œquickstart.javaä¸­çš„mainæ–¹æ³•ã€‚è¿è¡ŒæˆåŠŸï¼Œè¯´æ˜shiroåˆæ­¥æ­å»ºå®Œæ¯•ã€‚

![image-20211007121154258](springboot.assets/image-20211007121154258.png)



#### shiroçš„subjectåˆ†æ

å¯¹Quickstart.javaè§£è¯»ï¼Œé‡Œé¢ä¸»è¦æ˜¯åšshiro subjectå±‚çš„äº‹ã€‚å¯¹Quickstart.javaé€è¡Œä»£ç ç»†è¯»ï¼Œå¹¶åšäº†ä¸­æ–‡ç¿»è¯‘ã€‚

Quickstart.javaä¸­çš„åŠŸèƒ½ï¼Œspringsecurityéƒ½èƒ½å®ç°ã€‚

```java
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.*;
//import org.apache.shiro.ini.IniSecurityManagerFactory;
import org.apache.shiro.config.IniSecurityManagerFactory;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.session.Session;
import org.apache.shiro.subject.Subject;
//import org.apache.shiro.lang.util.Factory;
import org.apache.shiro.util.Factory;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;


/**
 * Simple Quickstart application showing how to use Shiro's API.
 *
 * @since 0.9 RC2
 */
public class Quickstart {
    //ä½¿ç”¨æ—¥å¿—é—¨é¢è¾“å‡ºï¼Œç”¨soutä¹Ÿèƒ½è¾“å‡ºï¼Œä½†æ˜¯æ•ˆæœæ²¡æœ‰ç”¨æ—¥å¿—è¿™ä¹ˆå¥½ã€‚
    private static final transient Logger log = LoggerFactory.getLogger(Quickstart.class);


    public static void main(String[] args) {

        /*
        * çœ‹åˆ°factoryæƒ³åˆ°å·¥å‚æ¨¡å¼ã€‚
        *
        * IniSecurityManagerFactoryå·¥å‚è¯»å–iniæ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªSecurityManagerå®ä¾‹ã€‚
        *
        * ä¸‹é¢ä¸¤è¡Œä¸ç®—é‡è¦ä»£ç ï¼Œå› ä¸ºè¿™æ˜¯å†™æ­»çš„ã€‚ä¹‹å‰å­¦jdbc mybatisä¹Ÿæœ‰ç±»ä¼¼å†™æ­»çš„ä»£ç è¡Œã€‚
        * */
        Factory<SecurityManager> factory = new IniSecurityManagerFactory("classpath:shiro.ini");
        SecurityManager securityManager = factory.getInstance();
        /*
        * SecurityManagerä½¿æˆä¸ºå•ä¾‹æ¨¡å¼
        *
        * è¿™è¡Œä»£ç ä¹Ÿæ˜¯å†™æ­»çš„ã€‚
        * */
        SecurityUtils.setSecurityManager(securityManager);

        /***ä»¥ä¸Šæ˜¯è®¾ç½®Shiro environmentå®Œæ¯•ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æˆ‘ä»¬èƒ½ç”¨shiroåšä»€ä¹ˆå®é™…çš„äº‹***/

        /*
        * ï¼ï¼ï¼è·å–å½“å‰ç”¨æˆ·å¯¹è±¡ï¼Œå¯¹è±¡å«åšsubject
        * */
        Subject currentUser = SecurityUtils.getSubject();

        /*
        * ï¼ï¼ï¼ä¸‹é¢ç¬¬ä¸€è¡Œï¼šé€šè¿‡å½“å‰ç”¨æˆ·å¯¹è±¡æ‹¿åˆ°sessionï¼ˆä¸éœ€è¦webæˆ–EJBå®¹å™¨ï¼‰
        *
        * è¿™ä¸æ˜¯httpçš„sessionï¼Œè¿™æ˜¯shiroçš„session
        *
        * ä¸‹é¢å…­è¡Œä»£ç è®²äº†subjectå¦‚ä½•é€šè¿‡shiroè‡ªå¸¦çš„sessionå­˜å€¼å’Œå–å€¼
        * */
        Session session = currentUser.getSession();
        session.setAttribute("someKey", "aValue");
        String value = (String) session.getAttribute("someKey");
        if (value.equals("aValue")) {
            log.info("Retrieved the correct value! [" + value + "]");
        }

        /*
        * ï¼ï¼ï¼åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦è¢«è®¤è¯
        * */
        if (!currentUser.isAuthenticated()) {
            //é€šè¿‡ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œã€‚è¿™ä¸ªç”¨æˆ·åå’Œå¯†ç åœ¨shiro.iniä¸­æœ‰é…ç½®ã€‚
            UsernamePasswordToken token = new UsernamePasswordToken("lonestarr", "vespa");
            //è®¾ç½®â€œè®°ä½æˆ‘â€
            token.setRememberMe(true);
            try {
                //æ‰§è¡Œäº†ç™»å½•çš„æ“ä½œã€‚çœ‹ä¸åˆ°ç»†èŠ‚ï¼Œç‚¹è¿›æºç ä¹Ÿä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ã€‚
                currentUser.login(token);
            }
            //å¼‚å¸¸ï¼šç”¨æˆ·ä¸å­˜åœ¨æ—¶
            catch (UnknownAccountException uae) {
                log.info("There is no user with username of " + token.getPrincipal());
            }
            //å¼‚å¸¸ï¼šç”¨æˆ·å¯†ç ä¸å¯¹æ—¶
            catch (IncorrectCredentialsException ice) {
                log.info("Password for account " + token.getPrincipal() + " was incorrect!");
            }
            //å¼‚å¸¸ï¼šç”¨æˆ·è¢«å†»ç»“æ—¶ã€‚æ¯”å¦‚äº”æ¬¡å¯†ç éƒ½ä¸å¯¹ï¼Œå°±å¯ä»¥å†»ç»“è¯¥ç”¨æˆ·ã€‚
            catch (LockedAccountException lae) {
                log.info("The account for username " + token.getPrincipal() + " is locked.  " +
                        "Please contact your administrator to unlock it.");
            }
            //å¯ä»¥è¿ç»­æ·»åŠ æ›´å¤šçš„å¼‚å¸¸
            //åœ¨æœ€åè¿™æ•æ‰æ²¡é¢„æ–™åˆ°çš„å¼‚å¸¸ã€‚UnknownAccountException,IncorrectCredentialsExceptionç­‰éƒ½æ˜¯AuthenticationExceptionçš„å­ç±»ã€‚
            catch (AuthenticationException ae) {
                //unexpected condition?  error?
            }
        }

        //ï¼ï¼ï¼æ‰“å°è®¤è¯ä¿¡æ¯ï¼Œå±•ç¤ºè°ç™»å½•äº†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè®¤è¯ä¿¡æ¯ä¸ºusernameï¼Œå³æ‰“å°usernameã€‚
        log.info("User [" + currentUser.getPrincipal() + "] logged in successfully.");

        //ï¼ï¼ï¼æµ‹è¯•å½“å‰ç”¨æˆ·æœ‰ä»€ä¹ˆè§’è‰²
        if (currentUser.hasRole("schwartz")) {
            log.info("May the Schwartz be with you!");
        } else {
            log.info("Hello, mere mortal.");
        }

        /*
        * ï¼ï¼ï¼ç²—ç²’åº¦çš„è¡Œä¸ºè®¸å¯æµ‹è¯•
        *
        * æµ‹è¯•å½“å‰ç”¨æˆ·èƒ½æœ‰ä»€ä¹ˆè¡Œä¸ºï¼Œä¸åŒroleå¯ä»¥æœ‰ä¸åŒçš„è¡Œä¸ºã€‚æœ¬ä¾‹æµ‹è¯•å½“å‰ç”¨æˆ·æœ‰æ²¡æœ‰lightsaber:wieldçš„è¡Œä¸ºã€‚
        * */
        if (currentUser.isPermitted("lightsaber:wield")) {
            log.info("You may use a lightsaber ring.  Use it wisely.");
        } else {
            log.info("Sorry, lightsaber rings are for schwartz masters only.");
        }

        /*
        * ï¼ï¼ï¼ç»†ç²’åº¦çš„è¡Œä¸ºè®¸å¯æµ‹è¯•
        * */
        if (currentUser.isPermitted("winnebago:drive:eagle5")) {
            log.info("You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  " +
                    "Here are the keys - have fun!");
        } else {
            log.info("Sorry, you aren't allowed to drive the 'eagle5' winnebago!");
        }

        //ï¼ï¼ï¼ç™»å‡º
        currentUser.logout();

        //ç»“æŸç³»ç»Ÿ
        System.exit(0);
    }
}

```



#### springbooté›†æˆshiro

å®æˆ˜ï¼š

![image-20211008211626437](springboot.assets/image-20211008211626437.png)

åˆ›å»ºå­module

![image-20211008174910696](springboot.assets/image-20211008174910696.png)

![image-20211008175029392](springboot.assets/image-20211008175029392.png)

è¿™é‡Œä¸ç”¨é€‰securityï¼Œä¸å¤Ÿçš„è¯å†åŠ ã€‚

![image-20211008175059048](springboot.assets/image-20211008175059048.png)

å­moduleçš„pomä¸­å¯¼å…¥thymeleafä¾èµ–

```xml
<!--thymeleafæ¨¡æ¿-->
<dependency>
    <groupId>org.thymeleaf</groupId>
    <artifactId>thymeleaf-spring5</artifactId>
</dependency>
<dependency>
    <groupId>org.thymeleaf.extras</groupId>
    <artifactId>thymeleaf-extras-java8time</artifactId>
</dependency>
```

ç¼–å†™ç®€æ˜“å‰ç«¯index.htmlï¼Œæµ‹è¯•ç¯å¢ƒ

```html
<!DOCTYPE html>
<!--åŠ ä¸Šå‘½åç©ºé—´åth:textä¸ä¼šçˆ†çº¢ï¼Œç½‘å‹è¯´å‘½åç©ºé—´æ˜¯æç¤ºæ€§çš„ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>é¦–é¡µ</h1>

<!--æ¥æ”¶ä¸€ä¸‹åç«¯ä¼ æ¥çš„modelä¸­çš„å‚æ•°-->
<p th:text="${msg}"></p>

</body>
</html>
```

ç¼–å†™ç®€æ˜“controllerï¼Œæµ‹è¯•ç¯å¢ƒ

```java
package com.zhangyun.shirospringboot.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class MyController {

    @RequestMapping({"/","/index"})
    public String toIndex(Model model){
        model.addAttribute("msg","hello shiro");

        return "index";

    }
}
```

è¿è¡Œé¡¹ç›®è®¿é—®localhostï¼Œå‘ç°é¡¹ç›®é…ç½®æˆåŠŸã€‚

![image-20211008195716757](springboot.assets/image-20211008195716757.png)

ç°åœ¨å¼€å§‹è¿›ä¸€æ­¥æ·±å…¥å­¦ä¹ 

pomä¸­å¯¼å…¥springæ•´åˆshiroçš„åŒ…

å»ä¸‹è½½çš„shiroæ–‡ä»¶ä¸­å»æ‰¾ã€‚

![image-20211008200244143](springboot.assets/image-20211008200244143.png)

pomä¸­æ‰¾åˆ°äº†ä¸‹é¢çš„ä¾èµ–ã€‚ä½†æ˜¯è¯¥ä¾èµ–ä¸æ˜¯springå«¡ç³»ï¼Œæ²¡æœ‰ç‰ˆæœ¬å·ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚![image-20211008200602788](springboot.assets/image-20211008200602788.png)

è€å¸ˆæ”¹ä¸ºå¯¼å…¥shiro-springåŒ…å¦‚ä¸‹

```xml
<dependency>
    <groupId>org.apache.shiro</groupId>
    <artifactId>shiro-spring</artifactId>
    <version>1.4.1</version>
</dependency>
```

ç¼–å†™é…ç½®ç±»ShiroConfig.java

```java
package com.zhangyun.shirospringboot.config;

import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class ShiroConfig {

    //ç¬¬ä¸‰æ­¥ï¼šShiroFilterFactoryBeanï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹Subject
    /*
    * ä¹‹æ‰€ä»¥ä»–æ˜¯ç¬¬ä¸‰æ­¥ï¼Œæ˜¯å› ä¸ºshiroFilterFactoryBeanéœ€è¦SecurityManager
    *
    * ä¸è¦å¿˜è®°@Bean
    * */
    @Bean
    public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Qualifier("getDefaultWebSecurityManager") DefaultWebSecurityManager defaultWebSecurityManager){
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();

        //éœ€è¦ç»‘å®šSecurityManagerå³è®¾ç½®å®‰å…¨ç®¡ç†å™¨ï¼Œç»‘å®šåŸç†åŒç¬¬äºŒæ­¥çš„setRealm()
        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);
        return shiroFilterFactoryBean;
    }

    //ç¬¬äºŒæ­¥ï¼šDefaultWebSecurityManagerï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹SecurityManager
    /*
    * ä¹‹æ‰€ä»¥ä»–ä¸ºç¬¬äºŒæ­¥ï¼Œæ˜¯å› ä¸ºsecurityManageréœ€è¦Realm
    *
    * å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ³¨å…¥ç‚¹éœ€è¦å¦ä¸€ä¸ª beanï¼Œæˆ‘ä»¬éœ€è¦ä¸“é—¨æŒ‡å‡ºå®ƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ @Qualifier æ³¨è§£æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚
    *
    * é…ç½®ç±»ä¸­çš„å½“å‰å‡½æ•°ä¸è¦å¿˜è®°åŠ ä¸Š@Bean
    * */
    @Bean
    public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier("userRealm") UserRealm userRealm){
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
        //éœ€è¦å‚æ•°ï¼Œå› ä¸ºéœ€è¦å…³è”UserRealmï¼Œå› ä¸ºsecurityManageræ˜¯ä¸€ä¸ªä¸­é—´å•†ã€‚ä»springä¸­å–å‡ºbeanä½œä¸ºsecuritymanagerçš„å‚æ•°å¹¶ç»™setRealmã€‚
        securityManager.setRealm(userRealm);

        return securityManager;
    }

    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºrealmå¯¹è±¡ï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹realm
    /*
    * ç±»é…ç½®spring beançŸ¥è¯†å›é¡¾ï¼š
    * 1. æ³¨å†ŒUserRealmæ‰€ä»¥å‡½æ•°çš„è¿”å›å€¼ä¸ºUserRealm
    * 2. å‡½æ•°åuserRealmä¸ºbeançš„åˆ«åï¼Œgetbeanå°±ä¼šgetåˆ°userRealm
    * 3. è¿”å›å€¼ä¸ºnew â€œè¦åœ¨springæ³¨å†Œçš„ç±»â€
    * 4. ä¸è¦å¿˜è®°åœ¨å‡½æ•°çš„ä¸Šé¢åŠ ä¸Š@Beanæ³¨è§£
    * åšå®Œä¸Šé¢å››æ­¥ï¼Œè‡ªå·±å†™çš„UserRealmç±»å°±è¢«springæ‰˜ç®¡äº†
    *
    * @Componentå’Œ@Beançš„åŒºåˆ«ï¼šhttps://blog.csdn.net/qq_35430000/article/details/108910387
    * */
    @Bean
    public UserRealm userRealm(){
        return new UserRealm();
    }
}
```

ç¼–å†™è‡ªå®šä¹‰Realmç±»ã€‚è‡ªå®šä¹‰Realmç±»å¿…é¡»ç»§æ‰¿AuthorizingRealm

```java
package com.zhangyun.shirospringboot.config;

import org.apache.shiro.authc.AuthenticationException;
import org.apache.shiro.authc.AuthenticationInfo;
import org.apache.shiro.authc.AuthenticationToken;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;

public class UserRealm extends AuthorizingRealm {

    //æˆæƒ
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        System.out.println("æ‰§è¡Œäº†=ã€‹æˆæƒdoGetAuthorizationInfo");
        return null;
    }

    //è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("æ‰§è¡Œäº†=ã€‹è®¤è¯doGetAuthenticationInfo");
        return null;
    }
}
```

ç¼–å†™æµ‹è¯•æ‹¦æˆªç”¨çš„å‰ç«¯é¡µé¢add.html å’Œupdate.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>add</h1>

</body>
</html>
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>update</h1>
</body>
</html>
```

indexé¡µé¢æ·»åŠ add.html update.htmlçš„è¶…é“¾æ¥ã€‚

```html
<!DOCTYPE html>
<!--åŠ ä¸Šå‘½åç©ºé—´åth:textä¸ä¼šçˆ†çº¢ï¼Œç½‘å‹è¯´å‘½åç©ºé—´æ˜¯æç¤ºæ€§çš„ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>é¦–é¡µ</h1>

<!--æ¥æ”¶ä¸€ä¸‹åç«¯ä¼ æ¥çš„modelä¸­çš„å‚æ•°-->
<p th:text="${msg}"></p>

<a th:href="@{/user/add}">add</a> | <a th:href="@{/user/update}">update</a>
</body>
</html>
```

controllerä¸­å¢åŠ å¯¹æ–°å‰ç«¯é¡µé¢çš„å¤„ç†

```java
package com.zhangyun.shirospringboot.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class MyController {

    @RequestMapping({"/","/index"})
    public String toIndex(Model model){
        model.addAttribute("msg","hello shiro");
        return "index";
    }

    @RequestMapping("/user/add")
    public String add(){
        return "user/add";
    }

    @RequestMapping("/user/update")
    public String update(){
        return "user/update";
    }


}
```

å¯åŠ¨é¡¹ç›®æµ‹è¯•

![image-20211008211651608](springboot.assets/image-20211008211651608.png)

ç‚¹å‡»update å’Œaddå¯ä»¥åˆ†åˆ«è·³åˆ°ç›¸åº”htmlé¡µé¢

![image-20211008211725896](springboot.assets/image-20211008211725896.png)

![image-20211008211741320](springboot.assets/image-20211008211741320.png)



shiroçš„çš„ShiroConfig.javaæ¯”springsecurityå¤šäº†ä¸‰ä¸ªbeanï¼Œä½“ç°**shiroæ›´è‡ƒè‚¿éº»çƒ¦ç‚¹**ã€‚



**é¡¹ç›®ç»“æ„åŸºç¡€æ­å»ºå®Œæˆ**ï¼Œæ¥ä¸‹æ¥å°±åšåŠŸèƒ½ï¼šâ€œä¸€äº›ç”¨æˆ·åªèƒ½è¿›ä¸€ä¸ªé¡µé¢ï¼Œå¦ä¸€ä¸ªé¡µé¢è¿›ä¸å»ï¼Œå®ç°æƒé™æ§åˆ¶â€ã€‚



#### shiroå®ç°ç™»å½•æ‹¦æˆª

é¡¹ç›®æ¥ç€**springbootç»§æ‰¿shiro**

å®æˆ˜ï¼š

![image-20211009122414266](springboot.assets/image-20211009122414266.png)

ShiroConfigä¸­åœ¨getShiroFilterFactoryBeanæ–¹æ³•ä¸­æ·»åŠ å…·ä½“è¿‡æ»¤è®¾ç½®

```java
package com.zhangyun.shirospringboot.config;

import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.LinkedHashMap;
import java.util.Map;

@Configuration
public class ShiroConfig {

    //ç¬¬ä¸‰æ­¥ï¼šShiroFilterFactoryBeanï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹Subject
    /*
    * ä¹‹æ‰€ä»¥ä»–æ˜¯ç¬¬ä¸‰æ­¥ï¼Œæ˜¯å› ä¸ºshiroFilterFactoryBeanéœ€è¦SecurityManager
    *
    * ä¸è¦å¿˜è®°@Bean
    * */
    @Bean
    public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Qualifier("getDefaultWebSecurityManager") DefaultWebSecurityManager defaultWebSecurityManager){
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();
        //éœ€è¦ç»‘å®šSecurityManagerå³è®¾ç½®å®‰å…¨ç®¡ç†å™¨ï¼Œç»‘å®šåŸç†åŒç¬¬äºŒæ­¥çš„setRealm()
        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);

        //æ·»åŠ shiroçš„å†…ç½®è¿‡æ»¤å™¨
        /*
        * ä»¥ä¸‹ä¸ºä¸åŒè¿‡æ»¤ç±»å‹ï¼Œç”¨ä»¥è¿‡æ»¤urlè¯·æ±‚
        * 1. anon:æ— éœ€è®¤è¯å°±èƒ½è®¿é—®
        * 2. authcï¼šå¿…é¡»è®¤è¯äº†æ‰èƒ½è®¿é—®
        * 3. userï¼šå¿…é¡»æ‹¥æœ‰äº†â€œè®°ä½æˆ‘â€åŠŸèƒ½æ‰èƒ½ç”¨ã€‚ä¸€èˆ¬ä¸ç”¨ã€‚
        * 4. permsï¼šæ‹¥æœ‰å¯¹æŸä¸ªèµ„æºçš„æƒé™æ‰èƒ½è®¿é—®
        * 5. rolesï¼šæ‹¥æœ‰æŸä¸ªè§’è‰²æƒé™æ‰èƒ½è®¿é—®
        *
        * æœ¬ä¾‹ä¸­ /user/add å’Œ /user/updateåªæœ‰è®¤è¯äº†çš„ç”¨æˆ·æ‰èƒ½è®¿é—®
        * */
        Map<String,String> filterMap=new LinkedHashMap<>();
        //è¿™é‡Œæ”¯æŒé€šé…ç¬¦ï¼Œæ”¹æˆâ€œ/user/*â€ä½¿userä¸‹çš„æ‰€æœ‰è¯·æ±‚éƒ½é…ç½®ä¸ºauthcè¿‡æ»¤æ–¹å¼
        filterMap.put("/user/add","authc");
        filterMap.put("/user/update","authc");
        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap);

        //è®¾ç½®urlè¯·æ±‚è·¯å¾„ï¼Œå‰å¾€ç”¨äºæäº¤ç™»å½•è¡¨å•çš„å‰ç«¯
        shiroFilterFactoryBean.setLoginUrl("/toLogin");

        return shiroFilterFactoryBean;
    }

    //ç¬¬äºŒæ­¥ï¼šDefaultWebSecurityManagerï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹SecurityManager
    /*
    * ä¹‹æ‰€ä»¥ä»–ä¸ºç¬¬äºŒæ­¥ï¼Œæ˜¯å› ä¸ºsecurityManageréœ€è¦Realm
    *
    * å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ³¨å…¥ç‚¹éœ€è¦å¦ä¸€ä¸ª beanï¼Œæˆ‘ä»¬éœ€è¦ä¸“é—¨æŒ‡å‡ºå®ƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ @Qualifier æ³¨è§£æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚
    *
    * é…ç½®ç±»ä¸­çš„å½“å‰å‡½æ•°ä¸è¦å¿˜è®°åŠ ä¸Š@Bean
    * */
    @Bean
    public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier("userRealm") UserRealm userRealm){
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
        //éœ€è¦å‚æ•°ï¼Œå› ä¸ºéœ€è¦å…³è”UserRealmï¼Œå› ä¸ºsecurityManageræ˜¯ä¸€ä¸ªä¸­é—´å•†ã€‚ä»springä¸­å–å‡ºbeanä½œä¸ºsecuritymanagerçš„å‚æ•°å¹¶ç»™setRealmã€‚
        securityManager.setRealm(userRealm);

        return securityManager;
    }

    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºrealmå¯¹è±¡ï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹realm
    /*
    * ç±»é…ç½®spring beançŸ¥è¯†å›é¡¾ï¼š
    * 1. æ³¨å†ŒUserRealmæ‰€ä»¥å‡½æ•°çš„è¿”å›å€¼ä¸ºUserRealm
    * 2. å‡½æ•°åuserRealmä¸ºbeançš„åˆ«åï¼Œgetbeanå°±ä¼šgetåˆ°userRealm
    * 3. è¿”å›å€¼ä¸ºnew â€œè¦åœ¨springæ³¨å†Œçš„ç±»â€
    * 4. ä¸è¦å¿˜è®°åœ¨å‡½æ•°çš„ä¸Šé¢åŠ ä¸Š@Beanæ³¨è§£
    * åšå®Œä¸Šé¢å››æ­¥ï¼Œè‡ªå·±å†™çš„UserRealmç±»å°±è¢«springæ‰˜ç®¡äº†
    *
    * @Componentå’Œ@Beançš„åŒºåˆ«ï¼šhttps://blog.csdn.net/qq_35430000/article/details/108910387
    * */
    @Bean
    public UserRealm userRealm(){
        return new UserRealm();
    }
}
```

ç¼–å†™ç™»å½•é¡µé¢ï¼ˆæäº¤ç™»å½•è¡¨å•çš„å‰ç«¯ï¼‰

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>ç™»å½•</h1>
<hr/>

<form>
    <!--pæ ‡ç­¾è¡¨ç¤ºæ®µè½ï¼Œbræ ‡ç­¾è¡¨ç¤ºæ¢è¡Œã€‚æ¦‚å¿µç±»ä¼¼wordä¸­ã€‚-->
    <p>ç”¨æˆ·åï¼š<input type="text" name="username"></p>
    <p>å¯†ç ï¼š<input type="text" name="password"></p>
    <p><input type="submit"></p>
</form>
</body>
</html>
```

MyControlleræ§åˆ¶å™¨ä¸­æ·»åŠ åˆ°ç™»å½•é¡µé¢çš„è·³è½¬è¯·æ±‚å¤„ç†

```java
@RequestMapping("/toLogin")
public String toLogin(){
    return "login";
}
```

è¿è¡Œé¡¹ç›®å¹¶æµ‹è¯•ã€‚

ç‚¹å‡»addæˆ–è€…updateæ ‡ç­¾ï¼Œå› ä¸ºshiroç›‘æµ‹åˆ°ç”¨æˆ·æ²¡è®¤è¯ä¸èƒ½è®¿é—®addå’Œupdateï¼Œæ•…æ‹¦æˆªä¸‹è¯·æ±‚å¹¶**è‡ªåŠ¨**è·³åˆ°ç¨‹åºå‘˜é€šè¿‡setLoginUrl()è®¾ç½®çš„ç™»å½•é¡µé¢ä¸­ã€‚

![image-20211009122823960](springboot.assets/image-20211009122823960.png)

![image-20211009122802161](springboot.assets/image-20211009122802161.png)

#### shiroå®ç°ç”¨æˆ·è®¤è¯

é¡¹ç›®æ¥**shiroå®ç°ç™»å½•æ‹¦æˆª**

shiroçš„ç‰¹ç‚¹ï¼š

- è¯·æ±‚è¿‡æ»¤éƒ½åœ¨ShiroConfig.javaçš„getShiroFilterFactoryBeanæ–¹æ³•ä¸­å¤„ç†
- æƒé™æ“ä½œéƒ½åœ¨UserRealm.javaä¸­å¤„ç†
- shiroéœ€è¦ShiroConfig.javaå’ŒUserRealm.javaä¸¤ä¸ªç±»è”åŠ¨ã€‚



Controllerä¸­å¤„ç†ç™»å½•è¡¨å•çš„æäº¤ï¼Œå¹¶å°è£…shrioç™»å½•ä»¤ç‰Œã€‚å¹¶å‚è€ƒQuickstart.javaåšä¸€äº›é¢å¤–çš„å¤„ç†ã€‚

```java
@RequestMapping("/login")
//usernameå’Œpasswordæ˜¯ä»å‰ç«¯è¡¨å•æäº¤çš„å‚æ•°å
public String login(String username,String password,Model model){
    //è·å–å½“å‰ç”¨æˆ·
    Subject subject = SecurityUtils.getSubject();
    //å°è£…ç”¨æˆ·çš„ç™»å½•æ•°æ®
    UsernamePasswordToken token = new UsernamePasswordToken(username, password);

    //å‚è€ƒshiroçš„Quickstart.java,åšå¦‚ç™»å½•ç­‰æ“ä½œ
    try{
        //æ‰§è¡Œç™»å½•æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å°±è¯´æ˜ç™»å½•æˆåŠŸ,å‰å¾€é¦–é¡µã€‚
        subject.login(token);
        return "index";
    }
    //ç”¨æˆ·åä¸å­˜åœ¨
    catch (UnknownAccountException e){
        model.addAttribute("msg","ç”¨æˆ·åä¸å­˜åœ¨");
        //çŒœæµ‹ä¸å¸¦æ–œæ è¡¨ç¤ºresourceä¸‹çš„é¡µé¢ï¼Œå¸¦æ–œæ çš„/loginè¡¨ç¤ºè¯·æ±‚ã€‚ç™»é™†å¤±è´¥å‰å¾€ç™»å½•é¡µã€‚
        return "login";
    }
    //å¯†ç é”™è¯¯
    catch (IncorrectCredentialsException e){
        model.addAttribute("msg","å¯†ç é”™è¯¯");
        //ç™»é™†å¤±è´¥å‰å¾€ç™»å½•é¡µã€‚
        return "login";
    }

}
```

ç™»å½•è¡¨å•çš„é¡µé¢æ·»åŠ è¡¨å•çš„æäº¤urlè¯·æ±‚ï¼Œä½¿ç”¨äº†thymeleafã€‚åŒæ—¶åŠ ä¸Špæ ‡ç­¾å±•ç¤ºåç«¯ä¼ æ¥å¾—ç™»å½•å¤±è´¥åé¦ˆã€‚

![image-20211009134959976](springboot.assets/image-20211009134959976.png)

doGetAuthenticationInfoä¸­åšç™»å½•è®¤è¯å¤„ç†

```java
package com.zhangyun.shirospringboot.config;

import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.*;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.apache.shiro.subject.Subject;

public class UserRealm extends AuthorizingRealm {

    //æˆæƒ
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        System.out.println("æ‰§è¡Œäº†=ã€‹æˆæƒdoGetAuthorizationInfo");
        return null;
    }

    //è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("æ‰§è¡Œäº†=ã€‹è®¤è¯doGetAuthenticationInfo");

        //ç”¨æˆ·å å¯†ç ï¼Œæ•°æ®åº“ä¸­å–
        String name="root";
        String password="123456";
        //UsernamePasswordTokenå’Œcontrollerä¸­loginæ–¹æ³•ç”¨çš„tokenåŒç±»
        UsernamePasswordToken userToken = (UsernamePasswordToken) token;
        //ç”¨æˆ·åè®¤è¯
        if(!userToken.getUsername().equals(name)){
            return null;//æŠ›å‡ºå¼‚å¸¸ï¼ŒUnknownAccountException
        }
        //å¯†ç è®¤è¯ï¼Œshiroåšã€‚ä¸è®©äººæ¥è§¦å¯†ç ï¼Œé¿å…æ³„éœ²ã€‚ä¸‹è¡Œä»£ç ä¸­ï¼Œå·¦å³çš„principalå’ŒrealmNameå…ˆç©ºç€ã€‚
        return new SimpleAuthenticationInfo("",password,"");
    }
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ã€‚

æ¥åˆ°é¦–é¡µç‚¹å‡»addæˆ–update

![image-20211009135125798](springboot.assets/image-20211009135125798.png)

å› ä¸ºæ²¡æœ‰ç™»å½•çŠ¶æ€ï¼Œshiroæ‹¦æˆªç™»å½•è¯·æ±‚å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢

![image-20211009135222621](springboot.assets/image-20211009135222621.png)

å¡«å†™ä¸å­˜åœ¨çš„ç”¨æˆ·åæ—¶ï¼Œå‰ç«¯å±•ç¤ºæç¤º

![image-20211009135310245](springboot.assets/image-20211009135310245.png)

![image-20211009135355165](springboot.assets/image-20211009135355165.png)

å¡«å†™é”™è¯¯å¯†ç æ—¶ï¼Œå‰ç«¯å±•ç¤ºæç¤º

![image-20211009135525176](springboot.assets/image-20211009135525176.png)

![image-20211009135445205](springboot.assets/image-20211009135445205.png)

ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®æ—¶ï¼ˆUserRealm.javaä¸­é…ç½®çš„ï¼‰ï¼Œç™»å½•æˆåŠŸï¼Œæ¥åˆ°é¦–é¡µï¼Œè¿™æ—¶å€™è®¿é—®addå’Œupdateé¡µé¢éƒ½èƒ½æˆåŠŸ

![image-20211009135622822](springboot.assets/image-20211009135622822.png)

![image-20211009135726253](springboot.assets/image-20211009135726253.png)

![image-20211009135742604](springboot.assets/image-20211009135742604.png)

![image-20211009135753904](springboot.assets/image-20211009135753904.png)





#### shiroæ•´åˆmybatis

é¡¹ç›®æ¥**shiroå®ç°ç”¨æˆ·è®¤è¯**

https://www.bilibili.com/video/BV1PE411i7CV?p=43&spm_id_from=pageDriver

pomä¸­æ·»åŠ ä¾èµ–

```xml
<!--é…ç½®æ•°æ®åº“é©±åŠ¨-->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.26</version>
</dependency>
<!--é…ç½®æ—¥å¿—-->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
<!--é…ç½®æ•°æ®æºï¼Œç”¨druid-->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.1.12</version>
</dependency>
<!--å¯¼å…¥mybatiså’Œspringbootçš„æ•´åˆåŒ…-->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>2.1.0</version>
</dependency>
```

ç¼–å†™yamlæ–‡ä»¶å¹¶é…ç½®æ•°æ®åº“ç›¸å…³å‚æ•°ã€‚è¿™æ ·åå°å¯ä»¥è‡ªåŠ¨è¿æ¥mybatisæ•°æ®åº“ã€‚

```yaml
spring:
  datasource:
    username: "root"
    password: "123456"
    url: jdbc:mysql://localhost:3306/mybatis?useUnicode=true&characterEncoding=utf-8
    driver-class-name: com.mysql.jdbc.Driver
    type: com.alibaba.druid.pool.DruidDataSource

    #Spring Boot é»˜è®¤æ˜¯ä¸æ³¨å…¥è¿™äº›å±æ€§å€¼çš„ï¼Œéœ€è¦è‡ªå·±ç»‘å®š
    #druid æ•°æ®æºä¸“æœ‰é…ç½®
    initialSize: 5
    minIdle: 5
    maxActive: 20
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 60000
    minEvictableIdleTimeMillis: 300000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true

    # ä¸‹é¢çš„éƒ¨åˆ†æ˜¯druidæ¯”å…¶ä»–æ•°æ®æºç‰›é€¼çš„åœ°æ–¹
    #é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filtersï¼Œstat:ç›‘æ§ç»Ÿè®¡ã€log4jï¼šæ—¥å¿—è®°å½•ã€wallï¼šé˜²å¾¡sqlæ³¨å…¥
    #å¦‚æœå…è®¸æ—¶æŠ¥é”™  java.lang.ClassNotFoundException: org.apache.log4j.Priority
    #åˆ™å¯¼å…¥ log4j ä¾èµ–å³å¯ï¼ŒMaven åœ°å€ï¼šhttps://mvnrepository.com/artifact/log4j/log4j
    filters: stat,wall,log4j
    maxPoolPreparedStatementPerConnectionSize: 20
    useGlobalDataSourceStat: true
    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
```

ideaè¿æ¥æœ¬åœ°æ•°æ®åº“ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ•°æ®è¡¨

![image-20211009161230297](springboot.assets/image-20211009161230297.png)

![image-20211009161354266](springboot.assets/image-20211009161354266.png)

![image-20211009161414418](springboot.assets/image-20211009161414418.png)

![image-20211009161431746](springboot.assets/image-20211009161431746.png)

ç¼–å†™propertiesæ–‡ä»¶ï¼Œé…ç½®pojoï¼Œmapperç›¸å…³ä¿¡æ¯

```properties
# é…ç½®åˆ«åï¼Œé¿å…mybatisçš„resultTypeä¸­å†™å®Œæ•´è·¯å¾„ï¼Œåªå†™è·¯å¾„å³å¯
mybatis.type-aliases-package=com.zhangyun.shirospringboot.pojo
# è®©springè¯†åˆ«XXXMapper.xmlæ–‡ä»¶åœ¨å“ª
mybatis.mapper-locations=classpath:mapper/*.xml
```

ç¼–å†™pojoç±»User

```java
package com.zhangyun.shirospringboot.pojo;

public class User {
    private int id;
    private String name;
    private String pwd;

    public User() {
    }

    public User(int id, String name, String pwd) {
        this.id = id;
        this.name = name;
        this.pwd = pwd;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPwd() {
        return pwd;
    }

    public void setPwd(String pwd) {
        this.pwd = pwd;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", pwd='" + pwd + '\'' +
                '}';
    }
}
```

ç¼–å†™XXXMapper.javaæ¥å£

```java
package com.zhangyun.shirospringboot.mapper;

import com.zhangyun.shirospringboot.pojo.User;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.stereotype.Repository;

@Repository
@Mapper
public interface UserMapper {

    public User queryUserByName(String name);
}
```

ç¼–å†™XXXMapper.xmlé…ç½®æ–‡ä»¶ã€‚æ³¨æ„æ”¾åˆ°resource/mapperç›®å½•ä¸‹

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhangyun.shirospringboot.mapper.UserMapper">
    <select id="queryUserByName" parameterType="String" resultType="User">
        select * from mybatis.user where name=#{name}
    </select>
</mapper>
```

ä¸ºäº†å®Œå–„é¡¹ç›®ç»“æ„ï¼Œæ·»åŠ serviceå±‚ã€‚serviceå±‚ä¸­æœ‰UserServiceæ¥å£å’ŒUserServiceImplç±»ã€‚

```java
package com.zhangyun.shirospringboot.service;

import com.zhangyun.shirospringboot.pojo.User;

public interface UserService {
    public User queryUserByName(String name);
}

```

```java
package com.zhangyun.shirospringboot.service;

import com.zhangyun.shirospringboot.mapper.UserMapper;
import com.zhangyun.shirospringboot.pojo.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

//è€å¸ˆè¯´è¿™é‡Œç”¨@Componentä¹Ÿå¯ä»¥
@Service
public class UserServiceImpl implements UserService {

    //ä»springå®¹å™¨ä¸­æ‹¿åˆ°UserMapperçš„bean
    @Autowired
    UserMapper userMapper;

    @Override
    public User queryUserByName(String name) {
        return userMapper.queryUserByName(name);
    }
}
```

æ›´æ”¹UserRealm.javaä¸ºè¿æ¥æ•°æ®åº“è·å–çœŸç”¨æˆ·åå’Œå¯†ç 

```java
package com.zhangyun.shirospringboot.config;

import com.zhangyun.shirospringboot.pojo.User;
import com.zhangyun.shirospringboot.service.UserService;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.*;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.apache.shiro.subject.Subject;
import org.springframework.beans.factory.annotation.Autowired;

public class UserRealm extends AuthorizingRealm {

    //ä»springå®¹å™¨ä¸­è·å–userServiceå®ä¾‹,ä»è€Œå¯ä»¥æ“çºµæ•°æ®åº“
    //!!!springæ³¨å…¥çš„æ˜¯å®ç°ç±»å¯¹è±¡ï¼Œæ¥æ”¶çš„æ¥å£ï¼›ç†è§£ä¸ºå¤šæ€
    @Autowired
    UserService userService;

    //æˆæƒ
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        System.out.println("æ‰§è¡Œäº†=ã€‹æˆæƒdoGetAuthorizationInfo");
        return null;
    }

    //è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("æ‰§è¡Œäº†=ã€‹è®¤è¯doGetAuthenticationInfo");

        //UsernamePasswordTokenå’Œcontrollerä¸­loginæ–¹æ³•ç”¨çš„tokenç›¸åŒ
        UsernamePasswordToken userToken = (UsernamePasswordToken) token;

        //ç”¨æˆ·å å¯†ç ï¼Œæ•°æ®åº“ä¸­å–
        User user = userService.queryUserByName(userToken.getUsername());

        //ç”¨æˆ·åè®¤è¯
        if(user==null){//ç”¨æˆ·ä¸å­˜åœ¨
            return null; //å¯¼è‡´MyControllerå‡ºç°UnknownAccountExceptionå¼‚å¸¸
        }
        //å¯†ç è®¤è¯ï¼Œshiroåšã€‚ä¸è®©äººæ¥è§¦å¯†ç ï¼Œé¿å…æ³„éœ²ã€‚ä¸‹è¡Œä»£ç ä¸­ï¼Œå·¦å³çš„principalå’ŒrealmNameå…ˆç©ºç€ã€‚
        //å¯†ç å¯ä»¥åŠ å¯†ï¼šMD5 æˆ–è€… MD5ç›å€¼åŠ å¯†
        return new SimpleAuthenticationInfo("",user.getPwd(),"");
    }
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•

å…ˆæŸ¥çœ‹userè¡¨çš„å†…å®¹

![image-20211009193236851](springboot.assets/image-20211009193236851.png)

æ¥åˆ°é¦–é¡µç‚¹å‡»addæˆ–update

![image-20211009193323693](springboot.assets/image-20211009193323693.png)

å› ä¸ºæœªç™»å½•ï¼ŒshiroæŠŠé¡µé¢è·³è½¬åˆ°ç™»å½•é¡µï¼Œè¾“å…¥æ•°æ®åº“userè¡¨ä¸­å­˜åœ¨çš„è´¦å·å¯†ç ç™»å½•

![image-20211009193451633](springboot.assets/image-20211009193451633.png)

ç™»å½•æˆåŠŸï¼Œç°åœ¨å¯ä»¥ä»»æ„è®¿é—®updateå’Œaddäº†

![image-20211009193543845](springboot.assets/image-20211009193543845.png)

![image-20211009193627940](springboot.assets/image-20211009193627940.png)



**æ³¨æ„ç‚¹**ï¼šä»Šæ—¥è§£å†³äº†ä¸€ä¸ªç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆspringä¸­ç”¨æ¥å£è°ƒç”¨æ–¹æ³•ï¼šâ€œspringæ³¨å…¥ï¼ˆ@Beanï¼‰çš„æ˜¯æ¥å£å®ç°ç±»å¯¹è±¡ï¼Œæ¥æ”¶ï¼ˆ@Autowiredï¼‰çš„æ¥å£ï¼›ç†è§£ä¸ºå¤šæ€â€ã€‚



#### shiroè¯·æ±‚æˆæƒå®ç°

ShiroConfig.javaä¸­æ·»åŠ æˆæƒè®¾ç½®ã€‚å¹¶ä¸”åœ¨shiroConfigä¸­è®¾ç½®å‡ºç°æœªæˆæƒè®¿é—®æ—¶è·³è½¬å»ä½•å¤„ï¼ˆsetUnauthorizedUrlï¼‰ã€‚

*æœ‰ç½‘å‹è¯´â€œæ²¡æœ‰æ‹¦æˆªçš„å…„å¼Ÿè¦æŠŠè¿™ä¸ªå†™åœ¨authcçš„ä¸Šé¢ ä¸ç„¶ä¸Šé¢é€šè¿‡ä¸‹é¢å°±ä¸è®¤è¯äº†â€ï¼Œä½†æ˜¯æˆ‘permså†™åœ¨authcçš„ä¸‹é¢ä¹Ÿæ‹¦æˆªæˆåŠŸäº†*

```java
package com.zhangyun.shirospringboot.config;

import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.LinkedHashMap;
import java.util.Map;

@Configuration
public class ShiroConfig {

    //ç¬¬ä¸‰æ­¥ï¼šShiroFilterFactoryBeanï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹Subject
    /*
    * ä¹‹æ‰€ä»¥ä»–æ˜¯ç¬¬ä¸‰æ­¥ï¼Œæ˜¯å› ä¸ºshiroFilterFactoryBeanéœ€è¦SecurityManager
    *
    * ä¸è¦å¿˜è®°@Bean
    * */
    @Bean
    public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Qualifier("getDefaultWebSecurityManager") DefaultWebSecurityManager defaultWebSecurityManager){
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();
        //éœ€è¦ç»‘å®šSecurityManagerå³è®¾ç½®å®‰å…¨ç®¡ç†å™¨ï¼Œç»‘å®šåŸç†åŒç¬¬äºŒæ­¥çš„setRealm()
        shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);

        /*
         * æ·»åŠ shiroçš„å†…ç½®è¿‡æ»¤å™¨
         *
         * ä»¥ä¸‹ä¸ºä¸åŒè¿‡æ»¤ç±»å‹ï¼Œç”¨ä»¥è¿‡æ»¤urlè¯·æ±‚
         * 1. anon:æ— éœ€è®¤è¯å°±èƒ½è®¿é—®
         * 2. authcï¼šå¿…é¡»è®¤è¯äº†æ‰èƒ½è®¿é—®
         * 3. userï¼šå¿…é¡»æ‹¥æœ‰äº†â€œè®°ä½æˆ‘â€åŠŸèƒ½æ‰èƒ½ç”¨ã€‚ä¸€èˆ¬ä¸ç”¨ã€‚
         * 4. permsï¼šæ‹¥æœ‰å¯¹æŸä¸ªèµ„æºçš„æƒé™æ‰èƒ½è®¿é—®
         * 5. rolesï¼šæ‹¥æœ‰æŸä¸ªè§’è‰²æƒé™æ‰èƒ½è®¿é—®
         *
         * */
        Map<String,String> filterMap=new LinkedHashMap<>();

        /*è®¤è¯ï¼ˆauthcï¼‰è®¾ç½®
        *
        * æœ¬ä¾‹ä¸­ /user/add å’Œ /user/updateåªæœ‰è®¤è¯äº†çš„ç”¨æˆ·æ‰èƒ½è®¿é—®.
        *
        * è¿™é‡Œæ”¯æŒé€šé…ç¬¦ï¼Œæ”¹æˆâ€œ/user/*â€ä½¿userä¸‹çš„æ‰€æœ‰è¯·æ±‚éƒ½é…ç½®ä¸ºauthcè¿‡æ»¤æ–¹å¼.
        * */
        filterMap.put("/user/add","authc");
        filterMap.put("/user/update","authc");

        /*
        * æˆæƒï¼ˆpermsï¼‰è®¾ç½®
        *
        * ä¸‹é¢è¿™è¡Œè¡¨ç¤ºï¼Œå¯¹äº/user/addè¯·æ±‚ï¼Œç”¨æˆ·çš„æƒé™å«"user:add"æ‰èƒ½è®¿é—®
        * */
        filterMap.put("/user/add","perms[user:add]");
        filterMap.put("/user/update","perms[user:update]");

        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap);

        //è®¾ç½®urlè¯·æ±‚è·¯å¾„ï¼Œå‰å¾€ç”¨äºæäº¤ç™»å½•è¡¨å•çš„å‰ç«¯
        shiroFilterFactoryBean.setLoginUrl("/toLogin");
        //è®¾ç½®æœªæˆæƒäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè·³å¾€ä½•é¡µé¢
        shiroFilterFactoryBean.setUnauthorizedUrl("/noAuth");


        return shiroFilterFactoryBean;
    }

    //ç¬¬äºŒæ­¥ï¼šDefaultWebSecurityManagerï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹SecurityManager
    /*
    * ä¹‹æ‰€ä»¥ä»–ä¸ºç¬¬äºŒæ­¥ï¼Œæ˜¯å› ä¸ºsecurityManageréœ€è¦Realm
    *
    * å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ³¨å…¥ç‚¹éœ€è¦å¦ä¸€ä¸ª beanï¼Œæˆ‘ä»¬éœ€è¦ä¸“é—¨æŒ‡å‡ºå®ƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ @Qualifier æ³¨è§£æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚
    *
    * é…ç½®ç±»ä¸­çš„å½“å‰å‡½æ•°ä¸è¦å¿˜è®°åŠ ä¸Š@Bean
    * */
    @Bean
    public DefaultWebSecurityManager getDefaultWebSecurityManager(@Qualifier("userRealm") UserRealm userRealm){
        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
        //éœ€è¦å‚æ•°ï¼Œå› ä¸ºéœ€è¦å…³è”UserRealmï¼Œå› ä¸ºsecurityManageræ˜¯ä¸€ä¸ªä¸­é—´å•†ã€‚ä»springä¸­å–å‡ºbeanä½œä¸ºsecuritymanagerçš„å‚æ•°å¹¶ç»™setRealmã€‚
        securityManager.setRealm(userRealm);

        return securityManager;
    }

    //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºrealmå¯¹è±¡ï¼šå¯¹åº”shiroæ ¸å¿ƒå¯¹è±¡ä¹‹realm
    /*
    * ç±»é…ç½®spring beançŸ¥è¯†å›é¡¾ï¼š
    * 1. æ³¨å†ŒUserRealmæ‰€ä»¥å‡½æ•°çš„è¿”å›å€¼ä¸ºUserRealm
    * 2. å‡½æ•°åuserRealmä¸ºbeançš„åˆ«åï¼Œgetbeanå°±ä¼šgetåˆ°userRealm
    * 3. è¿”å›å€¼ä¸ºnew â€œè¦åœ¨springæ³¨å†Œçš„ç±»â€
    * 4. ä¸è¦å¿˜è®°åœ¨å‡½æ•°çš„ä¸Šé¢åŠ ä¸Š@Beanæ³¨è§£
    * åšå®Œä¸Šé¢å››æ­¥ï¼Œè‡ªå·±å†™çš„UserRealmç±»å°±è¢«springæ‰˜ç®¡äº†
    *
    * @Componentå’Œ@Beançš„åŒºåˆ«ï¼šhttps://blog.csdn.net/qq_35430000/article/details/108910387
    * */
    @Bean
    public UserRealm userRealm(){
        return new UserRealm();
    }
}
```

controllerä¸­æ·»åŠ å¯¹æœªæˆæƒæƒ…å†µçš„é¡µé¢è·³è½¬è®¾ç½®

```java
//å¤„ç†æœªæˆæƒäº‹ä»¶å‘ç”Ÿæ—¶çš„urlè¯·æ±‚
@RequestMapping("/noAuth")
//ä¸èµ°è§†å›¾è§£æå™¨ï¼Œç›´æ¥åœ¨å‰ç«¯å±•ç¤ºreturnçš„å­—ç¬¦ä¸²
@ResponseBody
public String unauthorized(){
    return "æœªç»æˆæƒæ— æ³•è®¿é—®æ­¤é¡µé¢";
}
```

UserRealm.javaä¸­åšç”¨æˆ·æˆæƒã€‚useråœ¨UserRealmâ€è®¤è¯â€œé‡Œè¢«æŸ¥å‡ºæ¥ï¼Œæ€ä¹ˆèƒ½åœ¨UserRealmâ€æˆæƒâ€œè¢«ä½¿ç”¨ï¼Ÿ

- æŠŠprincipalç”¨ä¸Šï¼Œä¸å†ä¸ºç©ºå­—ç¬¦ä¸²ã€‚
- å¤šä¸ªæƒé™å­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„  åŠ åˆ°å‘¢ä¸ªæœ‰sçš„æ–¹æ³•(addStringPermissions)ä¸­.

```java
package com.zhangyun.shirospringboot.config;

import com.zhangyun.shirospringboot.pojo.User;
import com.zhangyun.shirospringboot.service.UserService;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.*;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.authz.SimpleAuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.apache.shiro.subject.Subject;
import org.springframework.beans.factory.annotation.Autowired;

public class UserRealm extends AuthorizingRealm {

    //ä»springå®¹å™¨ä¸­è·å–userServiceå®ä¾‹,ä»è€Œå¯ä»¥æ“çºµæ•°æ®åº“
    //!!!springæ³¨å…¥çš„æ˜¯å®ç°ç±»å¯¹è±¡ï¼Œæ¥æ”¶çš„æ¥å£ï¼›ç†è§£ä¸ºå¤šæ€
    @Autowired
    UserService userService;

    //æˆæƒ
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        System.out.println("æ‰§è¡Œäº†=ã€‹æˆæƒdoGetAuthorizationInfo");

        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();
        //æ³¨æ„æ­¤è¡Œè¦åˆ æ‰ï¼Œä¸ç„¶ä»»ä½•äººéƒ½æœ‰addæƒé™
        //info.addStringPermission("user:add");

        //æ‹¿åˆ°ç­‰é’±ç™»å½•çš„å¯¹è±¡subject
        Subject subject = SecurityUtils.getSubject();
        //æ‹¿åˆ°userå¯¹è±¡
        User currentUser = (User)subject.getPrincipal();
        //è®¾ç½®å½“å‰ç”¨æˆ·çš„æƒé™
        //å¤šä¸ªæƒé™å­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„  åŠ åˆ°å‘¢ä¸ªæœ‰sçš„æ–¹æ³•ä¸­
        info.addStringPermission(currentUser.getPerms());

        //å¦‚æœreturn nullçš„è¯ï¼Œæˆæƒä¸èƒ½è¢«shiroæ¥æ”¶åˆ°
        return info;
    }

    //è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("æ‰§è¡Œäº†=ã€‹è®¤è¯doGetAuthenticationInfo");

        //UsernamePasswordTokenå’Œcontrollerä¸­loginæ–¹æ³•ç”¨çš„tokenç›¸åŒ
        UsernamePasswordToken userToken = (UsernamePasswordToken) token;

        //ç”¨æˆ·å å¯†ç ï¼Œæ•°æ®åº“ä¸­å–
        User user = userService.queryUserByName(userToken.getUsername());

        //ç”¨æˆ·åè®¤è¯
        if(user==null){//ç”¨æˆ·ä¸å­˜åœ¨
            return null; //å¯¼è‡´MyControllerå‡ºç°UnknownAccountExceptionå¼‚å¸¸
        }
        //å¯†ç è®¤è¯ï¼Œshiroåšã€‚ä¸è®©äººæ¥è§¦å¯†ç ï¼Œé¿å…æ³„éœ²ã€‚ä¸‹è¡Œä»£ç ä¸­ï¼Œå·¦å³çš„principalå’ŒrealmNameå…ˆç©ºç€ã€‚
        //å¯†ç å¯ä»¥åŠ å¯†ï¼šMD5 æˆ–è€… MD5ç›å€¼åŠ å¯†
        return new SimpleAuthenticationInfo(user,user.getPwd(),"");
    }
}
```

ä¸ºæ•°æ®åº“userè¡¨æ·»åŠ ä¸€åˆ—ä¿å­˜æƒé™è®¾ç½®ï¼Œè¿™æ ·ä¸ºç”¨æˆ·æˆæƒçš„æ—¶å€™å¯ä»¥æŸ¥è¯¢ã€‚

![image-20211009210332680](springboot.assets/image-20211009210332680.png)

![image-20211009210433074](springboot.assets/image-20211009210433074.png)

![image-20211009210449026](springboot.assets/image-20211009210449026.png)

![image-20211009210659489](springboot.assets/image-20211009210659489.png)

ä¿®æ”¹pojoçš„Userç±»ï¼Œæ·»åŠ permå­—æ®µç›¸å…³å†…å®¹ã€‚è¿™æ—¶å€™å°±ä½“ç°ç”¨lombokçš„å¥½å¤„ï¼Œä¸ç”¨lombokå°±å¾—ä¿®æ”¹ï¼šæ„é€ å‡½æ•°+getter+setter+toStringã€‚

```java
package com.zhangyun.shirospringboot.pojo;

public class User {
    private int id;
    private String name;
    private String pwd;
    private String perms;

    public User() {
    }

    public User(int id, String name, String pwd, String perms) {
        this.id = id;
        this.name = name;
        this.pwd = pwd;
        this.perms=perms;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPwd() {
        return pwd;
    }

    public void setPwd(String pwd) {
        this.pwd = pwd;
    }

    public String getPerms() {
        return perms;
    }

    public void setPerms(String perms) {
        this.perms = perms;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", pwd='" + pwd + '\'' +
                ", perms='" + perms + '\'' +
                '}';
    }
}
```

MyController.javaä¸­è®¾ç½®logoutã€‚å³æŠŠsubject.logout();å†™åˆ°logoutè¯·æ±‚é‡Œã€‚

```java
package com.zhangyun.shirospringboot.controller;

import org.apache.shiro.SecurityUtils;
import org.apache.shiro.authc.IncorrectCredentialsException;
import org.apache.shiro.authc.UnknownAccountException;
import org.apache.shiro.authc.UsernamePasswordToken;
import org.apache.shiro.subject.Subject;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
public class MyController {

    @RequestMapping({"/","/index"})
    public String toIndex(Model model){
        model.addAttribute("msg","hello shiro");
        return "index";
    }

    @RequestMapping("/user/add")
    public String add(){
        return "user/add";
    }

    @RequestMapping("/user/update")
    public String update(){
        return "user/update";
    }

    @RequestMapping("/toLogin")
    public String toLogin(){
        return "login";
    }

    @RequestMapping("/login")
    //usernameå’Œpasswordæ˜¯ä»å‰ç«¯è¡¨å•æäº¤çš„å‚æ•°å
    public String login(String username,String password,Model model){
        //è·å–å½“å‰ç”¨æˆ·
        Subject subject = SecurityUtils.getSubject();
        //å°è£…ç”¨æˆ·çš„ç™»å½•æ•°æ®
        UsernamePasswordToken token = new UsernamePasswordToken(username, password);

        //å‚è€ƒshiroçš„Quickstart.java,åšå¦‚ç™»å½•ç­‰æ“ä½œ
        try{
            //æ‰§è¡Œç™»å½•æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å°±è¯´æ˜ç™»å½•æˆåŠŸ,å‰å¾€é¦–é¡µã€‚
            subject.login(token);
            return "index";
        }
        //ç”¨æˆ·åä¸å­˜åœ¨
        catch (UnknownAccountException e){
            model.addAttribute("msg","ç”¨æˆ·åä¸å­˜åœ¨");
            //çŒœæµ‹ä¸å¸¦æ–œæ è¡¨ç¤ºresourceä¸‹çš„é¡µé¢ï¼Œå¸¦æ–œæ çš„/loginè¡¨ç¤ºè¯·æ±‚ã€‚ç™»é™†å¤±è´¥å‰å¾€ç™»å½•é¡µã€‚
            return "login";
        }
        //å¯†ç é”™è¯¯
        catch (IncorrectCredentialsException e){
            model.addAttribute("msg","å¯†ç é”™è¯¯");
            //ç™»é™†å¤±è´¥å‰å¾€ç™»å½•é¡µã€‚
            return "login";
        }
    }

    //å¤„ç†æœªæˆæƒäº‹ä»¶å‘ç”Ÿæ—¶çš„urlè¯·æ±‚
    @RequestMapping("/noAuth")
    //ä¸èµ°è§†å›¾è§£æå™¨ï¼Œç›´æ¥åœ¨å‰ç«¯å±•ç¤ºreturnçš„å­—ç¬¦ä¸²
    @ResponseBody
    public String unauthorized(){
        return "æœªç»æˆæƒæ— æ³•è®¿é—®æ­¤é¡µé¢";
    }

    @RequestMapping("/logout")
    public String logout(){
        Subject subject = SecurityUtils.getSubject();
        subject.logout();

        //ç™»å‡ºåæ¥åˆ°é¦–é¡µ
        return "index";
    }

}
```

addå’Œupdateé¡µé¢æ·»åŠ logouté“¾æ¥

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>add</h1>
<br>
<a th:href="@{/logout}">ç™»å‡º</a>
</body>
</html>
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>update</h1>
<br>
<a th:href="@{/logout}">ç™»å‡º</a>
</body>
</html>
```

è¿è¡Œé¡¹ç›®å¹¶æµ‹è¯•ï¼Œæ¥åˆ°é¦–é¡µï¼Œç‚¹å‡»addæˆ–update

![image-20211009214219188](springboot.assets/image-20211009214219188.png)

å› ä¸ºæ²¡æœ‰è®¤è¯ï¼ˆç™»å½•ï¼‰ï¼Œæ¥åˆ°ç™»å½•é¡µé¢ã€‚è¾“å…¥åˆæ³•çš„ç”¨æˆ·åå¯†ç ç™»å½•ã€‚

![image-20211009214332779](springboot.assets/image-20211009214332779.png)

![image-20211009214527275](springboot.assets/image-20211009214527275.png)

ä¹‹å‰çœ‹è¿‡æ•°æ®åº“userè¡¨å†…å®¹ï¼Œrootç”¨æˆ·æœ‰updateçš„æƒé™ï¼Œå¼ äº‘ç”¨æˆ·æœ‰addçš„æƒé™ã€‚rootç”¨æˆ·ç™»å½•ä¸‹ï¼Œç‚¹å‡»addï¼Œé¡µé¢æç¤ºæ²¡æœ‰æƒé™ï¼Œåˆç†ã€‚



![image-20211009214503297](springboot.assets/image-20211009214503297.png)

å›é€€åˆ°é¦–é¡µï¼Œç‚¹å‡»updateï¼Œç”¨æˆ·rootæˆåŠŸè¿›å…¥

![image-20211009214623117](springboot.assets/image-20211009214623117.png)

ç‚¹å‡»ç™»å‡ºï¼Œç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼ˆè®¤è¯ï¼‰è¢«å–æ¶ˆï¼Œé¡µé¢è·³å›é¦–é¡µ

![image-20211009214725299](springboot.assets/image-20211009214725299.png)

å†ç‚¹å‡»addæˆ–updateï¼Œé¡µé¢æç¤ºè¦ç™»å½•ï¼Œç¬¦åˆæœªè®¤è¯çš„çŠ¶æ€

![image-20211009214805668](springboot.assets/image-20211009214805668.png)



ç½‘å‹è¯­å½•ï¼š

- Springä¸­ï¼Œå•ä¾‹ä½ çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¿…é¡»åœ¨newå’Œbeanå·¥å‚é€‰ä¸€ä¸ªï¼Œä¸€è·¯autowiredå¿…æŠ¥é”™ ï¼ˆ**è™½ç„¶æˆ‘ä¸çŸ¥é“ä»–è¯´çš„å¯¹ä¸å¯¹**ï¼Œä½†æ˜¯ä»–å¾ˆæœ‰è‡ªä¿¡çš„æ ·å­ã€‚ã€‚ï¼‰



#### shiroæ•´åˆthymeleaf

https://www.bilibili.com/video/BV1PE411i7CV?p=45&spm_id_from=pageDriver

**é¡¹ç›®æ¥shiroè¯·æ±‚æˆæƒå®ç°**

å®æˆ˜ï¼š

pomå¯¼å…¥æ•´åˆshiro+thymeleafçš„ä¾èµ–åŒ…

```xml
<!--shiro-thymeleafæ•´åˆ-->
<!-- https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro -->
<dependency>
    <groupId>com.github.theborakompanioni</groupId>
    <artifactId>thymeleaf-extras-shiro</artifactId>
    <version>2.0.0</version>
</dependency>
```

shiroè¦ShiroConfig.javaä¸­é…ç½®ä¸€ä¸‹ShiroDialectï¼›springsecurityå°±ä¸ç”¨ï¼Œä»–æ˜¯å®Œç¾é›†æˆäº†ã€‚

```java
//æ•´åˆshirodialectï¼Œç”¨æ¥æ•´åˆshiro-thymeleaf
@Bean
public ShiroDialect getShiroDialect(){
    return new ShiroDialect();
}
```

é¦–é¡µindex.htmlæ·»åŠ shiroæ§åˆ¶çš„å‰ç«¯ç»„ä»¶ï¼ˆå¯¼å…¥äº†shiro+thymeleafæ•´åˆåŒ…æ‰èƒ½ç”¨ï¼‰ã€‚å¹¶å¢åŠ ç™»å½•æŒ‰é’®ã€‚

- ç½‘å‹è¯´ç™»å½•åéšè—ç™»å½•æŒ‰é’®ï¼šä¸ç”¨sessionå­˜å€¼æ²Ÿé€šå‰åç«¯åˆ¤æ–­é‚£ä¹ˆéº»çƒ¦ï¼Œshiro:notAuthenticated="*:*" æˆ–è€… shiro:guest=""ï¼Œæˆ–è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨shiro:hasAnyRoles=â€œâ€åˆ¤æ–­
  - ç½‘å‹è¯´ï¼šshiro:guest="true"è¿™ä¸ªäº²æµ‹å¯ä»¥ç”¨ï¼Œå‰é¢çš„éƒ½ä¸è¡Œ
  - ç½‘å‹è¯´ï¼š<shiro:notAuthenticated>ç”¨è¿™ä¸ªæ ‡ç­¾å°±è¡Œäº†
  - è€å¸ˆçš„å­˜sessionçš„æ–¹æ³•ä¹Ÿå¯ä»¥
  - æˆ‘ä¸ªäººç”¨äº†shiro:guest="true"

```html
<!DOCTYPE html>
<!--åŠ ä¸Šå‘½åç©ºé—´åth:textä¸ä¼šçˆ†çº¢ï¼Œç½‘å‹è¯´å‘½åç©ºé—´æ˜¯æç¤ºæ€§çš„ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚-->
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.thymeleaf.org/thymeleaf-extras-shiro">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>é¦–é¡µ</h1>

<!--æ¥æ”¶ä¸€ä¸‹åç«¯ä¼ æ¥çš„modelä¸­çš„å‚æ•°-->
<p th:text="${msg}"></p>

<div shiro:guest="true">
    <a th:href="@{/toLogin}">ç™»å½•</a>
</div>
<br>
<div shiro:hasPermission="user:add"><a th:href="@{/user/add}">add</a> </div>  | <div shiro:hasPermission="user:update"><a th:href="@{/user/update}">update</a></div>
</body>
</html>
```

å¯åŠ¨å¹¶æµ‹è¯•

![image-20211010110136283](springboot.assets/image-20211010110136283.png)

ç‚¹å‡»ç™»å½•

![image-20211010110156965](springboot.assets/image-20211010110156965.png)

æˆåŠŸåªå±•ç¤ºç”¨æˆ·æœ‰æƒçœ‹åˆ°çš„é“¾æ¥ï¼Œå¹¶ä¸”ç™»é™†åéšè—ç™»å½•æŒ‰é’®ã€‚

![image-20211010110211649](springboot.assets/image-20211010110211649.png)

ç‚¹å‡»updateï¼Œrootç”¨æˆ·æœ‰æƒé™ï¼ˆæ•°æ®åº“å¯æŸ¥ï¼‰ï¼ŒæˆåŠŸè¿›å…¥

![image-20211010110330698](springboot.assets/image-20211010110330698.png)

ç‚¹å‡»â€ç™»å‡ºâ€œï¼Œå›åˆ°é¦–é¡µ

![image-20211010110433603](springboot.assets/image-20211010110433603.png)

## é¸¡æ±¤åˆ†æå¼€æºé¡¹ç›®

ä¸ªäººè®¤ä¸ºï¼šå¯ä»¥æ‰¾ä¸€ä¸ªå¥½çš„å¼€æºé¡¹ç›®éƒ¨ç½²-ã€‹è¯»æ‡‚ï¼ˆèƒ½å‡ ä¹ç‹¬ç«‹å†™å‡ºçš„ç¨‹åºï¼‰-ã€‹æ‰©å±•åŠŸèƒ½ã€‚



æ‹¿åˆ°æ–°é¡¹ç›®ï¼Œspringbootä¸éœ€è¦æ”¹mavenï¼Œæ˜¯ssmçš„æ—¶å€™æ‰è¦æ”¹mavenã€‚springbootæ‹¿åˆ°æ–°é¡¹ç›®ä¸€èˆ¬æ˜¯æ”¹æ•°æ®åº“é…ç½®ã€‚

Springbootä¹Ÿä¸ç”¨é…tomcatï¼ŒSpringbootè‡ªå¸¦äº†å®¹å™¨ã€‚



è¥¿éƒ¨å¼€æºï¼ˆbilibiliå¯æœï¼‰ å´é›ªåè€å¸ˆçš„dockerè®²çš„ç‰¹åˆ«å¥½ã€‚çœ‹åˆ°ç¬¬ä¸ƒèŠ‚å³å¯å®ç°ã€‚æœ‰ä¸€å®šlinuxåŸºç¡€ä¼šæ¯”è¾ƒå¥½ã€‚



æ­£ç»é¡¹ç›®éƒ½æ˜¯ï¼šå‰ç«¯ã€Š---ã€‹æ§åˆ¶å±‚controllerã€Š---ã€‹æœåŠ¡å±‚serviceæ¥å£ã€Š---ã€‹è°ƒdaoå±‚ã€Š---ã€‹æ•°æ®åº“



å¸¸ç”¨çš„å‰ç«¯æ¨¡æ¿ï¼šlayuiï¼Œæ¨¡æ¿ä¹‹å®¶ åå°æ¨¡æ¿ ã€‚



## Swagger

å­¦ä¹ ç›®æ ‡ï¼š

- äº†è§£swaggerçš„ä½œç”¨å’Œæ¦‚å¿µ
- å·©å›ºå‰åç«¯åˆ†ç¦»
- åœ¨springbootä¸­é›†æˆswagger 

 

### Swaggerå¼•å…¥

#### å‰åç«¯åˆ†ç¦»

åç«¯æ—¶ä»£ï¼šå‰ç«¯åªç”¨ç®¡ç†é™æ€é¡µé¢å¦‚htmlã€‚htmlè¦ç»™åç«¯ï¼Œåç«¯é€šè¿‡æ¨¡æ¿å¼•æ“ï¼ˆJSPï¼‰æŠŠhtmlé‡æ„ã€‚åç«¯æ˜¯å¼€å‘ä¸»åŠ›ï¼Œå·¥èµ„å·¨é«˜ã€‚



å‰åç«¯åˆ†ç¦»æ—¶ä»£ï¼šå½“å‰æœ€ä¸»æµçš„çš„æŠ€æœ¯æ ˆï¼šVue+Springboot

- åç«¯ï¼šåç«¯æ§åˆ¶å±‚ï¼ˆControllerï¼‰ï¼ŒæœåŠ¡å±‚ï¼ˆServiceï¼‰ï¼Œæ•°æ®è®¿é—®å±‚ï¼ˆDaoï¼‰ã€‚ã€åç«¯å›¢é˜Ÿã€‘
- å‰ç«¯ï¼šå‰ç«¯æ§åˆ¶å±‚ï¼Œè§†å›¾å±‚ã€‚ã€å‰ç«¯å›¢é˜Ÿã€‘
  - å‰ç«¯èƒ½ä¼ªé€ åç«¯æ•°æ®ï¼Œå°±ç¼–å†™å‰æ®µæ—¶å°±å­˜jsonæ•°æ®ï¼›è¿™æ—¶å€™ä¸éœ€è¦åç«¯ï¼Œå‰ç«¯å·¥ç¨‹ä¾æ—§èƒ½è·‘èµ·æ¥ï¼›è¿™ç§ç°è±¡å¸¸è§äºå‰ç«¯å•ç‹¬å¼€å‘é˜¶æ®µã€‚ç­‰åˆ°çœŸå®ä¸Šçº¿çš„æ—¶å€™ï¼Œé‚£äº›jsonæ”¹ä¸ºä»åç«¯è·å–ã€‚
- å‰åç«¯æ‚è°ˆï¼š
  - å‰åç«¯å¦‚ä½•äº¤äº’ï¼Ÿ==ã€‹çº¦å®šå¥½æ•°æ®æ ¼å¼ï¼Œé€šè¿‡apiäº¤äº’ã€‚
  - å‰åç«¯ç›¸å¯¹ç‹¬ç«‹ï¼Œæ¾è€¦åˆ
  - å‰åç«¯ç”šè‡³å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚



äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼š

- å‰åç«¯é›†æˆè”è°ƒã€‚å‰ç«¯äººå‘˜å’Œåç«¯äººå‘˜æ— æ³•åšåˆ°â€œåŠæ—¶åå•†ï¼Œå°½æ—©è§£å†³â€ï¼Œæœ€ç»ˆå¯¼è‡´é—®é¢˜é›†ä¸­çˆ†å‘ã€‚

è§£å†³æ–¹æ¡ˆï¼š

- åˆ¶å®šä¸€ä¸ªschemaã€è®¡åˆ’çš„æçº²ã€‘ï¼Œå®æ—¶æ›´æ–°æœ€æ–°apiï¼Œé™ä½é›†æˆçš„é£é™©ã€‚
- æ—©äº›å¹´ï¼šåˆ¶å®šwordè®¡åˆ’æ–‡æ¡£ã€‚
- å‰åç«¯åˆ†ç¦»ï¼š
  - å‰ç«¯æµ‹è¯•åç«¯æ¥å£ï¼špostman
  - åç«¯æä¾›æ¥å£ï¼Œéœ€è¦å®æ—¶æ›´æ–°æœ€æ–°çš„æ¶ˆæ¯å’Œæ”¹åŠ¨ã€‚



### Swaggeræ˜¯ä»€ä¹ˆ

æ˜¯ä»€ä¹ˆï¼š

- å·ç§°æ˜¯ä¸–ç•Œä¸Šæœ€æµè¡Œçš„Apiæ¡†æ¶
- RestFul Api æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆå·¥å…·==ã€‹apiæ–‡æ¡£ä¸apiå®šä¹‰ï¼ˆå³ä»£ç ï¼‰åŒæ­¥æ›´æ–°ã€‚
- å¯ä»¥ç›´æ¥è¿è¡Œï¼Œå¯ä»¥åœ¨çº¿æµ‹è¯•apiæ¥å£
- æ”¯æŒå¤šç§è¯­è¨€ï¼šï¼ˆjavaï¼Œphpï¼‰ã€‚



å®˜ç½‘ï¼šhttps://swagger.io/



åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Swaggeréœ€è¦Springfox

- swagger2
- swagger-ui



### Springbooté›†æˆSwagger

åšä¸€ä¸ªæœ€ç®€å•çš„é¡¹ç›®ï¼ŒæŠŠspringbootå’Œswaggeré›†æˆä¸€ä¸‹ã€‚

å®æˆ˜ï¼š

![image-20211010170529226](springboot.assets/image-20211010170529226.png)



æ–°å»ºspringboot-webé¡¹ç›®

![image-20211010163807078](springboot.assets/image-20211010163807078.png)

![image-20211010163859311](springboot.assets/image-20211010163859311.png)

![image-20211010163936944](springboot.assets/image-20211010163936944.png)

åˆ é™¤æ— ç”¨çš„æ–‡ä»¶ï¼ˆå¤¹ï¼‰

![image-20211010164345423](springboot.assets/image-20211010164345423.png)

![image-20211010164354439](springboot.assets/image-20211010164354439.png)



å¯¼å…¥ä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui -->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger-ui</artifactId>
    <version>2.9.2</version>
</dependency>
<!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 -->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.9.2</version>
</dependency>

```

ç¼–å†™ä¸€ä¸ªhelloå·¥ç¨‹ï¼Œå³ç¼–å†™æ§åˆ¶å™¨

```java
package com.zhangyun.swaggerdemo.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

//æ²¡æœ‰å‰ç«¯é¡µé¢ï¼Œæ‰€ä»¥ç”¨restcontrollerç›´æ¥ç»™æµè§ˆå™¨è¿”å›å­—ç¬¦ä¸²
@RestController
public class HelloController {

    @RequestMapping(value = "/hello")
    public String hello(){
        return "hello";
    }
}
```

é…ç½®swaggerï¼Œspringbootä¸­é…ç½®åŸºæœ¬è¦å†™ä¸€ä¸ªXXXConfig.java

```java
package com.zhangyun.swaggerdemo.config;

import org.springframework.context.annotation.Configuration;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

//@Configurationç­‰ä»·ä¸@Componentã€‚åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œç±»ä¸­çš„é…ç½®å°±ä¼šé›†æˆåˆ°springbootçš„é…ç½®ä¸­ã€‚
@Configuration
//å¼€å¯Swagger2
@EnableSwagger2
public class SwaggerConfig {
}
```

æµ‹è¯•è¿è¡Œã€‚å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®ï¼šhttp://localhost:8080/swagger-ui.html

![image-20211010170326043](springboot.assets/image-20211010170326043.png)



### Springbootä¸­é…ç½®Swaggerä¿¡æ¯

**é¡¹ç›®æ¥Springbooté›†æˆSwagger**



é€šè¿‡Swaggerçš„beanå®ä¾‹ Docketæ¥é…ç½®Swaggerä¿¡æ¯.

å®æˆ˜ï¼š

åœ¨SwaggerConfig.javaä¸­æ³¨å†ŒDocketçš„beanå®ä¾‹ï¼Œå¹¶ç¼–å†™é…å¥—æ–¹æ³•ã€‚

```java
package com.zhangyun.swaggerdemo.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

import java.util.ArrayList;

//@Configurationç­‰ä»·ä¸@Componentã€‚åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œç±»ä¸­çš„é…ç½®å°±ä¼šé›†æˆåˆ°springbootçš„é…ç½®ä¸­ã€‚
@Configuration
//å¼€å¯Swagger2
@EnableSwagger2
public class SwaggerConfig {

    /*
    * æŠŠSwaggerçš„Docketçš„beanæ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼š
    * 1. æ³¨å†Œä¸€ä¸ªbeané¦–å…ˆè¦@beanæ³¨è§£;
    * 2. æƒ³è¦æ³¨å†ŒDocketå¯¹è±¡çš„å®ä¾‹ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±å¾—æ˜¯Docket
    * 3. beançš„åå­—ä¸ºå‡½æ•°ådocket
    *
    * Docketç±»ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œéƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæ¯”å¦‚apiInfoã€‚
    * */
    @Bean
    public Docket docket(){
        //å¯¹swagger2æ¥è¯´ï¼Œä¸‹é¢ä¸¤è¡Œæ˜¯å†™æ­»çš„
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo());
    }

    /*
    * é…ç½®swaggerä¿¡æ¯ä¸­çš„apiInfo
    *
    * ä¸‹é¢å‡½æ•°ä¸æ˜¯ä¸€ä¸ªbeanï¼Œæ˜¯çœŸæ­£çš„æ–¹æ³•ï¼Œç”¨æ¥ç»™docket()beanæ³¨å†Œä¸­çš„Docket.apiInfoåå‚æ•°çš„
    * */
    private ApiInfo apiInfo(){
        //new apiinfoçš„æ—¶å€™éœ€è¦æä¾›default_contactï¼ˆä½œè€…ä¿¡æ¯ï¼‰ï¼Œåœ¨è¿™é‡Œåˆ›å»º
        Contact contact = new Contact("å¼ äº‘", "https://www.baidu.com/", "10000@qq.com");

        //å»ApiInfoçœ‹æºç ï¼Œå¯ä»¥çœ‹åˆ°æœ€åæœ‰apiinfoçš„æ„é€ å‡½æ•°é»˜è®¤çš„å¡«å……æ–¹æ³•ï¼Œå¤åˆ¶åˆ°è¿™è¿”å›ä¸€ä¸ªé»˜è®¤çš„Apiinfoçš„bean
        return new ApiInfo(
                //swaggeré¦–é¡µçš„titleï¼Œå¯ä»¥è‡ªå®šä¹‰
                "å¼ äº‘çš„swaggerapiæ–‡æ¡£",
                //swaggeré¦–é¡µçš„æè¿°ï¼Œå¯ä»¥è‡ªå®šä¹‰
                "è¿™æ˜¯å¼ äº‘å†™çš„æè¿°ï¼šå­¦å­¦å­¦",
                "1.0",
                //swaggeré¦–é¡µå¯ä»¥ç‚¹çš„urlã€‚ä¸€å®šè¦æœ‰httpï¼Œå¦åˆ™æ— æ³•æ­£ç¡®å¯¼å‘é¡µé¢ã€‚
                "https://www.baidu.com/",
                //å­˜å…¥é¢„å…ˆå®šä¹‰å¥½çš„contact
                contact,
                //licenseä¸ç”¨å˜
                "Apache 2.0",
                "http://www.apache.org/licenses/LICENSE-2.0",
                //é»˜è®¤è¦å¡«çš„ï¼Œæ˜¯ç©ºçš„
                new ArrayList()
        );
    }
}
```

è¿è¡Œé¡¹ç›®ï¼Œå¹¶è®¿é—®:http://localhost:8080/swagger-ui.html

é€šè¿‡Docketé…ç½®çš„ä¿¡æ¯æˆåŠŸå±•ç¤ºåœ¨é¡µé¢ä¸Š

![image-20211011193047910](springboot.assets/image-20211011193047910.png)

ç‚¹å‡»"å¼ äº‘_websit"ï¼ŒæˆåŠŸè·³åˆ°é…ç½®çš„ç½‘ç«™

![image-20211011193135244](springboot.assets/image-20211011193135244.png)



### Swaggeré…ç½®æ‰«ææ¥å£å’Œå¼€å…³

#### å®ç°

**é¡¹ç›®æ¥Springbootä¸­é…ç½®Swaggerä¿¡æ¯**



Swaggeré…ç½®æ‰«ææ¥å£å’Œå¼€å…³æ˜¯åŸºäºDocket.select()å®ç°çš„ã€‚

åœ¨SwaggerConfig.javaä¸­å…ˆé…ç½®æ‰«ææ¥å£ã€‚

```java
	/*
    * æŠŠSwaggerçš„Docketçš„beanæ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼š
    * 1. æ³¨å†Œä¸€ä¸ªbeané¦–å…ˆè¦@beanæ³¨è§£;
    * 2. æƒ³è¦æ³¨å†ŒDocketå¯¹è±¡çš„å®ä¾‹ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±å¾—æ˜¯Docket
    * 3. beançš„åå­—ä¸ºå‡½æ•°ådocket
    *
    * Docketç±»ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œéƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæ¯”å¦‚apiInfoã€‚
    * */
@Bean
public Docket docket(){
    //å¯¹swagger2æ¥è¯´ï¼Œä¸‹é¢ä¸¤è¡Œæ˜¯å†™æ­»çš„
    return new Docket(DocumentationType.SWAGGER_2)
            .apiInfo(apiInfo())
        	//select()apis()paths()build()æ˜¯ä¸€å¥—
            .select()
            /*
            * RequestHandlerSelectors:é…ç½®è¦æ‰«ææ¥å£çš„æ–¹å¼
            *   basePackage:æŒ‡å®šè¦æ‰«æçš„åŒ…
            *   any():æ‰«æå…¨éƒ¨
            *   none():ä¸æ‰«æ
            *   withClassAnnotationï¼šæ‰«æç±»ä¸Šçš„æ³¨è§£ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ³¨è§£çš„åå°„å¯¹è±¡
            *   withMethodAnnotation:æ‰«ææ–¹æ³•ä¸Šçš„æ³¨è§£
            * */
            .apis(RequestHandlerSelectors.basePackage("com.zhangyun.swaggerdemo.controller"))
            //paths():è¿‡æ»¤å¤„ç†ä»€ä¹ˆè·¯å¾„ï¼šç”±äº/zhangyunè·¯å¾„å’ŒbasePackageæŒ‡å®šçš„åŒ…æ²¡æœ‰é‡åˆéƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•æ¥å£è¢«æ‰«æã€‚
            .paths(PathSelectors.ant("/zhangyun/**"))
            .build();//buildä½“ç°å·¥å‚æ¨¡å¼
}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼Œæ²¡æœ‰æ¥å£è¢«æ‰«æï¼Œç¬¦åˆé¢„æœŸã€‚

![image-20211011201258040](springboot.assets/image-20211011201258040.png)



ç”¨apiInfo().enable()é…ç½®æ˜¯å¦å¼€å¯swaggerã€‚

ï¼ˆåŒæ—¶æ³¨é‡Šæ‰ä¹‹å‰çš„pathé…ç½®ï¼Œé¿å…æ‰«æä¸åˆ°æ¥å£ï¼‰ã€‚

```java
    /*
    * æŠŠSwaggerçš„Docketçš„beanæ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼š
    * 1. æ³¨å†Œä¸€ä¸ªbeané¦–å…ˆè¦@beanæ³¨è§£;
    * 2. æƒ³è¦æ³¨å†ŒDocketå¯¹è±¡çš„å®ä¾‹ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±å¾—æ˜¯Docket
    * 3. beançš„åå­—ä¸ºå‡½æ•°ådocket
    *
    * Docketç±»ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œéƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæ¯”å¦‚apiInfoã€‚
    * */
    @Bean
    public Docket docket(){
        //å¯¹swagger2æ¥è¯´ï¼Œä¸‹é¢ä¸¤è¡Œæ˜¯å†™æ­»çš„
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                //enable():æ˜¯å¦å¯ç”¨swaggerï¼Œå¦‚æœä¸ºfalseåˆ™swaggerä¸èƒ½åœ¨æµè§ˆå™¨ä¸­è®¿é—®
                .enable(false)
                //select()apis()paths()build()æ˜¯ä¸€å¥—
                .select()
                /*
                * RequestHandlerSelectors:é…ç½®è¦æ‰«ææ¥å£çš„æ–¹å¼
                *   basePackage:æŒ‡å®šè¦æ‰«æçš„åŒ…
                *   any():æ‰«æå…¨éƒ¨
                *   none():ä¸æ‰«æ
                *   withClassAnnotationï¼šæ‰«æç±»ä¸Šçš„æ³¨è§£ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ³¨è§£çš„åå°„å¯¹è±¡
                *   withMethodAnnotation:æ‰«ææ–¹æ³•ä¸Šçš„æ³¨è§£
                * */
                .apis(RequestHandlerSelectors.basePackage("com.zhangyun.swaggerdemo.controller"))
                //paths():è¿‡æ»¤å¤„ç†ä»€ä¹ˆè·¯å¾„ï¼šç”±äº/zhangyunè·¯å¾„å’ŒbasePackageæŒ‡å®šçš„åŒ…æ²¡æœ‰é‡åˆéƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•æ¥å£è¢«æ‰«æã€‚
                //.paths(PathSelectors.ant("/zhangyun/**"))
                .build();//buildä½“ç°å·¥å‚æ¨¡å¼
    }
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ã€‚é¡µé¢æ— æ³•å±•ç°ï¼Œä½“ç°swaggeræˆåŠŸå…³é—­ã€‚

![image-20211011202042480](springboot.assets/image-20211011202042480.png)



#### swaggeræ‰«æä¸å¼€å…³çš„æ€è€ƒ

**é—®é¢˜**ï¼šå¦‚æœæˆ‘åªå¸Œæœ›æˆ‘çš„Swaggeråœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œåœ¨å‘å¸ƒçš„æ—¶å€™ä¸ä½¿ç”¨ï¼Œæ€ä¹ˆåšï¼Ÿ

æ€è·¯ï¼š

- åˆ¤æ–­æ˜¯ä¸æ˜¯ç”Ÿäº§ç¯å¢ƒ: flag
- æ³¨å…¥enable(flag)

å®æˆ˜ï¼š

**é¡¹ç›®æ¥Swaggeré…ç½®æ‰«ææ¥å£å’Œå¼€å…³**

![image-20211011212028761](springboot.assets/image-20211011212028761.png)

ç¼–å†™ä¸¤ä¸ªspringbootåˆ†é…ç½®æ–‡ä»¶

application-dev.propertiesï¼š

```properties
server.port=8081
```

application-prod.propertiesï¼š

```properties
server.port=8082
```

application.propertiesä¸­æŒ‡å®šä½¿ç”¨å“ªä¸ªspringbootåˆ†é…ç½®æ–‡ä»¶

```properties
spring.profiles.active=dev
```

ä¿®æ”¹SwaggerConfig.javaå®ç°æé—®è¦æ±‚çš„åŠŸèƒ½ã€‚

- å…³é”®ä»£ç ä½ç½®å¯æœç´¢â€œå®ç°swaggeråœ¨ä¸åŒç¯å¢ƒä¸­å¼€å¯ä¸å¦çš„åŠŸèƒ½â€ã€‚

```java
package com.zhangyun.swaggerdemo.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.core.env.Environment;
import org.springframework.core.env.Profiles;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

import java.util.ArrayList;

//@Configurationç­‰ä»·ä¸@Componentã€‚åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œç±»ä¸­çš„é…ç½®å°±ä¼šé›†æˆåˆ°springbootçš„é…ç½®ä¸­ã€‚
@Configuration
//å¼€å¯Swagger2
@EnableSwagger2
public class SwaggerConfig {

    /*
    * æŠŠSwaggerçš„Docketçš„beanæ³¨å†Œåˆ°springå®¹å™¨ä¸­ï¼š
    * 1. æ³¨å†Œä¸€ä¸ªbeané¦–å…ˆè¦@beanæ³¨è§£;
    * 2. æƒ³è¦æ³¨å†ŒDocketå¯¹è±¡çš„å®ä¾‹ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±å¾—æ˜¯Docket
    * 3. beançš„åå­—ä¸ºå‡½æ•°ådocket
    *
    * Docketç±»ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œéƒ½æ˜¯å¯ä»¥é…ç½®çš„ï¼Œæ¯”å¦‚apiInfoã€‚
    * */
    @Bean
    public Docket docket(Environment environment){

        /*
        * å®ç°swaggeråœ¨ä¸åŒç¯å¢ƒä¸­å¼€å¯ä¸å¦çš„åŠŸèƒ½
        * */
        //è®¾ç½®â€œswaggerç”Ÿæ•ˆçš„ç¯å¢ƒâ€
        Profiles profiles = Profiles.of("dev", "test");
        //è¿™ä¸ªflagæ ‡è®°å½“å‰ç¯å¢ƒæ˜¯ä¸æ˜¯åœ¨é…ç½®çš„â€œswaggerç”Ÿæ•ˆçš„ç¯å¢ƒâ€ä¸­ï¼Œå¦‚æœåœ¨ï¼ŒapiInfo().enable(flag)ä¼šå¯ç”¨swaggerã€‚
        boolean flag = environment.acceptsProfiles(profiles);

        //å¯¹swagger2æ¥è¯´ï¼Œä¸‹é¢ä¸¤è¡Œæ˜¯å†™æ­»çš„
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                //enable():æ˜¯å¦å¯ç”¨swaggerï¼Œå¦‚æœä¸ºfalseåˆ™swaggerä¸èƒ½åœ¨æµè§ˆå™¨ä¸­è®¿é—®
                .enable(flag)
                //select()apis()paths()build()æ˜¯ä¸€å¥—
                .select()
                /*
                * RequestHandlerSelectors:é…ç½®è¦æ‰«ææ¥å£çš„æ–¹å¼
                *   basePackage:æŒ‡å®šè¦æ‰«æçš„åŒ…
                *   any():æ‰«æå…¨éƒ¨
                *   none():ä¸æ‰«æ
                *   withClassAnnotationï¼šæ‰«æç±»ä¸Šçš„æ³¨è§£ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ³¨è§£çš„åå°„å¯¹è±¡
                *   withMethodAnnotation:æ‰«ææ–¹æ³•ä¸Šçš„æ³¨è§£
                * */
                .apis(RequestHandlerSelectors.basePackage("com.zhangyun.swaggerdemo.controller"))
                //paths():è¿‡æ»¤å¤„ç†ä»€ä¹ˆè·¯å¾„ï¼šç”±äº/zhangyunè·¯å¾„å’ŒbasePackageæŒ‡å®šçš„åŒ…æ²¡æœ‰é‡åˆéƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•æ¥å£è¢«æ‰«æã€‚
                //.paths(PathSelectors.ant("/zhangyun/**"))
                .build();//buildä½“ç°å·¥å‚æ¨¡å¼
    }

    /*
    * é…ç½®swaggerä¿¡æ¯ä¸­çš„apiInfo
    *
    * ä¸‹é¢å‡½æ•°ä¸æ˜¯ä¸€ä¸ªbeanï¼Œæ˜¯çœŸæ­£çš„æ–¹æ³•ï¼Œç”¨æ¥ç»™docket()beanæ³¨å†Œä¸­çš„Docket.apiInfoåå‚æ•°çš„
    * */
    private ApiInfo apiInfo(){
        //new apiinfoçš„æ—¶å€™éœ€è¦æä¾›default_contactï¼ˆä½œè€…ä¿¡æ¯ï¼‰ï¼Œåœ¨è¿™é‡Œåˆ›å»º
        Contact contact = new Contact("å¼ äº‘", "https://www.baidu.com/", "10000@qq.com");

        //å»ApiInfoçœ‹æºç ï¼Œå¯ä»¥çœ‹åˆ°æœ€åæœ‰apiinfoçš„æ„é€ å‡½æ•°é»˜è®¤çš„å¡«å……æ–¹æ³•ï¼Œå¤åˆ¶åˆ°è¿™è¿”å›ä¸€ä¸ªé»˜è®¤çš„Apiinfoçš„bean
        return new ApiInfo(
                //swaggeré¦–é¡µçš„titleï¼Œå¯ä»¥è‡ªå®šä¹‰
                "å¼ äº‘çš„swaggerapiæ–‡æ¡£",
                //swaggeré¦–é¡µçš„æè¿°ï¼Œå¯ä»¥è‡ªå®šä¹‰
                "è¿™æ˜¯å¼ äº‘å†™çš„æè¿°ï¼šå­¦å­¦å­¦",
                "1.0",
                //swaggeré¦–é¡µå¯ä»¥ç‚¹çš„urlã€‚ä¸€å®šè¦æœ‰httpï¼Œå¦åˆ™æ— æ³•æ­£ç¡®å¯¼å‘é¡µé¢ã€‚
                "https://www.baidu.com/",
                //å­˜å…¥é¢„å…ˆå®šä¹‰å¥½çš„contact
                contact,
                //licenseä¸ç”¨å˜
                "Apache 2.0",
                "http://www.apache.org/licenses/LICENSE-2.0",
                //é»˜è®¤è¦å¡«çš„ï¼Œæ˜¯ç©ºçš„
                new ArrayList()
        );
    }
}

```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ï¼Œæ³¨æ„æ­¤æ—¶é¡¹ç›®çš„ç«¯å£å·ä¸º8081ã€‚devç¯å¢ƒæˆåŠŸæœ‰swaggerã€‚

![image-20211011210950272](springboot.assets/image-20211011210950272.png)

application.propertiesä¸­åˆ‡æ¢springbootä½¿ç”¨çš„é…ç½®æ–‡ä»¶ä¸ºprod

```properties
spring.profiles.active=prod
```

é‡å¯é¡¹ç›®å¹¶æµ‹è¯•ï¼Œæ³¨æ„æ­¤æ—¶é¡¹ç›®çš„ç«¯å£å·ä¸º8082ã€‚prodç¯å¢ƒæ²¡æœ‰swaggerï¼Œç¬¦åˆé¢„æœŸï¼Œå› ä¸ºProfiles.of()ä¸­æ²¡æœ‰prodã€‚

![image-20211011211520752](springboot.assets/image-20211011211520752.png)



#### Swaggeråˆ†ç»„å’Œæ¥å£ï¼ˆå®ä½“ç±»ï¼‰åŠæ¥å£æ³¨é‡Š

**é¡¹ç›®æ¥swaggeræ‰«æä¸å¼€å…³çš„æ€è€ƒ**

SwaggerConfig.javaä¸­é…ç½®åˆ†ç»„ï¼š

```java
/*
* é…ç½®ä¸åŒçš„docketï¼Œç”±ä¸åŒçš„groupnameåŒºåˆ†,ç”±ä¸åŒçš„äººè´Ÿè´£ï¼Œå¯ä»¥åœ¨swaggeré¦–é¡µå³ä¸Šè§’é€‰æ‹©groupè¿›å…¥å¯¹åº”çš„swaggeré¡µé¢
* */
@Bean
public Docket docket1(){
    return new Docket(DocumentationType.SWAGGER_2).groupName("A");
}
@Bean
public Docket docket2(){
    return new Docket(DocumentationType.SWAGGER_2).groupName("B");
}
@Bean
public Docket docket3(){
    return new Docket(DocumentationType.SWAGGER_2).groupName("C");
}
```

ä½¿ç”¨prodç¯å¢ƒï¼ˆ8082ç«¯å£ï¼‰ï¼Œè¿è¡Œé¡¹ç›®å¹¶æµ‹è¯•ï¼Œæ·»åŠ åˆ†ç»„æˆåŠŸã€‚

![image-20211012101705424](springboot.assets/image-20211012101705424.png)



æ¥å£ï¼ˆåŠæ³¨é‡Šï¼‰é…ç½®ï¼š

ç¼–å†™å®ä½“ç±»ã€‚åŒæ—¶ä½¿ç”¨@ApiXXXç»™pojoç±»çš„æ–‡æ¡£åŠ ä¸Šæ³¨é‡Šã€‚

```java
package com.zhangyun.swaggerdemo.pojo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;

//@ApiModelç»™å®ä½“ç±»åŠ æ–‡æ¡£æ³¨é‡Š
@ApiModel("ç”¨æˆ·å®ä½“ç±»")
public class User {
    //å±æ€§privateä¹Ÿå¯ä»¥åœ¨swaggerçš„modelä¸­å±•ç¤ºï¼Œä½†æ˜¯è¦åŠ ä¸Šget setæ‰èƒ½åœ¨swagerä¸­å±•ç¤ºå±æ€§
    @ApiModelProperty("ç”¨æˆ·å")
    public String username;
    //@ApiModelPropertyç»™å®ä½“ç±»çš„å­—æ®µåŠ æ³¨é‡Š
    @ApiModelProperty("å¯†ç ")
    public String password;
}

```

Controllerä¸­ç¼–å†™æ¥å£ã€‚

- æ¥å£VSéæ¥å£ï¼šæ¥å£è¿”å›çš„æ˜¯å®ä½“ç±»ï¼Œè¯·æ±‚è½¬å‘å‡½æ•°è¿”å›çš„æ˜¯â€œå‰ç«¯æ–‡ä»¶åâ€ã€‚

åŒæ—¶ä½¿ç”¨@ApiXXXç»™â€œè¯·æ±‚â€çš„æ–‡æ¡£åŠ ä¸Šæ³¨é‡Šã€‚

```java
package com.zhangyun.swaggerdemo.controller;

import com.zhangyun.swaggerdemo.pojo.User;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

//æ²¡æœ‰å‰ç«¯é¡µé¢ï¼Œæ‰€ä»¥ç”¨restcontrollerç›´æ¥ç»™æµè§ˆå™¨è¿”å›å­—ç¬¦ä¸²
@RestController
public class HelloController {

    /*
    * è¿™æ˜¯controllerä¸­ä¸€ä¸ªæ™®é€šçš„è¯·æ±‚å¤„ç†å’Œè½¬å‘å‡½æ•°
    * */
    @RequestMapping(value = "/hello")
    public String hello(){
        return "hello";
    }

    /*
    * è¿™æ˜¯ä¸€ä¸ªæ¥å£
    *
    * åªè¦æˆ‘ä»¬çš„æ¥å£ä¸­ï¼Œè¿”å›å€¼å­˜åœ¨å®ä½“ç±»ï¼Œè¯¥å®ä½“ç±»å°±ä¼šè¢«æ‰«æåˆ°swaggerçš„modelä¸­
    * */
    @PostMapping(value = "/user")
    public User user(){
        return new User();
    }

    //@ApiOperationæ¥å£æ˜¯æ”¾åœ¨æ–¹æ³•ä¸Šçš„ï¼Œä¸æ˜¯æ”¾åœ¨ç±»ä¸Šçš„
    @ApiOperation("helloæ§åˆ¶ç±»")
    @GetMapping( value = "/hello2")
    //@ApiParamç»™è¯·æ±‚å‡½æ•°çš„å‚æ•°æ·»åŠ æ³¨é‡Š
    public String hello2(@ApiParam("ç”¨æˆ·å") String username){
        return "hello"+username;
    }
}

```

è¿è¡Œé¡¹ç›®å¹¶æµ‹è¯•

/helloè¯·æ±‚è¿™ä¹ˆå¤šæ˜¯å› ä¸ºhello()ç”¨çš„RequestMappingï¼Œèƒ½æ¥å—ä»»ä½•æ–¹å¼çš„è¯·æ±‚ï¼Œæ‰€ä»¥swaggeréƒ½åˆ—äº†å‡ºæ¥ã€‚

![image-20211012112255346](springboot.assets/image-20211012112255346.png)

ç‚¹å¼€/hello2è¯·æ±‚ï¼Œçœ‹åˆ°hello2()ä¸­æ·»åŠ çš„apiæ³¨é‡Šéƒ½åœ¨swaggerä¸­æˆåŠŸå±•ç¤ºã€‚

![image-20211012112519951](springboot.assets/image-20211012112519951.png)

ç‚¹å¼€post /userå’Œmodelã€‚

å› ä¸ºuseræ–¹æ³•ä¸­ï¼Œè¿”å›å€¼æ˜¯Userå¯¹è±¡ï¼Œæ‰€ä»¥Userç±»èƒ½åœ¨swaggerçš„modelæ¨¡å—æŸ¥çœ‹åˆ°ã€‚åŒæ—¶æ³¨æ„åˆ°ï¼Œmodelä¸­Userç±»æœ‰@apiXXXé…ç½®çš„æ³¨é‡Šã€‚

![image-20211012112700606](springboot.assets/image-20211012112700606.png)



#### swaggerè¿›è¡Œç®€å•è¯·æ±‚æµ‹è¯•

åç«¯åŸºæœ¬ç”¨ä¸ä¸Šï¼Œäº†è§£æ­¤åŠŸèƒ½å³å¯ã€‚æƒ³å­¦çš„è¯Baiduçœ‹ä¸€ä¸‹ç›¸å…³åšå®¢ã€‚



#### Swaggeræ€»ç»“

- æˆ‘ä»¬å¯ä»¥é€šè¿‡swaggerç»™ä¸€äº›æ¯”è¾ƒéš¾ç†è§£çš„å±æ€§æˆ–è€…æ¥å£ï¼Œå¢åŠ æ³¨é‡Šä¿¡æ¯
- æ¥å£æ–‡æ¡£å®æ—¶æ›´æ–°
- å¯ä»¥åœ¨çº¿æµ‹è¯•

- **swaggeræ³¨é‡Šå¼ºå¤§åœ¨äº**ï¼Œå‰åç«¯åˆ†ç¦» ä½ ä¸ä¼šè¿½ç€åˆ«äººé—®æ¥å£äº†æˆ–è€…å­—æ®µäº†ï¼Œä½ è‡ªå·±è¦ä»€ä¹ˆè‡ªå·±æ‰¾ä»€ä¹ˆã€‚
- swaggeræ˜¯ä¸€ä¸ªä¼˜ç§€çš„å·¥å…·ï¼Œå‡ ä¹æ¯ä¸ªå¤§å…¬å¸éƒ½æœ‰ä½¿ç”¨ä»–
- ã€æ³¨æ„ç‚¹ã€‘æ­£å¼å‘å¸ƒçš„æ—¶å€™ï¼Œå…³é—­swaggerï¼ï¼ï¼å‡ºäºå®‰å…¨ï¼Œå¹¶ä¸”å¯ä»¥èŠ‚çœè¿è¡Œå†…å­˜ã€‚



## ä»»åŠ¡

å¼‚æ­¥ä»»åŠ¡ï¼š

- æ­£å¸¸ç½‘ç«™å‘é‚®ä»¶çš„æ—¶å€™ï¼Œé‚®ä»¶å‘é€å®Œæ‰èƒ½ç›¸åº”ä¸€äº›æ¶ˆæ¯ï¼Œæ€ä¹ˆå®ç°å¼‚æ­¥å‘¢ï¼Ÿ---å¤šçº¿ç¨‹å°±å¯ä»¥ï¼Œä¸è¿‡ç›´æ¥ç”¨å¤šçº¿ç¨‹å¯èƒ½è®©ç³»ç»Ÿæ€§èƒ½å˜æ…¢ã€‚

å®šæ—¶ä»»åŠ¡ï¼š

- Timerç±»ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡ŒæŸä»»åŠ¡ã€‚
  - æˆ‘ï¼šå¯ä»¥ç”¨springçš„@Scheduleå®ç°å®šæ—¶æ‰§è¡ŒæŸä¸ªåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç”¨linuxçš„cronå®ç°å®šæ—¶æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚


é‚®ä»¶å‘é€ï¼š

- springbootå®˜æ–¹çš„ã€‚



### å¼‚æ­¥ä»»åŠ¡

å®æˆ˜ï¼š

![image-20211012121203294](springboot.assets/image-20211012121203294.png)

æ–°å»ºé¡¹ç›®

![image-20211012114810586](springboot.assets/image-20211012114810586.png)

![image-20211012114830944](springboot.assets/image-20211012114830944.png)

åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼ˆå¤¹ï¼‰

![image-20211012114936528](springboot.assets/image-20211012114936528.png)

ç¼–å†™serviceå±‚

```java
package com.zhangyun.springboot09test.service;

import org.springframework.scheduling.annotation.Async;
import org.springframework.stereotype.Service;

//springæ‰˜ç®¡ä¸€ä¸‹ï¼ŒåŠ @Service
@Service
public class AsyncService {
    /*
    * @Asyncå‘Šè¯‰springè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ä»»åŠ¡,springä¼šè‡ªåŠ¨ä¸ºè¢«æ³¨è§£çš„å‡½æ•°å¼€å¯å¤šçº¿ç¨‹ã€‚å…å¾—è‡ªå·±æ‰‹åŠ¨å†™å¤šçº¿ç¨‹ã€‚
    *
    * å¼€å¯å¼‚æ­¥ï¼ˆspringè‡ªåŠ¨å¤šçº¿ç¨‹ï¼‰åï¼Œhello()çš„ä¼‘çœ ä¸‰ç§’ä¸ä¼šå½±å“å…¶ååˆ«çš„ä»»åŠ¡çš„æ‰§è¡Œã€‚
    * */
    @Async
    public void hello(){
        try {
            //çº¿ç¨‹ä¼šä¼‘çœ ä¸‰ç§’ï¼Œå‰å°ä¼šç™½å±3ç§’
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println("æ•°æ®æ­£åœ¨å¤„ç†");
    }
}

```

ç¼–å†™controllerå±‚

```java
package com.zhangyun.springboot09test.controller;

import com.zhangyun.springboot09test.service.AsyncService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class AsyncController {
    //ä»springå®¹å™¨æ‹¿åˆ°asyncServiceå®ä¾‹
    @Autowired
    AsyncService asyncService;

    //å†™ä¸€ä¸ªæ–¹æ³•è°ƒç”¨serviceå±‚å¼‚æ­¥çš„æ–¹æ³•
    @RequestMapping("hello")
    public String hello(){
        asyncService.hello();//åœæ­¢ä¸‰ç§’,ç½‘ç«™æ˜¯è½¬åœˆçš„
        return "ok";//èµ°åˆ°è¿™æ‰ç›¸åº”ä¸€ä¸ªok
    }
}
```

springbootapplicationæ·»åŠ â€œå¼€å¯å¼‚æ­¥åŠŸèƒ½â€çš„æ³¨è§£

```java
package com.zhangyun.springboot09test;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableAsync;

//å¼€å¯å¼‚æ­¥æ³¨è§£çš„åŠŸèƒ½
@EnableAsync
@SpringBootApplication
public class Springboot09TestApplication {

    public static void main(String[] args) {
        SpringApplication.run(Springboot09TestApplication.class, args);
    }

}
```

å¯åŠ¨é¡¹ç›®å¹¶æµ‹è¯•ã€‚â€œokâ€è¢«å³å¯æ˜¾ç¤ºåœ¨é¡µé¢ï¼Œæ²¡æœ‰ç­‰hello()çš„ä¼‘çœ ä¸‰ç§’ï¼Œä½“ç°å¼‚æ­¥å¼€å¯æˆåŠŸã€‚

![image-20211012121457854](springboot.assets/image-20211012121457854.png)



### é‚®ä»¶ä»»åŠ¡

**é¡¹ç›®æ¥å¼‚æ­¥ä»»åŠ¡**



 å®æˆ˜ï¼š

pomå¯¼å…¥mailä¾èµ–

```xml
<!--javax.mail-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
</dependency>
```

application.propertiesä¸­æ·»åŠ é‚®ç®±çš„é…ç½®

```properties
# é‚®ç®±
spring.mail.username=111@qq.com
# é‚®ç®±å¼€é€šsmtpæ—¶å‘çš„æˆæƒç 
spring.mail.password=aaaaaa
# é‚®ç®±æœåŠ¡å™¨
spring.mail.host=smtp.qq.com
# qqé‚®ç®±è¦æ±‚å¼€å¯åŠ å¯†éªŒè¯ã€‚ç½‘æ˜“å°±æ²¡æœ‰è¿™ä¸ªã€‚
spring.mail.properties.mail.smtp.ssl.enable=true
```

éœ€è¦å‘é€é‚®ä»¶çš„ä½ç½®æ·»åŠ é‚®ä»¶å‘é€é…ç½®ä»£ç 

```java
package com.zhangyun.springboot09test;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSenderImpl;
import org.springframework.scheduling.annotation.Async;

@SpringBootTest
class Springboot09TestApplicationTests {
    @Autowired
    JavaMailSenderImpl mailSender;

    @Test
    void contextLoads() {
        //ä¸€ä¸ªç®€å•çš„é‚®ä»¶
        SimpleMailMessage mailMessage = new SimpleMailMessage();
        mailMessage.setSubject("è¿™æ˜¯é‚®ä»¶çš„ä¸»é¢˜");
        mailMessage.setText("ä»Šå¤©å­¦ä¹ äº†å—");
        mailMessage.setTo("jie_shou_fang@qq.com");
        mailMessage.setFrom("fa_song_fang@qq.com");
        mailSender.send(mailMessage);
    }

}
```

å¯åŠ¨æµ‹è¯•ç±»ï¼Œè€å¸ˆçš„å±•ç¤ºæ•ˆæœå¦‚ä¸‹ï¼ŒæˆåŠŸæ”¶åˆ°è‡ªå·±ç»™è‡ªå·±å‘é€çš„é‚®ä»¶ã€‚å®ç°è¯¥åŠŸèƒ½æœ¬åœ°å¿…é¡»è”ç½‘ï¼

![image-20211012214805663](springboot.assets/image-20211012214805663.png)

é‚®ä»¶é™¤äº†ç®€å•ç¼–å†™æ–¹æ³•ï¼Œè¿˜æœ‰**å¤æ‚é…ç½®æ–¹æ³•ï¼Œå¯ä»¥å®ç°æ›´å¤šåŠŸèƒ½**ã€‚ä¸‹é¢å®ç°é‚®ä»¶å¤æ‚é…ç½®æ–¹æ³•ï¼Œå¹¶è‡ªå·±**å°è£…ä¸ºä¸€ä¸ªå‡½æ•°**ï¼Œè¯¥å‡½æ•°å¾—åœ¨å«`    @Autowired
    JavaMailSenderImpl mailSender;`çš„ç±»ä¸­ä½¿ç”¨ã€‚

```java
/*
* è‡ªå·±å°è£…å¤æ‚é‚®ä»¶ä»£ç 
*
* multipart:é‚®ä»¶æ˜¯å¦æ”¯æŒmultipart
* mailSubjectï¼šé‚®ä»¶ä¸»é¢˜
* ã€‚ã€‚ã€‚
* */
public void sendMail(Boolean multipart,
                     String mailSubject,
                     String mailText,
                     Boolean mailTextHtml,
                     String attachmentName,
                     String attachmentFullUrl,
                     String sendTo,
                     String sendFrom) throws MessagingException {
    //ä¸€ä¸ªå¤æ‚çš„é‚®ä»¶
    MimeMessage mimeMessage = mailSender.createMimeMessage();

    //ç»„è£…
    //MimeMessageHelperå¸®åŠ©é…ç½®å¤æ‚é‚®ä»¶ã€‚MimeMessageHelperç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºå…è®¸å¤šæ–‡ä»¶å‘é€
    MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, multipart);
    helper.setSubject(mailSubject);
    //è®¾ç½®è¦å‘é€çš„æ­£æ–‡ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueè¡¨ç¤ºæ–‡æœ¬ä¸­çš„htmlæ ‡ç­¾ä¼šè¢«è§£æã€‚
    helper.setText(mailText,mailTextHtml);
    //é™„ä»¶
    //è·¯å¾„åº”ä¸ºç»å¯¹è·¯å¾„
    helper.addAttachment(attachmentName,new File(attachmentFullUrl));
    helper.addAttachment("2.jpg",new File("D:\\2.jpg"));
    //é…ç½®é‚®ä»¶çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹
    helper.setTo(sendTo);
    helper.setFrom(sendFrom);

}
```



### å®šæ—¶æ‰§è¡Œä»»åŠ¡

https://www.bilibili.com/video/BV1PE411i7CV?p=53&spm_id_from=pageDriver

å¯ä»¥å†™ä¸€äº›å®šæ—¶è„šæœ¬ï¼ŒæŠ¢ä¸œè¥¿ã€‚



æ ¸å¿ƒæ¥å£ï¼š

- TaskSchedular:ä»»åŠ¡è°ƒåº¦è€…
- TaskExecutorï¼šä»»åŠ¡æ‰§è¡Œè€…

æ ¸å¿ƒæ³¨è§£ï¼š

- @EnableScheduling:å¼€å¯å®šæ—¶åŠŸèƒ½çš„æ³¨è§£ï¼Œæ”¾åœ¨springbootapplication.javaçš„ç±»ä¸Š
- @Scheduled:è§„å®šä»»åŠ¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ

**é‡éš¾ç‚¹**Cronè¡¨è¾¾å¼ï¼š

- ç™¾åº¦ä¸Šå¯ä»¥æœCronè¡¨è¾¾å¼è‡ªåŠ¨ç”Ÿæˆå™¨



å®æˆ˜ï¼š

**é¡¹ç›®æ¥é‚®ä»¶ä»»åŠ¡**

springbootapplication.javaçš„ç±»ä¸ŠåŠ ä¸Šæ³¨è§£@EnableScheduling

```java
package com.zhangyun.springboot09test;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.annotation.EnableScheduling;

//å¼€å¯å¼‚æ­¥æ³¨è§£çš„åŠŸèƒ½
@EnableAsync
//å¼€å¯å®šæ—¶åŠŸèƒ½
@EnableScheduling
@SpringBootApplication
public class Springboot09TestApplication {

    public static void main(String[] args) {
        SpringApplication.run(Springboot09TestApplication.class, args);
    }

}
```

serviceå±‚æ–°å»ºScheduledService.java

```java
package com.zhangyun.springboot09test.service;

import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;

@Service
public class ScheduledService {
    /*
    * åœ¨ä¸€ä¸ªç‰¹å®šæ—¶é—´æ‰§è¡Œè¿™ä¸ªæ–¹æ³•-Timer
    *
    * cronè¡¨è¾¾å¼ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨å‡ ã€‚å‚æ•°ä»¥ç©ºæ ¼éš”å¼€ã€‚
    * 30 15 10 * * ï¼Ÿ  æ¯å¤©10ç‚¹15åˆ†30ç§’æ‰§è¡Œä¸€æ¬¡ã€‚é—®å·è¡¨ç¤ºä¸éœ€è¦å…³æ³¨è¯¥é¡¹ã€‚
    * 30 0/5 10,18 * * ?   æ¯å¤©10ç‚¹å’Œ18ç‚¹ï¼Œæ¯éš”5åˆ†é’Ÿï¼ˆ0/5è¡¨ç¤ºå–æ¨¡ï¼‰çš„ç¬¬30ç§’æ‰§è¡Œä¸€æ¬¡
    * 0 15 10 ï¼Ÿ * 1-6  æ¯ä¸ªæœˆçš„å‘¨ä¸€åˆ°å‘¨å…­10ç‚¹15åˆ†çš„ç¬¬0ç§’æ‰§è¡Œä¸€æ¬¡
    * ä¸‹é¢@Scheduled()ä¸­å‚æ•°ä¸ºcronè¡¨è¾¾å¼:â€œæ¯å‘¨æ¯ä¸€å¤©â€çš„ä»»æ„â€œæœˆâ€â€œæ—¥â€â€œæ—¶â€â€œåˆ†â€çš„ç¬¬0ç§’ä¼šæ‰§è¡Œè¢«æ³¨è§£çš„å‡½æ•°ã€‚
    *
    * */
    @Scheduled(cron="0 * * * * 0-7")
    public void hello(){
        System.out.println("helloï¼Œä½ è¢«æ‰§è¡Œäº†");
    }
}
```

è¿è¡Œé¡¹ç›®å¹¶æµ‹è¯•ã€‚æ²¡åˆ†é’Ÿçš„ç¬¬0ç§’ä¼šæˆåŠŸæ‰“å°æ¶ˆæ¯

![image-20211013133601080](springboot.assets/image-20211013133601080.png)



## Redis

### SpringBooté›†æˆRedis

#### å‰è¨€

Springdataï¼š

- springbootæ“ä½œæ•°æ®ï¼šä½¿ç”¨spring-dataã€‚

- Springdataæ˜¯å’Œspringbooté½åçš„é¡¹ç›®ã€‚



spring2.Xåï¼ŒåŸæ¥ä½¿ç”¨çš„jredisè¢«æ›¿æ¢ä¸ºlettuce

- jredisï¼šé‡‡ç”¨çš„ç›´è¿ï¼Œæœ‰å¤šä¸ªçº¿ç¨‹æ“ä½œçš„è¯ï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœæƒ³é¿å…ä¸å®‰å…¨ï¼Œä½¿ç”¨jedis poolè¿æ¥æ± ï¼Œå®¹æ˜“å¸¦æ¥ä¸€äº›é—®é¢˜ã€‚æ›´åƒBIOæ¨¡å¼ã€‚
- lettuceï¼šé‡‡ç”¨nettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¿›è¡Œå…±äº«ï¼Œä¸å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µã€‚å¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®äº†ï¼Œæ›´åƒNIOæ¨¡å¼ã€‚



springbootæ‰€æœ‰çš„é…ç½®ç±»ï¼Œéƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ã€‚è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šç»‘å®šä¸€ä¸ªpropertiesé…ç½®æ–‡ä»¶ã€‚

- å¯ä»¥å»spring.factoryæ–‡ä»¶ä¸­çœ‹æœ‰å“ªäº›è‡ªåŠ¨é…ç½®ç±»,æ‰¾åˆ°rediså¯¹åº”çš„è‡ªåŠ¨é…ç½®ç±»ï¼šRedisAutoConfigurationã€‚
- RedisProperties.javaä¸­å¯ä»¥çœ‹rediså¯ä»¥é…ç½®å“ªäº›å‚æ•°ã€‚



RedisAutoConfiguration.javaæºç åˆ†æï¼š

```java
@Bean
@ConditionalOnMissingBean(
    name = {"redisTemplate"}
)//æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªredisTemplateæ¥æ›¿æ¢è¿™ä¸ªé»˜è®¤çš„
@ConditionalOnSingleCandidate(RedisConnectionFactory.class)
public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {
    //é»˜è®¤çš„redisTemplateï¼Œæ²¡æœ‰è¿‡å¤šçš„è®¾ç½®ã€‚rediså¯¹è±¡éƒ½æ˜¯éœ€è¦åºåˆ—åŒ–çš„ã€‚
    //ä¸¤ä¸ªåçœéƒ½æ˜¯Objectï¼ŒObjectçš„ç±»å‹ï¼Œæˆ‘ä»¬åç»­ä½¿ç”¨éœ€è¦å¼ºåˆ¶è½¬æ¢ä¸º<String,Object>
    RedisTemplate<Object, Object> template = new RedisTemplate();
    template.setConnectionFactory(redisConnectionFactory);
    return template;
}

@Bean
@ConditionalOnMissingBean//ç”±äºStringæ˜¯redisä¸­æœ€å¸¸ç”¨çš„ç±»å‹ï¼Œæ‰€ä»¥è¯´å•ç‹¬æå‡ºæ¥äº†ä¸€ä¸ªbean
@ConditionalOnSingleCandidate(RedisConnectionFactory.class)
public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) {
    StringRedisTemplate template = new StringRedisTemplate();
    template.setConnectionFactory(redisConnectionFactory);
    return template;
}
```



æœ‰äººæ¨èâ€œç¼–ç¨‹ä¸è‰¯äººâ€è®²çš„redisã€‚



#### å®æˆ˜

æ–°å»ºé¡¹ç›®å¹¶å‹¾é€‰ç›¸å…³åŠŸèƒ½ã€‚å‹¾é€‰ç›¸å…³åŠŸèƒ½åï¼Œé¡¹ç›®è‡ªåŠ¨ç”Ÿæˆçš„pomä¸­ä¼šè‡ªå¸¦æˆ‘ä»¬éœ€è¦çš„ä¾èµ–ï¼Œä¸ç”¨åç»­è‡ªå·±å¯¼å…¥ã€‚

![image-20211013134404602](springboot.assets/image-20211013134404602.png)

![image-20211013134529126](springboot.assets/image-20211013134529126.png)

åˆ é™¤å¤šä½™æ–‡ä»¶ï¼ˆå¤¹ï¼‰

![image-20211013134718195](springboot.assets/image-20211013134718195.png)

ç¡®è®¤pomæ–‡ä»¶ä¸­å¦‚ä¸‹ä¾èµ–æ­£ç¡®ä¸‹è½½äº†jaråŒ…

```xml
<!--æ“ä½œredis-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

åœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®Redis

```properties
# springbootæ‰€æœ‰çš„é…ç½®ç±»ï¼Œéƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»:RedisAutoConfiguration
# è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šç»‘å®šä¸€ä¸ªpropertiesé…ç½®æ–‡ä»¶:RedisProperties

# é…ç½®Redis
spring.redis.host=127.0.0.1
spring.redis.port=6379
# å¯ä»¥é…ç½®è¿æ¥æ± ï¼Œä½†æ˜¯è¦é…ç½®lettuceå¯¹åº”çš„è¿æ¥æ± ï¼Œè€Œä¸æ˜¯jediså¯¹åº”çš„è¿æ¥æ± ã€‚å› ä¸ºæºç é‡Œåªæ³¨å…¥äº†lettuceçš„è¿æ¥æ± ã€‚
# spring.redis.jedis.pool.max-active=
```

åœ¨springtestä¸­ç¼–å†™redisçš„ä½¿ç”¨

```java
package com.example.springboot10redis;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.data.redis.connection.RedisConnection;
import org.springframework.data.redis.core.RedisTemplate;

@SpringBootTest
class Springboot10RedisApplicationTests {
    @Autowired
    private RedisTemplate redisTemplate;

    @Test
    void contextLoads() {

        /*
        * redisTemplate:æ“ä½œä¸åŒçš„æ•°æ®ç±»å‹ï¼Œapiå’Œæˆ‘ä»¬çš„æŒ‡ä»¤æ˜¯ä¸€æ ·çš„ã€‚
        * redisTemplate.opsForValue()ï¼šæ“ä½œå­—ç¬¦ä¸²ï¼Œç±»ä¼¼String
        * redisTemplate.opsForListï¼šæ“ä½œListï¼Œç±»ä¼¼List
        * redisTemplate.opsForSet
        * redisTemplate.opsForHash
        * redisTemplate.opsForZSet
        * redisTemplate.opsForGeo
        * redisTemplate.opsForHyperLogLog
        * é™¤äº†åŸºæœ¬çš„æ“ä½œï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ–¹æ³•éƒ½å¯ä»¥ç›´æ¥é€šè¿‡redisTemplateæ“ä½œï¼Œæ¯”å¦‚äº‹åŠ¡ï¼Œæ¯”å¦‚åŸºæœ¬çš„CRUD
        *
        * è·å–redisçš„è¿æ¥å¯¹è±¡
        * RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();
        * connection.flushDb();
        * connection.flushAll();
        *
        * */
        redisTemplate.opsForValue().set("myKey","å¼ äº‘å­¦java");
        System.out.println(redisTemplate.opsForValue().get("myKey"));

    }

}
```

åœ¨è·‘redisæµ‹è¯•ä¹‹å‰ï¼Œéœ€è¦å®‰è£…redisçš„windowsç‰ˆæœ¬ å¹¶ä¸”å¼€å¯redisæœåŠ¡ æ‰èƒ½æµ‹è¯•é€šè¿‡ã€‚

- å®˜æ–¹zipåŒ…ä¸‹è½½https://github.com/MicrosoftArchive/redis/releases

- å¯åŠ¨æ•™ç¨‹å‚è€ƒï¼šhttps://www.cnblogs.com/pzw23/p/14888834.htmlã€‚ä¸æ¨èç”¨åšå®¢çš„redisï¼Œæœ€å¥½ç”¨Rediså®˜æ–¹çš„zipåŒ…ã€‚

  - å¯åŠ¨ä»£ç ï¼šredis-server.exe redis.windows.conf

  ![image-20211013145434915](springboot.assets/image-20211013145434915.png)



æŒ‰æ•™ç¨‹ä¸‹è½½å¹¶å¯åŠ¨RedisæˆåŠŸåï¼Œæµ‹è¯•Springbootæ•´åˆRedisã€‚å‘ç°redisæˆåŠŸå­˜å…¥æ•°æ®ï¼Œå¹¶æ ¹æ®keyå–å‡ºæ•°æ®ã€‚

![image-20211013145711585](springboot.assets/image-20211013145711585.png)

![image-20211013145808900](springboot.assets/image-20211013145808900.png)



#### åºåˆ—åŒ–ç›¸å…³

å»åˆ°RedisTemplate.classï¼ŒæŸ¥çœ‹åºåˆ—åŒ–ç›¸å…³æºç ã€‚

![image-20211013151044098](springboot.assets/image-20211013151044098.png)

![image-20211013151221432](springboot.assets/image-20211013151221432.png)



### è‡ªå®šä¹‰RedisTemplate

æ–°å»ºRedisConfig.java,æ¥è‡ªå·±å®šä¹‰RedisTemplateï¼Œé‚£ä¹ˆå®˜æ–¹çš„RedisTemplateå°±ä¼šè¢«æ³¨è§£`@ConditionalOnMissingBean(name = {"redisTemplate"})`æ¶ç©ºã€‚

åŒæ—¶å¯ä»¥åœ¨è‡ªå·±çš„RedisTemplateä¸­å®šä¹‰åºåˆ—åŒ–æ–¹å¼ï¼Œå› ä¸ºç³»ç»Ÿé»˜è®¤çš„jdkåºåˆ—åŒ–å¯èƒ½å¯¼è‡´ä¹±ç ã€‚

å®æˆ˜ï¼š

**é¡¹ç›®æ¥SpringBooté›†æˆRedis**

å…ˆæµ‹è¯•æ²¡æœ‰åºåˆ—åŒ–äº§ç”Ÿçš„ç»“æœã€‚

æ¸…ç©ºredisæ•°æ®åº“ã€‚

![image-20211014105500997](springboot.assets/image-20211014105500997.png)

å†™ä¸€äº›è‡ªå·±çš„æ•°æ®ï¼Œå†™ä¸ªpojoç±»ä¿å­˜javaå¯¹è±¡ï¼Œå…ˆä¸å¯¹pojoç±»å®ç°åºåˆ—åŒ–

```java
package com.example.springboot10redis.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;

import java.io.Serializable;

@Component
//ä½¿ç”¨lombokçš„ä¸‰ä¸ªæ³¨è§£ï¼Œè¿™æ ·åªéœ€è¦åœ¨pojoç±»ä¸­å†™å±æ€§
@AllArgsConstructor
@NoArgsConstructor
@Data
//pojoç±»è¦å®ç°åºåˆ—åŒ–implements Serializable
public class User {
    private String name;
    private int age;

}
```

ç¼–å†™æµ‹è¯•æ–¹æ³•

```java
@Test
public void test() throws JsonProcessingException {
    //çœŸæ˜¯çš„å¼€å‘ä¸€èˆ¬éƒ½ä½¿ç”¨jsonæ¥ä¼ é€’å¯¹è±¡
    User user = new User("å¼ äº‘å­¦", 3);
    //æŠŠuseråºåˆ—åŒ–ã€‚springbootä¸­æœ‰objectmapperï¼Œobjectmapperæ˜¯jacksonå¯¹è±¡ã€‚objectmapperå¯ä»¥æŠŠuserç¼–ç¨‹jsonå¯¹è±¡
    String jsonUser = new ObjectMapper().writeValueAsString(user);

    redisTemplate.opsForValue().set("user",jsonUser);
    Object user1 = redisTemplate.opsForValue().get("user");
    System.out.println(user1);
}
```

å¯åŠ¨é¡¹ç›®æµ‹è¯•redisã€‚ï¼ˆç¡®ä¿æ­¤æ—¶åå°å¼€å¯äº†redisï¼‰ã€‚æµ‹è¯•æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°rediså­˜å–jsonæ•°æ®ä¸éœ€è¦pojoç±»åºåˆ—åŒ–ä¹Ÿå¯ä»¥å®ç°ï¼Œå› ä¸ºpojoç±»å¯¹è±¡è¢«jsonåŒ–ä¸ºå­—ç¬¦ä¸²ã€‚

![image-20211014113158603](springboot.assets/image-20211014113158603.png)

ç°åœ¨ä¿®æ”¹æµ‹è¯•æ–¹æ³•ï¼Œä¸ä¼ jsonï¼Œè€Œæ˜¯ç›´æ¥ä¼ å¯¹è±¡

```java
@Test
public void test() throws JsonProcessingException {
    //çœŸæ˜¯çš„å¼€å‘ä¸€èˆ¬éƒ½ä½¿ç”¨jsonæ¥ä¼ é€’å¯¹è±¡
    User user = new User("å¼ äº‘å­¦", 3);
    //æŠŠuseråºåˆ—åŒ–ã€‚springbootä¸­æœ‰objectmapperï¼Œobjectmapperæ˜¯jacksonå¯¹è±¡ã€‚objectmapperå¯ä»¥æŠŠuserç¼–ç¨‹jsonå¯¹è±¡
    //String jsonUser = new ObjectMapper().writeValueAsString(user);

    redisTemplate.opsForValue().set("user",user);
    Object user1 = redisTemplate.opsForValue().get("user");
    System.out.println(user1);
}
```

å¯åŠ¨é¡¹ç›®æµ‹è¯•redisã€‚ï¼ˆç¡®ä¿æ­¤æ—¶åå°å¼€å¯äº†redisï¼‰ã€‚æµ‹è¯•å¤±è´¥ï¼Œ**æ‰€æœ‰å¯¹è±¡éœ€è¦è¢«åºåˆ—åŒ–æ‰èƒ½è¢«Rediså­˜å–**ã€‚

![image-20211014113603103](springboot.assets/image-20211014113603103.png)

ç°åœ¨åºåˆ—åŒ–pojoç±»

```java
package com.example.springboot10redis.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.stereotype.Component;

import java.io.Serializable;

@Component
//ä½¿ç”¨lombokçš„ä¸‰ä¸ªæ³¨è§£ï¼Œè¿™æ ·åªéœ€è¦åœ¨pojoç±»ä¸­å†™å±æ€§
@AllArgsConstructor
@NoArgsConstructor
@Data
//ä¼ä¸šä¸­pojoç±»è¦å®ç°åºåˆ—åŒ–ã€‚implements Serializable
public class User implements Serializable{
    private String name;
    private int age;

}
```

å†æ¬¡è¿è¡Œtest()æ–¹æ³•ï¼Œå› ä¸ºpojoç±»å·²è¢«åºåˆ—åŒ–ï¼Œæµ‹è¯•rediså­˜å–å¯¹è±¡æˆåŠŸã€‚ä½†æ˜¯ç³»ç»Ÿé»˜è®¤çš„jdkåºåˆ—åŒ–æ–¹å¼ä¼šå¯¼è‡´redisåº“ä¸­çš„keyä¹±ç ï¼Œ**ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜åªèƒ½è‡ªå®šä¹‰RedisTemplateï¼Œå¹¶åœ¨è‡ªå®šä¹‰çš„RedisTemplateè‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•**ã€‚

![image-20211014114013814](springboot.assets/image-20211014114013814.png)

![image-20211014141354480](springboot.assets/image-20211014141354480.png)

RedisConfig.javaä¸­è‡ªå®šä¹‰redisTemplateçš„beanï¼Œå¹¶åœ¨redisTemplateä¸­è®¾ç½®è‡ªå·±é€‰æ‹©åºåˆ—åŒ–æ–¹å¼ï¼Œè€Œä¸å†ä½¿ç”¨é»˜è®¤çš„jdkåºåˆ—åŒ–ï¼ˆä¼šå¯¼è‡´redisçš„keyä¹±ç ï¼‰ã€‚

```java
package com.example.springboot10redis.config;

import com.fasterxml.jackson.annotation.JsonAutoDetect;
import com.fasterxml.jackson.annotation.PropertyAccessor;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnSingleCandidate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;

@Configuration
public class RedisConfig {

    /*
    * ç¼–å†™è‡ªå®šä¹‰çš„RedisTemplateã€‚
    *
    * è‡ªå®šä¹‰çš„RedisTemplateçš„æ ¼å¼å’ŒRedisAutoConfiguration.javaä¸­å®šä¹‰RedisTemplateçš„æ ¼å¼ä¸€æ¨¡ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ä¿®æ”¹ä¸€ä¸‹
    * */
//    @Bean
//    @ConditionalOnSingleCandidate(RedisConnectionFactory.class)
//    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {
//        RedisTemplate<String, Object> template = new RedisTemplate();
//
//        //é»˜è®¤çš„jdkåºåˆ—åŒ–ä¼šä¹±ç ï¼Œæˆ‘ä»¬è¦è‡ªå·±é…ç½®å…·ä½“çš„åºåˆ—åŒ–æ–¹å¼
//        template.setKeySerializer();
//
//        template.setConnectionFactory(redisConnectionFactory);
//        return template;
//    }

    // è¿™æ˜¯æˆ‘ç»™å¤§å®¶å†™å¥½çš„ä¸€ä¸ªå›ºå®šæ¨¡æ¿ï¼Œå¤§å®¶åœ¨ä¼ä¸šä¸­ï¼Œæ‹¿å»å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼
    // è‡ªå·±å®šä¹‰äº†ä¸€ä¸ª RedisTemplate
    @Bean
    //å¼ºå‹è­¦å‘Šæ˜¯å› ä¸ºæœ‰ä¸€ä¸ªæ–¹æ³•è¿‡æ—¶äº†
    @SuppressWarnings("all")
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        // æˆ‘ä»¬ä¸ºäº†è‡ªå·±å¼€å‘æ–¹ä¾¿ï¼Œä¸€èˆ¬ç›´æ¥ä½¿ç”¨ <String,Object>
        RedisTemplate<String, Object> template = new RedisTemplate<String,Object>();
        template.setConnectionFactory(factory);
        // Jsonåºåˆ—åŒ–é…ç½®
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new
                Jackson2JsonRedisSerializer(Object.class);
        //jsonåºåˆ—åŒ–çš„æ—¶å€™éœ€è¦ObjectMapperæ¥è¿›è¡Œè½¬ä¹‰ï¼Œè½¬ä¹‰å®Œæ‰èƒ½ä½¿ç”¨
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        // String çš„åºåˆ—åŒ–
        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();

        // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
        template.setKeySerializer(stringRedisSerializer);
        // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
        template.setHashKeySerializer(stringRedisSerializer);
        // valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson
        template.setValueSerializer(jackson2JsonRedisSerializer);
        // hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson
        template.setHashValueSerializer(jackson2JsonRedisSerializer);

        //æŠŠæ‰€æœ‰çš„properties setè¿›å»
        template.afterPropertiesSet();
        return template;
    }

}
```

flushæ‰redisçš„å†…å®¹ï¼Œé‡æ–°è¿è¡Œtest()ã€‚æŸ¥çœ‹redisåº“ä¸­çš„keyï¼Œè¿™å›keyæ²¡æœ‰ä¹±ç ã€‚

![image-20211014133321196](springboot.assets/image-20211014133321196.png)



### è‡ªå®šä¹‰å°è£…RedisUtilså·¥å…·ç±»

åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¤§å¤šæ•°æƒ…å†µéƒ½ä¸ä¼šä½¿ç”¨åŸç”Ÿçš„æ–¹å¼å»ç¼–å†™ä»£ç ã€‚è€Œæ˜¯ä¼šæ ¹æ®å…¬å¸ä»£ç ä¸šåŠ¡éœ€è¦ï¼Œå°è£…ä¸€ä¸ªè‡ªå·±çš„XXXUtils.javaå»ç”¨ã€‚

- æŠŠå¸¸ç”¨çš„æ“ä½œæå–å‡ºæ¥ï¼Œå°è£…ä¸ºä¸€ä¸ªå·¥å…·ç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ã€‚



å®æˆ˜ï¼š

**é¡¹ç›®æ¥è‡ªå®šä¹‰RedisTemplate**



ä¸‹é¢æ¼”ç¤ºå°è£…RedisUtils.javaã€‚è€å¸ˆæ¨èçš„ï¼Œè›®å¤§ï¼Œæœ‰å°å…­ç™¾è¡Œã€‚

```java
package com.example.springboot10redis.utils;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Component;
import org.springframework.util.CollectionUtils;

import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.TimeUnit;

/*
* åœ¨æˆ‘ä»¬çœŸå®çš„å¼€å‘ä¸­ï¼Œæˆ–è€…ä½ ä»¬åœ¨å…¬å¸ä¸­ï¼Œä¸€èˆ¬éƒ½å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…¬å¸è‡ªå·±å°è£…RedisUtil
* */
@Component
public final class RedisUtil {

    //æ³¨å…¥è‡ªå·±å†™çš„redisTemplateã€‚ç‚¹å‡»ideaå·¦è¾¹æ ä¸Šçš„å¶å­ï¼Œå¦‚æœèƒ½è·³åˆ°è‡ªå®šä¹‰çš„redisTemplateåˆ™æ­£å¸¸ã€‚ä¸èƒ½çš„è¯ï¼Œç”¨@Qualifier(â€œredisTemplateâ€)æ˜¾å¼æŒ‡å®šä¸€ä¸‹ã€‚
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;

    // =============================common============================
    /**
     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´
     * @param key  é”®
     * @param time æ—¶é—´(ç§’)
     */
    public boolean expire(String key, long time) {
        try {
            if (time > 0) {
                redisTemplate.expire(key, time, TimeUnit.SECONDS);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´
     * @param key é”® ä¸èƒ½ä¸ºnull
     * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ
     */
    public long getExpire(String key) {
        return redisTemplate.getExpire(key, TimeUnit.SECONDS);
    }


    /**
     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
     * @param key é”®
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean hasKey(String key) {
        try {
            return redisTemplate.hasKey(key);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * åˆ é™¤ç¼“å­˜
     * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª
     */
    @SuppressWarnings("unchecked")
    public void del(String... key) {
        if (key != null && key.length > 0) {
            if (key.length == 1) {
                redisTemplate.delete(key[0]);
            } else {
                redisTemplate.delete((Collection<String>) CollectionUtils.arrayToList(key));
            }
        }
    }


    // ============================String=============================

    /**
     * æ™®é€šç¼“å­˜è·å–
     * @param key é”®
     * @return å€¼
     */
    public Object get(String key) {
        return key == null ? null : redisTemplate.opsForValue().get(key);
    }

    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥
     * @param key   é”®
     * @param value å€¼
     * @return trueæˆåŠŸ falseå¤±è´¥
     */

    public boolean set(String key, Object value) {
        try {
            redisTemplate.opsForValue().set(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ
     * @return trueæˆåŠŸ false å¤±è´¥
     */

    public boolean set(String key, Object value, long time) {
        try {
            if (time > 0) {
                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);
            } else {
                set(key, value);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * é€’å¢
     * @param key   é”®
     * @param delta è¦å¢åŠ å‡ (å¤§äº0)
     */
    public long incr(String key, long delta) {
        if (delta < 0) {
            throw new RuntimeException("é€’å¢å› å­å¿…é¡»å¤§äº0");
        }
        return redisTemplate.opsForValue().increment(key, delta);
    }


    /**
     * é€’å‡
     * @param key   é”®
     * @param delta è¦å‡å°‘å‡ (å°äº0)
     */
    public long decr(String key, long delta) {
        if (delta < 0) {
            throw new RuntimeException("é€’å‡å› å­å¿…é¡»å¤§äº0");
        }
        return redisTemplate.opsForValue().increment(key, -delta);
    }


    // ================================Map=================================

    /**
     * HashGet
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     */
    public Object hget(String key, String item) {
        return redisTemplate.opsForHash().get(key, item);
    }

    /**
     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼
     * @param key é”®
     * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼
     */
    public Map<Object, Object> hmget(String key) {
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * HashSet
     * @param key é”®
     * @param map å¯¹åº”å¤šä¸ªé”®å€¼
     */
    public boolean hmset(String key, Map<String, Object> map) {
        try {
            redisTemplate.opsForHash().putAll(key, map);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * HashSet å¹¶è®¾ç½®æ—¶é—´
     * @param key  é”®
     * @param map  å¯¹åº”å¤šä¸ªé”®å€¼
     * @param time æ—¶é—´(ç§’)
     * @return trueæˆåŠŸ falseå¤±è´¥
     */
    public boolean hmset(String key, Map<String, Object> map, long time) {
        try {
            redisTemplate.opsForHash().putAll(key, map);
            if (time > 0) {
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     *
     * @param key   é”®
     * @param item  é¡¹
     * @param value å€¼
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public boolean hset(String key, String item, Object value) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º
     *
     * @param key   é”®
     * @param item  é¡¹
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´
     * @return true æˆåŠŸ falseå¤±è´¥
     */
    public boolean hset(String key, String item, Object value, long time) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            if (time > 0) {
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * åˆ é™¤hashè¡¨ä¸­çš„å€¼
     *
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull
     */
    public void hdel(String key, Object... item) {
        redisTemplate.opsForHash().delete(key, item);
    }


    /**
     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼
     *
     * @param key  é”® ä¸èƒ½ä¸ºnull
     * @param item é¡¹ ä¸èƒ½ä¸ºnull
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean hHasKey(String key, String item) {
        return redisTemplate.opsForHash().hasKey(key, item);
    }


    /**
     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›
     *
     * @param key  é”®
     * @param item é¡¹
     * @param by   è¦å¢åŠ å‡ (å¤§äº0)
     */
    public double hincr(String key, String item, double by) {
        return redisTemplate.opsForHash().increment(key, item, by);
    }


    /**
     * hashé€’å‡
     *
     * @param key  é”®
     * @param item é¡¹
     * @param by   è¦å‡å°‘è®°(å°äº0)
     */
    public double hdecr(String key, String item, double by) {
        return redisTemplate.opsForHash().increment(key, item, -by);
    }


    // ============================set=============================

    /**
     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼
     * @param key é”®
     */
    public Set<Object> sGet(String key) {
        try {
            return redisTemplate.opsForSet().members(key);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨
     *
     * @param key   é”®
     * @param value å€¼
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public boolean sHasKey(String key, Object value) {
        try {
            return redisTemplate.opsForSet().isMember(key, value);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜
     *
     * @param key    é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public long sSet(String key, Object... values) {
        try {
            return redisTemplate.opsForSet().add(key, values);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜
     *
     * @param key    é”®
     * @param time   æ—¶é—´(ç§’)
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return æˆåŠŸä¸ªæ•°
     */
    public long sSetAndTime(String key, long time, Object... values) {
        try {
            Long count = redisTemplate.opsForSet().add(key, values);
            if (time > 0)
                expire(key, time);
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * è·å–setç¼“å­˜çš„é•¿åº¦
     *
     * @param key é”®
     */
    public long sGetSetSize(String key) {
        try {
            return redisTemplate.opsForSet().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * ç§»é™¤å€¼ä¸ºvalueçš„
     *
     * @param key    é”®
     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª
     * @return ç§»é™¤çš„ä¸ªæ•°
     */

    public long setRemove(String key, Object... values) {
        try {
            Long count = redisTemplate.opsForSet().remove(key, values);
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    // ===============================list=================================

    /**
     * è·å–listç¼“å­˜çš„å†…å®¹
     *
     * @param key   é”®
     * @param start å¼€å§‹
     * @param end   ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼
     */
    public List<Object> lGet(String key, long start, long end) {
        try {
            return redisTemplate.opsForList().range(key, start, end);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * è·å–listç¼“å­˜çš„é•¿åº¦
     *
     * @param key é”®
     */
    public long lGetListSize(String key) {
        try {
            return redisTemplate.opsForList().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼
     *
     * @param key   é”®
     * @param index ç´¢å¼• index>=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index<0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨
     */
    public Object lGetIndex(String key, long index) {
        try {
            return redisTemplate.opsForList().index(key, index);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     */
    public boolean lSet(String key, Object value) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’)
     */
    public boolean lSet(String key, Object value, long time) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            if (time > 0)
                expire(key, time);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     * @return
     */
    public boolean lSet(String key, List<Object> value) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }


    /**
     * å°†listæ”¾å…¥ç¼“å­˜
     *
     * @param key   é”®
     * @param value å€¼
     * @param time  æ—¶é—´(ç§’)
     * @return
     */
    public boolean lSet(String key, List<Object> value, long time) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            if (time > 0)
                expire(key, time);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®
     *
     * @param key   é”®
     * @param index ç´¢å¼•
     * @param value å€¼
     * @return
     */

    public boolean lUpdateIndex(String key, long index, Object value) {
        try {
            redisTemplate.opsForList().set(key, index, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }


    /**
     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue
     *
     * @param key   é”®
     * @param count ç§»é™¤å¤šå°‘ä¸ª
     * @param value å€¼
     * @return ç§»é™¤çš„ä¸ªæ•°
     */

    public long lRemove(String key, long count, Object value) {
        try {
            Long remove = redisTemplate.opsForList().remove(key, count, value);
            return remove;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }

    }

}
```

åœ¨éœ€è¦ä½¿ç”¨RedisUtilçš„åœ°æ–¹autowiredä¸€ä¸‹å°±å¥½

```java
@Autowired
private RedisUtil redisUtil;
```

åœ¨springbootæµ‹è¯•ç±»ä¸­@autowired redisUtilï¼ŒåŒæ—¶ç¼–å†™æµ‹è¯•æ–¹æ³•

```java
@Test
public void test1(){
    redisUtil.set("name","zhangyun");
    System.out.println(redisUtil.get("name"));
}
```

å¯åŠ¨æµ‹è¯•æ–¹æ³•ï¼ŒæˆåŠŸä½¿ç”¨è‡ªå·±å°è£…çš„RedisUtil.javaå®ç°Rediså­˜å–åŠŸèƒ½ã€‚

![image-20211014140552256](springboot.assets/image-20211014140552256.png)



**æ‰€æœ‰redisæ“ä½œï¼Œå¯¹äºjavaå¼€å‘äººå‘˜æ¥è¯´ååˆ†ç®€å•ã€‚ä½†æ˜¯æ›´é‡è¦çš„æ˜¯è¦å»ç†è§£redisçš„æ€æƒ³å’Œæ¯ä¸€ç§æ•°æ®ç»“æ„çš„ç”¨å¤„å’Œä½œç”¨åœºæ™¯ã€‚**



## åˆ†å¸ƒå¼Dubbo+ZooKeeper

- [dubboå®˜æ–¹æ¨èä½¿ç”¨zkä½œä¸ºdubboçš„æ³¨å†Œä¸­å¿ƒ](https://blog.csdn.net/sinat_33640788/article/details/79778506)

### åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º

#### ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ

- åœ¨ã€Šåˆ†å¸ƒå¼ç³»ç»ŸåŸç†ä¸èŒƒå‹ã€‹ä¸€ä¹¦ä¸­æœ‰å¦‚ä¸‹å®šä¹‰ï¼šâ€œåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯è‹¥å¹²ç‹¬ç«‹è®¡ç®—æœºçš„é›†åˆï¼Œè¿™äº›è®¡ç®—æœºå¯¹äºç”¨æˆ·æ¥è¯´å°±**åƒå•ä¸ªç›¸å…³ç³»ç»Ÿ**â€ï¼›

  ![image-20211014143431602](springboot.assets/image-20211014143431602.png)

- åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç”±ä¸€ç»„é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€ä¸ºäº†å®Œæˆå…±åŒçš„ä»»åŠ¡è€Œåè°ƒå·¥ä½œçš„è®¡ç®—æœºèŠ‚ç‚¹ç»„æˆçš„ç³»ç»Ÿã€‚

- åˆ†å¸ƒå¼ç³»ç»Ÿçš„å‡ºç°æ˜¯ä¸ºäº†ç”¨å»‰ä»·çš„ã€æ™®é€šçš„æœºå™¨å®Œæˆå•ä¸ªè®¡ç®—æœºæ— æ³•å®Œæˆçš„è®¡ç®—ã€å­˜å‚¨ä»»åŠ¡ã€‚å…¶ç›®çš„æ˜¯**åˆ©ç”¨æ›´å¤šçš„æœºå™¨ï¼Œå¤„ç†æ›´å¤šçš„æ•°æ®**ã€‚

- åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆdistributed systemï¼‰æ˜¯å»ºç«‹åœ¨ç½‘ç»œä¹‹ä¸Šçš„è½¯ä»¶ç³»ç»Ÿã€‚5Gä½¿ä¹‹æ›´easyã€‚

- é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œåªæœ‰å½“å•ä¸ªèŠ‚ç‚¹çš„å¤„ç†èƒ½åŠ›æ— æ³•æ»¡è¶³æ—¥ç›Šå¢é•¿çš„è®¡ç®—ã€å­˜å‚¨ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸”ç¡¬ä»¶çš„æå‡ï¼ˆåŠ å†…å­˜ã€åŠ ç£ç›˜ã€ä½¿ç”¨æ›´å¥½çš„CPUï¼‰é«˜æ˜‚åˆ°å¾—ä¸å¿å¤±çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰éœ€è¦è€ƒè™‘åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å› ä¸ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¦è§£å†³çš„é—®é¢˜æœ¬èº«å°±æ˜¯å’Œå•æœºç³»ç»Ÿä¸€æ ·çš„ï¼Œè€Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šèŠ‚ç‚¹ã€é€šè¿‡ç½‘ç»œé€šä¿¡çš„æ‹“æ‰‘ç»“æ„ï¼Œä¼šå¼•å…¥å¾ˆå¤šå•æœºç³»ç»Ÿæ²¡æœ‰çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜åˆä¼šå¼•å…¥æ›´å¤šçš„æœºåˆ¶ã€åè®®ï¼Œå¸¦æ¥æ›´å¤šçš„é—®é¢˜ã€‚ã€‚ã€‚**æ€»ä¹‹ä¸åº”è¯¥ç›²ç›®ç¬¬ä¸€é€‰æ‹©åˆ†å¸ƒå¼ç³»ç»Ÿã€‚**

  - åˆ†å¸ƒå¼ç³»ç»Ÿäº§ç”Ÿé—®é¢˜çš„æ¥æºï¼šç½‘ç»œä¸å¯é ã€‚
  - 20230522æˆ‘ï¼šè€Œä¸”ç½‘ç»œä¼ è¾“æ—¶æœ¬èº«å°±ä¼šæœ‰ç³»ç»Ÿæ¶ˆè€—å’Œæ—¶é—´æ¶ˆè€—ï¼Œæ‰€ä»¥å¯ä»¥å•ä½“è§£å†³çš„è¯å°±æ²¡å¿…è¦ä¸Šå¾®æœåŠ¡ã€‚

- ä¾‹å­ï¼šæ¯”å¦‚ç½‘è´­æ—¶ï¼Œç‚¹å‡»é¡µé¢çš„è¯·æ±‚å¤„ç†å ç”¨èµ„æºå°‘ï¼Œå‡ ä¸‡ä¸ªè¯·æ±‚å¯ä»¥ç»™ä¸€å°æœåŠ¡å™¨ä¸“é—¨å¤„ç†ï¼›ä½†æ˜¯æ”¯ä»˜æ—¶ç”±äºå„ç§æ ¡éªŒï¼Œå ç”¨èµ„æºå¤šï¼Œéœ€è¦ç»™æ”¯ä»˜æ¨¡å—åˆ†é…æ›´å¤šçš„æœåŠ¡å™¨ä¸“é—¨è´Ÿè´£æ”¯ä»˜ã€‚æ¨ªå‘å¼¹æ€§æ‰©å¢ç³»ç»Ÿã€‚



#### Dubboæ–‡æ¡£

éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™åº”ç”¨çš„è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œå¸¸è§„çš„å‚ç›´åº”ç”¨æ¶æ„å·²æ— æ³•åº”å¯¹ï¼Œåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä»¥åŠæµåŠ¨è®¡ç®—æ¶æ„åŠ¿åœ¨å¿…è¡Œï¼Œæ€¥éœ€**ä¸€ä¸ªæ²»ç†ç³»ç»Ÿ**ç¡®ä¿æ¶æ„æœ‰æ¡ä¸ç´Šçš„æ¼”è¿›ã€‚

åœ¨Dubboçš„å®˜ç½‘æ–‡æ¡£æœ‰è¿™æ ·ä¸€å¼ å›¾

![Image](springboot.assets/640.webp)



#### å•ä¸€åº”ç”¨æ¶æ„

å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚æ­¤æ—¶ï¼Œç”¨äºç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶(ORM)æ˜¯å…³é”®ã€‚

![Image](springboot.assets/640.webp)

é€‚ç”¨äºå°å‹ç½‘ç«™ï¼Œå°å‹ç®¡ç†ç³»ç»Ÿï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åˆ°ä¸€ä¸ªåŠŸèƒ½é‡Œï¼Œç®€å•æ˜“ç”¨ã€‚

ç¼ºç‚¹ï¼š

- æ€§èƒ½æ‰©å±•æ¯”è¾ƒéš¾

- ååŒå¼€å‘é—®é¢˜

- ä¸åˆ©äºå‡çº§ç»´æŠ¤



#### å‚ç›´åº”ç”¨æ¶æ„

å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„Webæ¡†æ¶(MVC)æ˜¯å…³é”®ã€‚

![Image](springboot.assets/640.webp)

é€šè¿‡åˆ‡åˆ†ä¸šåŠ¡æ¥å®ç°å„ä¸ªæ¨¡å—ç‹¬ç«‹éƒ¨ç½²ï¼Œé™ä½äº†ç»´æŠ¤å’Œéƒ¨ç½²çš„éš¾åº¦ï¼Œå›¢é˜Ÿå„å¸å…¶èŒæ›´æ˜“ç®¡ç†ï¼Œæ€§èƒ½æ‰©å±•ä¹Ÿæ›´æ–¹ä¾¿ï¼Œæ›´æœ‰é’ˆå¯¹æ€§ã€‚

ç¼ºç‚¹ï¼š

- å…¬ç”¨æ¨¡å—æ— æ³•é‡å¤åˆ©ç”¨ï¼Œå¼€å‘æ€§çš„æµªè´¹



#### åˆ†å¸ƒå¼æœåŠ¡æ¶æ„

å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„**åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶(RPC)**æ˜¯å…³é”®ã€‚

![Image](springboot.assets/640.webp)



#### æµåŠ¨è®¡ç®—æ¶æ„

å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äº**æé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ**(SOA)[ Service Oriented Architecture]æ˜¯å…³é”®ã€‚

![Image](springboot.assets/640.webp)



### ä»€ä¹ˆæ˜¯RPC

#### åˆ†å¸ƒå¼é€šä¿¡æ–¹å¼

åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸åŒæ¨¡å—è§çš„é€šä¿¡æœ‰ä¸¤ç§æ–¹å¼

- http
  - åŸºäºç½‘ç»œçš„ï¼Œæ— çŠ¶æ€çš„ï¼Œè´Ÿè´£é€šä¿¡çš„åè®®
- rpc
  - RPCã€Remote Procedure Callã€‘æ˜¯æŒ‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œä»–æ˜¯ä¸€ç§æŠ€æœ¯çš„æ€æƒ³ï¼Œè€Œä¸æ˜¯è§„èŒƒã€‚å®ƒå…è®¸ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼ˆé€šå¸¸æ˜¯å…±äº«ç½‘ç»œçš„å¦ä¸€å°æœºå™¨ä¸Šï¼‰çš„è¿‡ç¨‹æˆ–å‡½æ•°ï¼Œè€Œä¸ç”¨ç¨‹åºå‘˜æ˜¾å¼ç¼–ç è¿™ä¸ªè¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚ã€‚å³ç¨‹åºå‘˜æ— è®ºæ˜¯è°ƒç”¨æœ¬åœ°çš„è¿˜æ˜¯è¿œç¨‹çš„å‡½æ•°ï¼Œæœ¬è´¨ä¸Šç¼–å†™çš„è°ƒç”¨ä»£ç åŸºæœ¬ç›¸åŒã€‚
  - ä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆè¦ç”¨RPCå‘¢ï¼Ÿå°±æ˜¯æ— æ³•åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œç”šè‡³ä¸€ä¸ªè®¡ç®—æœºå†…é€šè¿‡æœ¬åœ°è°ƒç”¨çš„æ–¹å¼å®Œæˆçš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸åŒçš„ç³»ç»Ÿé—´çš„é€šè®¯ï¼Œç”šè‡³ä¸åŒçš„ç»„ç»‡é—´çš„é€šè®¯ï¼Œç”±äºè®¡ç®—èƒ½åŠ›éœ€è¦æ¨ªå‘æ‰©å±•ï¼Œéœ€è¦åœ¨å¤šå°æœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Šéƒ¨ç½²åº”ç”¨ã€‚**RPCå°±æ˜¯è¦åƒè°ƒç”¨æœ¬åœ°çš„å‡½æ•°ä¸€æ ·å»è°ƒè¿œç¨‹å‡½æ•°**



#### RPCåŸºæœ¬åŸç†

é€šè¿‡ç½‘ç»œè¿œç¨‹è°ƒç”¨ï¼š

![Image](springboot.assets/640.webp)

æ­¥éª¤è§£æï¼š

- æ³¨æ„è¦åºåˆ—åŒ–

![Image](springboot.assets/640.webp)



#### RPCä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—

RPCä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

- é€šè®¯
  - ä¸ºäº†ä¼ è¾“ã€‚
- åºåˆ—åŒ–
  - æ–¹ä¾¿æ•°æ®ä¼ è¾“ã€‚



#### Dubboå¼•å…¥

dubboä¸­é—´åœæ›´äº†äº”å¹´ï¼ŒæœŸé—´httpå’Œspringcloudå‡ºç°æ§åˆ¶äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¿¡æ¯ä¼ è¾“ã€‚

dubboé‡æ–°æ›´æ–°åï¼Œä¹Ÿä¸å¯èƒ½æ›¿ä»£springcloudã€‚å› ä¸ºdubboæ˜¯ä¸€ä¸ªä¸“æ³¨äºRPCçš„é€šä¿¡æ¡†æ¶ï¼Œè€ŒSpringCloudæ˜¯ä¸€ä¸ªç”Ÿæ€ã€‚



### Dubboå’ŒZooKeeperå®‰è£…

#### DubboåŸºæœ¬æ¦‚å¿µ

Apache Dubbo |ËˆdÊŒbÉ™ÊŠ| æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æºJava RPCæ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚



dubboå®˜ç½‘ http://dubbo.apache.org/zh-cn/index.html



è¦ç‚¹ï¼š

- äº†è§£Dubboçš„ç‰¹æ€§

- æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£



**Dubboç¤ºæ„å›¾**ï¼ˆéå¸¸é‡è¦ï¼ŒèƒŒä¸‹æ¥ï¼‰ï¼š

![Image](springboot.assets/640.webp)

å›¾ä¸­æˆåˆ†ä»‹ç»ï¼š

- æœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰ï¼š

  æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ï¼ŒæœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚

- æœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼š

  è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ï¼ŒæœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚

- æ³¨å†Œä¸­å¿ƒï¼ˆRegistryï¼‰ï¼š

  æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…

- ç›‘æ§ä¸­å¿ƒï¼ˆMonitorï¼‰ï¼š

  æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒ

è°ƒç”¨å…³ç³»è¯´æ˜ï¼š

- æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚

- æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚

- æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚

- æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚

- æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚

- æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚



#### ZooKeeperåŸºæœ¬æ¦‚å¿µ

Zoo+Keeperï¼šåŠ¨ç‰©å›­ç®¡ç†è€…ï¼Œç®¡ç†hadoopï¼ˆå¤§è±¡ï¼‰ï¼Œhiveï¼ˆèœœèœ‚ï¼‰ç­‰ã€‚



ZooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯Googleçš„Chubbyä¸€ä¸ªå¼€æºçš„å®ç°ï¼Œæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚

æ ¸å¿ƒï¼šä»–å°±æä¾›æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚



#### ZooKeeperå®‰è£…

[ç™»å½•zkå®˜æ–¹ä¸‹è½½åœ°å€](http://archive.apache.org/dist/zookeeper/zookeeper-3.4.14/)

tar.gzç»“å°¾çš„æ–‡ä»¶æ˜¯linuxä¸“ç”¨çš„ï¼Œä¸è¿‡windowsä¹Ÿå¯ä»¥ç”¨ã€‚

- æˆ‘è·Ÿéšæ•™ç¨‹ä¸‹è½½äº†è€ç‰ˆæœ¬ã€‚ä½†æ˜¯3.5.5å¼€å§‹ï¼Œå¸¦æœ‰binåç§°çš„åŒ…æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸‹è½½ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨çš„é‡Œé¢æœ‰ç¼–è¯‘åçš„äºŒè¿›åˆ¶çš„åŒ…ï¼Œè€Œä¹‹å‰çš„æ™®é€šçš„tar.gzçš„åŒ…é‡Œé¢æ˜¯åªæ˜¯æºç çš„åŒ…æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚

![image-20211015154948525](springboot.assets/image-20211015154948525.png)

å‚è€ƒä¸‹è€å¸ˆçš„ç”µè„‘ç›®å½•ç»“æ„ï¼Œå’Œzkå®‰è£…ä½ç½®

![image-20211015155540134](springboot.assets/image-20211015155540134.png)

![image-20211015155511343](springboot.assets/image-20211015155511343.png)

åœ¨è‡ªå·±çš„ç”µè„‘ç›¸åº”ä½ç½®è§£å‹

![image-20211015155820976](springboot.assets/image-20211015155820976.png)

è¿›å…¥binæ–‡ä»¶å¤¹ï¼Œå…ˆç‚¹å‡»â€zkServer.cmdâ€œç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¼€å¯æœåŠ¡ç«¯

- å³é”®zkServer.cmdæ–‡ä»¶æœ‰ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„é€‰é¡¹

- å¦‚æœç¢°è§é—ªé€€é—®é¢˜ï¼ŒæŒ‰ä¸‹é¢æ–¹å¼å°è¯•

  1. åœ¨zkServer.cmdä¸­åŠ ä¸Špauseï¼Œä¿å­˜ï¼Œè¿™æ ·åœ¨é—ªé€€çš„æ—¶å€™å¯ä»¥çœ‹åˆ°é”™è¯¯çš„æ˜ç¡®ä¿¡æ¯

     ![image-20211015160406951](springboot.assets/image-20211015160406951.png)

  2. å†æ¬¡è¿è¡Œâ€zkServer.cmdâ€œï¼Œè¿™æ˜¯çœ‹åˆ°é”™è¯¯æ˜¯ï¼šconfæ–‡ä»¶å¤¹ä¸­ç¼ºå°‘â€zoo.cfgâ€œæ–‡ä»¶

     ![image-20211015160544895](springboot.assets/image-20211015160544895.png)

  3. æ¥åˆ°confæ–‡ä»¶å¤¹ï¼ŒæŠŠâ€œzoo_sample.cfgâ€å¤åˆ¶ä¸€ä»½ï¼Œå¹¶æŠŠå¤åˆ¶æ–‡ä»¶æ”¹åä¸ºâ€œzoo.cfgâ€œ

     - åŒæ—¶æ³¨æ„zkçš„å®¢æˆ·ç«¯çš„é»˜è®¤clientPortï¼ˆzkå®¢æˆ·ç«¯ç«¯å£å·ï¼‰æ˜¯2181ï¼Œå¯ä»¥åœ¨zoo.cfgä¸­ä¿®æ”¹ç«¯å£å·ä¸ºåˆ«çš„å·ã€‚

     ![image-20211015160739103](springboot.assets/image-20211015160739103.png)

     ![image-20211015160846550](springboot.assets/image-20211015160846550.png)

  4. é‡æ–°ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€zkServer.cmdâ€œã€‚å¯åŠ¨æˆåŠŸï¼Œå³ä½¿æ­¤æ—¶â€zkServer.cmdâ€œä¸­æ·»åŠ çš„pauseæ²¡æœ‰åˆ é™¤ã€‚

     ![image-20211015161356709](springboot.assets/image-20211015161356709.png)

å›åˆ°æ­£è½¨,å¯åŠ¨å¥½æœåŠ¡åï¼Œä¸è¦å…³é—­cmdæ¡†ï¼Œå…³é—­çš„è¯æœåŠ¡å°±åœäº†ã€‚

ç°åœ¨å¼€å¯å®¢æˆ·ç«¯ï¼Œç®¡ç†å‘˜èº«ä»½è¿è¡Œbin/zkCli.cmdï¼Œçœ‹å®¢æˆ·ç«¯èƒ½å¦æˆåŠŸè¿æ¥zkæœåŠ¡ç«¯ã€‚å®¢æˆ·ç«¯æ˜¾ç¤º0å·ç”¨æˆ·è¿æ¥ä¸Šäº†ï¼ŒæˆåŠŸã€‚

- æœ¬ä¾‹ä¸­zkå®¢æˆ·ç«¯å’ŒzkæœåŠ¡ç«¯éƒ½åœ¨æœ¬æœº

![image-20211015163728478](springboot.assets/image-20211015163728478.png)

è¿æ¥æˆåŠŸåï¼Œç”¨`ls /`(æ³¨æ„så’Œ/é—´æœ‰ç©ºæ ¼)å‘½ä»¤çœ‹ä¸€ä¸‹zkä¸­æœ‰å‡ ä¸ªèŠ‚ç‚¹ã€‚æŸ¥çœ‹åˆ°å½“å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å«â€œzookeeperâ€ã€‚

![image-20211015165325955](springboot.assets/image-20211015165325955.png)

å°è¯•åˆ›å»ºä¸€ä¸ªzkèŠ‚ç‚¹ï¼š`create -e /zhangyun 123`ã€‚â€œzhangyunâ€æ˜¯èŠ‚ç‚¹çš„åç§°ï¼Œâ€œ123â€æ˜¯èŠ‚ç‚¹é‡Œçš„å€¼ã€‚

![image-20211015164508759](springboot.assets/image-20211015164508759.png)

å†æ¬¡æŸ¥çœ‹ä¸€ä¸‹zkèŠ‚ç‚¹æ•°ã€‚è¿™æ—¶å€™æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ã€‚

![image-20211015164714153](springboot.assets/image-20211015164714153.png)

å¯ä»¥ä»zkèŠ‚ç‚¹ä¸­å–å€¼ï¼Œæ¯”å¦‚ï¼š`get /zhangyun`ã€‚è¿™å°±å®ç°äº†åœ¨zkä¸­å­˜å€¼å–å€¼ã€‚

![image-20211015164840606](springboot.assets/image-20211015164840606.png)

ä¹Ÿå¯ä»¥åˆ é™¤èŠ‚ç‚¹ï¼š`delete /zhangyun`ã€‚åˆ é™¤æ·»åŠ çš„èŠ‚ç‚¹åå†æŸ¥çœ‹ä¸€ä¸‹èŠ‚ç‚¹ï¼Œåªå‰©ä¸‹åˆå§‹çš„â€œzookeeperâ€äº†ï¼Œè¯´æ˜åˆ é™¤æˆåŠŸã€‚

![image-20211015165150485](springboot.assets/image-20211015165150485.png)



#### dubboå®‰è£…

dubboæ‰˜ç®¡åœ¨githubä¸Šï¼Œ[è®¿é—®githubçš„dubboé¡¹ç›®](https://github.com/apache/dubbo-admin/tree/master)

- æ¨èä½¿ç”¨masteråˆ†æ”¯ï¼Œç‰ˆæœ¬ç¨³å®šç‚¹

![image-20211015170226180](springboot.assets/image-20211015170226180.png)

ä¸‹è½½åè§£å‹åœ¨è‡ªå·±åå¥½çš„ä½ç½®ã€‚ç‚¹å¼€é¡¹ç›®å¯ä»¥çœ‹åˆ°pom.xmlï¼Œè¯´æ˜å®ƒæ˜¯ä¸€ä¸ªmavené¡¹ç›®ã€‚

![image-20211015170435463](springboot.assets/image-20211015170435463.png)

åœ¨dubboçš„application.propertiesæ–‡ä»¶ä¸­æŸ¥çœ‹é…ç½®æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œç¡®è®¤åœ°å€ä¸ºzkçš„åœ°å€ï¼ˆå°¤å…¶ç«¯å£å·ï¼‰ã€‚

- æœ€æ–°çš„dubboé¡¹ç›®ä¸­æœ‰å¤šä¸ªå­moduleï¼Œè¿™é‡Œå°±æ¼”ç¤ºå­moduleâ€œdubbo-admin-testâ€çš„æŸ¥çœ‹

  ![image-20211015171232730](springboot.assets/image-20211015171232730.png)

![image-20211015171010818](springboot.assets/image-20211015171010818.png)

![image-20211015171059553](springboot.assets/image-20211015171059553.png)

**dubbo-adminæœ€å¥½ä¿®æ”¹è‡ªå·±çš„è®¿é—®åœ°å€ä¸º7001**ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„8080ï¼Œè¿™æ ·çœçš„ç«¯å£è¢«å ç”¨

- æŸ¥çœ‹ç«¯å£è¢«å ç”¨çš„æ–¹æ³•ï¼šhttps://www.runoob.com/w3cnote/windows-finds-port-usage.html
- ä¿®æ”¹dubboå’Œzkç«¯å£å·çš„é—®é¢˜ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼šhttps://www.cnblogs.com/timingstarts/p/12604211.htmlã€‚å…·ä½“ç«¯å£å·ä¿®æ”¹ä»¥ç‹‚ç¥è€å¸ˆçš„ä¸ºå‡†ï¼Œè¿™å—æˆ‘æ¼å¬äº†ï¼Ÿï¼Ÿï¼Ÿ

æŸ¥çœ‹åœ°å€æ— è¯¯åï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰“åŒ…dubbo-admin

```
mvn clean package -Dmaven.test.skip=true
```

![image-20211015171558581](springboot.assets/image-20211015171558581.png)

- å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œæ˜¯å› ä¸ºä¹‹å‰ideaç”¨è‡ªå¸¦çš„mavenï¼Œè€Œwindowsç¯å¢ƒå˜é‡ä¸­æ²¡æœ‰é…ç½®ideaè‡ªå¸¦çš„maven

  ![image-20211015171933036](springboot.assets/image-20211015171933036.png)

  è§£å†³æ–¹æ³•ï¼š

  1. å› ä¸ºæœ¬æœºä½¿ç”¨çš„æ˜¯ideaè‡ªå¸¦çš„mavenï¼Œé¦–å…ˆæ‰¾åˆ°ideaè‡ªå¸¦mavençš„ä½ç½®ï¼š**ideaå®‰è£…ç›®å½•\plugins\maven\lib\maven3**

  2. å•å‡»â€œè®¡ç®—æœº-å±æ€§-é«˜çº§ç³»ç»Ÿè®¾ç½®â€ï¼Œå•å‡»â€œç¯å¢ƒå˜é‡â€

     - â€ç¯å¢ƒå˜é‡â€œä¸­ç‚¹â€œæ–°å»ºâ€->å˜é‡å"**MAVEN_HOME**"ï¼Œå˜é‡å€¼"**ideaå®‰è£…ç›®å½•\plugins\maven\lib\maven3**"ï¼ˆå³ideaè‡ªå¸¦MAVENçš„è·¯å¾„ï¼‰
     -  â€ç¯å¢ƒå˜é‡â€œä¸­ç‚¹â€œç¼–è¾‘â€->å˜é‡å"**Path**"ï¼Œåœ¨åŸå˜é‡å€¼çš„æœ€åé¢åŠ ä¸Šâ€œ**;%MAVEN_HOME%\bin**â€ï¼ˆæœ€å¼€å§‹çš„å†’å·win10ä¸­å¯ä»¥ä¸åŠ ï¼‰

  3. cmd-ã€‹`mvn -version`.èƒ½æ‰“å°mavenä¿¡æ¯åˆ™åœ¨ç¯å¢ƒå˜é‡ä¸­æ³¨å†Œideaè‡ªå¸¦mavenæˆåŠŸã€‚

     ![image-20211015210223551](springboot.assets/image-20211015210223551.png)

  

åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®å¥½mavenåï¼Œå›å½’æ­£è½¨ã€‚é‡æ–°åœ¨dubboç›®å½•cmdæ‰§è¡Œmvn clean package -Dmaven.test.skip=trueã€‚åˆåœ¨å¦‚ä¸‹å‘½ä»¤å‘ç”Ÿæ—¶å¡ä½ï¼š

```
[INFO] Downloading https://nodejs.org/dist/v9.11.1/node-v9.11.1-win-x64.zip to F:\Maven\repository\com\github\eirslett\node\9.11.1\node-9.11.1-win-x64.zip
[INFO] No proxies configured
[INFO] No proxy was configured, downloading directly
```

è§£å†³æ–¹æ¡ˆï¼š

1. å‚è€ƒ[ç½‘ä¸Šè§£å†³æ–¹æ¡ˆ](https://blog.csdn.net/dataiyangu/article/details/105640224)ã€‚æˆ‘ç§‘å­¦ä¸Šç½‘åä¸‹è½½çš„node-9.11.1-win-x64.zipæ”¾å…¥XXX\Maven\repository\com\github\eirslett\node\9.11.1åï¼Œæ§åˆ¶å°å¹¶æ²¡ç»§ç»­å¼€åŠ¨ã€‚
2. äºæ˜¯æˆ‘å…³é—­æ§åˆ¶å°ï¼Œé‡æ–°cmdè¿›å…¥å¹¶å†æ¬¡æ‰§è¡Œå‘½ä»¤mvn clean package -Dmaven.test.skip=trueã€‚è¿™æ¬¡æ‰“åŒ…æµç•…ï¼Œæœ€åæˆåŠŸå®Œæˆï¼Œ

æ’æŸ¥å®Œé”™è¯¯å¹¶æ‰“åŒ…å®Œæˆï¼Œæ§åˆ¶å°å±•ç¤ºå¦‚ä¸‹ï¼š

![image-20211015212335220](springboot.assets/image-20211015212335220.png)

ä¸‹å›¾çº¢æ¡†ä¸­æ¯ä¸ªæ–‡ä»¶å¤¹å†…éƒ½æ–°å¢äº†ä¸€ä¸ªtargetæ–‡ä»¶å¤¹ï¼Œä»¥dubbo-admin-testä¸ºä¾‹æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œå¯ä»¥çœ‹åˆ°åˆšé€šè¿‡mavenå‘½ä»¤æ‰“çš„jaråŒ…ã€‚

![image-20211015213146837](springboot.assets/image-20211015213146837.png)

![image-20211015213304478](springboot.assets/image-20211015213304478.png)

å…³äºå½“å‰æ–°ç‰ˆdubboä¸‹é¢æœ‰å››ä¸ªdubbo-admin-XXXçš„é—®é¢˜ï¼Œè¿™é‡Œæœç´¢ç ”ç©¶ä¸€ä¸‹ï¼š

1. [å‚è€ƒé“¾æ¥](https://blog.csdn.net/zhanggonglalala/article/details/88831049)ï¼Œé“¾æ¥ä¸­é€‰æ‹©ä½¿ç”¨/dubbo-admin-distributionæ¥æ‰“jaråŒ…ï¼Œä½†æˆ‘æ‰“åŒ…çš„æ—¶å€™æ˜¯åœ¨çˆ¶ç›®å½•æ‰“çš„ï¼Œæ‰€ä»¥å››ä¸ªdubbo-admin-XXXä¸‹éƒ½æœ‰jaråŒ…

2. æ•…æˆ‘æŸ¥çœ‹dubbo-admin-master\dubbo-admin-distribution\targetï¼Œç«Ÿç„¶é™¤äº†æœ¬dubbo-admin-distributionå¯¹åº”çš„jaråŒ…dubbo-admin-distribution-0.3.0.jarï¼Œè¿˜æœ‰ä¸€ä¸ªjaråŒ…`dubbo-admin-0.3.0.jar`ã€‚

3. dubbo-admin-0.3.0.jaråº”è¯¥å°±æ˜¯ç½‘è¯¾é‡Œæ—§ç‰ˆæœ¬æ‰“åŒ…å½¢æˆçš„é‚£ç§jaråŒ…ï¼Œå› ä¸ºä»–æ²¡æœ‰åƒuiæˆ–distributionçš„åç¼€ã€‚è€Œä¸”dubbo-admin-0.3.0.jarçš„å¤§å°ä¹Ÿæ˜¯å…¶ä»–jaråŒ…çš„å‡ ç™¾å€å¤§ã€‚

   ![image-20211015214812207](springboot.assets/image-20211015214812207.png)

æ‹¿åˆ°äº†ç›®æ ‡dubboçš„jaråŒ…ï¼Œç°åœ¨æ¥æ‰§è¡Œä¸€ä¸‹è¯¥jaråŒ…

![image-20211015215033568](springboot.assets/image-20211015215033568.png)

![image-20211015215600647](springboot.assets/image-20211015215600647.png)

å‡ºç°é”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰å¼€å¯**zkServer.cmd**

![image-20211015215638352](springboot.assets/image-20211015215638352.png)

å…ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ**zkServer.cmd**

![image-20211015215927447](springboot.assets/image-20211015215927447.png)

å†æ¬¡è¿è¡Œdubbo-admin-0.3.0.jar

![image-20211015220358697](springboot.assets/image-20211015220358697.png)

æŸ¥çœ‹zkServer.cmdçš„å†…å®¹ï¼Œå¼¹å‡ºäº†å¾ˆå¤šæ–°å†…å®¹ã€‚å…¶ä¸­å¯ä»¥çœ‹åˆ°binding to 2181ã€‚è¯´æ˜dubboå’Œzkç»‘å®šæˆåŠŸã€‚

![image-20211015220447768](springboot.assets/image-20211015220447768.png)

ç»‘å®šæˆåŠŸåå°è¯•è®¿é—®dubboé¡µé¢ï¼Œæµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8080/ã€‚æˆåŠŸè¿›å…¥é¡µé¢ã€‚

- é»˜è®¤ç”¨æˆ·å-å¯†ç ï¼šroot-root

![image-20211015221243475](springboot.assets/image-20211015221243475.png)

![image-20211015221324518](springboot.assets/image-20211015221324518.png)



äº‹åæ€»ç»“ï¼š

- dubbo-adminï¼š

  dubbo-adminæ˜¯ä¸€ä¸ª**ç›‘æ§**ç®¡ç†åå°ï¼Œä»–å¯ä»¥**æŸ¥çœ‹**æˆ‘ä»¬æ³¨å†Œäº†å“ªäº›æœåŠ¡ï¼Œå“ªäº›æœåŠ¡è¢«æ¶ˆè´¹äº†ã€‚ä»–åœ¨å¼€å‘ä¸­å¯ä»¥ä¸ä½¿ç”¨ï¼Œå› ä¸ºä»–ä¸å½±å“æˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œåªæ˜¯è¾…åŠ©å¼€å‘ç®¡ç†ã€‚

  - 20230522æˆ‘ï¼š[å‚è€ƒ](https://developer.aliyun.com/article/819875)ï¼Œdubbo æ¡†æ¶æä¾›äº†æå…¶ä¸°å¯Œçš„æœåŠ¡æ²»ç†çš„åŠŸèƒ½å¦‚æµé‡æ§åˆ¶ã€åŠ¨æ€é…ç½®ã€æœåŠ¡ Mockã€æœåŠ¡æµ‹è¯•ç­‰åŠŸèƒ½ï¼Œè€Œ **dubbo-admin çš„ä½œç”¨åœ¨äºå°† dubbo æ¡†æ¶æä¾›çš„æœåŠ¡æ²»ç†èƒ½åŠ›æä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨çš„å¹³å°**ã€‚æ‰€ä»¥åº”è¯¥æ˜¯dubboadminåŒ…å«äº†dubboçš„åŠŸèƒ½ï¼Œå¹¶é™„å¸¦äº†ç›‘ç®¡çš„åŠŸèƒ½ã€‚
  - 20220522æˆ‘ï¼šå‚åŠ æœ¬æ–‡æ¡£åé¢çš„â€œæœåŠ¡æ³¨å†Œå‘ç°å®æˆ˜â€ï¼Œé¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„æ—¶å€™æ²¡æœ‰ä¸‹è½½dubboadminï¼Œè€Œæ˜¯åœ¨springbooté¡¹ç›®çš„pomä¸­å¯¼å…¥zkå’Œdubboçš„ä¾èµ–ï¼›ç„¶åå°±å¯ä»¥ä½¿ç”¨dubboå»åšè¿œç¨‹æœåŠ¡è°ƒç”¨äº†ã€‚

- zookeeperï¼š

  zookeeperæ˜¯æ³¨å†Œä¸­å¿ƒï¼Œ**å¿…é¡»è¦**ã€‚

- dubboï¼š

  dubboæ˜¯jaråŒ…ï¼Œå…¶å¯é€šè¿‡é«˜æ€§èƒ½çš„ RPC å®ç°æœåŠ¡çš„è¾“å‡ºå’Œè¾“å…¥åŠŸèƒ½



### æœåŠ¡æ³¨å†Œå‘ç°å®æˆ˜

https://www.bilibili.com/video/BV1PE411i7CV?p=60&spm_id_from=pageDriver

å®æˆ˜ï¼š

ç”±äºä»æ¥æ²¡æœ‰åˆ›å»ºè¿‡empty projectï¼Œè€å¸ˆå¸¦ç€åˆ›å»ºä¸€ä¸ªempty projecté¡¹ç›®ã€‚

- å†™ç©ºé¡¹ç›®çš„è¯å¯ä»¥åœ¨é‡Œé¢æ„é€ ä»»ä½•ä¸œè¥¿ã€‚

![image-20211016100849911](springboot.assets/image-20211016100849911.png)

å»ºç«‹ç©ºé¡¹ç›®åï¼Œideaè‡ªåŠ¨å¼¹å‡ºproject Structureè®©äººé€‰æ‹©å¥½jdkã€‚

![image-20211016101024346](springboot.assets/image-20211016101024346.png)

æ–°å»ºä¸€ä¸ªmoduleï¼Œmoduleå¯ä»¥ç”¨mavenæˆ–è€…spring initåˆå§‹åŒ–ï¼Œè¿™é‡Œé€‰æ‹©spring init

![image-20211016101259742](springboot.assets/image-20211016101259742.png)

**è¿™é‡Œçš„packagenameè¦åˆ æ‰providerserver**ï¼Œä½¿å¾—providerå’Œconsumerçš„é¡¹ç›®è·¯å¾„ä¸€è‡´ï¼Œéƒ½ä¸ºcom.zhangyun

![image-20211016101454664](springboot.assets/image-20211016101454664.png)

ä¸€èˆ¬éƒ½ä¼šå‹¾é€‰webæ¨¡å—ï¼Œå…¶ä»–è¦çš„è¯ï¼Œå†åŠ å°±å¯ä»¥äº†ã€‚

![image-20211016101539560](springboot.assets/image-20211016101539560.png)

åˆ æ‰provider-serverå­moduleä¸­å¤šä½™çš„æ–‡ä»¶

![image-20211016101619440](springboot.assets/image-20211016101619440.png)

ç¼–å†™serviceå±‚çš„æ¥å£å’Œå®ç°ç±»ã€‚

- **æ³¨æ„**ï¼šè¢«æ³¨å†Œçš„beanä¸Šç”¨äºæ‰«æå’Œæ³¨å†ŒæœåŠ¡çš„æ³¨è§£â€œ@Serviceâ€æ˜¯dubboçš„ï¼Œä¸æ˜¯springbootçš„ã€‚è€Œä¸”æœ€æ–°çš„dubboä¹ŸæŠŠæ³¨è§£æ”¹åä¸º@DubboServiceäº†ã€‚

```java
package com.zhangyun.service;

public interface TicketService {
    public String getTicket();
}
```

```java
package com.zhangyun.service;

import org.apache.dubbo.config.annotation.Service;
import org.springframework.stereotype.Component;

//zookeeperï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°

/*
* ä½¿ç”¨dubboåå°½é‡ä¸è¦ç”¨springè‡ªå¸¦çš„@Serviceæ³¨è§£ï¼Œå› ä¸ºdubboè‡ªå·±ä¹Ÿæœ‰ä¸€ä¸ªserviceæ³¨è§£ç”¨äºdubboæ‰«æï¼Œå®¹æ˜“å¼„æ··ï¼Œä¸å¦‚ç”¨ä¸‡èƒ½çš„Componentæ³¨è§£
* */
@Component
/*
* åŠ äº†dubboçš„@Serviceåï¼Œç±»å¯ä»¥è¢«dubboæ‰«æåˆ°å¹¶å¾€zkæ³¨å†Œï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±è‡ªåŠ¨æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚
* */
@Service
public class TicketServiceImpl implements TicketService{

    @Override
    public String getTicket() {
        return "å¼ äº‘å­¦java";
    }
}
```

å†æ–°å»ºä¸€ä¸ªmoduleï¼Œåšä¸ºå®¢æˆ·ç«¯.

**è¿™é‡Œçš„packagenameè¦åˆ æ‰consumerserver**ï¼Œä½¿å¾—providerå’Œconsumerçš„é¡¹ç›®è·¯å¾„ä¸€è‡´ï¼Œéƒ½ä¸ºcom.zhangyun

![image-20211016102520306](springboot.assets/image-20211016102520306.png)

![image-20211016102536793](springboot.assets/image-20211016102536793.png)

æ¸…é™¤consumer-serverå­moduleä¸­å¤šä½™çš„æ–‡ä»¶

![image-20211016102700020](springboot.assets/image-20211016102700020.png)

ç°åœ¨consumer-serverå’Œprovider-serveræ˜¯ä¸¤ä¸ªapplicationï¼Œä¸åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ€ä¹ˆèƒ½è®©ä»–ä»¬æ²Ÿé€šå‘¢ï¼Ÿ

- é€šè¿‡httpæˆ–RPC

  

å› ä¸ºæ˜¯å­moduleæ˜¯webï¼Œä¼šå ç”¨é»˜è®¤ç«¯å£å·8080ã€‚ä¸ºäº†é˜²æ­¢8080ç«¯å£ï¼ˆå·²åˆ†é…ç»™dubbo-adminï¼‰è¢«äº‰æŠ¢ï¼Œé…ç½®consumer-serveré¡¹ç›®çš„ç«¯å£

```properties
server.port=8081
```

é…ç½®provider-serveré¡¹ç›®çš„ç«¯å£

```properties
server.port=8082
```

provider-serverè¦æ‰¾åˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥è¦å¯¼å…¥dubboï¼ˆå’Œspringbootç›¸å…³çš„dubboï¼‰å’Œzkclient(githubä¸‹çš„åŒ…)çš„ä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter -->
<dependency>
    <groupId>org.apache.dubbo</groupId>
    <artifactId>dubbo-spring-boot-starter</artifactId>
    <version>2.7.3</version>
</dependency>
<!-- https://mvnrepository.com/artifact/com.github.sgroschupf/zkclient -->
<dependency>
    <groupId>com.github.sgroschupf</groupId>
    <artifactId>zkclient</artifactId>
    <version>0.1</version>
</dependency>

```

æ–°ç‰ˆï¼ˆ2021å¹´ï¼‰å¯¼å…¥zkåå¯èƒ½ä¼šæœ‰å„ç§é—®é¢˜ï¼š

- zookeeperåŠå…¶ä¾èµ–åŒ…å¯¼è‡´çš„é”™è¯¯

  ```
  java.lang.NoClassDefFoundError: org/apache/curator/framework/CuratorFrameworkFactory
  ```

  éœ€è¦å¯¼å…¥zookeeperåŠå…¶ä¾èµ–åŒ…

- zkå’Œspringbootæ—¥å¿—å†²çªå¯¼è‡´é”™è¯¯

  ```
  Correct the classpath of your application so that it contains a single, compatible version of org.apache.zookeeper.ZooKeeper
  ```

  æ—¥å¿—å†²çªï¼Œéœ€è¦ä»pomä¸­å‰”é™¤æ—¥å¿—ä¾èµ–ã€‚

- è§£å†³æ–¹æ¡ˆï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š

	```xml
	<!-- å¼•å…¥zookeeper -->
	<dependency>
   <groupId>org.apache.curator</groupId>
   <artifactId>curator-framework</artifactId>
   <version>2.12.0</version>
	</dependency>
	<dependency>
   <groupId>org.apache.curator</groupId>
   <artifactId>curator-recipes</artifactId>
   <version>2.12.0</version>
	</dependency>
	<dependency>
   <groupId>org.apache.zookeeper</groupId>
   <artifactId>zookeeper</artifactId>
   <version>3.4.14</version>
   <!--æ’é™¤è¿™ä¸ªslf4j-log4j12-->
   <exclusions>
       <exclusion>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-log4j12</artifactId>
       </exclusion>
   </exclusions>
	</dependency>
	```

provider-serverçš„application.propertiesä¸­æ·»åŠ åšæœåŠ¡æ³¨å†Œç›¸å…³çš„é…ç½®

```properties
# æœåŠ¡åº”ç”¨çš„åå­—
dubbo.application.name=provider-server
# æ³¨å†Œä¸­å¿ƒåœ°å€ã€‚åœ°å€å¯ä»¥å†™localhostï¼Œä¸è¿‡ä¸€èˆ¬å†™æœ¬æœºçš„ipåœ°å€ã€‚å®é™…å¼€å‘æ—¶åœ°å€å¯ä»¥ä¸ºä»»ä½•ç”µè„‘ã€‚
dubbo.registry.address=zookeeper://127.0.0.1:2181
# å“ªäº›æœåŠ¡è¦è¢«æ³¨å†Œ
dubbo.scan.base-packages=com.zhangyun.service
```

ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒzkServer.cmd

![image-20211016121040953](springboot.assets/image-20211016121040953.png)

å¯åŠ¨ProviderServerApplication.javaï¼Œå¹¶è®¿é—®localhost:8080ã€‚æˆåŠŸæ‰¾åˆ°è‡ªå·±æ³¨å†Œçš„æ¥å£ã€‚

![image-20211016121831176](springboot.assets/image-20211016121831176.png)

![image-20211016121250170](springboot.assets/image-20211016121250170.png)

![image-20211016121345399](springboot.assets/image-20211016121345399.png)

ç°åœ¨å¤„ç†æœåŠ¡æ¶ˆè´¹è€…

åœ¨consumer-serverä¸­å¯¼å…¥ä¾èµ–ï¼Œå¯¼å…¥çš„å’Œprovider-serverä¸€æ ·

```xml
<!--dubbo-->
<!-- Dubbo Spring Boot Starter -->
<dependency>
   <groupId>org.apache.dubbo</groupId>
   <artifactId>dubbo-spring-boot-starter</artifactId>
   <version>2.7.3</version>
</dependency>
<!--zookeeper-->
<!-- https://mvnrepository.com/artifact/com.github.sgroschupf/zkclient -->
<dependency>
   <groupId>com.github.sgroschupf</groupId>
   <artifactId>zkclient</artifactId>
   <version>0.1</version>
</dependency>
<!-- å¼•å…¥zookeeper -->
<dependency>
   <groupId>org.apache.curator</groupId>
   <artifactId>curator-framework</artifactId>
   <version>2.12.0</version>
</dependency>
<dependency>
   <groupId>org.apache.curator</groupId>
   <artifactId>curator-recipes</artifactId>
   <version>2.12.0</version>
</dependency>
<dependency>
   <groupId>org.apache.zookeeper</groupId>
   <artifactId>zookeeper</artifactId>
   <version>3.4.14</version>
   <!--æ’é™¤è¿™ä¸ªslf4j-log4j12-->
   <exclusions>
       <exclusion>
           <groupId>org.slf4j</groupId>
           <artifactId>slf4j-log4j12</artifactId>
       </exclusion>
   </exclusions>
</dependency>
```

consumer-serverå­moduleçš„application.propertiesä¸­é…ç½®æ¶ˆè´¹è€…çš„æœåŠ¡æ‹¿å–ç›¸å…³äº‹å®œã€‚

```properties
# æ¶ˆè´¹è€…å»å“ªé‡Œæ‹¿æœåŠ¡éœ€è¦æš´éœ²è‡ªå·±çš„åå­—
dubbo.application.name=consumer-server
# æ³¨å†Œä¸­å¿ƒçš„åœ°å€ã€‚å®é™…å¼€å‘æ—¶åœ°å€å¯ä»¥ä¸ºä»»ä½•ç”µè„‘ã€‚
dubbo.registry.address=zookeeper://127.0.0.1:2181
```

ç¼–å†™æ¶ˆè´¹è€…çš„serviceå±‚ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯æ¥å£+implçš„æ ¼å¼

```java
package com.zhangyun.service;

import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

//æœ€å¥½ç”¨componentï¼Œé˜²æ­¢å’Œdubboçš„serviceæ³¨è§£æ··æ·†
@Service
//æ¥å£ä¸èƒ½è¢«æ”¾å…¥å®¹å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå¾—æ˜¯class
public class UserService {
    //æƒ³æ‹¿åˆ°provideræä¾›çš„ç¥¨,è¦å»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°æœåŠ¡

    /*
    * dubboåŒ…ä¸‹çš„@Referenceå®ç°è¿œç¨‹å¼•ç”¨çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½ç±»ä¼¼åŸæ¥çš„@Autowired.
    *
    * è¿œæ–¹çš„TicketServiceæ— æ³•æ‰¾åˆ°ï¼Œé‚£å°±åœ¨æœ¬åœ°å®šä¹‰è·¯å¾„ç›¸åŒçš„æ¥å£åï¼ŒæœåŠ¡ä¸éœ€è¦ç›¸åŒã€‚
    * æ•…æŠŠprovider-serviceä¸­çš„TicketService.javaæ‹·è´åˆ°consumer-serverä¸­
    * */
    @Reference
    TicketService ticketService;

    public void buyTicket(){
        String ticket=ticketService.getTicket();
        System.out.println("åœ¨æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°=ã€‹"+ticket);
    }


}
```

UserService.javaä¸­è¿œæ–¹çš„TicketServiceæ— æ³•æ‰¾åˆ°ï¼Œé‚£å°±åœ¨æœ¬åœ°å®šä¹‰é¡¹ç›®è·¯å¾„ç›¸åŒçš„æ¥å£åï¼ŒæœåŠ¡ä¸éœ€è¦ç›¸åŒã€‚æ•…æŠŠprovider-serviceä¸­çš„TicketService.javaæ‹·è´åˆ°consumer-serverä¸­ã€‚

- **æ³¨æ„**ï¼šè·¯å¾„ç›¸åŒæ˜¯ä»com.zhangyunå¼€å§‹å°±å¾—ç›¸åŒã€‚æœ€å¼€å§‹é¡¹ç›®è·¯å¾„ä¸€ä¸ªæ˜¯com.zhangyun.providerserverï¼Œä¸€ä¸ªæ˜¯com.zhangyun.consumerserverå¯¼è‡´æŠ¥é”™`Injection of @Reference dependencies is failed; nested exception is java.lang.IllegalSta`ã€‚åä¸¤ä¸ªé¡¹ç›®çš„é¡¹ç›®è·¯å¾„åŒæ„è¢«æˆ‘æ”¹æˆcom.zhangyunã€‚
  - æ­£å¼å¼€å‘çš„æ—¶å€™ä¸ä¼šè¦æ±‚é¡¹ç›®è·¯å¾„ä¸€è‡´ï¼Œè€Œæ˜¯ç”¨pomåæ ‡çš„æ–¹å¼è§£å†³providerå’Œconsumerå¯¹è·¯å¾„çš„å¯¹å£çš„è¦æ±‚ã€‚

![image-20211016140025973](springboot.assets/image-20211016140025973.png)

åœ¨consumer-serverçš„æµ‹è¯•æ–¹æ³•ä¸­ï¼Œå°è¯•é€šè¿‡æ³¨å†Œä¸­å¿ƒzkè·å–provider-serveræ³¨å†Œçš„TicketServiceæœåŠ¡

```java
package com.zhangyun;

import com.zhangyun.service.UserService;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class ConsumerServerApplicationTests {
    @Autowired
    UserService userService;

    @Test
    void contextLoads() {
        userService.buyTicket();
    }

}
```

æ‰§è¡Œæµ‹è¯•æ–¹æ³•ï¼ŒæˆåŠŸè¿œç¨‹ä½¿ç”¨äº†zkä¸Šæ³¨å†Œçš„TicketServiceæœåŠ¡ã€‚**æ³¨æ„ä»æ³¨å†ŒæœåŠ¡åˆ°è·å–æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½å…³é—­zkï¼ï¼ï¼**

![image-20211016140330971](springboot.assets/image-20211016140330971.png)



## èŠèŠç°åœ¨å’Œæœªæ¥

å›é¡¾ä¹‹å‰ã€‚ã€‚

æ¶æ„ï¼š

- ä¸‰å±‚æ¶æ„ï¼šmvc
- æ¶æ„çš„ç›®çš„å°±æ˜¯è§£è€¦

ä¸‰å±‚æ¶æ„å¯¹åº”çš„å¼€å‘æ¡†æ¶ï¼š

- spring

  - ioc

    - æ§åˆ¶ç¿»è½¬

    - æ‹¿çº¦å­¦ä¹ ä¸ºä¾‹ï¼š

      åŸæ¥çº¦å­¦ä¹ ï¼šé™„è¿‘socialæ‰¾å¥½å­¦ä¹‹å¾’-ã€‹åŠ vx-ã€‹èŠå¤©-ã€‹çº¦ç€å­¦ä¹ ã€‚

      ç°åœ¨æœ‰å­¦æ ¡ï¼šæœ‰ä¹¦æ¡Œæ•™å¸ˆå­¦å‹-ã€‹ç›´æ¥è¿›å­¦æ ¡å°±æœ‰äººä¸€èµ·å­¦ä¹ äº†ã€‚

    - åŸæ¥æˆ‘ä»¬éƒ½æ˜¯è‡ªå·±ä¸€æ­¥æ­¥æ“ä½œï¼Œç°åœ¨äº¤ç»™å®¹å™¨ï¼ˆå­¦æ ¡ï¼‰äº†ï¼Œæˆ‘ä»¬éœ€è¦ä»€ä¹ˆç›´æ¥å»æ‹¿å°±å¯ä»¥äº†ã€‚

  - aop

    - åˆ‡é¢ï¼šæœ¬è´¨æ˜¯åŠ¨æ€ä»£ç†
    - ä¸ºäº†è§£å†³é—®é¢˜ï¼šä¸å½±å“ä¸šåŠ¡æœ¬æ¥çš„æƒ…å†µä¸‹ï¼Œå®ç°åŠ¨æ€å¢åŠ åŠŸèƒ½ã€‚å¤§é‡åº”ç”¨äºæ—¥å¿—ï¼Œäº‹åŠ¡ç­‰ã€‚

  - springæ˜¯ä¸€ä¸ªæ¸…é‡çº§çš„javaå¼€æºæ¡†æ¶ï¼Œå®¹å™¨ã€‚

  - ç›®çš„ï¼šè§£å†³ä¼ä¸šå¼€å‘çš„å¤æ‚æ€§é—®é¢˜ã€‚

  - springæ˜¯æ˜¥å¤©ã€‚é…åˆ¶æ–‡ä»¶ä¹Ÿååˆ†å¤æ‚ï¼

- springboot

  - æ–°ä¸€ä»£javaEEçš„å¼€å‘æ ‡å‡†ï¼Œå¼€ç®±å³ç”¨-->æ‹¿è¿‡æ¥å°±èƒ½ç”¨ã€‚ä»–è‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®äº†å¾ˆå¤šçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬æ‹¿æ¥å³ç”¨ã€‚
  - springbootä¸æ˜¯æ–°ä¸œè¥¿ï¼Œå®ƒæ˜¯springçš„å‡çº§ç‰ˆï¼Œç®€åŒ–ç‰ˆã€‚
  - ç‰¹ç‚¹ï¼š**çº¦å®šå¤§äºé…ç½®ï¼ˆæ‹¿æ¥å³ç”¨çš„ä»£ä»·ï¼‰**



éšç€å…¬å¸ä½“ç³»è¶Šæ¥è¶Šå¤§ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼å¾®æœåŠ¡æ¶æ„å‡ºç°ã€‚

å¾®æœåŠ¡æ¶æ„

- ç‰¹ç‚¹ï¼šæ¨¡å—åŒ–ï¼ŒåŠŸèƒ½åŒ–
- äººå¤šè®¿é—®é‡å¤šåï¼Œå¢åŠ æœåŠ¡å™¨çš„æ•°é‡---æ¨ªå‘æ‰©å®¹
- å‡è®¾AæœåŠ¡çš„æ€§èƒ½ç”¨æ‰98%ï¼ŒbæœåŠ¡å™¨çš„æ€§èƒ½åªç”¨äº†10%ï¼Œè¿™å°±ä¸åˆç†ã€‚ä»–ä»¬åº”å®ç°è´Ÿè½½å‡è¡¡ã€‚
  - ç”¨æˆ·éå¸¸å¤šï¼Œè€Œç­¾åˆ°ååˆ†å°‘çš„æ—¶å€™ã€‚é‚£ä¹ˆå°±ç»™â€œç”¨æˆ·â€å¤šç‚¹æœåŠ¡å™¨ï¼Œç»™â€œç­¾åˆ°â€å°‘ç‚¹æœåŠ¡å™¨ã€‚
  - å°†åŸæ¥çš„æœåŠ¡æ¨¡å—åŒ–ï¼Œç”¨æˆ·æ˜¯å•ç‹¬çš„é¡¹ç›®ï¼Œç­¾åˆ°ä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚é¡¹ç›®å’Œé¡¹ç›®ä¹‹é—´éœ€è¦é€šä¿¡ã€‚



å¾®æœåŠ¡æ¶æ„é—®é¢˜ï¼Ÿæ¢è¨€ä¹‹ï¼Œåˆ†å¸ƒå¼æ¶æ„ä¼šé‡åˆ°çš„å››ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Ÿ

1. è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå®¢æˆ·ç«¯è¯¥å¦‚ä½•å»è®¿é—®ï¼Ÿ
2. è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ
3. è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†ï¼ˆæ³¨å†Œä¸å‘ç°ï¼‰ï¼Ÿ
4. æœåŠ¡æŒ‚äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ



è§£å†³æ–¹æ¡ˆï¼š

- ç”Ÿæ€åœˆspringcloudå‡ºæ¥äº†ï¼Œå°±æ˜¯æ¥è§£å†³ä»¥ä¸Šåˆ†å¸ƒå¼æ¶æ„çš„å››ä¸ªé—®é¢˜ã€‚

- æƒ³ä½¿ç”¨springcloudï¼Œå¿…é¡»æŒæ¡springbootï¼Œå› ä¸ºspringcloudæ˜¯åŸºäºspringbootçš„ã€‚

- spring cloud netflixï¼Œå‡ºæ¥äº†ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼

  1. è®¿é—®ï¼ˆapiç½‘å…³ï¼‰ï¼šzuulç»„ä»¶
  2. é€šä¿¡ï¼šfeign--ã€‹httpclient--ã€‹httpçš„é€šä¿¡æ–¹å¼æ˜¯â€œåŒæ­¥å¹¶é˜»å¡â€
  3. æ²»ç†:æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ŒEureka
  4. é˜²ç¾ï¼šç†”æ–­æœºåˆ¶ï¼ŒHystrix

  2018å¹´å¹´åº•ï¼Œnetflixå®£å¸ƒæ— é™æœŸåœæ­¢ç»´æŠ¤ã€‚ç”Ÿæ€ä¸å†ç»´æŠ¤ï¼Œå°±ä¼šè„±èŠ‚ã€‚

- apache dubbo+zookeeperå‡ºç°ï¼Œç¬¬äºŒå¥—è§£å†³ç³»ç»Ÿ

  1. apiï¼šæ²¡æœ‰ï¼Œè¦ä¹ˆæ‰¾ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè¦ä¹ˆè‡ªå·±å®ç°
  2. é€šä¿¡ï¼šdubboæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åŸºäºjavaçš„rpcé€šä¿¡æ¡†æ¶ã€‚
  3. æ³¨å†Œä¸å‘ç°ï¼šzookeeper
  4. ç†”æ–­æœºåˆ¶ï¼šæ— ï¼Œå€ŸåŠ©äº†netflixçš„ç†”æ–­æœºåˆ¶

  ä¸å®Œå–„ï¼Œæ­£åœ¨å­µåŒ–dubboæ–°ä¸€ä»£ï¼Œå¯èƒ½æˆä¸ºapacheçš„é¡¶çº§é¡¹ç›®ã€‚

- springcloud alibabaï¼Œç¬¬ä¸‰å¥—è§£å†³ç³»ç»Ÿï¼Œä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚

  - åˆšå­µåŒ–å®Œï¼Œä¸€å †äººç”¨ã€‚

- ç›®å‰åˆæå‡ºä¸€ç§æ–¹æ¡ˆï¼šæœåŠ¡ç½‘æ ¼

  - ç§°å…¶ä¸ºä¸‹ä¸€ä»£å¾®æœåŠ¡æ ‡å‡†ï¼Œserver meshã€‚
  - ä»£è¡¨è§£å†³æ–¹æ¡ˆï¼šistioï¼ˆæœªæ¥å¯èƒ½éœ€è¦æŒæ¡ï¼‰

- ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œä¸€é€šç™¾é€šã€‚å°±æ˜¯è§£å†³åˆ†å¸ƒå¼æ¶æ„çš„å››ä¸ªæ ¸å¿ƒé—®é¢˜ã€‚æŠŠå››ä¸ªæ ¸å¿ƒé—®é¢˜æ¢ä¸€ç§è¯´æ³•ï¼Œç”¨è§£å†³æ€è·¯æè¿°ï¼š

  1. apiç½‘ç®¡ï¼ŒæœåŠ¡è·¯ç”±
  2. httpï¼ŒRPCæ¡†æ¶ï¼Œå¼‚æ­¥è°ƒç”¨
  3. æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé«˜å¯ç”¨
  4. ç†”æ–­æœºåˆ¶ï¼ŒæœåŠ¡é™çº§



å¦‚æœæˆ‘èƒ½è§£å†³è¿™å››ä¸ªé—®é¢˜ï¼Œå¼€å‘ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå«springCloud



ä¸ºä½•è¦è§£å†³åˆ†å¸ƒå¼æ¶æ„çš„å››ä¸ªé—®é¢˜ï¼Ÿ

- æœ¬è´¨ï¼šç½‘ç»œä¸å¯é 



ç¨‹åºå‘˜ï¼Œä¸è¦åœæ­¢å­¦ä¹ ï¼



## è‡ªå·±æ·±å…¥å­¦ä¹ dubbo

### å­¦ä¹ æ–¹å¼

1ï¼Œå…ˆçœ‹dubboå®˜ç½‘

- ç®€å•é¡¹ç›®å¼€å‘
- æ€ä¹ˆéƒ¨ç½²
  - ç¢°åˆ°é—®é¢˜ï¼ˆå¯ä»¥é—®chatgptï¼‰ï¼š
    - åŒä¸€å°æœºå™¨ä¸Šï¼Œèƒ½å¦å®ç°ä¸¤ä¸ªæœåŠ¡è€…æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œç„¶åè®©æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡å»æ¶ˆè´¹ï¼Ÿï¼ˆæˆ‘ä¸€å¼€å§‹ç›´æ¥å¤åˆ¶æœåŠ¡å¹¶è§£å†³ç«¯å£å†²çª+QOSå†²çªåå®ç°äº† ä½†æ˜¯è°ƒæ•´moduleçš„projectstructureåå°±å„ç§æŠ¥é”™æ— æ³•è§£å†³ ä»¥åè°ƒæ•´projectstructureå¯ä»¥å…ˆæˆªå›¾ä¿å­˜é¡¹ç›®å¯ç”¨æ—¶çš„ç»“æ„ï¼‰

2ï¼Œå¸¦ç€çœ‹å®˜ç½‘çš„ç–‘é—®ï¼Œè¿…é€Ÿçœ‹ä¸€é[é›·è€å¸ˆdubboè¯¾ç¨‹](https://www.bilibili.com/video/BV1ns411c7jV?p=19&vd_source=8be62db2c8e19174231a64770292e191)çš„[é«˜èµcsdnç¬”è®°ï¼ˆå·²ä¿å­˜åˆ°ref/ï¼‰](https://blog.csdn.net/qq_41157588/article/details/106737191)ï¼Œç¬”è®°çœ‹ä¸æ‡‚çš„å°±å»è§†é¢‘å¯¹åº”ä½ç½®çœ‹ã€‚

3ï¼Œä¸‹é¢çš„ç¬”è®°é‡ç‚¹è®°å½•csdnä¸­æ²¡æœ‰çš„ï¼Œæˆ–è€…æœ‰ä¸”éœ€è¦é¢å¤–è¡¥å……æ³¨æ„çš„

### zk

1ï¼Œæ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡ï¼Œä¼šæœ‰æ ¹èŠ‚ç‚¹ç­‰èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨ä¸€å®šçš„æ•°æ®ã€‚æ¯”å¦‚åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™å°±å¯ä»¥å¾€é‡Œé¢æ·»åŠ æ•°æ®ã€‚dubboä¸»è¦æ˜¯é‚£å®ƒåšæ³¨å†Œä¸­å¿ƒã€‚

### dubboadminæŸ¥çœ‹æœåŠ¡è€…æ¶ˆè´¹è€…

#### å‰è¨€

1ï¼Œdubbo-adminæ˜¯dubboæ¡†æ¶ä¸­çš„monitorçš„è§’è‰²ï¼Œä¸æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯å¯ä»¥å¸®åŠ©é€šè¿‡å¯è§†åŒ–çš„ç•Œé¢å»ç»´æŠ¤å¤šç§æœåŠ¡ã€‚

![image-20230524155343194](springboot.assets/image-20230524155343194.png)

#### ç‹¬ç«‹interfaceæ¨¡å—

1ï¼Œâ€åˆ›å»ºMavené¡¹ç›®=> gmail-interface ç”¨äºå­˜æ”¾å…±åŒçš„æœåŠ¡æ¥å£â€œï¼Œæ˜¯ä¸ºäº†è®©consumerå’Œprovideréƒ½èƒ½æ‹¿åˆ°æ¥å£ã€‚å¹¶ä¸”ä¹Ÿä¼šå­˜æ”¾å…±ç”¨çš„javaã€‚

2ï¼Œåˆ›å»ºinterfaceæ¨¡å—ï¼š

![image-20230524161022255](springboot.assets/image-20230524161022255.png)

3ï¼ŒæŠŠå…±ç”¨çš„serviceæ¥å£ï¼Œpojoç±»ï¼Œå¼‚å¸¸ç­‰ï¼Œéƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ã€‚è¿™é‡Œ**ç›´æ¥å°±æŠŠæœ¬åœ°å…¶ä»–æ¨¡å—ï¼ˆå³consumerå’Œprocviderï¼‰ç”¨mavenæ–¹å¼å¼•å…¥äº†æœ¬æ¨¡å—**ï¼Œæœ¬æ¨¡å—å°±å¯ä»¥ç”¨åˆ°åˆ«çš„æ¨¡å—çš„æ¥å£å®šä¹‰äº†ï¼š

![image-20230524161203180](springboot.assets/image-20230524161203180.png)

- æˆ‘ï¼šçœŸå®å¼€å‘ä¸­ä¸€èˆ¬æ˜¯å§interfaceæ¨¡å—æ”¾åˆ°mavenä»“åº“ä¸­ï¼Œç„¶åè®©consumerå’Œprovideråœ¨pomä¸­å¼•å…¥

4ï¼Œç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼š

- consumerä¸­é€šè¿‡mavenå¼•å…¥çš„interfaceæ¨¡å—ä¸­çš„æ¥å£çš„å®ç°ç±»åœ¨åˆ«çš„æ¨¡å—ä¸­ï¼ˆç°å®ä¸–ç•Œä¸­æ˜¯åœ¨åˆ«çš„èŠ‚ç‚¹ä¸­ï¼‰ï¼Œæ˜¯æ— æ³•ç›´æ¥ä½¿ç”¨æ¥å£çš„ï¼›æ‰€ä»¥éœ€è¦dubboæ¥è¿œç¨‹è°ƒç”¨ã€‚

#### ssmæ–¹å¼å®ç°è¿œç¨‹è°ƒç”¨-provider

- providerå’Œconsumeråœ¨é…ç½®å‰è¦pomå¼•å…¥éœ€è¦çš„ä¾èµ–ï¼ˆcsdnç¬”è®°ï¼‰

1ï¼Œspringæ–¹å¼ï¼ˆå³xmlå¼ï¼‰çš„é…ç½®providerï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dubbo="http://code.alibabatech.com/schema/dubbo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
		http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd">
    <!--1ã€æŒ‡å®šå½“å‰æœåŠ¡/åº”ç”¨çš„åå­—(åŒæ ·çš„æœåŠ¡åå­—ç›¸åŒï¼Œä¸è¦å’Œåˆ«çš„æœåŠ¡åŒå)-->
   <dubbo:application name="user-service-provider"></dubbo:application>
    <!--2ã€æŒ‡å®šæ³¨å†Œä¸­å¿ƒçš„ä½ç½®-->
    <!--<dubbo:registry address="zookeeper://127.0.0.1:2181"></dubbo:registry>-->
    <dubbo:registry protocol="zookeeper" address="127.0.0.1:2181"></dubbo:registry>
    <!--3ã€æŒ‡å®šé€šä¿¡è§„åˆ™ï¼ˆé€šä¿¡åè®®? æœåŠ¡ç«¯å£ï¼‰-->
    <dubbo:protocol name="dubbo" port="20880"></dubbo:protocol>
    <!--4ã€æš´éœ²æœåŠ¡ è®©åˆ«äººè°ƒç”¨ã€‚interfaceæŒ‡å®šæš´éœ²çš„æ¥å£ refæŒ‡å‘æœåŠ¡çš„çœŸæ­£å®ç°å¯¹è±¡å³implç±»-->
    <dubbo:service interface="com.lemon.gmail.service.UserService" ref="userServiceImpl"></dubbo:service>

    <!--æœåŠ¡çš„å®ç°-->
    <bean id="userServiceImpl" class="com.lemon.gmail.service.impl.UserServiceImpl"></bean>
</beans>

```

- æˆ‘ï¼šspringbooté‡Œï¼Œè¿™äº›é…ç½®éƒ½åœ¨ymlä¸­å®Œæˆã€‚
- æˆ‘ï¼šæ³¨æ„â€œåŒåæœåŠ¡çš„æœåŠ¡åå­—ç›¸åŒâ€ï¼Œå¤šä¸ªåŒåæœåŠ¡å°±èƒ½è®©è´Ÿè½½å‡è¡¡æ’ä¸Šç”¨åœºäº†
- æˆ‘ï¼šâ€é€šä¿¡åè®®â€œï¼šå¯ä»¥æ”¯æŒhttps dubboç­‰å¤šç§é€šä¿¡åè®®ï¼Œè¿™é‡Œé€‰dubboã€‚
- æˆ‘ï¼šâ€œæš´éœ²æœåŠ¡â€ï¼šè¯´æ˜ä¸€ä¸ªæœåŠ¡é’ˆå¯¹ä¸€ä¸ªæ¥å£åªèƒ½æä¾›ä¸€ç§å®ç°ã€‚
- æˆ‘ï¼šâ€œæœåŠ¡çš„å®ç°â€ï¼šå…ˆç”¨beanæ ‡ç­¾æŠŠuserServiceImplæ³¨å†Œä¸ºbeanï¼Œç„¶åâ€œæš´éœ²æœåŠ¡â€çš„refæ‰èƒ½å¼•ç”¨è¿™ä¸ªbeanï¼›è¿™ä¸ªbeanä¹Ÿå³æ˜¯æœåŠ¡çš„å®ç°ã€‚
- æˆ‘ï¼šè¿™é‡Œç”¨çš„ssmæ–¹å¼åšçš„é…ç½®ï¼Œå…¶å®ä¹‹å‰å«schemaæ–¹å¼åšçš„é…ç½®ï¼Œå®˜ç½‘å·²ç»ä¸ç»´æŠ¤äº†schemaçš„æ–‡æ¡£äº†ï¼Œä½†æ˜¯å®˜ç½‘ç°åœ¨ä»åœ¨ç»´æŠ¤[xmlé…ç½®æ–¹å¼çš„æ–‡æ¡£](https://cn.dubbo.apache.org/zh-cn/docsv2.7/user/configuration/xml/)ï¼›bootå¸¸ç”¨æ³¨è§£åšçš„é…ç½®ã€‚

2ï¼Œä¸ºprovideræ¨¡å—ç¼–å†™å¯åŠ¨ç±»ã€‚springå¯åŠ¨iocå®¹å™¨åï¼Œå°±ä¼šæŠŠæœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š

```java
public class MailApplication {
    public static void main(String[] args) throws IOException {
        ClassPathXmlApplicationContext applicationContext= new ClassPathXmlApplicationContext("provider.xml");
        applicationContext.start();
        System.in.read();
    }
}
```

- æˆ‘ï¼šspringbootä¸­ç”¨@ComponentæŠŠç±»å½“åšbeanæ³¨å†Œåˆ°springå®¹å™¨ä¸­ã€‚dubboç”¨xmlæŠŠç±»æ³¨å†Œåˆ°é…ç½®åˆ°çš„æ³¨å†Œä¸­å¿ƒï¼ˆå³zkï¼‰ã€‚

3ï¼Œå¯ä»¥åœ¨dubboadminçœ‹åˆ°æœåŠ¡æ³¨å†Œçš„æƒ…å†µï¼š

ç‚¹å‡»â€œæœåŠ¡æ²»ç†-æä¾›è€…â€ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡æä¾›è€…çš„ipå’Œç«¯å£å·ï¼š

![image-20230524164022878](springboot.assets/image-20230524164022878.png)

ç‚¹å‡»â€œæœåŠ¡æ²»ç†-åº”ç”¨â€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å“ªäº›åº”ç”¨è¢«æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œåå­—å°±æ˜¯xmlä¸­é…ç½®çš„applicationnameï¼š

![image-20230524164158874](springboot.assets/image-20230524164158874.png)

ç‚¹å‡»â€œæœåŠ¡æ²»ç†-æœåŠ¡â€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å“ªäº›æ¥å£ï¼ˆå³æœåŠ¡ï¼‰è¢«æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š

![image-20230524164306736](springboot.assets/image-20230524164306736.png)

- æˆ‘ï¼š192ipæ˜¯ä¸€ä¸ªæœºå™¨ï¼ˆå¾®æœåŠ¡èŠ‚ç‚¹ï¼‰ï¼Œæœºå™¨ä¸­æœ‰åä¸ºProviderçš„åº”ç”¨ï¼Œproviderä¸­æœ‰åä¸ºUserServiceçš„ä¸€ä¸ªæœåŠ¡ã€‚

#### SSMæ–¹å¼å®ç°è¿œç¨‹è°ƒç”¨-consumer

1ï¼Œé…ç½®xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dubbo="http://dubbo.apache.org/schema/dubbo"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
		http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
		http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd">
   <!--åŒ…æ‰«æ è¿™æ˜¯æ­£å¸¸çš„springé¡¹ç›®éƒ½å¾—é…ç½®çš„ ä½†æ˜¯springbootä¸€èˆ¬ä¸åŒé…ç½®è¿™ä¸ªæ‰«æè€Œåªéœ€è¦åœ¨è‡ªå·±çš„ç±»ä¸Šç”¨@Componentæ³¨è§£å³å¯-->
    <context:component-scan base-package="com.lemon.gmail.service.impl"/>

    <!--æŒ‡å®šå½“å‰æœåŠ¡/åº”ç”¨çš„åå­—(åŒæ ·çš„æœåŠ¡åå­—ç›¸åŒï¼Œä¸è¦å’Œåˆ«çš„æœåŠ¡åŒå)-->
    <dubbo:application name="order-service-consumer"></dubbo:application>
    <!--æŒ‡å®šæ³¨å†Œä¸­å¿ƒçš„ä½ç½®-->
    <dubbo:registry address="zookeeper://127.0.0.1:2181"></dubbo:registry>

    <!--è°ƒç”¨è¿œç¨‹æš´éœ²çš„æœåŠ¡ï¼Œç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†-->
    <dubbo:reference interface="com.lemon.gmail.service.UserService" id="userService"></dubbo:reference>
</beans>
```

- æˆ‘ï¼š` <dubbo:reference`ä¼šæŠŠprovideræä¾›çš„UserServiceæœåŠ¡æ³¨å…¥åˆ°æ¶ˆè´¹è€…æ‰€åœ¨çš„springå®¹å™¨ä¸­ï¼Œè¿™æ ·æ¶ˆè´¹è€…ä½¿ç”¨UserServiceæ—¶å°±å¯ä»¥ç›´æ¥ç”¨Autowiredå»æ‹¿åˆ°UserServiceæœåŠ¡äº†ã€‚ä¸ºè¿™ä¸ªæœåŠ¡åœ¨consumerçš„springå®¹å™¨ä¸­ä¹Ÿå–ä¸€ä¸ªåå­—ï¼Œç”¨beanidè¡¨ç¤ºã€‚

2ï¼Œç¼–å†™æ¶ˆè´¹è€…çš„å¯åŠ¨ç±»

```java
public class ConsumerApplication {
    public static void main(String[] args) {
        ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("consumer.xml");
        OrderService orderService = applicationContext.getBean(OrderService.class);

        //è°ƒç”¨æ–¹æ³•æŸ¥è¯¢å‡ºæ•°æ®
        orderService.initOrder("1");
        System.out.println("è°ƒç”¨å®Œæˆ...");
	    System.in.read();
    }
}
```

- æˆ‘ï¼šSpringçš„å¯åŠ¨ç±»å’Œspirngbootä¸ä¸€æ ·ã€‚è¿™é‡Œç›´æ¥åœ¨å¯åŠ¨ç±»ä¸­è°ƒç”¨consumerè‡ªå·±çš„orderServiceï¼ŒorderServiceåˆè¿œç¨‹è°ƒç”¨providerçš„Userserviceï¼Œæœ€åæˆåŠŸå±•ç¤ºç»“æœã€‚
- æˆ‘ï¼šè¿™é‡Œ`System.in.read();`æ˜¯ä¸ºäº†ioé˜»å¡è¿›ç¨‹ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨dubboadminçœ‹åˆ°ä¸¤ä¸ªåº”ç”¨ï¼›å¦åˆ™è¿œç¨‹è°ƒç”¨å®Œå°±ç¨‹åºç»“æŸï¼Œæä¾›è€…å°±ä¸­æ–­ã€‚

3ï¼ŒdubboadminæŸ¥çœ‹åº”ç”¨ã€‚èƒ½çœ‹åˆ°æœ‰ä¸¤ä¸ªåº”ç”¨ï¼Œåˆ†åˆ«æ˜¯æœåŠ¡è€…å’Œæ¶ˆè´¹è€…ï¼›æ­¤æ—¶æ¶ˆè´¹è€…æ­£åœ¨æ¶ˆè´¹æœåŠ¡è€…çš„æœåŠ¡ï¼š

![image-20230524170407244](springboot.assets/image-20230524170407244.png)

### monitor

- dubboadminæ˜¯ç®¡ç†æ§åˆ¶å°ï¼Œdubbomonitoræ˜¯ç›‘æ§ä¸­å¿ƒã€‚

1ï¼Œæ£€æŸ¥gité¡¹ç›®çš„propertiesï¼š

![image-20230524170826977](springboot.assets/image-20230524170826977.png)

- é‡ç‚¹å…³æ³¨æ³¨å†Œä¸­å¿ƒzkçš„åœ°å€
- 7070æ˜¯å…¶ä»–æœåŠ¡ä¸monitorçš„é€šä¿¡æ¥å£
- 8080æ˜¯monitorçš„webé¡µé¢çš„è®¿é—®æ¥å£

2ï¼Œå…¶ä»–ï¼šå‚è€ƒcsdnç¬”è®°ã€‚

### æ•´åˆspringboot

- ä¹‹å‰éƒ½æ˜¯åœ¨ssmä¸­ä½¿ç”¨dubboï¼ˆxmlé…ç½®å°±æ˜¯springçš„ç‰¹ç‚¹ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬åœ¨springbootï¼ˆç‰¹ç‚¹æ˜¯ä½¿ç”¨æ³¨è§£ä»£æ›¿xmlï¼‰ä¸­ä½¿ç”¨dubboã€‚

1ï¼ŒæœåŠ¡æä¾›è€…é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼š

```properties
dubbo.application.name=boot-user-service-provider
dubbo.registry.address=127.0.0.1:2181
dubbo.registry.protocol=zookeeper

dubbo.protocol.name=dubbo
dubbo.protocol.port=20880

#è¿æ¥ç›‘æ§ä¸­å¿ƒï¼šregistryè¡¨ç¤ºè®©æœåŠ¡ç«¯å»æ³¨å†Œä¸­å¿ƒzkæ‰¾ç›‘æ§ä¸­å¿ƒçš„åœ°å€
dubbo.monitor.protocol=registry
```

- ssmé¡¹ç›®ä¸­ç”¨xmlåšå¦‚ä¸Šçš„é…ç½®ã€‚springbooté¡¹ç›®ä¸­ç”¨propertiesæˆ–ymlæ–‡ä»¶åšå¦‚ä¸Šé…ç½®ã€‚

2ï¼ŒæœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡ï¼š

ssmä¸­ï¼Œproviderç”¨æ³¨è§£å»æš´éœ²æœåŠ¡ï¼›ä½†æ˜¯æ¯ä¸ªæœåŠ¡éƒ½å†™æ³¨è§£å¾ˆéº»çƒ¦ï¼š

![image-20230524202831740](springboot.assets/image-20230524202831740.png)

springbootä¸­ç”¨@Serviceï¼ˆä¸springbootè‡ªèº«çš„@ServiceåŒºåˆ†å¼€ï¼‰å»æš´éœ²æœåŠ¡ï¼Œæ–°ç‰ˆdubboæŠŠæ³¨è§£é‡å‘½åä¸º@DubboServiceï¼š

![image-20230524203131434](springboot.assets/image-20230524203131434.png)

- åœ¨ä½¿ç”¨è€ç‰ˆæœ¬dubboçš„@Serviceæ³¨è§£æ—¶ï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œå¯ä»¥æŠŠSpringbootçš„@Serviceæ³¨è§£æ¢æˆ@Componentæ³¨è§£æ¥æ³¨å†Œå½“å‰beanã€‚

3ï¼Œæ¶ˆè´¹è€…å¼•ç”¨æœåŠ¡ï¼š

![image-20230524203916347](springboot.assets/image-20230524203916347.png)

- é’ˆå¯¹dubboçš„ä½¿ç”¨ï¼Œå¯¹æ¯”ssmå’Œspringbootæ¶ˆè´¹è€…ï¼š
  - ssmä¸­æ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œé€šè¿‡dubboæŠŠæœåŠ¡æä¾›è€…çš„beanæ”¾å…¥æ¶ˆè´¹è€…çš„å®¹å™¨ï¼Œç„¶åæ¶ˆè´¹è€…ç”¨@Autowiredæ‹¿åˆ°beanï¼Œå°±åƒå•ä½“æ¶æ„æ‹¿è‡ªå·±é¡¹ç›®çš„beanä¼¼çš„ã€‚
  - Springbootä¸­çš„æ¶ˆè´¹è€…ä½¿ç”¨@DubboReferenceæ‹¿åˆ°beanã€‚åŠ äº†@DubboReferenceæ³¨è§£åï¼Œæ¶ˆè´¹è€…ä¼šè‡ªå·±å»æ³¨å†Œä¸­å¿ƒä¸­æ‹¿åˆ°è¿œç¨‹çš„æœåŠ¡ã€‚

4ï¼Œå…¶ä»–çš„å†…å®¹å‚è€ƒå®˜ç½‘ï¼Œå’Œcsdnç¬”è®°

- æˆ‘ï¼šcsdnç¬”è®°ä¸­çš„æ³¨è§£æ¯”è¾ƒè€äº†ï¼Œç”¨çš„è¿˜æ˜¯@Serviceå’Œ@Referenceï¼›ç°åœ¨æ³¨è§£æ›´æ–°ä¸º@DubboServiceå’Œ@DubboReference



### xmlå®ç°dubboé…ç½®

#### é…ç½®çš„åŠ è½½é¡ºåº

1ï¼Œå¤šç§é…ç½®æ–¹å¼åŒæ—¶å­˜åœ¨æ—¶ï¼Œå‚æ•°ä¼˜å…ˆçº§é€’å‡è§„åˆ™ï¼šJVM å¯åŠ¨ -D å‚æ•°ï¼ŒXMLæˆ–springå›ºæœ‰çš„application.propertiesï¼Œdubboé»˜è®¤é…ç½®dubbo.Properties:

![image-20230524210134112](springboot.assets/image-20230524210134112.png)

- æˆ‘ï¼šè¿™ä¸ªcsdnç¬”è®°æœ‰ç»†è¯´ï¼Œæˆ‘åœ¨è¿™ä¹Ÿç®€ç•¥å¼ºè°ƒä¸‹ã€‚
- ideaçš„ç»¿è‰²ä¸‰è§’è¿è¡ŒæŒ‰é’®ï¼Œå¯ä»¥é…ç½®è¿è¡Œæ—¶çš„å‚æ•°ï¼Œä¹Ÿå³configurationå¯ä»¥é…ç½®jvmå¯åŠ¨æ—¶çš„å‚æ•°ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](springboot.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTU3NTg4,size_16,color_FFFFFF,t_70.png)

- ä½¿ç”¨é…ç½®ç­‰çº§çš„æ€è·¯ï¼šdubboé»˜è®¤çš„é…ç½®å¯ä»¥æ”¾åœ¨dubbo.propertiesæ–‡ä»¶ä¸­ï¼›æˆ‘ä»¬æƒ³åœ¨é»˜è®¤é…ç½®çš„åŸºç¡€ä¸Šé¢å¤–ä¿®æ”¹é…ç½®çš„è¯ï¼Œå¯ä»¥è¿›è¡Œxmlé…ç½®ï¼›æ‰“æˆjaråŒ…åè¦è¿è¡Œçš„æ—¶å€™ä¸´æ—¶æ”¹é…ç½®çš„è¯å°±ç”¨-Dçš„æ–¹å¼

#### å¯åŠ¨æ—¶æ£€æŸ¥

1ï¼Œé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œduuboé»˜è®¤ä¼šæ£€æŸ¥é¡¹ç›®ä¾èµ–çš„æœåŠ¡ï¼ˆå³æœ¬é¡¹ç›®çš„providerï¼‰æ˜¯å¦å¯ç”¨ï¼›å¦‚æœæœ‰providerä¸å¯ç”¨ï¼Œå½“å‰é¡¹ç›®å¯åŠ¨å°±ä¼šæŠ¥é”™ã€‚å¦‚æœæƒ³å…³é—­é»˜è®¤çš„æ£€æŸ¥å°±è®¾ç½®`check=false`ã€‚

2ï¼Œssmä¸­ï¼Œé’ˆå¯¹æŸä¸ª**ç‰¹å®šæœåŠ¡**è®©checkä¸ºfalseçš„æ–¹å¼å¦‚ä¸‹ï¼š

![image-20230524212610309](springboot.assets/image-20230524212610309.png)

- checkæ˜¯åœ¨æœåŠ¡çš„æ¶ˆè´¹ç«¯åšçš„é…ç½®ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯referenceæ ‡ç­¾å¤„è®¾ç½®

3ï¼Œssmä¸­ï¼Œ**ç»Ÿä¸€é…ç½®æ¶ˆè´¹è€…çš„æ‰€æœ‰å±æ€§**ï¼Œå¯ä»¥ç”¨`<dubbo:consumeræ ‡ç­¾`ï¼›è¿™ä¸ªæ ‡ç­¾ä¸­é…ç½®check=falseåï¼Œä¸ä¼šæ£€æŸ¥æ¶ˆè´¹è€…ä¾èµ–çš„æ‰€æœ‰æœåŠ¡ï¼š

![image-20230524213035153](springboot.assets/image-20230524213035153.png)

4ï¼Œssmä¸­ï¼Œå–æ¶ˆå¯¹æ³¨å†Œä¸­å¿ƒçš„æ£€æŸ¥ï¼›å³æ¶ˆè´¹è€…å¯åŠ¨æ—¶ï¼Œå¦‚æœæ³¨å†Œä¸­å¿ƒä¸å¯ç”¨ï¼Œä¹Ÿä¼šè®©æ¶ˆè´¹è€…æ­£å¸¸å¯åŠ¨ï¼š

![image-20230524231224168](springboot.assets/image-20230524231224168.png)

#### è¶…æ—¶é™åˆ¶

1ï¼Œå¦‚æœæœåŠ¡è°ƒç”¨è¶…è¿‡ä¸€å®šæ—¶é—´è¿˜ä¸å“åº”ï¼Œé‚£ä¹ˆå°±æŠ¥å¼‚å¸¸æ”¾å¼ƒï¼Œé˜²æ­¢æ¶ˆè´¹ç«¯è¿‡ä¹…çš„å ç”¨çº¿ç¨‹ã€‚

2ï¼Œè¶…æ—¶é™åˆ¶è®¾ç½®çš„è¦†ç›–å…³ç³»ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](springboot.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMTU3NTg4,size_16,color_FFFFFF,t_70-1684942178811-4.png)

- è¶…æ—¶é…ç½®çš„ä¼˜å…ˆçº§é™åºï¼šæ¶ˆè´¹ç«¯å¯¹æ–¹æ³•è®¾ç½®çš„è¶…æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹æ–¹æ³•è®¾ç½®çš„è¶…æ—¶ï¼Œæ¶ˆè´¹ç«¯å¯¹æ¥å£è®¾ç½®çš„è¶…æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹æ¥å£è®¾ç½®çš„è¶…æ—¶ï¼Œæ¶ˆè´¹ç«¯è®¾ç½®çš„å…¨å±€ï¼ˆé’ˆå¯¹æ‰€æœ‰æ¥å£çš„ï¼‰è¶…æ—¶ï¼ŒæœåŠ¡ç«¯è®¾ç½®çš„å…¨å±€ï¼ˆé’ˆå¯¹æ‰€æœ‰æ¥å£çš„ï¼‰è¶…æ—¶ã€‚
  - æ€»ç»“æ¥è¯´å°±æ˜¯ï¼šæ–¹æ³• å¤§äº æ¥å£ å¤§äº å…¨å±€ï¼›å¦‚æœscopeçš„çº§åˆ«ç›¸åŒï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…çš„é…ç½® å¤§äº æœåŠ¡è€…çš„é…ç½®ã€‚

#### é‡è¯•æ¬¡æ•°

- â€œé‡è¯•æ¬¡æ•°â€ä¸€èˆ¬å’Œâ€œè¶…æ—¶â€æ­é…ä½¿ç”¨

1ï¼Œè¶…æ—¶å’Œé‡è¯•ï¼Œéƒ½å¯ä»¥é…ç½®åœ¨æœåŠ¡æ–¹æˆ–æ¶ˆè´¹æ–¹ã€‚ä¸‹å›¾æ˜¯é…ç½®åœ¨æ¶ˆè´¹æ–¹ï¼š

![image-20230526225700175](springboot.assets/image-20230526225700175.png)

- æ³¨æ„ï¼šåœ¨å¹‚ç­‰æ–¹æ³•ï¼ˆæ¯”å¦‚æ•°æ®åº“çš„ æŸ¥è¯¢ åˆ é™¤ ä¿®æ”¹ï¼‰ä¸Šå¯ä»¥è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œä½†æ˜¯éå¹‚ç­‰æ–¹æ³•ï¼ˆæ¯”å¦‚æ•°æ®åº“çš„ æ–°å¢ï¼‰ä¸åº”è¯¥è®¾ç½®é‡è¯•æ¬¡æ•°ã€‚

2ï¼Œ**é‡ç‚¹**ï¼šè€å¸ˆè¿™ç”¨eclipseçš„é¡¹ç›®å¤šå¯åŠ¨åŠŸèƒ½ï¼Œåœ¨æœ¬æœºå®ç°äº†ä¸‰ä¸ªç›¸åŒæœåŠ¡ã€‚å®ç°æ–¹å¼ï¼š

1. ä¿®æ”¹æœåŠ¡æ–¹æ¨¡å—çš„dubble protocolç«¯å£å·ï¼Œä½¿å¾—ç«¯å£å·ä¸å’Œä¸Šä¸€æ¬¡å¯åŠ¨çš„æœ¬æ¨¡å—å†²çª
2. å¤šå¯åŠ¨æœ¬æ¨¡å—
3. é‡å¤æ­¥éª¤12å¤šæ¬¡ï¼Œå°±å¯ä»¥å¾—åˆ°å¤šä¸ªç›¸åŒçš„æœåŠ¡æä¾›è€…ã€‚å¯ä»¥è®©ä¸åŒæœåŠ¡æä¾›è€…åœ¨æä¾›æœåŠ¡æ—¶æ‰“å°ä¸åŒè¯­å¥ï¼Œè¿™æ ·æ¶ˆè´¹è€…ä½¿ç”¨æœåŠ¡æ—¶ï¼Œå°±å¯ä»¥å‘ç°å› ä¸ºè´Ÿè½½å‡è¡¡ï¼Œæ¯ä¸ªæœåŠ¡æä¾›è€…éƒ½ä¼šæ‰“å°è‡ªå·±çš„è¯­å¥ï¼Œå³æ¯ä¸ªæœåŠ¡éƒ½å¯èƒ½è¢«ä½¿ç”¨ã€‚

![image-20230526224546728](springboot.assets/image-20230526224546728.png)

- ç½‘å‹ï¼šideaå¤šå¯åŠ¨åœ¨edit configurationså“ªé‡Œ å°±æ˜¯é¡¹ç›®å¯åŠ¨å“ªé‡Œè®¾ç½® è¿›å»åé¡¹ç›®åæ—è¾¹Allow parallel run å‹¾æ‰å°±å¥½äº†

- æˆ‘ï¼šä¹‹å‰ä¸€ç›´å°è¯•åœ¨æœ¬æœºå®ç°å¤šä¸ªåŒåæœåŠ¡ï¼Œç°åœ¨æ‰çŸ¥é“å¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼å®ç°ï¼ˆä¸Šç½‘è¯¾æ¯”è‡ªå·±å­¦è¿˜æ˜¯æœ‰å¥½å¤„ äº‹åŠåŠŸå€ï¼‰ã€‚

å¯ä»¥çœ‹åˆ°æœåŠ¡æä¾›è€…æœ‰ä¸‰ä¸ªï¼Œç«¯å£å·ä¸åŒï¼š

![image-20230526224935316](springboot.assets/image-20230526224935316.png)

#### å¤šç‰ˆæœ¬

- ç½‘å‹ï¼šå¸¸ç”¨äºç°åº¦å‘å¸ƒï¼Œabæµ‹è¯•

1ï¼Œä¸ºä¸€ä¸ªæ¥å£è®¾ç½®ä¸¤ä¸ªå®ç°ç±»ï¼Œç±»åä¸åŒï¼Œç›¸å½“äºä¸€ä¸ªserviceæ¥å£æœ‰æ–°æ—§åŠŸèƒ½ï¼š

![image-20230526225930377](springboot.assets/image-20230526225930377.png)

2ï¼Œåœ¨æœåŠ¡æš´éœ²çš„æ—¶å€™ï¼Œé…ç½®ç‰ˆæœ¬å·ï¼›å¯ä»¥è®©è¾ƒæ–°ç‰ˆæœ¬å·çš„æ¥å£æœåŠ¡ä¼šæä¾›ä¸€äº›æ–°çš„åŠŸèƒ½ï¼š

![image-20230526230356753](springboot.assets/image-20230526230356753.png)

3ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹çš„æ—¶å€™ï¼Œå¯ä»¥ä»»é€‰æ˜¯ç”¨è€ç‰ˆæœ¬è¿˜æ˜¯æ–°ç‰ˆæœ¬æœåŠ¡ï¼ˆè¿™ä¸¤ä¸ªæœåŠ¡éƒ½è¢«æš´éœ²å¹¶æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒäº†ï¼‰ï¼Œä»è€Œæ‹¿åˆ°ä¸€ä¸ªæœåŠ¡ä¸åŒç‰ˆæœ¬çš„åŠŸèƒ½ï¼š

![image-20230526230610034](springboot.assets/image-20230526230610034.png)

- æ¶ˆè´¹è€…å¯ä»¥è®©`version="*"`ï¼Œè¿™æ ·å°±ä»»æ„ä½¿ç”¨è€ç‰ˆæœ¬æˆ–è€…æ–°ç‰ˆæœ¬äº†ã€‚

- ä¸€èˆ¬æ˜¯æ–°ç‰ˆæœ¬ç¨³å®šåï¼Œå°±é€‰æ‹©ä½¿ç”¨æ–°ç‰ˆæœ¬äº†ã€‚ä½¿ç”¨versionå¯ä»¥å¹³æ»‘çš„ä»æ—§ç‰ˆæœ¬è¿‡åº¦åˆ°æ–°ç‰ˆæœ¬ï¼Œä»è€Œå®ç°dubboå®˜ç½‘è¯´çš„â€œç°åº¦å‘å¸ƒâ€
- å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼šæ¶ˆè´¹è€…é…ç½®äº†versionå­—æ®µçš„è¯ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰é…ç½®å¯¹åº”versionï¼Œdubboä¼šæŠ¥é”™æ²¡æœ‰å¯ç”¨çš„provider

#### æœ¬åœ°å­˜æ ¹

1ï¼Œä½¿ç”¨XXXStubï¼Œå¯ä»¥åœ¨è°ƒç”¨è¿œç¨‹æ–¹æ³•å‰åšä¸€äº›æ ¡éªŒï¼Œé˜²æ­¢æ— æ•ˆè°ƒç”¨è¿œç¨‹èµ„æºï¼Œä»è€ŒèŠ‚çº¦è¿œç¨‹èµ„æºã€‚

- æˆ‘ï¼šè¿™ä¸ªçš„å®ç°ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯ä»¥æŠŠæ ¡éªŒå†™åˆ°æœåŠ¡ç«¯æˆ–è€…æ¶ˆè´¹ç«¯é‡Œï¼›ä½†æ˜¯ç”¨å­˜æ ¹ç±»ä¼¼äºè§£è€¦ï¼Œç¬¦åˆé«˜å†…èšä½è€¦åˆã€‚

### springbootä¸­å®ç°dubboé…ç½®

- è¶…æ—¶é™åˆ¶ é‡è¯•æ¬¡æ•°ç­‰é…ç½®ï¼Œä»¥springbootçš„æ–¹å¼ï¼ˆè€Œéxmlçš„æ–¹å¼ï¼‰åšé…ç½®ä¹Ÿå¾ˆç®€å•ã€‚
- è¿™é‡Œåˆ«çœ‹csdnç¬”è®°çš„å†…å®¹ï¼Œcsdnç¬”è®°è¿™æ²¡å†™å¥½ã€‚

#### å‰è¨€

1ï¼Œé’ˆå¯¹æœåŠ¡ç«¯ï¼Œspringbootä¸­çš„`@DubboService`æ³¨è§£ï¼Œå…¶å®å°±å¯¹åº”xmlä¸­çš„`<dubbo: service`æ ‡ç­¾ï¼›æ ‡ç­¾ä¸­èƒ½å†™çš„å±æ€§ï¼Œåœ¨æ³¨è§£ä¸­éƒ½èƒ½é…ç½®ï¼š

![image-20230526232352883](springboot.assets/image-20230526232352883.png)

2ï¼Œé’ˆå¯¹æ¶ˆè´¹è€…ï¼Œ`<refrence`çš„ç›¸å…³é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨`@DubboReference`ä¸­é…ç½®ã€‚

3ï¼Œxmlä¸­å¯ä»¥åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œç»†åŒ–é…ç½®æŸä¸ªæ–¹æ³•ï¼›ä½†æ˜¯æ³¨è§£æ— æ³•å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š

![image-20230526232554541](springboot.assets/image-20230526232554541.png)

- ç½‘å‹ï¼š@DubboServiceç°åœ¨å¯ä»¥é…æ–¹æ³•äº†

4ï¼Œæ¥ä¸‹æ¥å°†dubboå’Œspringbootæ•´åˆçš„ä¸‰ç§æ–¹å¼

#### æ–¹å¼1-æ³¨è§£æ•´åˆï¼ˆæˆ‘æ¨èï¼‰

1ï¼Œâ€œæ•´åˆspringbootâ€ç« èŠ‚è®²è¿‡ã€‚æ­¥éª¤ï¼š

1. åœ¨å¯åŠ¨ç±»ç”¨@enabledubboå¼€å¯dubbo

2. åœ¨æœåŠ¡ç«¯ç”¨@DubboServiceæš´éœ²æœåŠ¡

3. åœ¨æ¶ˆè´¹ç«¯ç”¨@DubboReferenceä½¿ç”¨æœåŠ¡

#### æ–¹å¼2-xmlæ•´åˆ

1ï¼Œâ€œxmlå®ç°dubboé…ç½®â€è®²è¿‡ã€‚ç•¥ï¼Œè¯¦æƒ…è§è§†é¢‘

- ç½‘å‹ï¼šdubboå®˜æ–¹æ¨èä½¿ç”¨xmlé…ç½®ï¼Œä½†æ˜¯springbootä¸€èˆ¬è¿˜æ˜¯ä¹ æƒ¯ç”¨æ³¨è§£ï¼Œæ³¨è§£è¿˜æ–¹ä¾¿

#### æ–¹å¼3-apiæ•´åˆ

1ï¼Œxmlæ–‡ä»¶ä¸­çš„æ¯ä¸ªxmlé…ç½®ï¼Œåœ¨apiä¸­éƒ½æ˜¯ä¸€ä¸ªConfigé…ç½®ç±»ã€‚ç•¥ï¼Œè¯¦æƒ…è§è§†é¢‘

- æˆ‘å’Œç½‘å‹ï¼šè¿™ä¸ªå°±æœ‰ç‚¹éº»çƒ¦äº†

- ç½‘å‹ï¼šå…¶å®ä¸ªäººå¤šå¹´å¼€å‘æ„Ÿè§‰ï¼Œæ˜¯è„±ç¦»äº†xmlï¼Œä½†æ˜¯è¿™ç§é…ç½®ç±»æ ¹æœ¬ä¸å¥½æ‰¾ä¸å¥½è·Ÿè¸ªä»£ç å’Œå…¥å£

### é«˜å¯ç”¨

- é€šè¿‡é«˜å¯ç”¨çš„è®¾è®¡ï¼Œå‡å°‘ç³»ç»Ÿä¸èƒ½æä¾›æœåŠ¡çš„æ—¶é—´

#### å®•æœº

1ï¼Œå‚è€ƒcsdnç¬”è®°

- æ¶ˆè´¹è€…å’ŒæœåŠ¡è€…æœ¬åœ°éƒ½ç¼“å­˜äº†å¯¹æ–¹çš„ä½ç½®ä¿¡æ¯ï¼Œå³ä½¿æ³¨å†Œä¸­å¿ƒæŒ‚æ‰äº†ï¼Œä¹‹å‰è”ç³»è¿‡çš„æ¶ˆè´¹è€…å’ŒæœåŠ¡è€…éƒ½å¯ä»¥é€šè¿‡æœ¬åœ°ç¼“å­˜å»ç›´è¿å¯¹æ–¹å¹¶ä½¿ç”¨/æä¾›æœåŠ¡ã€‚

#### dubboç›´è¿

1ï¼Œæ¶ˆè´¹è€…å¯ä»¥ç»•è¿‡æ³¨å†Œä¸­å¿ƒï¼Œç›´æ¥é€šè¿‡æœåŠ¡æ‰€åœ¨æœºå™¨åœ°å€å»è®¿é—®å¯¹åº”æœåŠ¡ï¼š

![image-20230527001553740](springboot.assets/image-20230527001553740.png)

- ç½‘å‹é—®ï¼šç›´è¿è¿˜èƒ½å®ç°åˆ†å¸ƒå¼çš„åŠŸèƒ½å—ï¼Ÿ

- ç»¼åˆâ€œå®•æœºâ€å’Œâ€œdubboç›´è¿â€ï¼Œå¯ä»¥çŸ¥é“ï¼š
  - æ³¨å†Œä¸­å¿ƒæŒ‚äº†ï¼ŒæœåŠ¡è€…å’Œæ¶ˆè´¹è€…å¯ä»¥é€šè¿‡æœ¬åœ°ç¼“å­˜äº’ç›¸é€šä¿¡
  - æ²¡æœ‰æ³¨å†Œä¸­å¿ƒï¼Œå¯ä»¥é€šè¿‡dubboç›´è¿ä½¿ç”¨æœåŠ¡

#### è´Ÿè½½å‡è¡¡

- ç½‘å‹ï¼šå¼ºçƒˆå»ºè®®è¿™é‡Œçœ‹çœ‹æºç ï¼ŒçœŸçš„ä¸éš¾
- ç½‘å‹ï¼šè´Ÿè½½å‡è¡¡ç®—æ³•ç±»ä¼¼nginxï¼Œéšæœº(dubboä¸­é»˜è®¤) è½®è¯¢ æƒé‡ ä¸€è‡´æ€§hash

1ï¼Œè´Ÿè½½å‡è¡¡çš„æµ‹è¯•æ–¹æ³•ï¼Œåœ¨â€œé‡è¯•æ¬¡æ•°â€ç« èŠ‚è®²è¿‡äº†ï¼š

- åœ¨IDEä¸­ä½¿ç”¨**å¤šå¯åŠ¨**çš„æ–¹å¼ï¼Œæ¯æ¬¡åªéœ€è¦ä¿®æ”¹dubboprotocolç‰ˆæœ¬å·ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªæœåŠ¡æä¾›è€…æ¨¡å—å¯åŠ¨å¤šä¸ªç›¸åŒçš„æœåŠ¡ã€‚

2ï¼Œè´Ÿè½½å‡è¡¡å¯ä»¥åœ¨æ¶ˆè´¹è€…æˆ–æœåŠ¡è€…é…ç½®ï¼Œä¾‹å¦‚æ¶ˆè´¹è€…çš„æ¥å£ä½ç½®é…ç½®ï¼š

![image-20230527003241153](springboot.assets/image-20230527003241153.png)

- ç½‘å‹ï¼šå’ŒspringCloudçš„Feignå·®ä¸å¤š

#### æœåŠ¡é™çº§

1ï¼ŒæœåŠ¡é™çº§å¯ä»¥åœ¨dubboadminçš„webé¡µé¢åšé…ç½®ï¼Œä¸»è¦æœ‰ä¸¤ç§æ‰‹æ®µï¼š

![image-20230527004338108](springboot.assets/image-20230527004338108.png)

- å±è”½ï¼š
  - æ•ˆæœï¼šæ¶ˆè´¹è€…è¢«å±è”½åï¼Œå°†ä¸ä¼šå‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œç›´æ¥åœ¨å®¢æˆ·ç«¯è¿”å›ç©ºå¯¹è±¡ï¼›
  - ä½¿ç”¨åœºæ™¯ï¼šæœåŠ¡å™¨èµ„æºä¸å¤Ÿï¼Œtomcatæ€»å…±å°±1000ä¸ªçº¿ç¨‹ï¼ŒæœåŠ¡å™¨æœ‰3000ä¸ªå¹¶å‘è¯·æ±‚ï¼›é‚£ä¹ˆå°±å¯ä»¥åœ¨dubboadminé¡µé¢ä¸Šæ‰‹åŠ¨å±è”½ä¼šè°ƒç”¨æŸäº›ä¸é‡è¦æœåŠ¡çš„æ¶ˆè´¹è€…ï¼Œè®©æœåŠ¡è€…æ‰€åœ¨çš„æœåŠ¡å™¨å‡å°å‹åŠ›ã€‚
- å®¹é”™ï¼š
  - æ•ˆæœï¼šæ¶ˆè´¹è€…è®¾ç½®ä¸ºå®¹é”™åï¼Œå‘èµ·è¿œç¨‹è°ƒç”¨å¤±è´¥çš„è¯ï¼ˆæ¯”å¦‚è¶…è¿‡è®¾ç½®çš„timeoutï¼‰ï¼Œæ‰è¿”å›ç©ºå¯¹è±¡ï¼›å¦‚æœä¸è¿”å›ç©ºå¯¹è±¡ï¼Œåœ¨æ¶ˆè´¹è€…çœ‹æ¥å°±æ˜¯å‡ºç°äº†é”™è¯¯ï¼ˆæ¯”å¦‚é¡µé¢å¯èƒ½ä¼šæ˜¾ç¤ºæŠ¥é”™ï¼‰ã€‚
  - æˆ‘ï¼šä¸ªäººæ„Ÿè§‰è¿™ä¸ªçš„ä½¿ç”¨åœºæ™¯ä¸æ˜¯ä¸ºäº†æœåŠ¡é™çº§ï¼Œè€Œæ˜¯å®ç°é«˜å¯ç”¨ï¼Œå³è°ƒç”¨å¤±è´¥ä¹Ÿä¼šæœ‰è¿”å›å€¼ï¼Œè™½ç„¶è¿”å›å€¼æ˜¯ç©ºçš„ã€‚

#### é›†ç¾¤å®¹é”™&hystrix

1ï¼Œç•¥ã€‚è§csdnç¬”è®°å’Œè§†é¢‘è¯¾ç¨‹ã€‚

- ç½‘å‹ï¼šspringCloudä¸­feignç»„ä»¶é›†æˆäº†hystrix
- ç½‘å‹ï¼šæä¾›è€…é…ç½®äº†å®¹é”™ï¼Œä½†æ˜¯æ²¡æœ‰å®¹é”™æ–¹æ³•ï¼ˆå³è¿œç¨‹è°ƒç”¨å¤±è´¥åæ¶ˆè´¹è€…æ‰§è¡Œçš„æ–¹æ³•ï¼‰ï¼›å®¹é”™æ–¹æ³•æ˜¯åœ¨æ¶ˆè´¹è€…å¤„é…ç½®çš„ã€‚

### dubboåŸç†

#### å‰è¨€-RPCå’ŒnettyåŸç†

1ï¼ŒRPCæ¦‚å¿µ

![image-20230527105720482](springboot.assets/image-20230527105720482.png)

ä¸€æ¬¡å®Œæ•´çš„RPCè°ƒç”¨æµç¨‹ï¼ˆåŒæ­¥è°ƒç”¨ï¼Œå¼‚æ­¥å¦è¯´ï¼‰å¦‚ä¸‹ï¼š

1. **æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰è°ƒç”¨ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ï¼›**
2. client stubæ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼›
3. client stubæ‰¾åˆ°æœåŠ¡åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼›
4. server stubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ï¼›
5. server stubæ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ï¼›
6. æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stubï¼›
7. server stubå°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ï¼›
8. client stubæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼›
9. **æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°æœ€ç»ˆç»“æœã€‚**

dubboåªç”¨äº†ä¸¤æ­¥1å’Œ8ï¼Œä¸­é—´çš„è¿‡ç¨‹æ˜¯é€æ˜çš„çœ‹ä¸åˆ°çš„ã€‚**RPCæ¡†æ¶çš„ç›®æ ‡å°±æ˜¯è¦2~8è¿™äº›æ­¥éª¤éƒ½å°è£…èµ·æ¥**ï¼Œè¿™äº›ç»†èŠ‚å¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä¸å¯è§çš„ã€‚



2ï¼Œnettyã€‚nettyå®ç°æ˜¯åŸºäºjavaçš„nioã€‚bioå’Œnioå¯¹æ¯”å¦‚ä¸‹ï¼š

![image-20230527110711429](springboot.assets/image-20230527110711429.png)

- bioï¼šä»¥ç½‘ç»œioä¸ºä¾‹ï¼Œæ¯ä¸ªè¯·æ±‚è¿›æ¥ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå¼€ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¼€socketï¼‰æ¥å¤„ç†æ•°æ®ï¼Œæ¥è¯»å–socketç»™æˆ‘ä»¬ä¼ æ¥çš„æ•°æ®ï¼Œç„¶åä¼šæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œæœ€åè¿”å›ï¼›æœåŠ¡å™¨å¯èƒ½ä¼šæ”¶åˆ°å¾ˆå¤šçš„è¯·æ±‚æ¥åšæ“ä½œï¼›åœ¨ä¸šåŠ¡é€»è¾‘æ²¡å®Œæˆå‰ï¼Œçº¿ç¨‹æ˜¯ä¸èƒ½é‡Šæ”¾çš„ï¼Œå› ä¸ºå¤§é‡çº¿ç¨‹éƒ½åœ¨é˜»å¡ç­‰å¾…ä¸šåŠ¡é€»è¾‘çš„å®Œæˆï¼Œæ‰€ä»¥æœåŠ¡å™¨æ— æ³•å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚
- nioï¼šé€šè¿‡selectorå»ç›‘å¬å¤šä¸ªsocketï¼›æŸä¸ªé€šé“çš„ä»»ä½•ä¸€ä¸ªçŠ¶æ€å‡†å¤‡å¥½äº†ï¼ˆå³å‘ç”Ÿäº†æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼‰ï¼Œå°±å¯ä»¥é¢å¤–å¼€ä¸€ä¸ªçº¿ç¨‹å»åšè¿™ä¸ªäº‹ï¼Œé¿å…çº¿ç¨‹é˜»å¡æµªè´¹ç³»ç»Ÿèµ„æºã€‚

#### åŸç†1-æ¡†æ¶è®¾è®¡

ç•¥ï¼Œçœ‹å®˜ç½‘æˆ–è€…è§†é¢‘

- çœ‹dubboåŸç†ä¹‹å‰ï¼Œæ„Ÿè§‰å¾—å…ˆçœ‹æ‡‚springåŸç†æ¯”è¾ƒå¥½ï¼ˆæ‰‹å†™ç®€å•çš„springæ¡†æ¶ï¼‰

#### åŸç†2-æ ‡ç­¾è§£æ

ç•¥ï¼Œçœ‹å®˜ç½‘æˆ–è€…è§†é¢‘

#### åŸç†3-æœåŠ¡æš´éœ²

ç•¥

#### åŸç†4-æœåŠ¡å¼•ç”¨

ç•¥

#### åŸç†5-æœåŠ¡è°ƒç”¨

ç•¥

### ç»“æŸè¯­

